/* Copyright Energyworx - Tue Feb 25 2020 10:57:26 GMT+0000 (UTC) */
"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}angular.module("console",["ngAnimate","ngSanitize","ngMessages","ngCookies","ngTouch","ngNumeraljs","angularMoment","as.sortable","angular-cache","duScroll","pascalprecht.translate","ui.router","ui.codemirror","highcharts-ng","angular.filter","moment-picker","ngOnload","dndLists","ngFileUpload","angular-filters","rzModule","base64","jsonFormatter","angular-click-outside","widgetGrid","uiGmapgoogle-maps","ng-split","agGrid","angularTrix","ewx.components","ewx.services","console.core","console.dashboard","console.iam","console.datasources","console.flow-management","console.docs","console.admin","console.help","console.advanced-search","console.tcm","console.file-management","console.release-notes","console.audit-events","console.signup","console.billing","console.market-adapters","console.user","console.decision-tree","console.transport-adapters","console.soap-endpoints","console.channel-classifiers","console.tasks","console.timeslice-groups","console.triggers"]);var debugConfig={};angular.module("console.admin",["console.core"]),angular.module("console.advanced-search",["console.core"]),angular.module("console.docs",["console.core"]),angular.module("console.audit-events",["console.core"]),angular.module("console.billing",["console.core"]),angular.module("console.channel-classifiers",["console.core"]),angular.module("console.dashboard",["console.core"]),angular.module("console.datasources",["console.core"]),angular.module("console.decision-tree",["console.core"]),angular.module("console.file-management",["console.core"]),angular.module("console.flow-management",["console.core"]),angular.module("console.help",["console.core"]),angular.module("console.iam",["console.core"]),angular.module("console.market-adapters",["console.core"]),angular.module("console.release-notes",["console.core"]),angular.module("console.signup",["console.core"]),angular.module("console.soap-endpoints",["console.core"]),angular.module("console.tasks",["console.core"]),angular.module("console.tcm",["console.core"]),angular.module("console.timeslice-groups",["console.core"]),angular.module("console.transport-adapters",["console.core"]),angular.module("console.triggers",["console.core"]),angular.module("console.user",["console.core"]),angular.module("console.datasources",["console.core"]),angular.module("console.datasources",["console.core"]),angular.module("console.datasources",["console.core"]),angular.module("console.datasources",["console.core"]),angular.module("ewx.components",["ewx-components-filters","ewx-components-period-navigation","ewx-components-header-account","ewx-components-header-menu","ewx-components-sheet","ewx-components-navigation","ewx-components-namespace-selector","ewx-components-accordion","ewx-components-feedback-bar","ewx-components-select-click","ewx-components-print","ewx-components-route-class","ewx-components-card-period-navigation","ewx-components-string-to-number","ewx-components-tag-search","ewx-components-rule-search","ewx-components-control-widgets","ewx-components-datasource-properties","ewx-components-flowconfig-search","ewx-components-datetime-zone","ewx-components-drag-pill","ewx-components-tcm-search","ewx-components-combo-box","ewx-components-tabs","ewx-components-dashboard-widget","ewx-components-eql-wizard","ewx-components-upload","ewx-components-datasource-view-configurator","ewx-components-flow-metadata","ewx-components-chart","ewx-components-datasource-navigator","ewx-components-create-virtual-datasource","ewx-components-google-maps","ewx-components-permission","ewx-components-result-table","ewx-components-tag-timeline","ewx-components-channel-classifier-search","ewx-components-icap-nits","ewx-components-tier-table","ewx-components-datasource-classifiers-search","ewx-components-datasource-classifiers-create","ewx-components-billing-account-search","ewx-components-result-list","ewx-components-create-channel-classifier","ewx-components-market-adapters-search","ewx-components-eql-docs","ewx-components-properties-manager","ewx-components-transport-adapters-search","ewx-components-csv-export","ewx-components-drag-scroll","ewx-components-audit-event-search","ewx-components-soap-endpoints-search","ewx-components-label-indicators","ewx-components-grid-table","ewx-components-timeslice-group-search","ewx-components-user-search","ewx-components-task-flow-search","ewx-components-auto-focus","ewx-components-flow-trigger","ewx-components-decision-tree-search","ewx-components-flow-rule-parameters","ewx-components-triggers-search"]),angular.module("console.core",["blocks.router","ui.router"]),angular.module("blocks.router",["ui.router"]),angular.module("ewx-components-accordion",["ewx-components-accordion"]),angular.module("ewx-components-audit-event-search",[]),angular.module("ewx-components-billing-account-search",[]),angular.module("ewx-components-auto-focus",[]),angular.module("ewx-components-card-period-navigation",[]),angular.module("ewx-components-channel-classifier-search",[]),angular.module("ewx-components-chart",[]),angular.module("ewx-components-combo-box",[]),angular.module("ewx-components-control-widgets",[]),angular.module("ewx-components-create-channel-classifier",[]),angular.module("ewx-components-create-virtual-datasource",[]),angular.module("ewx-components-csv-export",[]),angular.module("ewx-components-datasource-classifiers-create",[]),angular.module("ewx-components-datasource-classifiers-search",[]),angular.module("ewx-components-dashboard-widget",[]).filter("strReplace",function(){return function(e,t,a){return t=t||"",a=a||"",(e=e||"").replace(new RegExp(t,"g"),a)}}),angular.module("ewx-components-datasource-navigator",[]),angular.module("ewx-components-datasource-properties",[]),angular.module("ewx-components-datasource-view-configurator",[]),angular.module("ewx-components-datetime-zone",[]),angular.module("ewx-components-decision-tree-search",[]),angular.module("ewx-components-drag-pill",[]),angular.module("ewx-components-drag-scroll",[]),angular.module("ewx-components-eql-docs",[]),angular.module("ewx-components-eql-wizard",[]),angular.module("ewx-components-feedback-bar",["ewx-components-feedback-bar"]),angular.module("ewx-components-filters",[]),angular.module("ewx-components-flow-metadata",[]),angular.module("ewx-components-flow-rule-parameters",[]),angular.module("ewx-components-flow-trigger",[]),angular.module("ewx-components-flowconfig-search",[]),angular.module("ewx-components-google-maps",[]),angular.module("ewx-components-grid-table",[]),angular.module("ewx-components-header-account",[]),angular.module("ewx-components-header-menu",[]),angular.module("ewx-components-icap-nits",[]),angular.module("ewx-components-label-indicators",[]),angular.module("ewx-components-market-adapters-search",[]),angular.module("ewx-components-namespace-selector",[]),angular.module("ewx-components-navigation",[]),angular.module("ewx-components-period-navigation",[]),angular.module("ewx-components-permission",[]),angular.module("ewx-components-print",[]),angular.module("ewx-components-properties-manager",[]),angular.module("ewx-components-result-list",[]),angular.module("ewx-components-result-table",[]),angular.module("ewx-components-route-class",[]),angular.module("ewx-components-rule-search",[]),angular.module("ewx-components-select-click",[]),angular.module("ewx-components-sheet",[]),angular.module("ewx-components-soap-endpoints-search",[]),angular.module("ewx-components-string-to-number",[]),angular.module("ewx-components-tabs",["ewx-components-tabs"]),angular.module("ewx-components-tag-search",[]),angular.module("ewx-components-tag-timeline",[]),angular.module("ewx-components-task-flow-search",[]),angular.module("ewx-components-tcm-search",[]),angular.module("ewx-components-timeslice-group-search",[]),angular.module("ewx-components-tier-table",[]),angular.module("ewx-components-transport-adapters-search",[]),angular.module("ewx-components-triggers-search",[]),angular.module("ewx-components-upload",[]),angular.module("ewx-components-user-search",[]),angular.module("ewx.services",["ewx-services-constants","ewx-services-login","ewx-services-period","ewx-services-tag","ewx-services-user","ewx-services-state","ewx-services-flow","ewx-services-flowconfig","ewx-services-dashboard","ewx-services-rules","ewx-services-datasource","ewx-services-iam","ewx-services-admin","ewx-services-storage","ewx-services-query","ewx-services-share","ewx-services-util","ewx-services-ingest","ewx-services-system","ewx-services-channel","ewx-services-virtualdatasource","ewx-services-chart","ewx-services-marketadapter","ewx-services-aggregation","ewx-services-billing","ewx-services-billing-admin","ewx-services-transportadapter","ewx-services-soap","ewx-services-decision-tree","ewx-services-datapoint","ewx-services-timeslice","ewx-services-tasks","ewx-services-timezones","ewx-services-triggers"]),angular.module("ewx-services-admin",[]),angular.module("ewx-services-billing",[]),angular.module("ewx-services-billing-admin",[]),angular.module("ewx-services-channel",[]),angular.module("ewx-services-chart",[]),angular.module("ewx-services-constants",[]),angular.module("ewx-services-dashboard",[]),angular.module("ewx-services-datapoint",[]),angular.module("ewx-services-datasource",[]),angular.module("ewx-services-flow",[]),angular.module("ewx-services-decision-tree",[]),angular.module("ewx-services-flowconfig",[]),angular.module("ewx-services-iam",[]),angular.module("ewx-services-ingest",[]),angular.module("ewx-services-login",[]),angular.module("ewx-services-marketadapter",[]),angular.module("ewx-services-period",[]),angular.module("ewx-services-query",[]),angular.module("ewx-services-rules",[]),angular.module("ewx-services-share",[]),angular.module("ewx-services-soap",[]),angular.module("ewx-services-state",[]),angular.module("ewx-services-storage",[]),angular.module("ewx-services-system",[]),angular.module("ewx-services-tag",[]),angular.module("ewx-services-tasks",[]),angular.module("ewx-services-timeslice",[]),angular.module("ewx-services-timezones",[]),angular.module("ewx-services-transportadapter",[]),angular.module("ewx-services-triggers",[]),angular.module("ewx-services-user",[]),angular.module("ewx-services-util",[]),angular.module("ewx-services-virtualdatasource",[]),function(){function e(e){e.configureStates([{state:"console.admin",config:{abstract:!0,url:"/admin"}},{state:"console.admin.billing-accounts",config:{url:"/billing-accounts",title:"Billing Accounts",views:{"main@":{templateUrl:"admin/billing-accounts/billing-accounts.html"}}}},{state:"console.admin.billing-accounts.details",config:{url:"/details/:billingAccountId",title:"Billing Account Details",params:{billingAccountId:null},views:{"main@":{templateUrl:"admin/billing-accounts/details/billing-account-details.html",controller:"AdminBillingAccountController",controllerAs:"vm"}}}},{state:"console.admin.namespace",config:{url:"/namespaces",title:"Namespaces",views:{"main@":{templateUrl:"admin/namespace/namespace.html",controller:"AdminNamespaceController",controllerAs:"vm"}}}},{state:"console.admin.namespace.details",config:{url:"/details/:namespaceId",title:"Namespace Details",views:{"sheet-right@":{templateUrl:"admin/namespace/namespace-details.html",controller:"AdminNamespaceDetailsController",controllerAs:"vm"}}}},{state:"console.admin.namespace.create",config:{url:"/create",title:"Namespace Create",views:{"sheet-right@":{templateUrl:"admin/namespace/namespace-create.html",controller:"AdminNamespaceCreateController",controllerAs:"vm"}}}},{state:"console.admin.whitelist",config:{url:"/whitelist",title:"Whitelist",views:{"main@":{templateUrl:"admin/whitelist/whitelist.html",controller:"AdminWhitelistController",controllerAs:"vm"}}}},{state:"console.admin.whitelist.details",config:{title:"Whitelist Details",params:{whitelistedAccount:null},views:{"sheet-right@":{templateUrl:"admin/whitelist/whitelist-details.html",controller:"AdminWhitelistDetailsController",controllerAs:"vm"}}}},{state:"console.admin.whitelist.add",config:{url:"/add",title:"Add to whitelist",views:{"sheet-right@":{templateUrl:"admin/whitelist/addto-whitelist.html",controller:"AdminAddToWhitelistController",controllerAs:"vm"}}}}])}angular.module("console.admin").run(e),e.$inject=["routerHelper"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this,u=e.getEqlHints();c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a";var d=null;CodeMirror.defineMIME("text/x-eql",u);var f={mode:"text/x-eql",extraKeys:{"Ctrl-Space":"autocomplete"},hint:CodeMirror.hint.sql,hintOptions:{tables:{}}};c.isLoadingMetadata=!0,t.eqlMetadata().then(function(e){c.isLoadingMetadata=!1;var t={};e&&e.data&&e.data.tables&&(e.data.tables.forEach(function(e){var a=[];t[e.name]||(e.fields.forEach(function(e){-1===a.indexOf(e.field)&&a.push(e.field)}),t[e.name]=a)}),c.metadata=e.data.tables),angular.extend(f.hintOptions.tables,t)},function(e){c.isLoadingMetadata=!1}),c.queryValidationResponseText="",c.isLoading=!1,c.moreLoading=!1;var m=sessionStorage.getItem("advancedsearchPriority");c.settings=m?{priority:m}:{priority:"batch"},c.cmOption=angular.extend(f,{lineNumbers:!0,indentWithTabs:!0,lineWrapping:!0,readOnly:!1,theme:"ewx-dark"}),c.queryParams={compressed:!0},c.runQuery=function(e){if("invalid"===c.queryValidationStatus)c.errorDialog=!0,c.noResults=!1,c.queryValidationResponseText&&(c.errorMessage=c.queryValidationResponseText);else{c.showCreateVirtualDatasourceButton=!1,c.queryIsCancelled=!1,c.chartDataStructure={},c.noResults=!1,c.errorDialog=!1,c.isLoading=!0,c.queryParams.query=c.cmModel,r.sessionStorage.setItem("advancedSearchInput",c.queryParams.query);var t=void 0;c.queryParams.query?t=c.queryParams.query.trim():c.queryParams.query="",c.queryParams.priority=c.settings.priority,e&&t&&t.length>0&&function(e){c.advancedSearchLatest.forEach(function(t){var a=t.searchParams.trim(),n=e.trim();a===n&&c.advancedSearchLatest.splice(c.advancedSearchLatest.indexOf(t),1)}),c.advancedSearchLatest.push({searchParams:e,timestamp:moment().format()}),c.advancedSearchLatest.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)});c.advancedSearchLatest.length>=19&&(c.advancedSearchLatest=c.advancedSearchLatest.slice(0,20));var t={properties:[{key:"advancedsearchlatest",value:JSON.stringify(c.advancedSearchLatest)}]};c.isSavingSearch=!0,a.updateUserProperties(t).then(function(){c.isSavingSearch=!1},function(){c.isSavingSearch=!1})}(c.queryParams.query),v(c.queryParams,!1)}},c.cancelQuery=function(){d&&(c.queryIsCancelled=!0,d.cancel(),angular.forEach(l.pendingRequests,function(e){e.cancel&&e.timeout&&e.cancel.resolve()}))},c.clearQuery=function(){c.cancelledQuery=!0,c.errorDialog=!1,c.showCreateVirtualDatasourceButton=!1,c.cmModel=""},c.createVirtualDatasource=function(e){c.virtualDatasourceEql=e},c.showMoreResults=function(){if(c.isLoading)return;c.queryParams.pageToken&&(c.moreLoading=!0,v(c.queryParams,!0,!0))},c.applyStoredSearch=function(e){c.cmModel=e,c.resultAvailable=!1,c.noResults=!1},c.setTab=function(e){c.tab=e,r.sessionStorage.setItem("advancedSearchTabIndex",e)},c.tabIsSet=function(e){return c.tab===e},c.addToFavorite=function(e){c.manageUserProperties=!0,c.newPropertyToStore={name:"",description:"",searchParams:c.cmModel}},c.showValidatorInfo=function(){c.showValidatorFeedback=!0},c.hideValidatorInfo=function(){c.showValidatorFeedback=!1},c.toggleSettingsSheet=function(){c.showSettings=!c.showSettings},c.clearSearchHistory=function(e){if(e){c.confirmClearSearchHistory=!1;c.isClearingSearch=!0,a.updateUserProperties({properties:[{key:"advancedsearchlatest",value:"[]"}]}).then(function(){c.isClearingSearch=!1,c.advancedSearchLatest=[],C(s("translate")("feedback.messages.ok"))},function(e){c.isClearingSearch=!1,e.data&&e.data.error&&e.data.error.message?y(s("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):y(s("translate")("feedback.messages.error"))})}else c.confirmClearSearchHistory=!0},r.sessionStorage.getItem("advancedSearchInput")?(c.cmModel=r.sessionStorage.getItem("advancedSearchInput"),w()):c.cmModel="";var g,p=null,h=null;function v(e,a,n){a||(c.queryParams.pageToken=null,c.queryParams.jobId=null),d&&d.cancel(),(d=t.eqlQuery(e)).then(function(e){c.isLoading=!1,c.moreLoading=!1,e&&e.parsed&&e.parsed.length>0?(c.resultAvailable=!0,e.reference&&e.reference.jobId?c.queryParams.jobId=e.reference.jobId:c.queryParams.jobId=null,e.pageToken?c.queryParams.pageToken=e.pageToken:c.queryParams.pageToken=null,a?(e.rows.forEach(function(e){c.data.rows.push(e)}),e.parsed.forEach(function(e){c.data.parsed.push(e)}),c.data.pageToken=e.pagetoken,c.data.reference=e.reference,c.data.metadata=e.metadata):c.data=e,function(e,t){if(e.parsed){var a=!1;t||(e.parsed.forEach(function(e){e.row&&"timestamp"in e.row?(a="timeseries",c.outputVisual="chart"):e.tags||e.flow_id?(a="list",c.outputVisual="list",e.tags&&c.queryParams.query.length>0&&(c.showCreateVirtualDatasourceButton=!0)):c.outputVisual="table",c.context=a}),"timeseries"===a&&function(e){c.chartDataStructure={},e.parsed.forEach(function(e){if(e.row&&e.row.datasource){var t=e.row.datasource.datasource_id;c.chartDataStructure[t]||(c.chartDataStructure[t]={}),e.row.datasource.channel.forEach(function(a){var n=a.channel_classifier_id;c.chartDataStructure[t][n]||(c.chartDataStructure[t][n]={flowId:"",values:[],isSource:!0,visible:!0}),c.chartDataStructure[t][n].deleted=!1,c.chartDataStructure[t][n].values.push([e.row.timestamp,a.value]),c.chartDataStructure[t][n].annotations||(c.chartDataStructure[t][n].annotations=[]),a.annotation.forEach(function(a){S(t,n,e.row.timestamp,a)})})}if(e.row&&e.row.flow){var a=e.row.flow.flow_id;c.chartDataStructure[a]||(c.chartDataStructure[a]={}),e.row.flow.channel.forEach(function(t){var n=t.channel_classifier_id;c.chartDataStructure[a][n]||(c.chartDataStructure[a][n]={flowId:"",values:[],isSource:!0,visible:!0}),c.chartDataStructure[a][n].deleted=!1,c.chartDataStructure[a][n].values.push([e.row.timestamp,t.value]),c.chartDataStructure[a][n].annotations||(c.chartDataStructure[a][n].annotations=[]),t.annotation.forEach(function(t){S(a,n,e.row.timestamp,t)})})}})}(e))}c.rawData=e}(c.data,n)):(c.resultAvailable=!1,c.noResults=!0)},function(e){c.queryIsCancelled||(c.errorDialog=!0,e.data&&e.data.error&&e.data.error.message&&(c.errorMessage=e.data.error.message),c.queryParams.jobId=null),c.isLoading=!1,c.moreLoading=!1,c.resultAvailable=!1,c.showCreateVirtualDatasourceButton=!1})}function S(e,t,a,n){var r=c.chartDataStructure[e][t].annotations.filter(function(e){return e.id===n.annotation&&e.sequenceId===n.sequence_id});0===r.length?c.chartDataStructure[e][t].annotations.push({id:n.annotation,sequenceId:n.sequence_id,values:[[a,n.properties]]}):(r.length,r[0].values.push([a,n.properties]))}function w(){c.refreshCodeMirrorElement=!0,o(function(){c.refreshCodeMirrorElement=!1})}if(i.$watch("vm.cmModel",function(e,a){p&&o.cancel(p),c.queryValidationStatus="validating",p=o(function(){h&&h.cancel();var e={query:c.cmModel,validateOnly:!0};(h=t.eqlQuery(e)).then(function(e){e.reference.errors&&e.reference.errors.length>0?(c.queryValidationResponseText=e.reference.errors[0].message+"\n",c.queryValidationStatus="invalid"):(c.queryValidationStatus="valid",c.errorDialog=!1)},function(e){(400===e.status||404===e.status)&&e.data&&e.data.error&&e.data.error.message?(c.queryValidationResponseText=e.data.error.message,c.queryValidationStatus="invalid"):c.queryValidationStatus="unavailable"})},800)}),g=!0,c.userPropertiesLoading=!0,c.advancedSearchLatest=[],c.advancedSearchFavorites=[],a.getUser(g).then(function(e){if(c.userPropertiesLoading=!1,e.properties){var t=e.properties.filter(function(e){return"advancedsearchlatest"===e.key.toLowerCase()}),a=e.properties.filter(function(e){return"advancedsearchfavorites"===e.key.toLowerCase()});t&&t.length>0&&(c.advancedSearchLatest=JSON.parse(t[0].value),c.advancedSearchLatest.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)})),a&&a.length>0&&(c.advancedSearchFavorites=JSON.parse(a[0].value),c.advancedSearchFavorites.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)}))}},function(){c.userPropertiesLoading=!1}),a.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time)},function(e){}),r.sessionStorage.getItem("advancedSearchTabIndex")){var T=r.sessionStorage.getItem("advancedSearchTabIndex");c.tab=parseInt(T,10)}else c.tab=0;function C(e,t){n.addMessage({type:t,message:e})}function y(e){C(e,"error")}angular.element(r).bind("keydown",function(e){e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),c.runQuery(!0))}),i.$on("$destroy",function(){d&&d.cancel(),angular.element(r).unbind("keydown")}),angular.element(r).bind("keydown",function(e){27===e.keyCode&&(c.docsVisible||c.manageUserProperties||c.showSettings)&&(e.preventDefault(),c.docsVisible=!1,c.manageUserProperties=!1,c.showSettings=!1,i.$evalAsync()),c.showValidatorFeedback&&(c.showValidatorFeedback=!1)}),angular.element(document).ready(function(){w()}),i.$watch("vm.settings.priority",function(e,t){e!==t&&sessionStorage.setItem("advancedsearchPriority",c.settings.priority)})}angular.module("console.advanced-search").config(["JSONFormatterConfigProvider",function(e){e.hoverPreviewEnabled=!0}]).controller("AdvancedSearchController",e),e.$inject=["ConstantsService","QueryService","UserService","feedbackService","$window","$scope","$timeout","$filter","$http"]}(),function(){function e(e){e.configureStates([{state:"console.advanced-search",config:{url:"/advanced-search/",title:"Advanced Search",views:{"main@":{templateUrl:"advanced-search/advanced-search.html",controller:"AdvancedSearchController",controllerAs:"vm"}}}}])}angular.module("console.advanced-search").run(e),e.$inject=["routerHelper"]}(),function(){function e(){this.docsUrl="/docs",active_namespace_id&&(this.docsUrl+="?namespace="+active_namespace_id)}angular.module("console.docs").controller("DocsController",e),e.$inject=[]}(),function(){function e(e){e.configureStates([{state:"console.docs",config:{url:"/apidocs",title:"API docs",views:{"main@":{templateUrl:"apidocs/docs.html",controller:"DocsController",controllerAs:"vm"}}}}])}angular.module("console.docs").run(e),e.$inject=["routerHelper"]}(),function(){function e(e,t){e.configureStates([{state:"console.audit-events",config:{url:"/audit-events",title:"Audit Events",views:{"main@":{templateUrl:"audit-events/audit-events.html"}}}},{state:"console.audit-events.details",config:{title:"Audit Details",params:{event:null},views:{"sheet-right@":{templateUrl:"audit-events/details/audit-events-details.html",controller:"AuditEventDetailsController",controllerAs:"vm"}}}}])}angular.module("console.audit-events").run(e),e.$inject=["routerHelper","$state"]}(),function(){function e(e,t){e.configureStates([{state:"console.billing",config:{abstract:!0,url:"/billing"}},{state:"console.billing.account",config:{url:"/account",title:"Billing Account",views:{"main@":{templateUrl:"billing/account/billing-account.html",controller:"BillingAccountController",controllerAs:"vm"}}}},{state:"console.billing.overview",config:{url:"/overview",title:"Billing Overview",views:{"main@":{templateUrl:"billing/overview/billing-overview.html",controller:"BillingOverviewController",controllerAs:"vm"}}}}])}angular.module("console.billing").run(e),e.$inject=["routerHelper","$state"]}(),function(){function e(e,t,a){var n=this;n.toggleCreate=function(){n.createSheet=!n.createSheet},angular.element(t).bind("keydown",function(t){27===t.keyCode&&"console.channel-classifiers"===a.current.name&&(t.preventDefault(),e.$apply(function(){n.createSheet=!1}))}),e.$on("$destroy",function(){angular.element(t).unbind("keydown")})}angular.module("console.channel-classifiers").controller("ChannelClassifiersController",e),e.$inject=["$scope","$window","$state"]}(),function(){function e(e){e.configureStates([{state:"console.channel-classifiers",config:{url:"/channel-classifiers",title:"Channel Classifiers",views:{"main@":{templateUrl:"channel-classifiers/channel-classifiers.html",controller:"ChannelClassifiersController",controllerAs:"vm"}}}}])}function t(){return[{state:"console.channel-classifiers",config:{url:"/channel-classifiers",title:"Channel Classifiers",views:{"main@":{templateUrl:"channel-classifiers/channel-classifiers.html",controller:"ChannelClassifiersController",controllerAs:"vm"}}}}]}angular.module("console.channel-classifiers").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),angular.module("console.dashboard").constant("DataScoreChartConfig",{colors:["#019beb"],chart:{height:380,type:"scatter",zoomType:"xy",resetZoomButton:{position:{align:"right",verticalAlign:"top"},relativeTo:"chart"},margin:[20,0,80,60]},boost:{useGPUTranslations:!0,usePreAllocated:!0},legend:{enabled:!0},yAxis:{title:{text:"Score"},max:100,min:0},xAxis:{type:"datetime",title:{text:"Date"},startOnTick:!0,endOnTick:!0,showLastLabel:!0},tooltip:{shared:!1,headerFormat:"",followPointer:!1,pointFormat:"<strong>{series.name}</strong>: {point.y:.2f}% <br> <strong>Account</strong>: {point.name}",footerFormat:"<br>{point.x:%e %b %Y}"},plotOptions:{scatter:{marker:{radius:3,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}}},series:{cursor:"pointer",point:{events:{click:function(){location.href="/#!/datasources/"+this.name}}}}},series:[],exporting:{enabled:!1},title:{text:""},credits:{enabled:!1}}).constant("DataFlowChartConfig",{colors:["#019beb","#014e76"],chart:{height:380,type:"areaspline",margin:[20,0,80,60]},tooltip:{shared:!0},legend:{enabled:!0},yAxis:{title:{text:"Activity"}},xAxis:{type:"datetime",title:{text:"Date"},startOnTick:!0,endOnTick:!0,showLastLabel:!0},series:[],exporting:{enabled:!1},title:{text:""},credits:{enabled:!1}}),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;c.tab=0,c.columns=30,c.rows=20,c.editable=!1,c.options={showGrid:!1,highlightNextPosition:!1},w(),window.onresize=w,c.addWidget=function(e){var t=new l;t.setTitle("Untitled"),e.full||e.config.push(t)},c.removeWidget=function(e,t){var a=e.config.indexOf(t);a>-1&&e.config.splice(a,1)},c.toggleEditable=function(e){e&&c.originalDashboards?(c.dashboards=c.originalDashboards,c.originalDashboards=null,c.tab>=c.dashboards.length?C(0):C(c.tab)):c.originalDashboards=angular.copy(c.dashboards);c.editable=!c.editable,c.options.showGrid=c.editable},c.saveDashboardConfig=S,c.addDashboardTab=function(){var e={name:"New Tab",config:angular.copy(g)};c.dashboards.push(e),C(c.dashboards.length-1),n(function(){var e=document.getElementById("dashboardTabsScroll");e.scrollLeft=e.scrollWidth},100)},c.deleteDashboardTab=function(e){delete c.dashboards[e],c.dashboards=c.dashboards.filter(function(e){return void 0!==e}),C(0),S(!1)},c.setTab=C,c.tabIsSet=function(e){return c.tab===e},c.updateLocalStorage=T;var u=new l;u.setPosition({top:1,height:10,left:1,width:15}),u.setTitle("Widget 1");var d=new l;d.setPosition({top:1,height:10,left:16,width:15}),d.setTitle("Widget 2");var f=new l;f.setPosition({top:11,height:10,left:1,width:15}),f.setTitle("Widget 3");var m=new l;m.setPosition({top:11,height:10,left:16,width:15}),m.setTitle("Widget 4");var g=[u,d,f,m],p=r.localStorage.getItem(active_namespace_id+"_dashboardconfig");if(p){var h=JSON.parse(p);h.namespace===active_namespace_id?(c.dashboards=h.dashboard,s.dashboardIndex&&s.dashboardIndex<c.dashboards.length&&(c.tab=Number(s.dashboardIndex))):v()}else v();function v(){c.dashboardLoading=!0,e.getUser(!0).then(function(e){var t=!0;if(e.properties){var a=e.properties.filter(function(e){return"dashboardconfig"===e.key.toLowerCase()});a&&a.length>0&&(c.dashboards=JSON.parse(a[0].value),t=!1,s.dashboardIndex&&s.dashboardIndex<c.dashboards.length&&(c.tab=Number(s.dashboardIndex)))}t&&(c.dashboards=[{name:"Dashboard",full:!1,config:angular.copy(g)}]),c.dashboardLoading=!1,T()},function(){c.dashboardLoading=!1,k(o("translate")("feedback.messages.error"))})}function S(t,a,n){if(c.isSaving=!0,a&&!c.dashboardForm.$valid)return c.isSaving=!1,!1;T();var r=angular.copy(c.dashboards);r.forEach(function(e){e.config.forEach(function(e){e.fromCache&&(e.fromCache=null,e.fromCacheTimeStamp=null)})});var s={properties:[{key:"dashboardconfig",value:JSON.stringify(r)}]};e.updateUserProperties(s).then(function(){c.isSaving=!1,t&&y(o("translate")("feedback.messages.ok")),c.toggleEditable(),n&&i.reload()},function(){c.isSaving=!1,k(o("translate")("feedback.messages.error"))})}function w(){n(function(){var e=document.getElementById("dashboard-grid");e&&(c.gridWidth=e.clientWidth,c.gridHeight=e.clientHeight)})}function T(){c.dashboards.forEach(function(e){e.config&&e.config.length>0&&e.config.forEach(function(e){e.fromCache&&e.fromCache.results&&e.fromCache.results.length>5e3&&delete e.fromCache})}),r.localStorage.setItem(active_namespace_id+"_dashboardconfig",JSON.stringify({namespace:active_namespace_id,dashboard:c.dashboards}))}function C(e){c.tab=e}function y(e,a){t.addMessage({type:a,message:e})}function k(e){y(e,"error")}a.$on("wg-grid-full",function(e){e.targetScope.$parent.dashboard.full||(e.targetScope.$parent.dashboard.full=!0)}),a.$on("wg-grid-space-available",function(e){e.targetScope.$parent.dashboard.full&&(e.targetScope.$parent.dashboard.full=!1)}),a.$on("wg-update-position",function(e,t){})}angular.module("console.dashboard").controller("DashboardController",e),e.$inject=["UserService","feedbackService","$scope","$timeout","$window","$state","$filter","$stateParams","DashboardWidget"]}(),function(){function e(e){e.configureStates([{state:"console.dashboard",config:{url:"/dashboard",title:"Dashboard",params:{dashboardIndex:"0",loadFromLocalStorage:null},views:{"main@":{templateUrl:"dashboard/dashboard.html",controller:"DashboardController",controllerAs:"vm"}}}},{state:"console.dashboard.widget",config:{title:"Widget Setup",params:{widgetConfig:null,dashboardIndex:null,fromCache:null},views:{"modal@":{templateUrl:"dashboard/widget-setup/widget-setup.html",controller:"WidgetSetupController",controllerAs:"vm"}}}},{state:"console.dashboard.widgetFullscreen",config:{title:"Fullscreen",params:{widget:null,dashboardIndex:null,fromCache:null},views:{"modal@":{templateUrl:"dashboard/widget-fullscreen/widget-fullscreen.html",controller:"WidgetFullscreenController",controllerAs:"vm"}}}}])}angular.module("console.dashboard").run(e),e.$inject=["routerHelper"]}(),angular.module("console.dashboard").factory("DashboardWidget",function(){return function(){function e(){_classCallCheck(this,e),this.isLoading=!1,this.configured=!1,this.isValidated=!1,this.isTestable=!1,this.isRecipe=!1,this.title="",this.description="",this.view={type:"list",dataType:"datasource",dataOptions:[]},this.period={periodType:"dynamic",static:{startTimestamp:(new Date).toISOString(),endTimestamp:(new Date).toISOString()},dynamic:{end:{subtractionValue:0,subtractionUnit:"days"},start:{subtractionValue:3,subtractionUnit:"days"}}},this.queries=[],this.limit=10,this.position={}}return _createClass(e,[{key:"setPosition",value:function(e){this.position=e}},{key:"setTitle",value:function(e){this.title=e}},{key:"validate",value:function(){this.isValidated=!0}},{key:"toJSON",value:function(){return{isLoading:this.isLoading,configured:this.configured,isValidated:this.isValidated,isTestable:this.isTestable,isRecipe:this.isRecipe,title:this.title,description:this.description,view:this.view,period:this.period,queries:this.queries,limit:this.limit,position:this.position}}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}()}),function(){function e(e,t,a){var n=this;n.activeSearch="",n.searchFilters="";var r=["currentSearchInput","activeSearch"];e.$on("$destroy",function(){a.save("DatasourcesController",n,r)}),n.combineToView=function(e){n.combineViewDatasources=[],angular.forEach(e,function(e){n.combineViewDatasources.push(e)})},n.showHelp=function(){t.go(t.current.name+".help")},n.searchTermChanged=function(e,a){n.searchFilters=e,0===n.searchFilters.length&&(n.searchFilters=""),n.activeSearch=a,t.transitionTo("console.datasources",{active:n.activeSearch,searchFilters:n.searchFilters},{notify:!1,location:"replace"})},n=a.load("DatasourcesController",n,r),t.params.searchInput&&""!==t.params.searchInput?(n.searchInput=t.params.searchInput,n.currentSearchInput=t.params.searchInput):n.searchInput=n.currentSearchInput,t.params.searchFilters&&""!==t.params.searchFilters&&(n.searchFilters=t.params.searchFilters),t.params.searchOnLoad&&""!==t.params.searchOnLoad&&(n.searchOnLoad=t.params.searchOnLoad)}angular.module("console.datasources").controller("DatasourcesController",e),e.$inject=["$scope","$state","StateService"]}(),function(){function e(e){e.configureStates([{state:"console.datasources",config:{url:"/datasources?searchInput&searchFilters",title:"Datasources",params:{searchOnLoad:null},views:{"main@":{templateUrl:"datasources/datasources.html",controller:"DatasourcesController",controllerAs:"vm"}}}},{state:"console.datasources.view",config:{url:"/view/builder?datasourceIds&channels&startTime&endTime&timezone",title:"Datasources Viewer",params:{datasourceIds:null,channels:null,startTime:null,endTime:null,timezone:null,prevState:null,prevStateId:null},views:{"main@":{templateUrl:"datasources/view/datasources-view.html",controller:"DatasourcesViewController",controllerAs:"vm"}}}},{state:"console.datasources.collection",config:{url:"/view/collection",title:"Datasource Collection",views:{"main@":{templateUrl:"datasources/collected/collected-datasources.html",controller:"CollectedDatasourcesController",controllerAs:"vm"}}}},{state:"console.datasources.tag-management",config:{url:"/tags/management",title:"Tag Management",params:{collection:null,datasources:null},views:{"main@":{templateUrl:"datasources/tag-management/tag-management.html",controller:"TagManagementController",controllerAs:"vm"}}}},{state:"console.datasources-classifiers",config:{url:"/datasource-classifiers",title:"Datasource Classifiers",views:{"main@":{templateUrl:"datasources/classifiers/classifiers.html",controller:"DatasourceClassifiersController",controllerAs:"vm"}}}}])}angular.module("console.datasources").run(e),e.$inject=["routerHelper"]}(),function(){function e(e){e.configureStates([{state:"console.decision-tree",config:{url:"/decision-trees",title:"Decision Trees",views:{"main@":{templateUrl:"decision-tree/decision-tree.html"}}}},{state:"console.decision-tree.details",config:{url:"/details/:decisionTreeId",title:"Decision Tree",params:{decisionTree:null},views:{"main@":{templateUrl:"decision-tree/details/decision-tree-details.html",controller:"DecisionTreeDetailsController",controllerAs:"vm"}}}},{state:"console.decision-tree.create",config:{url:"/create",title:"Create Decision Tree",views:{"main@":{templateUrl:"decision-tree/create/create-decision-tree.html",controller:"CreateDecisionTreeController",controllerAs:"vm"}}}}])}angular.module("console.decision-tree").run(e),e.$inject=["routerHelper"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;function u(){var e=o.sessionStorage.getItem("searchFilesCriteria");if(e&&(c.searchCriteria=JSON.parse(e),c.searchCriteria.marketAdapterId&&(c.moreSearchOptions=!0),c.searchCriteria.createdDate)){c.createdDateActive=!0,c.moreSearchOptions=!0;var t=moment(c.searchCriteria.createdDate,"YYYY-MM-DD").format("YYYY");c.years.forEach(function(e,a){parseFloat(t)===e&&(c.selectedYear=e)})}l.updatedResults?(c.storedFiles.items=l.updatedResults,c.pageToken=l.originalPageToken,c.moreResultsAvailable=l.originalMoreResultsAvailable,c.limitQuantity=l.originalLimitQuantity,c.searchActive=!1):d(c.searchCriteria),v()}function d(t,a){if(t=angular.copy(t),c.isLoading=!0,t.tags)if("string"==typeof t.tags){t.tags=t.tags.split(",");for(var n=0;n<t.tags.length;n++)t.tags[n]=t.tags[n].trim()}else for(var i=0;i<t.tags.length;i++)t.tags[i]=t.tags[i].trim();r(function(){e.searchFiles(t,a).then(function(e){e.data.items&&(a?(c.storedFiles.items=c.storedFiles.items.concat(e.data.items),c.limitQuantity+=e.data.items.length):(c.storedFiles=e.data,c.limitQuantity=e.data.items.length)),c.pageToken=e.data.pageToken,c.moreResultsAvailable=e.data.more,c.isLoading=!1,c.searchActive=!1},function(e){c.isLoading=!1,c.searchActive=!1})},500)}function f(){c.searchCriteria.tags||delete c.searchCriteria.tags,c.searchCriteria.filename||delete c.searchCriteria.filename,c.searchCriteria.marketAdapterId||delete c.searchCriteria.marketAdapterId,c.searchCriteria.createdDate&&c.createdDateActive||delete c.searchCriteria.createdDate,delete c.searchCriteria.pageToken,c.createdDateActive&&(c.searchCriteria.createdDate=moment(c.selectedYear+"-"+c.selectedMonth.month+"-"+c.selectedDay.day,"YYYY-MMMM-D").format("YYYY-MM-DD")),c.searchActive=!0,c.storedFiles.items=null,o.sessionStorage.setItem("searchFilesCriteria",JSON.stringify(c.searchCriteria)),m(),d(c.searchCriteria)}function m(){c.storedFiles&&c.storedFiles.items&&c.storedFiles.items.forEach(function(e){e.selected=!1})}function g(){c.showUpload=!c.showUpload,c.showUpload||f()}function p(){c.selectedFiles=[],c.selectedReadOnlyFiles=[],c.storedFiles.items.forEach(function(e){e.selected&&c.selectedFiles.push(e)}),c.selectedFiles.forEach(function(e){e.readOnly&&c.selectedReadOnlyFiles.push(e)})}function h(){c.searchMarketAdaptersActive=!c.searchMarketAdaptersActive}function v(){var e=moment.months(),t=moment().format("MMMM");if(c.months=[],e.forEach(function(e,a){var n=moment(c.selectedYear+"-"+e,"YYYY-MMMM"),r=moment().isBefore(n);c.months.push({month:e,disabled:r}),e!==t||c.searchCriteria.createdDate||(c.selectedMonth=c.months[a])}),c.searchCriteria.createdDate){var a=moment(c.searchCriteria.createdDate,"YYYY-MM-DD").format("MMMM");c.months.forEach(function(e,t){a===e.month&&(c.selectedMonth=e)})}S()}function S(){for(var e=moment(c.selectedYear+"-"+c.selectedMonth.month,"YYYY-MMM").daysInMonth(),t=[],a=1;a<=e;a++){var n=moment(c.selectedYear+"-"+c.selectedMonth.month+"-"+a,"YYYY-MMM-D"),r=moment().isBefore(n);t.push({day:a,name:a,disabled:r})}if(c.days=t,c.searchCriteria.createdDate){var i=moment(c.searchCriteria.createdDate,"YYYY-MM-DD").format("D");c.days.forEach(function(e,t){parseFloat(i)===e.day&&(c.selectedDay=e)})}else c.selectedDay=c.days[0]}function w(e,t){a.addMessage({type:t,message:e})}c.isLoading=!1,c.storedFiles=[],c.folders=[],c.selectedFolder="UPLOAD",c.selectedFiles=[],c.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],c.searchCriteria={},c.searchCriteria.limit=20,c.searchActive=!0,c.showDeleteFilesConfirmation=!1,c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",c.years=function(e){var t=(new Date).getFullYear(),a=[];e=e||1980;for(;e<=t;)a.push(e++);return a}("2018"),c.selectedYear=moment().year(),c.createdDateActive=!1,c.filesUploaded=function(){g(),f()},c.loadMoreFiles=function(){d(c.searchCriteria,c.pageToken)},c.deleteFile=function(t,a){a?(t.showFileDeleteConfirmation=!1,t.disableControls=!0,e.deleteFile(t.blobKey).then(function(){var e=c.storedFiles.items.filter(function(e){return e.blobKey===t.blobKey});e&&1===e.length&&(t.isRemoving=!0,r(function(){t.disableControls=!1,c.storedFiles.items.splice(c.storedFiles.items.indexOf(e[0]),1),c.limitQuantity--},235))},function(e){t.disableControls=!1})):t.showFileDeleteConfirmation=!0},c.deleteFiles=function(){c.deletingFiles=!0;var t=[];c.storedFiles.items.forEach(function(e){e.selected&&!e.readOnly&&t.push(e.blobKey)});var a=[];for(;t.length>0;)a.push(t.splice(0,15));var n=0;a.forEach(function(t){n++,function(t,a,n){e.deleteFile(t).then(function(){a===n&&r(function(){c.deletingFiles=!1,w(s("translate")("feedback.messages.deleted")),c.limitQuantity=c.storedFiles.items.length,c.showDeleteFilesConfirmation=!1,c.moreResultsAvailable&&0===c.storedFiles.items.length?d(c.searchCriteria,c.pageToken):d(c.searchCriteria)},3e3)},function(e){c.deletingFiles=!1,w(s("translate")("feedback.messages.error"),"error")})}(t.join(),a.length,n)})},c.toggleUpload=g,c.selectAll=function(){c.storedFiles.items.forEach(function(e){e.selected=!0})},c.unSelectAll=m,c.searchFiles=f,c.toggleDeleteConfirmation=function(){p(),c.showDeleteFilesConfirmation=!c.showDeleteFilesConfirmation},c.toggleDeleteFileConfirmation=function(e){e.showFileDeleteConfirmation=!e.showFileDeleteConfirmation},c.selectedFilesAction=function(e){p(),i.go(e,{files:c.selectedFiles,results:c.storedFiles.items,pageToken:c.pageToken,moreResultsAvailable:c.moreResultsAvailable,limitQuantity:c.limitQuantity})},c.downloadFile=function(e){o.open(e+"?namespace_id="+active_namespace_id)},c.ingestSelectedFiles=function(){p(),i.go("console.file-management.ingest",{files:c.selectedFiles})},c.assignMarketAdapter=function(){p(),i.go("console.file-management.assign-market-adapter",{files:c.selectedFiles})},c.toggleSearchMarketAdapter=h,c.setSelectedMarketAdapter=function(e){c.searchCriteria.marketAdapterId=e.id,h()},c.getDaysInMonth=S,c.getMonthsInYear=v,c.disableCreatedDateSearch=function(){c.createdDateActive&&(c.createdDateActive=!1,f())},t.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time),c.userSettings.defaultChunkSize&&(c.searchCriteria.limit=c.userSettings.defaultChunkSize),u()},function(e){u()}),n.$watch("vm.storedFiles.items",function(){!c.isLoading&&c.storedFiles.items&&(c.selectedFilesDetected=!1,c.storedFiles.items.forEach(function(e){e.selected&&(c.selectedFilesDetected=!0)}),"console.file-management.add-tags"!==i.current.name&&"console.file-management.remove-tags"!==i.current.name||i.go("console.file-management"))},!0)}angular.module("console.file-management").controller("FileManagementController",e),e.$inject=["StorageService","UserService","feedbackService","$scope","$timeout","$state","$window","$filter","$stateParams"]}(),function(){function e(e){e.configureStates([{state:"console.file-management",config:{url:"/files/",title:"File Management",params:{updatedResults:null,originalPageToken:null,originalMoreResultsAvailable:null,originalLimitQuantity:null},views:{"main@":{templateUrl:"file-management/file-management.html",controller:"FileManagementController",controllerAs:"vm"}}}},{state:"console.file-management.details",config:{title:"File Details",params:{file:null},views:{"sheet-right@":{templateUrl:"file-management/file-details/file-details.html",controller:"FileManagementDetailsController",controllerAs:"vm"}}}},{state:"console.file-management.ingest",config:{title:"Ingest File",params:{files:null},views:{"sheet-right@":{templateUrl:"file-management/file-ingest/file-ingest.html",controller:"FileManagementIngestController",controllerAs:"vm"}}}},{state:"console.file-management.add-tags",config:{title:"Add Tags",params:{files:null,results:null,pageToken:null,moreResultsAvailable:null,limitQuantity:null},views:{"sheet-right@":{templateUrl:"file-management/add-tags/add-tags.html",controller:"FileManagementAddTagsController",controllerAs:"vm"}}}},{state:"console.file-management.remove-tags",config:{title:"Remove Tags",params:{files:null,results:null,pageToken:null,moreResultsAvailable:null,limitQuantity:null},views:{"sheet-right@":{templateUrl:"file-management/remove-tags/remove-tags.html",controller:"FileManagementRemoveTagsController",controllerAs:"vm"}}}},{state:"console.file-management.assign-market-adapter",config:{title:"Assign Market Adapter",params:{files:null},views:{"sheet-right@":{templateUrl:"file-management/assign-market-adapter/assign-market-adapter.html",controller:"FileManagementAssignMarketAdapterController",controllerAs:"vm"}}}}])}angular.module("console.file-management").run(e),e.$inject=["routerHelper"]}(),function(){function e(e){e.configureStates([{state:"console.flow-design",config:{url:"/flow-management/flow-designs",title:"Flow Designs",views:{"main@":{templateUrl:"flow-management/flow-designs/flow-designs.html"}}}},{state:"console.flow-design.details",config:{url:"/details/:configId",title:"Flow Design",params:{datasourceId:null,channelId:null},views:{"main@":{templateUrl:"flow-management/flow-designs/details/flow-design-details.html",controller:"FlowDesignDetailsController",controllerAs:"vm"}}}},{state:"console.flow-design.details.start-flow",config:{url:"/start-flow?searchInput&searchFilters",title:"Start Flow",views:{"main@":{templateUrl:"flow-management/flow-designs/details/flow-design-start-flow.html",controller:"FlowDesignStartFlowController",controllerAs:"vm"}}}},{state:"console.flow-design.new",config:{url:"/new-flow-design",title:"New Flow Design",params:{copiedFlowConfig:null,datasourceId:null,channelId:null},views:{"main@":{templateUrl:"flow-management/flow-designs/details/flow-design-details.html",controller:"FlowDesignDetailsController",controllerAs:"vm"}}}},{state:"console.search-flows",config:{url:"/search-flows",title:"Search Flows",params:{execSearch:null,eqlConfig:null},views:{"main@":{templateUrl:"flow-management/search-flows/search-flows.html",controller:"SearchFlowsController",controllerAs:"vm"}}}},{state:"console.flow-rules-management",config:{url:"/rule-management/rules",title:"Manage Rules",views:{"main@":{templateUrl:"flow-management/rules/rules.html",controller:"RulesOverviewController",controllerAs:"vm"}}}},{state:"console.flow-rules-management.create",config:{url:"/create",title:"Create Rule",views:{"main@":{templateUrl:"flow-management/rules/mutate-rule/mutate-rule.html",controller:"MutateRuleController",controllerAs:"vm"}}}},{state:"console.flow-rules-management.edit",config:{url:"/edit/:ruleType/:ruleName",title:"Edit Rule",params:{prevStateFlowConfig:null},views:{"main@":{templateUrl:"flow-management/rules/mutate-rule/mutate-rule.html",controller:"MutateRuleController",controllerAs:"vm"}}}}])}angular.module("console.flow-management").run(e),e.$inject=["routerHelper"]}(),function(){function e(e,t){t.get().forEach(function(t){var a;e.configureStates([{state:(a=t.name)+".help-overview",config:{title:"Help",views:{"sheet-right@":{templateUrl:"help/help.html"}}}},{state:a+".help-search",config:{title:"Search Help",views:{"sheet-right@":{controller:"HelpSearchController",controllerAs:"vm",templateUrl:"help/search/search.html"}}}}])})}angular.module("console.help").run(e),e.$inject=["routerHelper","$state"]}(),function(){function e(e){e.configureStates([{state:"console.iam",config:{abstract:!0,url:"/iam"}},{state:"console.iam.users",config:{url:"/users",title:"Users",views:{"main@":{templateUrl:"iam/users/users.html",controller:"IamUsersController",controllerAs:"vm"}}}},{state:"console.iam.users.detail",config:{url:"/:userId",title:"User Details",views:{"sheet-right@":{templateUrl:"iam/users/user-details.html",controller:"IamUserDetailsController",controllerAs:"vm"}}}},{state:"console.iam.users.group",config:{url:"/group/:groupId",title:"Users by group",params:{groupName:null},views:{"main@":{templateUrl:"iam/users/users.html",controller:"IamUsersController",controllerAs:"vm"}}}},{state:"console.iam.users.group.detail",config:{url:"/:userId",title:"User Details",views:{"sheet-right@":{templateUrl:"iam/users/user-details.html",controller:"IamUserDetailsController",controllerAs:"vm"}}}},{state:"console.iam.groups",config:{url:"/groups",title:"Groups",views:{"main@":{templateUrl:"iam/groups/groups.html",controller:"IamGroupsController",controllerAs:"vm"}}}},{state:"console.iam.groups.detail",config:{url:"/details/:groupId",title:"Group Details",views:{"main@":{templateUrl:"iam/groups/group-details.html",controller:"IamGroupDetailsController",controllerAs:"vm"}}}},{state:"console.iam.groups.create",config:{url:"/create",title:"Create Group",views:{"main@":{templateUrl:"iam/groups/group-details.html",controller:"IamGroupDetailsController",controllerAs:"vm"}}}},{state:"console.iam.whitelist",config:{url:"/whitelist",title:"Whitelist",views:{"main@":{templateUrl:"iam/whitelist/whitelist.html",controller:"WhitelistController",controllerAs:"vm"}}}},{state:"console.iam.whitelist.add",config:{url:"/add",title:"Add to whitelist",views:{"sheet-right@":{templateUrl:"iam/whitelist/addto-whitelist.html",controller:"AddToWhitelistController",controllerAs:"vm"}}}},{state:"console.iam.whitelist.details",config:{params:{whitelistedAccount:null},title:"Details",views:{"sheet-right@":{templateUrl:"iam/whitelist/whitelist-details.html",controller:"WhitelistDetailsController",controllerAs:"vm"}}}}])}angular.module("console.iam").run(e),e.$inject=["routerHelper"]}(),angular.module("console.market-adapters").constant("FileRegexOptions",[{name:"Excel File",regex:"^.*.(xlsx|XLSX|xls|XLS)$"},{name:"CSV File",regex:"^.*.(csv|CSV)$"},{name:"Zip File",regex:"^.*.(zip|ZIP)$"}]),function(){function e(e){e.configureStates([{state:"console.market-adapters",config:{url:"/market-adapters",title:"Market Adapters",views:{"main@":{templateUrl:"market-adapters/market-adapters.html"}}}},{state:"console.market-adapters.details",config:{url:"/details/:marketAdapterId",title:"Market Adapter",params:{marketAdapter:null},views:{"main@":{templateUrl:"market-adapters/details/market-adapters-details.html",controller:"MarketAdapterDetailsController",controllerAs:"vm"}}}},{state:"console.market-adapters.create",config:{url:"/create",title:"Create Market Adapter",params:{copiedMarketAdapter:null},views:{"main@":{templateUrl:"market-adapters/create/market-adapters-create.html",controller:"MarketAdapterCreateController",controllerAs:"vm"}}}}])}function t(){return[{state:"console.market-adapters",config:{url:"/market-adapters",title:"Market Adapters",views:{"main@":{templateUrl:"market-adapters/market-adapters.html"}}}},{state:"console.market-adapters.details",config:{url:"/details/:marketAdapterId",title:"Market Adapter",params:{marketAdapter:null},views:{"main@":{templateUrl:"market-adapters/details/market-adapters-details.html",controller:"MarketAdapterDetailsController",controllerAs:"vm"}}}},{state:"console.market-adapters.create",config:{url:"/create",title:"Create Market Adapter",params:{copiedMarketAdapter:null},views:{"main@":{templateUrl:"market-adapters/create/market-adapters-create.html",controller:"MarketAdapterCreateController",controllerAs:"vm"}}}}]}angular.module("console.market-adapters").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),function(){function e(e,t,a){var n=this;function r(t){var a={limit:100};t&&(a.pageToken=t),e.getReleaseNotes(a).then(function(e){var t=e.data;t.releases&&t.releases.forEach(function(e){n.listing.push(e)}),t.pageToken?r(t.pageToken):n.isLoading=!1},function(e){n.isLoading=!1,n.errorDialog=!0})}n.isLoading=!0,n.errorDialog=!1,n.resultLimit=20,n.resultLimitDefault=20,n.listing=[],n.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",n.updateStorageSearchKey=function(){a.sessionStorage.setItem("releaseNotesSearchKey",n.filterListing)},a.sessionStorage.getItem("releaseNotesSearchKey")&&(n.filterListing=a.sessionStorage.getItem("releaseNotesSearchKey")),t.getUserSettings().then(function(e){n.userSettings=e,n.userSettings.defaultDateTime&&(n.userDateTimeFormat=n.userSettings.defaultDateTime.date+" "+n.userSettings.defaultDateTime.time),n.userSettings.defaultChunkSize&&(n.resultLimit=parseInt(n.userSettings.defaultChunkSize)||20,n.resultLimitDefault=parseInt(n.userSettings.defaultChunkSize)||20),r()},function(e){r()}),n.showMoreResults=function(){n.resultLimit=n.resultLimit+n.resultLimitDefault},n.resetResultLimit=function(){n.resultLimit=n.resultLimitDefault},n.resetFilter=function(){n.filterListing="",n.resultLimit=n.resultLimitDefault,a.sessionStorage.removeItem("releaseNotesSearchKey")}}angular.module("console.release-notes").controller("ReleaseNotesController",e),e.$inject=["SystemService","UserService","$window"]}(),function(){function e(e){e.configureStates([{state:"console.release-notes",config:{url:"/release-notes",title:"Release Notes",views:{"main@":{templateUrl:"release-notes/release-notes.html",controller:"ReleaseNotesController",controllerAs:"vm"}}}}])}angular.module("console.release-notes").run(e),e.$inject=["routerHelper"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;l.billingAccount={},l.fullname=i.auth_fullname,l.validationPatternEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,l.pendingApproval=!1,l.registerAccount=function(){if(!l.signupForm.$valid)return l.isSubmitting=!1,!1;l.isSubmitting=!0,r.updateBillingAccount(l.billingAccount).then(function(e){l.isSubmitting=!1,l.pendingApproval=!0},function(e){(function(e,t){n.addMessage({type:t,message:e})})(o("translate")("feedback.messages.error"),"error"),l.isSubmitting=!1})},l.copyFinancialContact=function(){var e=angular.copy(l.billingAccount.financialContact);l.billingAccount.technicalContact=e},l.resetInvoiceAddress=function(){l.setInvoiceAddress||delete l.billingAccount.invoiceAddress},"None"===l.fullname&&(l.fullname=!1),l.billingAccount.activePaymentMethod||(l.billingAccount.activePaymentMethod="invoice"),l.countryList=e.getCountries(),l.logout=function(){t.logout()},r.getBillingAccount().then(function(e){e.data&&(l.billingAccount=e.data,"created"!==l.billingAccount.status&&(l.pendingApproval=!0))},function(){l.pendingApproval=!1})}angular.module("console.signup").controller("SignupController",e),e.$inject=["ConstantsService","LoginService","UserService","feedbackService","BillingService","$window","$filter","$state"]}(),function(){function e(e){e.configureStates([{state:"console.signup",config:{url:"/signup",title:"Signup",views:{"main@":{templateUrl:"signup/signup.html",controller:"SignupController",controllerAs:"vm"}}}},{state:"console.activate",config:{url:"/activate",title:"Activate",views:{"main@":{templateUrl:"signup/activate/activate.html",controller:"ActivateController",controllerAs:"vm"}}}},{state:"console.disabled",config:{url:"/disabled",title:"Disabled",views:{"main@":{templateUrl:"signup/disabled/disabled.html",controller:"DisabledController",controllerAs:"vm"}}}}])}angular.module("console.signup").run(e),e.$inject=["routerHelper"]}(),function(){function e(e){e.configureStates([{state:"console.soap-endpoints",config:{url:"/soap-endpoints",title:"Soap Endpoints",views:{"main@":{templateUrl:"soap-endpoints/soap-endpoints.html"}}}},{state:"console.soap-endpoints.details",config:{url:"/details/:soapEndpointId",title:"Soap Endpoint",views:{"sheet-right@":{templateUrl:"soap-endpoints/details/soap-endpoint-details.html",controller:"SoapEndpointDetailsController",controllerAs:"vm"}}}}])}function t(){return[{state:"console.soap-endpoints",config:{url:"/soap-endpoints",title:"Soap Endpoints",views:{"main@":{templateUrl:"soap-endpoints/soap-endpoints.html"}}}},{state:"console.soap-endpoints.details",config:{url:"/details/:soapEndpointId",title:"Soap Endpoint",views:{"sheet-right@":{templateUrl:"soap-endpoints/details/soap-endpoint-details.html",controller:"SoapEndpointDetailsController",controllerAs:"vm"}}}}]}angular.module("console.soap-endpoints").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),function(){function e(e){e.configureStates([{state:"console.tasks",config:{abstract:!0,url:"/tasks"}},{state:"console.tasks.search",config:{url:"/search",title:"Tasks Search",views:{"main@":{templateUrl:"tasks/search/tasks-search.html",controller:"TasksSearchController",controllerAs:"vm"}}}},{state:"console.tasks.flows",config:{url:"/flows",title:"Tasks Boards",views:{"main@":{templateUrl:"tasks/flows/tasks-flows.html"}}}},{state:"console.tasks.flows.details",config:{url:"/details/:taskFlowId",title:"Board Details",views:{"main@":{templateUrl:"tasks/flows/details/tasks-flows-details.html",controller:"TasksFlowDetailsController",controllerAs:"vm"}}}},{state:"console.tasks.flows.create",config:{url:"/create",title:"Create Task Board",views:{"main@":{templateUrl:"tasks/flows/create/tasks-flows-create.html",controller:"TasksFlowCreateController",controllerAs:"vm"}}}},{state:"console.tasks.flows.details.task",config:{url:"/task/:taskId",title:"Task Details",params:{taskId:null,orderByRanking:null},views:{"modal@":{templateUrl:"tasks/details/task-details.html",controller:"TaskDetailsController",controllerAs:"vm"}}}},{state:"console.tasks.flows.details.create",config:{url:"/create",title:"Create Task",params:{orderByRanking:null},views:{"modal@":{templateUrl:"tasks/create/task-create.html",controller:"TaskCreateController",controllerAs:"vm"}}}},{state:"console.tasks.search.details",config:{url:"/details/:taskId",title:"Task Details",params:{taskId:null},views:{"modal@":{templateUrl:"tasks/details/task-details.html",controller:"TaskDetailsController",controllerAs:"vm"}}}},{state:"console.tasks.search.create",config:{url:"/create",title:"Create Task",params:{taskFlowId:null},views:{"modal@":{templateUrl:"tasks/create/task-create.html",controller:"TaskCreateController",controllerAs:"vm"}}}},{state:"console.tasks.search.add-tags",config:{title:"Add Tags",params:{tasks:null,results:null,pageToken:null,moreResultsAvailable:null,limitQuantity:null},views:{"sheet-right@":{templateUrl:"tasks/search/add-tags/add-tags.html",controller:"TasksAddTagsController",controllerAs:"vm"}}}},{state:"console.tasks.search.remove-tags",config:{title:"Remove Tags",params:{tasks:null,results:null,pageToken:null,moreResultsAvailable:null,limitQuantity:null},views:{"sheet-right@":{templateUrl:"tasks/search/remove-tags/remove-tags.html",controller:"TasksRemoveTagsController",controllerAs:"vm"}}}},{state:"console.tasks.search.manage-tasks",config:{title:"Manage Tasks",params:{tasks:null,results:null,pageToken:null,moreResultsAvailable:null,limitQuantity:null},views:{"sheet-right@":{templateUrl:"tasks/search/manage-tasks/manage-tasks.html",controller:"TasksManageController",controllerAs:"vm"}}}},{state:"console.tasks.settings",config:{title:"Tasks Settings",url:"/settings",views:{"main@":{templateUrl:"tasks/settings/tasks-settings.html",controller:"TasksSettingsController",controllerAs:"vm"}}}}])}angular.module("console.tasks").run(e),e.$inject=["routerHelper"]}(),function(){function e(e){e.configureStates([{state:"console.tcm",config:{url:"/tcm",title:"Transformation Configurations",params:{file:null},views:{"main@":{templateUrl:"tcm/tcm.html"}}}},{state:"console.tcm.details",config:{url:"/configuration/:configId",title:"Transformation Configuration",params:{configuration:null,file:null},views:{"main@":{templateUrl:"tcm/details/tcm-details.html",controller:"TcmDetailsController",controllerAs:"vm"}},data:{cssClassnames:"split-view"}}}])}function t(){return[{state:"console.tcm",config:{url:"/tcm",title:"Transformation Configurations",params:{file:null},views:{"main@":{templateUrl:"tcm/tcm.html"}}}},{state:"console.tcm.details",config:{url:"/configuration/:configId",title:"Transformation Configuration",params:{configuration:null,file:null},views:{"main@":{templateUrl:"tcm/details/tcm-details.html",controller:"TcmDetailsController",controllerAs:"vm"}},data:{cssClassnames:"split-view"}}}]}angular.module("console.tcm").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),function(){function e(e){e.configureStates([{state:"console.timeslice-groups",config:{url:"/timeslice-groups",title:"Timeslice Groups",views:{"main@":{templateUrl:"timeslice-groups/timeslice-groups.html"}}}},{state:"console.timeslice-groups.details",config:{url:"/details/:timesliceGroupId",title:"Timeslice Group Details",params:{timesliceGroup:null},views:{"main@":{templateUrl:"timeslice-groups/details/timeslice-groups-details.html",controller:"TimesliceGroupDetailsController",controllerAs:"vm"}}}},{state:"console.timeslice-groups.create",config:{url:"/create",title:"Create Timeslice Group",params:{copiedTimesliceGroup:null},views:{"main@":{templateUrl:"timeslice-groups/create/timeslice-groups-create.html",controller:"TimesliceGroupCreateController",controllerAs:"vm"}}}},{state:"console.timeslice-groups.details.assign",config:{url:"/assign",title:"Assign Timeslice Group",params:{timesliceGroupObject:null},views:{"sheet-right@":{templateUrl:"timeslice-groups/assign/timeslice-groups-assign.html",controller:"TimesliceGroupAssignController",controllerAs:"vm"}}}}])}function t(){return[{state:"console.timeslice-groups",config:{url:"/timeslice-groups",title:"Timeslice Groups",views:{"main@":{templateUrl:"timeslice-groups/timeslice-groups.html"}}}},{state:"console.timeslice-groups.details",config:{url:"/details/:timesliceGroupId",title:"Timeslice Group Details",params:{timesliceGroup:null},views:{"main@":{templateUrl:"timeslice-groups/details/timeslice-groups-details.html",controller:"TimesliceGroupDetailsController",controllerAs:"vm"}}}},{state:"console.timeslice-groups.create",config:{url:"/create",title:"Create Timeslice Group",params:{copiedTimesliceGroup:null},views:{"main@":{templateUrl:"timeslice-groups/create/timeslice-groups-create.html",controller:"TimesliceGroupCreateController",controllerAs:"vm"}}}},{state:"console.timeslice-groups.details.assign",config:{url:"/assign",title:"Assign Timeslice Group",params:{timesliceGroupObject:null},views:{"sheet-right@":{templateUrl:"timeslice-groups/assign/timeslice-groups-assign.html",controller:"TimesliceGroupAssignController",controllerAs:"vm"}}}}]}angular.module("console.timeslice-groups").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),function(){function e(e){e.configureStates([{state:"console.transport-adapters",config:{url:"/transport-adapters",title:"Transport Adapters",views:{"main@":{templateUrl:"transport-adapters/transport-adapters.html"}}}},{state:"console.transport-adapters.details",config:{url:"/details/:transportAdapterId",title:"Transport Adapter",params:{transportAdapter:null},views:{"main@":{templateUrl:"transport-adapters/details/transport-adapters-details.html",controller:"TransportAdapterDetailsController",controllerAs:"vm"}}}},{state:"console.transport-adapters.create",config:{url:"/create",title:"Create Transport Adapter",params:{copiedTransportAdapter:null},views:{"main@":{templateUrl:"transport-adapters/create/transport-adapters-create.html",controller:"TransportAdapterCreateController",controllerAs:"vm"}}}}])}function t(){return[{state:"console.transport-adapters",config:{url:"/transport-adapters",title:"Transport Adapters",views:{"main@":{templateUrl:"transport-adapters/transport-adapters.html"}}}},{state:"console.transport-adapters.details",config:{url:"/details/:transportAdapterId",title:"Transport Adapter",params:{transportAdapter:null},views:{"main@":{templateUrl:"transport-adapters/details/transport-adapters-details.html",controller:"TransportAdapterDetailsController",controllerAs:"vm"}}}},{state:"console.transport-adapters.create",config:{url:"/create",title:"Create Transport Adapter",params:{copiedTransportAdapter:null},views:{"main@":{templateUrl:"transport-adapters/create/transport-adapters-create.html",controller:"TransportAdapterCreateController",controllerAs:"vm"}}}}]}angular.module("console.transport-adapters").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),function(){function e(e){e.configureStates([{state:"console.triggers",config:{url:"/triggers",title:"Triggers",views:{"main@":{templateUrl:"triggers/triggers.html"}}}},{state:"console.triggers.details",config:{url:"/details/:triggerId",title:"Trigger Details",params:{trigger:null},views:{"main@":{templateUrl:"triggers/details/trigger-details.html",controller:"TriggerDetailsController",controllerAs:"vm"}}}},{state:"console.triggers.create",config:{url:"/create",title:"Create Trigger",params:{copiedTrigger:null},views:{"main@":{templateUrl:"triggers/create/trigger-create.html",controller:"TriggerCreateController",controllerAs:"vm"}}}}])}function t(){return[{state:"console.triggers",config:{url:"/triggers",title:"Triggers",views:{"main@":{templateUrl:"triggers/triggers.html"}}}},{state:"console.triggers.details",config:{url:"/details/:triggerId",title:"Trigger Details",params:{trigger:null},views:{"main@":{templateUrl:"triggers/details/trigger-details.html",controller:"TriggerDetailsController",controllerAs:"vm"}}}},{state:"console.triggers.create",config:{url:"/create",title:"Create Trigger",params:{copiedTrigger:null},views:{"main@":{templateUrl:"triggers/create/trigger-create.html",controller:"TriggerCreateController",controllerAs:"vm"}}}}]}angular.module("console.triggers").run(e),e.$inject=["routerHelper"],t.$inject=["$q","$http"]}(),function(){function e(e){e.configureStates([{state:"console.user",config:{abstract:!0,url:"/user"}},{state:"console.user.settings",config:{url:"/settings?activeTab",title:"User Settings",views:{"main@":{templateUrl:"user/settings/user-settings.html",controller:"UserSettingsController",controllerAs:"vm"}}}}])}angular.module("console.user").run(e),e.$inject=["routerHelper"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e,t){a.addMessage({type:t,message:e})}function u(e){c(e,"error")}l.newNamespace={properties:[]},l.errorDialog=!1,l.regionList=e.getSaasRegions(),l.validationPatternDomain=/([a-z0-9|-]+\.)*[a-z0-9|-]+\.[a-z]+/,l.createNamespace=function(){if(l.isSubmitting=!0,!l.createNamespaceForm.$valid)return l.isSubmitting=!1,!1;t.createNamespace(l.newNamespace).then(function(){n(function(){l.isSubmitting=!1,c(r("translate")("feedback.messages.ok")),s.go("console.admin.namespace",{},{reload:!0})},500)},function(e){l.isSubmitting=!1,l.errorDialog=!0,e.data&&e.data.error&&e.data.error.message?u(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):u(r("translate")("feedback.messages.error"))})},l.addNewProperty=function(){l.newNamespace.properties.push({key:"",value:""})},l.deleteNewProperty=function(e){l.newNamespace.properties.splice(e,1)},l.selectedBillingAccount=function(e){l.selectedBillingAccountName=e.companyName,l.newNamespace.billingAccountId=e.id,l.billingAccountSearchActive=!1},l.stateUp=function(){s.go("^")},angular.element(i).bind("keydown",function(e){27===e.keyCode&&"console.admin.namespace.create"===s.current.name&&(e.preventDefault(),s.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.admin").controller("AdminNamespaceCreateController",e),e.$inject=["ConstantsService","BillingAdminService","feedbackService","$timeout","$filter","$window","$scope","$state"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;if(l.newNamespaceProperties=[],l.isDeleting=!1,l.isSubmitting=!1,l.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",t.getUserSettings().then(function(e){l.userSettings=e,l.userSettings.defaultDateTime&&(l.userDateTimeFormat=l.userSettings.defaultDateTime.date+" "+l.userSettings.defaultDateTime.time)},function(e){}),r.namespaceId){var c=r.namespaceId;l.namespaceLoading=!0,e.getNamespace(c).then(function(e){l.namespaceLoading=!1,l.namespaceDetails=e},function(e){l.namespaceLoading=!1,d(a("translate")("feedback.messages.error"))})}else d(a("translate")("feedback.messages.errorNotFound"));function u(e,t){n.addMessage({type:t,message:e})}function d(e){u(e,"error")}l.deleteProperty=function(t){l.isDeleting=!0;var n={id:r.namespaceId,properties:[l.namespaceDetails.properties[t]]};e.removeNamespaceProperties(n).then(function(){l.namespaceDetails.properties.splice(t,1),l.isDeleting=!1},function(){d(a("translate")("feedback.messages.error")),l.isDeleting=!1})},l.addNewProperty=function(){l.newNamespaceProperties.push({value:"",key:""})},l.deleteNewProperty=function(e){l.newNamespaceProperties.splice(e,1)},l.submitNewProperties=function(){if(l.isSubmitting=!0,!l.submitPropertiesForm.$valid)return l.isSubmitting=!1,!1;var t={id:r.namespaceId,properties:l.newNamespaceProperties};e.addNamespaceProperties(t).then(function(){l.namespaceDetails.properties||(l.namespaceDetails.properties=[]);for(var e=t.properties,n=0;n<e.length;n++)e.indexOf(e[n])===n&&l.namespaceDetails.properties.push(e[n]);l.isSubmitting=!1,l.newNamespaceProperties=[],l.submitPropertiesForm.$setPristine(),u(a("translate")("feedback.messages.ok"))},function(){l.isSubmitting=!1,d(a("translate")("feedback.messages.error"))})},l.resetAddNewProperty=function(){l.newNamespaceProperties=[]},l.bootstrapNamespace=function(){var t={namespaceIds:[l.namespaceDetails.id]};l.isBootstrapping=!0,e.bootstrapNamespaces(t).then(function(){l.isBootstrapping=!1,u(a("translate")("feedback.messages.started"))},function(){l.isBootstrapping=!1,d(a("translate")("feedback.messages.error"))})},l.stateUp=function(){i.go("^")},angular.element(o).bind("keydown",function(e){27===e.keyCode&&"console.admin.namespace.details"===i.current.name&&(e.preventDefault(),i.go("^"))}),s.$on("$destroy",function(){angular.element(o).unbind("keydown")})}angular.module("console.admin").controller("AdminNamespaceDetailsController",e),e.$inject=["AdminService","UserService","$filter","feedbackService","$stateParams","$state","$window","$scope"]}(),function(){function e(e,t,a,n,r,i){var o=this;function s(t){var a={limit:100};t&&(a.pageToken=t),e.getNamespaceList(a).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){o.listing.push(e)}),t.nextPageToken?s(t.nextPageToken):o.isLoading=!1},function(e){o.isLoading=!1,o.errorDialog=!0})}function l(e,t){a.addMessage({type:t,message:e})}o.isLoading=!0,o.errorDialog=!1,o.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],o.resultLimit=20,o.resultLimitDefault=20,o.listing=[],o.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",o.updateStorageSearchKey=function(){n.sessionStorage.setItem("adminNamespaceSearchKey",o.filterListing)},n.sessionStorage.getItem("adminNamespaceSearchKey")&&(o.filterListing=n.sessionStorage.getItem("adminNamespaceSearchKey")),t.getUserSettings().then(function(e){o.userSettings=e,o.userSettings.defaultDateTime&&(o.userDateTimeFormat=o.userSettings.defaultDateTime.date+" "+o.userSettings.defaultDateTime.time),o.userSettings.defaultChunkSize&&(o.resultLimit=parseInt(o.userSettings.defaultChunkSize)||20,o.resultLimitDefault=parseInt(o.userSettings.defaultChunkSize)||20),s()},function(e){s()}),o.selectAll=function(){var e=r.$eval("vm.listing | filter: vm.filterListing | limitTo: vm.resultLimit");e&&e.length>0&&e.forEach(function(e,t){e.selected=!0})},o.unSelectAll=function(){o.listing&&o.listing.length>0&&o.listing.forEach(function(e){e.selected=!1})},o.bootstrapSelection=function(){var t=[];o.listing.forEach(function(e){e.selected&&t.push(e.id)}),o.isBootstrapping=!0,e.bootstrapNamespaces({namespaceIds:t}).then(function(){o.isBootstrapping=!1,o.showBootstrapConfirmation=!1,l(i("translate")("feedback.messages.started"))},function(){o.isBootstrapping=!1,o.showBootstrapConfirmation=!1,l(i("translate")("feedback.messages.error"),"error")})},o.toggleBootstrapConfirmation=function(){o.showBootstrapConfirmation=!o.showBootstrapConfirmation},o.showMoreResults=function(){o.resultLimit=parseInt(o.resultLimit)+parseInt(o.resultLimitDefault)},o.resetResultLimit=function(){o.resultLimit=o.resultLimitDefault},o.resetFilter=function(){o.filterListing="",o.resultLimit=o.resultLimitDefault,n.sessionStorage.removeItem("adminNamespaceSearchKey")},r.$watch("vm.listing",function(){!o.isLoading&&o.listing&&(o.selectedNamespacesDetected=!1,o.selectedNamespaces=o.listing.filter(function(e){return e.selected&&(o.selectedNamespacesDetected=!0),e.selected}))},!0)}angular.module("console.admin").controller("AdminNamespaceController",e),e.$inject=["AdminService","UserService","feedbackService","$window","$scope","$filter"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e,t){n.addMessage({type:t,message:e})}function u(e){c(e,"error")}l.newAccount={},l.availableNamespaces=[],l.regionList=e.getSaasRegions(),l.validationPatternEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,l.whitelistAccounts=function(){if(l.isSubmitting=!0,!l.addWhitelistForm.$valid)return l.isSubmitting=!1,!1;for(var e=l.accountsList.replace(/ /g,"").split(","),n=[],i=0;i<e.length;i++)n.push({email:e[i].trim(),namespaces:l.newAccount.namespaces,region:l.newAccount.region});var o={billingAccountId:l.newAccount.billingAccountId,accountsToWhitelist:n};t.whitelistAccounts(o).then(function(){s(function(){l.isSubmitting=!1,c(a("translate")("feedback.messages.ok")),r.go("console.admin.whitelist",{},{reload:!0})},500)},function(e){l.isSubmitting=!1,e.data&&e.data.error&&e.data.error.message?u(a("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):u(a("translate")("feedback.messages.error"))})},l.selectedResource=function(e){l.searchResourceActive=!l.searchResourceActive,l.newAccount.billingAccountId=e.id},function e(a){var n={limit:100};a&&(n.pageToken=a);l.isLoadingNamespaces=!0;t.getNamespaceList(n).then(function(t){var a=t.data;a.items&&a.items.forEach(function(e){l.availableNamespaces.push(e)}),a.nextPageToken?e(a.nextPageToken):l.isLoadingNamespaces=!1},function(e){l.isLoadingNamespaces=!1,l.errorDialog=!0})}(),angular.element(i).bind("keydown",function(e){27===e.keyCode&&"console.admin.whitelist.add"===r.current.name&&(e.preventDefault(),r.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.admin").controller("AdminAddToWhitelistController",e),e.$inject=["ConstantsService","AdminService","$filter","feedbackService","$state","$window","$scope","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;c.isSubmitting=!1,c.availableNamespaces=[],n.whitelistedAccount?(c.whitelistDetails=n.whitelistedAccount,function a(n){var r={limit:100};n&&(r.pageToken=n);c.isLoadingNamespaces=!0;e.getNamespaceList(r).then(function(e){var n=e.data;n.items&&n.items.forEach(function(e){c.availableNamespaces.push(e)}),n.nextPageToken?a(n.nextPageToken):(t.getUser(!1).then(function(e){c.whitelistDetails.email===e.email?d(!0):d(!1)},function(){c.errorDialog=!0}),c.isLoadingNamespaces=!1)},function(e){c.isLoadingNamespaces=!1,c.errorDialog=!0})}()):i.go("console.admin.whitelist");var u=angular.copy(c.whitelistDetails);function d(e){var t=s.active_namespace_id;c.availableNamespaces.forEach(function(a){c.whitelistDetails.namespaces.indexOf(a.id)>=0&&(a.selected=!0),e&&a.name===t&&(a.disabled=!0)})}function f(e,t){a.addMessage({type:t,message:e})}c.reset=function(){angular.copy(u,c.whitelistDetails)},c.updateWhitelistAccount=function(){c.isSubmitting=!0;var t=[];c.availableNamespaces.forEach(function(e){e.selected&&t.push(e.id)});var a={disabled:c.whitelistDetails.disabled,namespaces:t,email:c.whitelistDetails.email};e.updateWhitelistAccount(a).then(function(){l(function(){c.isSubmitting=!1,f(r("translate")("feedback.messages.ok")),i.go("console.admin.whitelist",{},{reload:!0})},500)},function(){c.isSubmitting=!1,f(r("translate")("feedback.messages.error"),"error")})},angular.element(s).bind("keydown",function(e){27===e.keyCode&&"console.admin.whitelist.details"===i.current.name&&(e.preventDefault(),c.reset(),i.go("^"))}),o.$on("$destroy",function(){angular.element(s).unbind("keydown")})}angular.module("console.admin").controller("AdminWhitelistDetailsController",e),e.$inject=["AdminService","UserService","feedbackService","$stateParams","$filter","$state","$scope","$window","$timeout"]}(),function(){function e(e,t,a){var n=this;function r(t){n.isLoading=!0;var a={limit:100};t&&(a.pageToken=t),e.getWhitelist(a).then(function(e){var t=e.data.whitelistedAccounts;t&&t.forEach(function(e){n.listing.push(e)}),e.data.pageToken?r(e.data.pageToken):n.isLoading=!1},function(e){n.isLoading=!1,n.errorDialog=!0})}n.isLoading=!0,n.errorDialog=!1,n.resultLimit=20,n.resultLimitDefault=20,n.listing=[],n.searchStatus=null,n.updateStorageSearchKey=function(){a.sessionStorage.setItem("adminWhitelistSearchKey",n.filterListing)},a.sessionStorage.getItem("adminWhitelistSearchKey")&&(n.filterListing=a.sessionStorage.getItem("adminWhitelistSearchKey")),t.getUserSettings().then(function(e){n.userSettings=e,n.userSettings.defaultDateTime&&(n.userDateTimeFormat=n.userSettings.defaultDateTime.date+" "+n.userSettings.defaultDateTime.time),n.userSettings.defaultChunkSize&&(n.resultLimit=parseInt(n.userSettings.defaultChunkSize)||20,n.resultLimitDefault=parseInt(n.userSettings.defaultChunkSize)||20),r()},function(e){r()}),n.statusChanged=function(){n.listing=[],r()},n.showMoreResults=function(){n.resultLimit=n.resultLimit+n.resultLimitDefault},n.resetResultLimit=function(){n.resultLimit=n.resultLimitDefault},n.resetFilter=function(){n.filterListing="",n.resultLimit=n.resultLimitDefault,a.sessionStorage.removeItem("adminWhitelistSearchKey")}}angular.module("console.admin").controller("AdminWhitelistController",e),e.$inject=["AdminService","UserService","$window"]}(),function(){function e(e,t,a,n,r){var i=this;i.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",i.closeSheet=function(){a.go("^")},e.getUserSettings().then(function(e){i.userSettings=e,i.userSettings.defaultDateTime&&(i.userDateTimeFormat=i.userSettings.defaultDateTime.date+" "+i.userSettings.defaultDateTime.time)},function(e){}),t.event?i.event=t.event:a.go("^"),angular.element(n).bind("keydown",function(e){27===e.keyCode&&"console.audit-events.details"===a.$current.name&&(e.preventDefault(),a.go("^"))}),r.$on("$destroy",function(){angular.element(n).unbind("keydown")})}angular.module("console.audit-events").controller("AuditEventDetailsController",e),e.$inject=["UserService","$stateParams","$state","$window","$scope"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e,t){n.addMessage({type:t,message:e})}l.validationPatternEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,l.validationPatternNumberDigits=/^[0-9]+(.[0-9]{0,2})?$/,l.validationPatternNumber=/^(0|[1-9]\d*)(\.\d+)?$/,l.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",l.countryList=e.getCountries(),l.currencyList=e.getCurrencies(),l.supportLevels=e.getSupportLevels(),l.paymentMethods=e.getPaymentMethods(),l.propertyLimit=5,l.getCurrencyInfo=function(t){l.billingAccountCurrency=e.getCurrency(t)},l.updateBillingAccount=function(){if(l.isSaving=!0,!l.billingAccountForm.$valid)return l.isSaving=!1,!1;var e=angular.copy(l.billingAccount);delete e.acceptedServiceLevelAgreement,delete e.acceptedTermsOfServices,l.isSubmitting=!0,t.updateBillingAccount(e).then(function(e){l.isSaving=!1,l.editMode=!1,c(r("translate")("feedback.messages.ok"))},function(e){c(r("translate")("feedback.messages.error"),"error"),l.isSaving=!1})},l.cancelUpdateBillingAccount=function(){s.reload()},l.toggleTierLevels=function(){l.tierLevelsVisible=!l.tierLevelsVisible},a.getUserSettings().then(function(e){l.userSettings=e,l.userSettings.defaultDateTime&&(l.userDateTimeFormat=l.userSettings.defaultDateTime.date+" "+l.userSettings.defaultDateTime.time)},function(e){}),l.isLoading=!0,t.getBillingAccount().then(function(e){l.billingAccount=e.data,l.isLoading=!1},function(e){l.isLoading=!1,l.errorDialog=!0}),angular.element(i).bind("keydown",function(e){27===e.keyCode&&l.tierLevelsVisible&&(e.preventDefault(),l.tierLevelsVisible=!1,o.$evalAsync())}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.billing").controller("BillingAccountController",e),e.$inject=["ConstantsService","BillingService","UserService","feedbackService","$filter","$window","$scope","$state"]}(),angular.module("console.billing").constant("BillingStorageChart",{colors:["#019beb"],chart:{height:780,margin:[40,0,100,70],zoomType:"xy"},title:{text:""},exporting:{enabled:!1},credits:{enabled:!1},legend:{enabled:!0},yAxis:{title:{text:"Storage Points",style:{color:Highcharts.getOptions().colors[0]}}},xAxis:{type:"datetime",title:{text:"Date"}},series:[]}).constant("BillingConcurrentFlowsChart",{colors:["#019beb"],chart:{height:390,margin:[40,0,100,70]},title:{text:""},exporting:{enabled:!1},credits:{enabled:!1},legend:{enabled:!0},yAxis:{title:{text:"Concurrent Flows",style:{color:Highcharts.getOptions().colors[0]}},minRange:1,allowDecimals:!1},xAxis:{type:"datetime",title:{text:"Date"}},series:[]}).constant("BillingConcurrentRequestsChart",{colors:["#019beb"],chart:{height:390,margin:[40,0,100,70]},title:{text:""},exporting:{enabled:!1},credits:{enabled:!1},legend:{enabled:!0},yAxis:{title:{text:"Concurrent Requests",style:{color:Highcharts.getOptions().colors[0]}},minRange:1,allowDecimals:!1},xAxis:{type:"datetime",title:{text:"Date"}},series:[]}),function(){function e(e,t,a,n,r,i,o,s,l,c,u){var d=this;function f(){var e=moment.months(),t=moment().format("MMMM");d.months=[],e.forEach(function(e,a){var n=moment(d.selectedYear+"-"+e,"YYYY-MMMM"),r=moment().isBefore(n);d.months.push({month:e,disabled:r}),e===t&&(d.selectedMonth=d.months[a])}),m()}function m(){for(var e=moment(d.selectedYear+"-"+d.selectedMonth.month,"YYYY-MMM").daysInMonth(),t=[{day:0,name:l("translate")("billing.usage.allDays")}],a=1;a<=e;a++){var n=moment(d.selectedYear+"-"+d.selectedMonth.month+"-"+a,"YYYY-MMM-D"),r=moment().isBefore(n);t.push({day:a,name:a,disabled:r})}d.days=t,d.selectedDay=d.days[0]}function g(){d.isLoading=!0;var e="quota_metric_";"total"===d.selectedBillingScope.id?(d.showPricing=!0,e+=d.billingAccount.id):(d.showPricing=!1,e+=d.selectedBillingScope.name.replace(/[ .]/g,"_"));e=e.toLowerCase();var t=moment().month(d.selectedMonth.month).format("M"),a=moment(d.selectedYear+t,"YYYY-MM").format(),n=moment(a).endOf("month").format();if(d.loadedMonth=d.selectedMonth,d.loadedYear=d.selectedYear,d.flowStructure&&d.flowStructure[e]){var r="MONTH";0!==d.selectedDay.day&&(r="DAYS",a=moment(d.selectedYear+"-"+t+"-"+d.selectedDay.day,"YYYY-MM-DD").startOf("day").format(),n=moment(a).endOf("day").format()),function(e,t,a,n){d.errorDialog=!1,d.chartStorageConfig.series=[],d.chartConcurrentFlowsConfig.series=[],d.chartConcurrentRequestsConfig.series=[];var r=[];if(Object.keys(d.flowStructure[a]).forEach(function(e){r.push("'"+d.flowStructure[a][e].selectedFlow.flowId+"'")}),0===r.length)return d.noDataAvailable=!0,d.errorDialog=!1,void(d.isLoading=!1);r=r.join(","),e=moment(e).utc().format("YYYY-MM-DDTHH:mm:ss"),t=moment(t).utc().format("YYYY-MM-DDTHH:mm:ss");var i={query:"SELECT   struct(timestamp, struct(flow_id, array[STRUCT(channel_classifier_id, value, ARRAY(SELECT AS STRUCT annotation, sequence_id, ARRAY_AGG(STRUCT(key, value))))] AS channel) AS flow) AS row\r\nFROM     flows \r\nWHERE    flow_id IN ("+r+") \r\nAND      timestamp > '"+e+"' \r\nAND      timestamp <= '"+t+"' \r\nGROUP BY timestamp, \r\n         flow_id, \r\n         channel_classifier_id, \r\n         value \r\nORDER BY timestamp, \r\n         flow_id",limit:100};h&&h.cancel();(h=o.eqlQuery(i)).then(function(e){if(!e||!e.parsed)return d.noDataAvailable=!0,void(d.isLoading=!1);d.isLoading=!1,function(e,t){var a=[],n=[],r=[],i={};"YEAR"===t?i={storagePointsChannel:"STORAGE_POINTS_MONTH",concFlowsChannel:"CONCURRENT_FLOWS_MONTH",concRequestsChannel:"CONCURRENT_REQUESTS_MONTH"}:"MONTH"===t?i={storagePointsChannel:"STORAGE_POINTS_DAY",concFlowsChannel:"CONCURRENT_FLOWS_DAY",concRequestsChannel:"CONCURRENT_REQUESTS_DAY"}:"DAYS"===t&&(i={storagePointsChannel:"STORAGE_POINTS_HOUR",concFlowsChannel:"CONCURRENT_FLOWS_HOUR",concRequestsChannel:"CONCURRENT_REQUESTS_HOUR"});e.forEach(function(e){if(e.row.flow&&e.row.flow.channel[0].channel_classifier_id===i.storagePointsChannel){var t=[e.row.timestamp,e.row.flow.channel[0].value];a.push(t)}if(e.row.flow&&e.row.flow.channel[0].channel_classifier_id===i.concFlowsChannel){var o=[e.row.timestamp,e.row.flow.channel[0].value];n.push(o)}if(e.row.flow&&e.row.flow.channel[0].channel_classifier_id===i.concRequestsChannel){var s=[e.row.timestamp,e.row.flow.channel[0].value];r.push(s)}}),function(e,t,a){d.isLoading=!1,d.chartStorageConfig.series=[{name:"Storage Points",type:"areaspline",data:e}],d.chartConcurrentFlowsConfig.series=[{name:"Concurrent Flows",type:"column",data:t}],d.chartConcurrentRequestsConfig.series=[{name:"Concurrent Requests",type:"column",data:a}],function(){var e=[];d.chartStorageConfig.series[0].data.forEach(function(t){e.push(t[1])}),e.length>0?d.totalStoragePoints=e.slice(-1)[0]:d.totalStoragePoints=0;var t=[];d.chartConcurrentRequestsConfig.series[0].data.forEach(function(e){t.push(e[1])}),t.length>0?d.maxConcurrentRequests=t.reduce(function(e,t){return Math.max(e,t)}):d.maxConcurrentRequests=0;var a=[];d.chartConcurrentFlowsConfig.series[0].data.forEach(function(e){a.push(e[1])}),a.length>0?d.maxConcurrentFlows=a.reduce(function(e,t){return Math.max(e,t)}):d.maxConcurrentFlows=0;(function(e,t,a){var n={totalStoragePoints:{level:1,price:d.tierRate},maxConcurrentRequests:{level:1,price:d.tierRate},maxConcurrentFlows:{level:1,price:d.tierRate}};d.tierLevels.forEach(function(r,i){var o=parseFloat(r.cumulativeStoragePoints.from),s=parseFloat(r.cumulativeStoragePoints.to),l=parseFloat(r.concurrentRequests.from),c=parseFloat(r.concurrentRequests.to),u=parseFloat(r.concurrentFlows.from),d=parseFloat(r.concurrentFlows.to);e=parseFloat(e),t=parseFloat(t),a=parseFloat(a),e>=o&&e<=s&&(n.totalStoragePoints={level:i+1,price:r.tierRate}),t>=l&&t<=c&&(n.maxConcurrentRequests={level:i+1,price:r.tierRate}),a>=u&&a<=d&&(n.maxConcurrentFlows={level:i+1,price:r.tierRate})}),d.currentTierLevel=Math.max(n.totalStoragePoints.level,n.maxConcurrentRequests.level,n.maxConcurrentFlows.level),d.currentTierRate=Math.max(n.totalStoragePoints.price,n.maxConcurrentRequests.price,n.maxConcurrentFlows.price);var r=d.billingAccount.supportLevel,i=0,o=0;"premium"===r?(d.premiumSupport=!0,i=5e3,(o=.25*d.currentTierRate)>i&&(o=i)):"standard"===r?(i=2500,(o=.15*d.currentTierRate)>i&&(o=i)):o=0;d.supportRate=o,d.maxSupportRate=i,d.totalPPU=d.currentTierRate+d.supportRate})(d.totalStoragePoints,d.maxConcurrentRequests,d.maxConcurrentFlows),d.chartStorageConfig.plotOptions={series:{fillColor:{linearGradient:{x1:1,y1:0,x2:0,y2:1},stops:[[0,Highcharts.Color("#019beb").setOpacity(1).get("rgba")],[1,Highcharts.Color("#019beb").setOpacity(0).get("rgba")]]}}},d.chartConcurrentRequestsConfig.plotOptions={column:{zones:[{value:d.maxConcurrentRequests,color:"#019beb"},{color:"#ff5841"}]}},d.chartConcurrentFlowsConfig.plotOptions={column:{zones:[{value:d.maxConcurrentFlows,color:"#019beb"},{color:"#ff5841"}]}},function(){for(var e=[],t=[],a=[],n=0;n<d.tierLevels.length;n++){var r=n+2,i={zIndex:5,color:"#014e76",width:1,id:"Tier"+r,label:{align:"left",text:"Tier "+r}},o={zIndex:5,color:"#014e76",width:1,id:"Tier"+r,label:{align:"left",text:"Tier "+r}},s={zIndex:5,color:"#014e76",width:1,id:"Tier"+r,label:{align:"left",text:"Tier "+r}};i.value=d.tierLevels[n].cumulativeStoragePoints.to,o.value=d.tierLevels[n].concurrentRequests.to,s.value=d.tierLevels[n].concurrentFlows.to,e.push(i),t.push(o),a.push(s)}d.chartStorageConfig.yAxis.plotLines=e,d.chartConcurrentRequestsConfig.yAxis.plotLines=t,d.chartConcurrentFlowsConfig.yAxis.plotLines=a}()}()}(a,n,r)}(e.parsed,n),d.noDataAvailable=!1},function(e){d.noDataAvailable=!0,d.errorDialog=!0,d.isLoading=!1})}(a,n,e,r)}else!function(e){d.noFlowsAvailable=!1;var t={datasourceIds:[e],latestFlowsOnly:!0};i.getAllFlows(t).then(function(t){d.flowStructure[e]={},t&&t.data&&t.data.items&&t.data.items.length>0?(t.data.items.forEach(function(t){d.flowStructure[e][t.channelClassifier]&&0!==d.flowStructure[e][t.channelClassifier].length||(d.flowStructure[e][t.channelClassifier]=[]),d.flowStructure[e][t.channelClassifier].push(t),p(d.flowStructure[e][t.channelClassifier],"flowTimestamp"),d.flowStructure[e][t.channelClassifier].selectedFlow=d.flowStructure[e][t.channelClassifier][0]}),g()):(d.noFlowsAvailable=!0,d.isLoading=!1)},function(e){d.noFlowsAvailable=!0,d.isLoading=!1})}(e)}function p(e,t){return e.sort(function(e,a){var n=e[t],r=a[t];return n>r?-1:n<r?1:0})}d.isLoading=!0,d.billingScopes=[],d.flowStructure={},d.selectedYear=moment().year(),d.chartStorageConfig=a,d.chartConcurrentFlowsConfig=n,d.chartConcurrentRequestsConfig=r,d.getCurrencyInfo=function(t){d.billingAccountCurrency=e.getCurrency(t)},d.loadBillingDataFromRange=g,d.toggleTierLevels=function(){d.tierLevelsVisible=!d.tierLevelsVisible},d.getDaysInMonth=m,d.getMonthsInYear=f,d.isLoading=!0,d.loadingBillingAccount=!0,t.getBillingAccount().then(function(e){var t=e.data;d.billingAccount=t;var a=moment(t.createdDatetime).year();d.years=function(e){var t=(new Date).getFullYear(),a=[];for(e=e||1980;e<=t;)a.push(e++);return a}(a),d.loadingBillingAccount=!1,t.commercialElements?(d.billingAccount=t,d.tierRate=d.billingAccount.commercialElements.tierRate,function(e){var t=1,a=[],n=e,r=null;for(n.tierRate||(n.tierRate=0);t<101;){var i={tierRate:n.tierRate*t,concurrentFlows:{from:Math.abs(n.quotas.concurrentFlows-n.quotas.concurrentFlows*t-1),to:n.quotas.concurrentFlows*t},concurrentRequests:{from:Math.abs(n.quotas.concurrentRequests-n.quotas.concurrentRequests*t-1),to:n.quotas.concurrentRequests*t},cumulativeStoragePoints:{from:1===t?Math.abs(n.quotas.cumulativeStoragePoints-n.quotas.cumulativeStoragePoints*t-1):r.cumulativeStoragePoints.to+1,to:1===t?n.quotas.cumulativeStoragePoints*(t-1)+n.quotas.cumulativeStoragePoints*Math.pow(n.quotas.cumulativeStoragePointsFactor,t-1):r.cumulativeStoragePoints.to+n.quotas.cumulativeStoragePoints*Math.pow(n.quotas.cumulativeStoragePointsFactor,t-1)},priorityFeatures:n.quotas.priorityFeatures*t};1===t&&(i.concurrentFlows.from=0,i.concurrentRequests.from=0,i.cumulativeStoragePoints.from=0,i.cumulativeStoragePoints.to=n.quotas.cumulativeStoragePoints),a.push(i),t++,r=i}d.tierLevels=a}(t.commercialElements),function(e){var t=[];e.namespaceModels&&e.namespaceModels.length>0&&e.namespaceModels.forEach(function(e){var a={id:e.id,name:e.name};t.push(a)});var a={id:"total",name:l("translate")("billing.usage.totalUsage")};p(t,"name"),t.push(a),t.reverse(),d.selectedBillingScope=a,d.billingScopes=t,g()}(t)):(d.isLoading=!1,d.noDataAvailable=!0)},function(e){d.isLoading=!1,d.errorDialog=!0,d.loadingBillingAccount=!1}),f(),Highcharts.setOptions({global:{timezone:"utc"}});var h=null;angular.element(c).bind("keydown",function(e){27===e.keyCode&&d.tierLevelsVisible&&(e.preventDefault(),d.tierLevelsVisible=!1,s.$evalAsync())}),s.$on("$destroy",function(){angular.element(c).unbind("keydown")}),s.$watch("vm.isLoading",function(){d.isLoading||angular.element(document).ready(function(){fitty(".card-statistic .card-statistic__value",{maxSize:46}),fitty(".card-statistic .card-statistic__label",{maxSize:24})})})}angular.module("console.billing").controller("BillingOverviewController",e),e.$inject=["ConstantsService","BillingService","BillingStorageChart","BillingConcurrentFlowsChart","BillingConcurrentRequestsChart","FlowService","QueryService","$scope","$filter","$window","$timeout"]}(),function(){function e(e,t,a,n){this.widget=e.widget,this.dashboardIndex=e.dashboardIndex,this.widget||t.go("^"),angular.element(a).bind("keydown",function(e){27===e.keyCode&&"console.dashboard.widgetFullscreen"===t.current.name&&(e.preventDefault(),t.go("^"))}),n.$on("$destroy",function(){angular.element(a).unbind("keydown")})}angular.module("console.dashboard").controller("WidgetFullscreenController",e),e.$inject=["$stateParams","$state","$window","$scope"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this,u=null,d=null;function f(t){active_namespace_id&&(c.loadingRecipes=!0,c.dashboardRecipes=[],e.getUser(t).then(function(e){var t,a=e.namespaces.filter(function(e){return e&&e.name?e.name===active_namespace_id:e===active_namespace_id});a&&a.length>0&&a[0].properties&&(t=a[0].properties.filter(function(e){return"dashboardrecipes"===e.key.toLowerCase()}))&&t.length>0&&(c.dashboardRecipes=JSON.parse(t[0].value)),c.loadingRecipes=!1},function(e){c.loadingRecipes=!1,p(o("translate")("feedback.messages.error"))}))}function m(e){e&&(c.widget=d),i.go("console.dashboard")}function g(e,t){a.addMessage({type:t,message:e})}function p(e){g(e,"error")}s.widgetConfig?(c.widget=angular.copy(s.widgetConfig),s.dashboardIndex&&(u=s.dashboardIndex),s.fromCache&&(c.widget.fromCache=s.fromCache,c.isLoading=!1)):i.go("console.dashboard"),f(!0),c.closeSetup=m,c.saveWidgetConfig=function(){var t=r.localStorage.getItem(active_namespace_id+"_dashboardconfig");t=JSON.parse(t);for(var a=0;a<t.dashboard[u].config.length;a++){var n=t.dashboard[u].config[a].position,o=_.isEqual(n,c.widget.position);o&&t.dashboard[u].config.splice(a,1)}t.dashboard[u].config.push(c.widget),c.widget.fromCache&&(c.widget.fromCache=null,c.widget.fromCacheTimeStamp=null);r.localStorage.setItem(active_namespace_id+"_dashboardconfig",JSON.stringify({namespace:active_namespace_id,dashboard:t.dashboard})),t.dashboard.forEach(function(e){e.config.forEach(function(e){e.fromCache&&(e.fromCache=null,e.fromCacheTimeStamp=null)})});var s=JSON.stringify(t.dashboard);c.isSaving=!0;var l={properties:[{key:"dashboardconfig",value:s}]};e.updateUserProperties(l).then(function(){c.isSaving=!1,i.go("console.dashboard",{dashboardIndex:u,loadFromLocalStorage:!0},{reload:!0})},function(){c.isSaving=!1})},c.testConfiguration=function(){c.widget.configured=!0,n.$broadcast("applySettings")},c.saveWidgetAsRecipe=function(){active_namespace_id&&(c.isSavingAsRecipe=!0,e.getUser().then(function(e){var a=[];if(active_namespace_id===e.namespace.id){var n=e.namespace.properties.filter(function(e){return"dashboardrecipes"===e.key.toLowerCase()});n&&n.length>0&&(a=JSON.parse(n[0].value))}else{var r=e.namespaces.filter(function(e){return e.id===active_namespace_id});if(r&&r.length>0&&r[0].properties){var i=r[0].properties.filter(function(e){return"dashboardrecipes"===e.key.toLowerCase()});i&&i.length>0&&(a=JSON.parse(i[0].value))}}var s=angular.copy(c.widget);s.fromCache=null,s.fromCacheTimeStamp=null,s.position=null,a.push(s);var u={id:active_namespace_id,properties:[{key:"dashboardrecipes",value:JSON.stringify(a)}]};(a.length>1?t.updateNamespaceProperties(u):t.addNamespaceProperties(u)).then(function(e){c.isSavingAsRecipe=!1,c.confirmSaveAsRecipe=!1,l(function(){f(!0)},100),g(o("translate")("feedback.messages.ok"))},function(e){c.isSavingAsRecipe=!1,p(o("translate")("feedback.messages.error"))})},function(e){c.isSavingAsRecipe=!1,p(o("translate")("feedback.messages.error"))}))},c.onRecipeSelected=function(e){Object.keys(e).forEach(function(t){"position"!==t&&(c.widget[t]=e[t])})},angular.element(r).bind("keydown",function(e){27===e.keyCode&&"console.dashboard.widget"===i.current.name&&(e.preventDefault(),m())}),n.$on("$destroy",function(){angular.element(r).unbind("keydown")})}angular.module("console.dashboard").controller("WidgetSetupController",e),e.$inject=["UserService","AdminService","feedbackService","$scope","$window","$state","$filter","$stateParams","$timeout"]}(),function(){function e(e,t,a){var n=this;n.toggleCreate=function(){n.createSheet=!n.createSheet},angular.element(t).bind("keydown",function(t){27===t.keyCode&&"console.datasources-classifiers"===a.current.name&&(t.preventDefault(),e.$apply(function(){n.createSheet=!1}))}),e.$on("$destroy",function(){angular.element(t).unbind("keydown")})}angular.module("console.datasources").controller("DatasourceClassifiersController",e),e.$inject=["$scope","$window","$state"]}(),function(){function e(e,t,a,n,r){var i=this;function o(){var e=a.localStorage.getItem(active_namespace_id+"_ewxCollectedDatasources");e&&(i.selectedDatasourceCollection=JSON.parse(e),i.selectedDatasourceCollection.forEach(function(e){e.selected=!1}))}i.resultLimit=20,i.chunkSize=i.resultLimit,i.resultLimitDefault=20,i.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],i.showMoreResults=function(){i.resultLimit=i.resultLimit+i.resultLimitDefault},i.resetResultLimit=function(){i.resultLimit=i.resultLimitDefault},i.resetFilter=function(){i.filterListing="",i.resultLimit=i.resultLimitDefault},i.updateResultLimit=function(){i.resultLimit=i.chunkSize},i.checkAll=function(){for(var e=0;e<i.selectedDatasourceCollection.length;e++)e<i.resultLimit&&(i.selectedDatasourceCollection[e].selected=!0)},i.unCheckAll=function(){for(var e=0;e<i.selectedDatasourceCollection.length;e++)e<i.resultLimit&&(i.selectedDatasourceCollection[e].selected=!1)},i.deleteSelected=function(){for(var e=i.selectedDatasourceCollection.length-1;e>=0;--e)i.selectedDatasourceCollection[e].selected&&i.selectedDatasourceCollection.splice(e,1);a.localStorage.setItem(active_namespace_id+"_ewxCollectedDatasources",JSON.stringify(i.selectedDatasourceCollection)),n=r("translate")("feedback.messages.deleted"),t.addMessage({type:o,message:n});var n,o},i.createView=function(){i.viewCollection=i.selectedDatasourceCollection},e.getUserSettings().then(function(e){i.userSettings=e,i.userSettings.defaultDateTime&&(i.userDateTimeFormat=i.userSettings.defaultDateTime.date+" "+i.userSettings.defaultDateTime.time),i.userSettings.defaultChunkSize&&(i.resultLimit=parseInt(i.userSettings.defaultChunkSize)||20,i.resultLimitDefault=parseInt(i.userSettings.defaultChunkSize)||20,i.chunkSize=i.resultLimit),o()},function(e){o()}),i.startFlow=function(){i.startFlowDatasources=[],i.selectedDatasourceCollection.forEach(function(e){e.selected&&i.startFlowDatasources.push(e)}),i.triggerFlow=!0},n.$watch("vm.selectedDatasourceCollection",function(){i.selectedDatasourceCollection&&(i.selectedFilesDetected=!1,i.selectedDatasourceCollection.forEach(function(e){e.selected&&(i.selectedFilesDetected=!0)}))},!0)}angular.module("console.datasources").controller("CollectedDatasourcesController",e),e.$inject=["UserService","feedbackService","$window","$scope","$filter"]}(),function(){function e(e,t,a,n,r,i,o,s,l,c){var u=this;function d(){if(u.dataStructure={},u.flowStructure={getListOfDatasources:function(){var e=this,t=[];return Object.keys(this).forEach(function(a){_.isFunction(e[a])||-1!==t.indexOf(a)||t.push(a)}),t},getSelectedFlowIds:function(){var e=this,t=[];return Object.keys(this).forEach(function(a){_.isFunction(e[a])||e[a].getChannelClassifiers().forEach(function(n){t.push(e[a][n].selectedFlow.flowId)})}),t},getDatasourceByFlowId:function(e){var t=this,a=void 0;return Object.keys(this).forEach(function(n){_.isFunction(t[n])||t[n].getChannelClassifiers().forEach(function(r){var i=t[n][r].getFlow(e);i&&(a=i.datasourceId)})}),a},getFlowClassifierByFlowId:function(e){var t=this,a=void 0;return Object.keys(this).forEach(function(n){_.isFunction(t[n])||t[n].getChannelClassifiers().forEach(function(r){t[n][r].selectedFlow.flowId===e&&(a=t[n][r].selectedFlow.channelClassifier)})}),a}},u.datasources=[],u.timezone=null,u.excludeTagNames=["flow_info"],u.excludeTagDescriptions=["ICAP","NITS"],u.multipleDatasources=!1,u.collapseDatasourceMap=!0,u.datasourcesLoading=!0,u.flowsLoading=!1,u.annotationsLoadings=!1,u.chartLoading=!1,u.loadingSourceChannels=!1,n.datasourceIds){var e=n.datasourceIds.split(",");!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e&&e.length<=0)return;o.tagsGetAll(e).then(function(e){var a,r;u.datasourcesLoading=!1,u.timezone=null,e.data&&e.data.datasources&&e.data.datasources.length>0&&(u.datasources=e.data.datasources),u.datasources&&u.datasources.length>0&&(u.datasources.forEach(function(e){e.tags&&e.tags.forEach(function(e){"geopoint"===e.tag&&(u.geolocationAvailable=!0)})}),u.multipleDatasources=u.datasources.length>1,u.multipleDatasources||(u.typeOfDatasource=null,u.virtualDatasourceEql=null,a=u.datasources,r=[],a.forEach(function(e){r.indexOf(e.classifier)<=-1&&r.push(e.classifier)}),l.getDatasourceClassifiersForNamespace({limit:100},active_namespace_id).then(function(e){var t={};e.forEach(function(e){r.forEach(function(a){e.name&&e.name.toUpperCase()===a.toUpperCase()&&(t[a]=e)})}),1===r.length&&t[r[0]]&&(u.typeOfDatasource=t[r[0]].source,a[0].classifierType=t[r[0]].source)}),u.datasources.forEach(function(e){e&&e.filter&&(u.virtualDatasourceEql=e.filter);var t=[];!u.timezone&&e.timezone&&(u.timezone=e.timezone),e.tags&&(t=e.tags.filter(function(e){return"datasource"===e.tag})).length>0&&t.forEach(function(e){e.properties.forEach(function(e){"eql"!==e.key&&"filter"!==e.key||(u.virtualDatasourceEql=e.value)})})})),function(e){var a=[];u.userSettings.selectedTimezones&&Object.keys(u.userSettings.selectedTimezones).length>0&&Object.keys(u.userSettings.selectedTimezones).forEach(function(e){u.userSettings.selectedTimezones[e].forEach(function(e){a.push(e.timezone)})});var r=[];e.forEach(function(e){r.push(e.id),e.timezone&&(a.indexOf(e.timezone)>-1||a.push(e.timezone))}),u.availableTimeZones=a.filter(function(e,t,a){return a.indexOf(e)===t}),u.availableTimeZones.indexOf("UTC")>-1||u.availableTimeZones.push("UTC");!u.timezone&&u.availableTimeZones.length>0?u.timezone=u.availableTimeZones[0]:u.timezone||(u.timezone=moment.tz.guess());u.selectedTimeZone=u.timezone,n.startTime?u.startTime=moment(n.startTime).format():u.userSettings&&u.userSettings.defaultDateRangeTimeseries&&u.userSettings.defaultDateRangeTimeseries.backward.timespan?u.startTime=moment.tz(u.timezone).startOf("day").add(1,"day").subtract(u.userSettings.defaultDateRangeTimeseries.backward.amount,u.userSettings.defaultDateRangeTimeseries.backward.timespan).format():u.startTime=moment.tz(u.timezone).startOf("day").add(1,"day").subtract(12,"month").format();n.endTime?u.endTime=moment(n.endTime).format():u.userSettings&&u.userSettings.defaultDateRangeTimeseries&&u.userSettings.defaultDateRangeTimeseries.forward.timespan?u.endTime=moment.tz(u.timezone).startOf("day").add(1,"day").add(u.userSettings.defaultDateRangeTimeseries.forward.amount,u.userSettings.defaultDateRangeTimeseries.forward.timespan).format():u.endTime=moment.tz(u.timezone).startOf("day").add(1,"day").add(12,"month").format();!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e&&e.length<=0)return;0===a.length&&n.channels&&(a=n.channels.split(","));var r={datasourceIds:e,channelClassifierIds:a,latestFlowsOnly:!0,limit:100};u.flowsLoading=!0,t.getAllFlows(r).then(function(e){u.flowsLoading=!1,e&&e.data&&e.data.items&&e.data.items.length>0?(e.data.items.forEach(function(e){var t,a;u.flowStructure[e.datasourceId]||g(e.datasourceId),u.flowStructure[e.datasourceId][e.channelClassifier]||p(e.datasourceId,e.channelClassifier),u.flowStructure[e.datasourceId][e.channelClassifier].flows.push(e),t=u.flowStructure[e.datasourceId][e.channelClassifier].flows,a="flowTimestamp",t.sort(function(e,t){var n=e[a],r=t[a];return n>r?-1:n<r?1:0}),u.flowStructure[e.datasourceId][e.channelClassifier].selectedFlow=u.flowStructure[e.datasourceId][e.channelClassifier].flows[0]}),S(u.flowStructure.getSelectedFlowIds())):u.loadRawData(!1,!0)},function(e){u.loadRawData(!1,!0),u.flowsLoading=!1})}(r)}(u.datasources))},function(e){u.datasourcesLoading=!1})}(e),e.length>1&&(u.multipleDatasources=!0),angular.element(document).ready(function(){var e=n.datasourceIds.split(",");e&&1===e.length&&(document.title=e[0]+" · Datasource Viewer · Console")})}else r.go("console.datasources")}function f(){u.dataStructure={}}function m(){Object.keys(u.flowStructure).forEach(function(e){if(!_.isFunction(u.flowStructure[e])&&u.flowStructure[e]){var t=u.flowStructure[e];Object.keys(t).forEach(function(e){!_.isFunction(t[e])&&t[e]&&t[e].annotations&&(t[e].annotations={})})}})}function g(e){u.flowStructure[e]={getChannelClassifiers:function(){var e=this,t=[];return Object.keys(this).forEach(function(a){_.isFunction(e[a])||-1!==t.indexOf(a)||t.push(a)}),t}}}function p(e,t){u.flowStructure[e][t]={selectedFlow:{},flows:[],annotations:{},getFlow:function(e){var t=this.flows.filter(function(t){return t.flowId===e});if(t.length>0)return t[0]},getAnnotations:function(e){if(this.annotations[e])return this.annotations[e]}}}u.datasourcesLoading=!0,a.getUserSettings().then(function(e){u.userSettings=e,d()},function(e){d()}),u.changeDateRange=function(e,t){if(u.startTime=e,u.endTime=t,u.chartLoaded=!1,u.chartLoading=!0,u.flowStructure.getSelectedFlowIds().length>0){var a=!1;u.flowStructure.getSelectedFlowIds().forEach(function(e){e&&(a=!0)}),a&&(m(),S(u.flowStructure.getSelectedFlowIds()))}u.sourceChannelsToLoad&&u.loadRawData(u.sourceChannelsToLoad),f()};var h=null;u.loadRawData=function(t,a){var n=[],r=[];if(t?(t.selectedDatasources.forEach(function(e){e.id?n.push(e.id):n.push(e)}),t.selectedSourceChannels.forEach(function(e){e.classifier?r.push(e.classifier):r.push(e)})):!t&&a&&(u.datasources.forEach(function(e){n.push(e.id),e.channels&&e.channels.length>0&&e.channels.forEach(function(e){e.isSource&&(e.selected=!0,r.push(e.classifier))})}),u.sourceChannelsToLoad={selectedDatasources:n,selectedSourceChannels:r}),0!==n.length&&0!==r.length){var i={query:"SELECT datasource_id, timestamp, ARRAY[STRUCT(channel AS channel_classifier, value AS value)] AS raw FROM INGEST WHERE timestamp > '"+moment(u.startTime).utc().format("YYYY-MM-DDTHH:mm:ss")+"' AND timestamp <= '"+moment(u.endTime).utc().format("YYYY-MM-DDTHH:mm:ss")+"' AND datasource_id IN ('"+n.join("', '")+"') AND channel_classifier_id IN ('"+r.join("', '")+"') GROUP BY timestamp, channel, value ORDER BY timestamp",limit:99999};u.loadingSourceChannels=!0,u.showChart||(u.chartLoading=!0),u.showChart=!0,h&&h.cancel(),(h=e.eqlQuery(i)).then(function(e){u.chartLoading&&(u.chartLoading=!1),u.loadingSourceChannels=!1,e&&e.parsed&&e.parsed.length>0?function(e){if(!e.parsed)return;e.parsed.forEach(function(e){var t=e.row.datasource.datasource_id;u.dataStructure[t]||(u.dataStructure[t]={}),e.row.datasource.channel.forEach(function(a){var n=a.channel_classifier_id;u.dataStructure[t][n]||(u.dataStructure[t][n]={flowId:"",values:[],annotations:[],isSource:!0,channelClassifierId:a.channel_classifier_id,visible:!0}),u.dataStructure[t][n].values.push([e.row.timestamp,a.value]),u.dataStructure[t][n].deleted=!1;var r=T(a.channel_classifier_id,u.datasources,t);r&&(u.dataStructure[t][n].unitType=r),u.flowStructure[t]||g(t),u.flowStructure[t][n]||p(t,n),u.flowStructure[t][n].annotations[n]||(u.flowStructure[t][n].annotations[n]={annotations:{}}),a.annotation.forEach(function(a){u.flowStructure[t][n].annotations[n].annotations[a.sequence_id]||(u.flowStructure[t][n].annotations[n].annotations[a.sequence_id]={}),u.flowStructure[t][n].annotations[n].annotations[a.sequence_id][a.annotation]||(u.flowStructure[t][n].annotations[n].annotations[a.sequence_id][a.annotation]={properties:a.properties,indexes:[]}),u.flowStructure[t][n].annotations[n].annotations[a.sequence_id][a.annotation].indexes.push(e.row.timestamp),C(t,n,e.row.timestamp,a)})})})}(e):(u.showChart=!0,u.chartLoading=!1,u.noDataAvailable=!0)},function(e){u.chartLoading&&(u.chartLoading=!1),u.loadingSourceChannels=!1})}},u.toggleSourceChannelSelector=function(e){u.loadAllSourceChannels?u.loadRawData(!1,!0):e?u.showSourceChannelSelector=!1:(u.showSourceChannelSelector=!0,u.datasources.forEach(function(e){if(u.dataStructure[e.id]){var t=u.dataStructure[e.id];Object.keys(t).forEach(function(a){e.channels.forEach(function(n){a!==n.id||t[a].deleted||(n.loadedInChart=!0,e.loadedInChart=!0)})})}}))},u.addSourceChannelsToChart=function(e){u.sourceChannelsToLoad=e,u.loadRawData(u.sourceChannelsToLoad),u.toggleSourceChannelSelector(!0)};var v=null;function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a={query:"SELECT STRUCT(timestamp, STRUCT(flow_id, ARRAY[STRUCT(channel_classifier_id, value, ARRAY(SELECT AS STRUCT annotation, sequence_id, ARRAY_AGG(STRUCT(key, value))))] AS channel) AS flow) AS row FROM flows WHERE flow_id IN ("+("'"+(t=t.filter(Boolean)).join("', '")+"'")+") AND timestamp > '"+moment(u.startTime).utc().format("YYYY-MM-DDTHH:mm:ss")+"' AND timestamp <= '"+moment(u.endTime).utc().format("YYYY-MM-DDTHH:mm:ss")+"' GROUP BY timestamp, flow_id, channel_classifier_id, value ORDER BY timestamp, flow_id ",limit:99999};u.chartLoading=!0,v&&v.cancel(),(v=e.eqlQuery(a)).then(function(e){e&&e.parsed?(!function(e){e.parsed.forEach(function(e){var t=e.row.flow.flow_id,a=u.flowStructure.getDatasourceByFlowId(t);u.dataStructure[a]||(u.dataStructure[a]={}),e.row.flow.channel.forEach(function(n){var r=n.channel_classifier_id;u.flowStructure.getFlowClassifierByFlowId(t)&&(r=u.flowStructure.getFlowClassifierByFlowId(t)+" - "+n.channel_classifier_id),u.dataStructure[a][r]||(u.dataStructure[a][r]={flowId:t,values:[],annotations:[],isSource:w(a,n.channel_classifier_id),channelClassifierId:n.channel_classifier_id,visible:!0});var i=T(n.channel_classifier_id,u.datasources,a);i&&(u.dataStructure[a][r].unitType=i),u.dataStructure[a][r].values.push([e.row.timestamp,n.value]),u.flowStructure[a]||g(a),u.flowStructure[a][r]||p(a,r),u.flowStructure[a][r].annotations[t]||(u.flowStructure[a][r].annotations[t]={annotations:{}}),n.annotation.forEach(function(i){u.flowStructure[a][r].annotations[t].annotations[i.sequence_id]||(u.flowStructure[a][r].annotations[t].annotations[i.sequence_id]={}),u.flowStructure[a][r].annotations[t].annotations[i.sequence_id][i.annotation]||(u.flowStructure[a][r].annotations[t].annotations[i.sequence_id][i.annotation]={properties:i.properties,indexes:[]}),u.flowStructure[a][r].annotations[t].annotations[i.sequence_id][i.annotation].indexes.push(e.row.timestamp),C(a,r,e.row.timestamp,i,n.channel_classifier_id)})})})}(e),u.showChart=!0,u.chartLoading=!1,u.noDataAvailable=!1):u.loadRawData(!1,!0)},function(e){u.showChart=!1,u.chartLoading=!1,u.noDataAvailable=!0})}function w(e,t){var a=u.datasources.filter(function(t){return t.id===e});if(a.length<=0)return!0;var n=a[0].channels.filter(function(e){return e.classifier===t});return n.length<=0||n[0].isSource}function T(e,t,a){var n=!1;if(e&&a&&t){var r=t.filter(function(e){return e.id===a});if(r&&1===r.length&&r[0].channels){var i=r[0].channels.filter(function(t){return t.id===e});i&&1===i.length&&i[0].unitType&&(n=i[0].unitType)}}return n}function C(e,t,a,n,r){var i=u.dataStructure[e][t].annotations.filter(function(e){return e.id===n.annotation&&e.sequenceId===n.sequence_id}),o=T(r,u.datasources,e);o&&(u.dataStructure[e][t].unitType=o),0===i.length?u.dataStructure[e][t].annotations.push({id:n.annotation,sequenceId:n.sequence_id,values:[[a,n.properties]]}):(i.length,i[0].values.push([a,n.properties]))}u.icapNitsAvailable=function(){var e=!1;return u.datasources?(u.datasources.forEach(function(t){t.tags&&t.tags.forEach(function(t){"icap"!==t.description&&"nits"!==t.description||(e=!0)})}),e):e},u.onFlowSelected=function(e,t,a,n){m(),f(),S(u.flowStructure.getSelectedFlowIds())},u.onChartLoaded=function(){u.chartLoaded=!0,u.dataStrucLength=Object.keys(u.dataStructure).length},s.localStorage.loadAllSourceChannels?u.loadAllSourceChannels=JSON.parse(s.localStorage.loadAllSourceChannels):u.loadAllSourceChannels=!1,u.changeCheckBoxAllSourceChannels=function(){s.localStorage.setItem("loadAllSourceChannels",u.loadAllSourceChannels)},u.toggleChartEdit=function(){c.$broadcast("chartEditToggle")},angular.element(s).bind("keydown",function(e){27===e.keyCode&&(e.preventDefault(),u.toggleSourceChannelSelector(!0),i.$apply())}),i.$on("$destroy",function(){angular.element(s).unbind("keydown"),h&&h.cancel(),v&&v.cancel()})}angular.module("console.datasources").controller("DatasourcesViewController",e),e.$inject=["QueryService","FlowService","UserService","$stateParams","$state","$scope","TagService","$window","DataSourceService","$rootScope"]}(),function(){function e(e,t,a,n,r,i,o){var s=this;function l(){s.resultLimit=20,s.chunkSize=s.resultLimit,s.resultLimitDefault=20,s.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],s.tab=1,s.nameValidationPattern="^[a-zA-Z0-9-_]+$",s.showMoreResults=x,s.resetResultLimit=F,s.resetFilter=O,s.updateResultLimit=E,s.checkAll=M,s.unCheckAll=L,s.deleteSelected=I,s.setTab=b,s.tabIsSet=D,s.newTagAddProperty=y,s.newTagDeleteProperty=k,s.addTag=c,s.deleteTags=d,s.updateDatasourceProperties=T,s.getAvailableTagNames=f,s.getPropertyKeysForTagName=p,s.removePropertyFromTags=h,s.cancelUpdateTags=S,s.addPropertyToTag=v,s.saveUpdateTags=w,s.updateTagValidFrom=m,s.updateTagDescription=g,s.resetAddTagForm=u,s.newTag={properties:[],validFrom:moment().format()},o.datasources?(s.datasources=o.datasources,s.datasources.forEach(function(e){e.selected=!1}),o.collection&&(s.fromCollection=!0),C()):s.noDatasources=!0}function c(e,a){if(s.duplicateTagsDatasources=[],!s.addTagForm.$valid)return!1;if(0===s.newTag.properties.length)return s.noProperties=!0,!1;s.addTagForm.$setPristine(),s.addTaggLoading=!0;var n={properties:s.newTag.properties,tag:s.newTag.name,description:s.newTag.description,validFrom:moment.utc(s.newTag.validFrom).format("YYYY-MM-DDTHH:mm:ss.SSS")},r=[];e||(e=s.datasources);var o=[];e.forEach(function(e){e.tags.forEach(function(t){t.tag===n.tag.toLowerCase()&&o.push(e.id)}),r.push({datasourceId:e.id,tags:n})}),o.length>0&&!a?s.duplicateTagsDatasources=o:(o.forEach(function(e){r.forEach(function(t,a){e===t.datasourceId&&r.splice(a,1)})}),s.duplicateTagsDatasources=[],t.addTags(r).then(function(){s.addTaggLoading=!1,s.datasources.forEach(function(e){e.tags.push(n),n.properties.forEach(function(t){e.allTagProperties.push(t)})}),f(),C(),u(),b(1),R(i("translate")("Tag added succesfully")),A(s.datasources)},function(e){s.addTaggLoading=!1,e.data&&e.data.error?P(i("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")"):P(i("translate")("feedback.messages.error"))}))}function u(){s.newTag={name:"",description:"",properties:[],validFrom:moment().format()},s.newTagPropertyKey="",s.newTagPropertyValue=""}function d(e){if(!s.delateTagsForm.$valid)return!1;var a=[],n=[];s.tagList.forEach(function(e){e.selected&&n.push({tag:e.name})}),e||(e=s.datasources),e.forEach(function(e){var t={datasourceId:"",tags:[]};if(e.tags){var r=[];e.tags.forEach(function(e){n.forEach(function(t){t.tag===e.tag&&r.push({tag:e.tag})})}),t={datasourceId:e.id,tags:r}}t.tags.length>0&&a.push(t)}),s.deleteTagLoading=!0,t.removeTags(a).then(function(){s.deleteTagLoading=!1,n.forEach(function(t){e.forEach(function(e){e.tags.forEach(function(a,n){t.tag===a.tag&&e.tags.splice(n,1)})})}),s.tagList.forEach(function(e,t){e.selected&&s.tagList.splice(t,1)}),R(i("translate")("Tag(s) removed succesfully")),f(),C(),A(s.datasources)},function(e){s.deleteTagLoading=!1,e.data&&e.data.error&&e.data.error.message?P(i("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")"):P(i("translate")("feedback.messages.error"))})}function f(){var e=[];return s.updateTagDatasources||(s.updateTagDatasources=angular.copy(s.datasources)),s.updateTagDatasources.forEach(function(t){t.tags.forEach(function(t){-1===e.indexOf(t.tag.toLowerCase())&&e.push(t.tag.toLowerCase())})}),e.sort()}function m(e,t,a){if(s.override[e].validFromInvalid=!1,!s.override[e].validFromValue)return s.override[e].validFromOverride=!1,void(s.override[e].validFromInvalid=!0);s.updateTagDatasources||(s.updateTagDatasources=angular.copy(s.datasources)),s.updateTagDatasources.forEach(function(a){a.tags.forEach(function(n){n.tag.toLowerCase()===e.toLowerCase()&&(n.validFrom=moment.utc(t).format("YYYY-MM-DDTHH:mm:ss.SSS"),n.modified=!0,a.modified=!0)})})}function g(e,t,a){if(s.override[e].descriptionInvalid=!1,!t)return s.override[e].descriptionInvalid=!0,void(s.override[e].descriptionOverride=!1);s.updateTagDatasources||(s.updateTagDatasources=angular.copy(s.datasources)),s.updateTagDatasources.forEach(function(a){a.tags.forEach(function(n){n.tag.toLowerCase()===e.toLowerCase()&&(n.description=t,n.modified=!0,a.modified=!0)})})}function p(e){var t=[];return s.updateTagDatasources||(s.updateTagDatasources=angular.copy(s.datasources)),s.updateTagDatasources.forEach(function(a){a.tags.forEach(function(a){a.tag.toLowerCase()===e.toLowerCase()&&a.properties.forEach(function(e){-1===t.indexOf(e.key.toLowerCase())&&t.push(e.key.toLowerCase())})})}),t.sort()}function h(e,t){s.updateTagDatasources||(s.updateTagDatasources=angular.copy(s.datasources)),s.updateTagDatasources.forEach(function(a){a.tags.forEach(function(n){n.tag.toLowerCase()===t.toLowerCase()&&n.properties.filter(function(t){return t.key.toLowerCase()===e.toLowerCase()}).forEach(function(e){n.modified=!0,a.modified=!0,n.properties.splice(n.properties.indexOf(e),1)})})})}function v(e,t){t&&t.key&&t.value?(s.newTagPropertyHasErrors=!1,s.updateTagDatasources||(s.updateTagDatasources=angular.copy(s.datasources)),s.updateTagDatasources.forEach(function(a){a.tags.forEach(function(n){n.tag.toLowerCase()===e.toLowerCase()&&(n.modified=!0,a.modified=!0,n.properties.push(angular.copy(t)))})}),t.key="",t.value=""):s.newTagPropertyHasErrors=!0}function S(){s.newTagPropertyHasErrors=!1,s.updateTagDatasources=angular.copy(s.datasources)}function w(){s.noUpdatedTags=!1;var e=[];if(s.updateTagDatasources){s.updateTagDatasources.forEach(function(t){t.modified&&e.push({datasourceId:t.id,tags:t.tags.filter(function(e){return e.modified})})});for(var a=!1,n=0;n<s.updateTagDatasources.length;n++)if(!0===s.updateTagDatasources[n].modified){a=!0;break}a?(s.updateTagLoading=!0,t.updateTags(e).then(function(e){s.updateTagLoading=!1,s.override=[],s.updateTagDatasources.forEach(function(e){e.modified=!1,T(e)}),R(i("translate")("feedback.messages.ok")),s.datasources=s.updateTagDatasources,A(s.datasources)},function(e){s.updateTagLoading=!1,P(i("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")")})):s.noUpdatedTags=!0}}function T(e){s.datasources.forEach(function(t){t.id===e.id&&(t.tags=e.tags,t.allTagProperties=function(e){var t=[];return e.tags.forEach(function(e){t=t.concat(e.properties)}),t}(t))}),A(s.datasources)}function C(){var e,t=[],a=[];s.datasources.forEach(function(e){e.tags.forEach(function(e){t.push(e.tag)})}),e=new Set(t),(t=Array.from(e)).forEach(function(e){a.push({name:e})}),s.tagList=a}function y(){var e;s.addTagkeyAlreadyExists=!1,s.newTag.properties.forEach(function(t){t.key===s.newTagPropertyKey&&(e=!0)}),e?s.addTagkeyAlreadyExists=!0:s.newTagPropertyKey&&s.newTagPropertyValue&&!s.newTagPropertyCheck.keyInput.$error.pattern?(s.newTag.properties.push({key:s.newTagPropertyKey,value:s.newTagPropertyValue}),s.newTagPropertyHasErrors=!1,s.newTagPropertyKey="",s.newTagPropertyValue=""):s.newTagPropertyHasErrors=!0}function k(e){s.newTag.properties.splice(e,1)}function A(e){if(e){var t=n.localStorage.getItem("ewxCollectedDatasources");(t=JSON.parse(t))&&(t.forEach(function(t){e.forEach(function(e){t.id===e.id&&(t.tags=e.tags)})}),n.localStorage.setItem("ewxCollectedDatasources",JSON.stringify(t)))}}function b(e){s.tab=e}function D(e){return s.tab===e}function E(){s.resultLimit=s.chunkSize}function M(e){for(var t=0;t<e.length;t++)t<s.resultLimit&&(e[t].selected=!0)}function L(e){for(var t=0;t<e.length;t++)t<s.resultLimit&&(e[t].selected=!1)}function I(e){for(var t=e.length-1;t>=0;--t)e[t].selected&&e.splice(t,1)}function x(){s.resultLimit=s.resultLimit+s.resultLimitDefault}function F(){s.resultLimit=s.resultLimitDefault}function O(){s.filterListing="",s.resultLimit=s.resultLimitDefault}function R(t,a){e.addMessage({type:a,message:t})}function P(e){R(e,"error")}a.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time),s.userSettings.defaultChunkSize&&(s.resultLimit=parseInt(s.userSettings.defaultChunkSize)||20,s.resultLimitDefault=parseInt(s.userSettings.defaultChunkSize)||20,s.chunkSize=s.resultLimit),l()},function(e){l()}),s.getUpdatesFromDatasourceProperties=function(e){e.viewMode=!1,T(e)},r.$watch("vm.datasources",function(){s.datasources&&(s.selectedFilesDetected=!1,s.datasources.forEach(function(e){e.selected&&(s.selectedFilesDetected=!0)}))},!0),r.$watch("vm.newTag.properties",function(){s.newTag&&s.newTag.properties.length>0&&(s.noProperties=!1)},!0)}angular.module("console.datasources").controller("TagManagementController",e),e.$inject=["feedbackService","TagService","UserService","$window","$scope","$filter","$stateParams"]}(),function(){function e(e,t,a,n,r,i,o){var s=this;function l(e,t){n.addMessage({type:t,message:e})}function c(e){l(e,"error")}s.savingDecisionTree=!1,s.decisionTreeSaving=!1,s.decisionTreeTesting=!1,s.selectedTestDatasource=null,s.cmOption={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!1,readOnly:!1,indentUnit:4,mode:"python",theme:"ewx-dark"},s.decisionTreeTypes=["flow_configuration","rule_parameters"],s.decisionTree={decisionTreeType:"flow_configuration"},s.saveDecisionTree=function(){if(!s.decisionTreeForm.$valid)return!1;s.decisionTreeSaving=!0,t.createDecisionTree(s.decisionTree).then(function(e){var t=e.data;o(function(){s.refreshCodemirror=!0,o(function(){s.refreshCodemirror=!1}),l(r("translate")("feedback.messages.ok")),s.decisionTreeSaving=!1,i.go("console.decision-tree.details",{decisionTreeId:t.id})},200)},function(e){400===e.data.error.code&&e.data.error.message?c(e.data.error.message):c(r("translate")("feedback.messages.error")),s.decisionTreeSaving=!1})},s.toggleSearchDatasourceId=function(){s.searchDatasourceActive=!s.searchDatasourceActive},s.selectDatasourceId=function(e){s.selectedTestDatasource=e,s.selectedTestDatasource.channels.length>0&&(s.selectedChannel=s.selectedTestDatasource.channels[0].id),s.searchDatasourceActive=!1,s.testDecisionTree()},s.testDecisionTree=function(){if(s.selectedTestDatasource){s.decisionTreeTesting=!0;var e={datasourceId:s.selectedTestDatasource.id,sourceChannelId:s.selectedChannel,pythonCode:s.decisionTree.pythonCode};t.testDecisionTree(e).then(function(e){s.decisionTreeTesting=!1,e.data.result?l("Result: "+e.data.result):c("Decision Tree didn't generate a result")},function(e){s.decisionTreeTesting=!1,e.data.error.message?c(e.data.error.message):c(r("translate")("feedback.messages.error"))})}else s.searchDatasourceActive=!0}}angular.module("console.decision-tree").controller("CreateDecisionTreeController",e),e.$inject=["UserService","DecisionTreeService","$stateParams","feedbackService","$filter","$state","$timeout"]}(),function(){function e(e,t,a,n,r,i,o){var s=this;if(s.decisionTreeLoading=!1,s.savingDecisionTree=!1,s.deletingDecisionTree=!1,s.blocklyDecisionTree="<xml></xml>",s.blocklyDecisionTreeLoading=!1,s.decisionTreeSaving=!1,s.decisionTreeTesting=!1,s.selectedTestDatasource=null,s.cmOption={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!1,readOnly:!1,indentUnit:4,mode:"python",theme:"ewx-dark"},s.decisionTreeTypes=["flow_configuration","rule_parameters"],s.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time)},function(e){}),a.decisionTreeId){var l=a.decisionTreeId;a.decisionTree?(s.decisionTree=a.decisionTree,o(function(){c()},10)):function(e){s.decisionTreeLoading=!0,t.getDecisionTree(e).then(function(e){s.decisionTree=e.data,s.decisionTreeLoading=!1,o(function(){c()},10)},function(e){s.decisionTreeLoading=!1,d(r("translate")("feedback.messages.errorNotFound")),i.go("console.decision-tree")})}(l)}function c(){s.refreshCodemirror=!0,o(function(){s.refreshCodemirror=!1})}function u(e,t){n.addMessage({type:t,message:e})}function d(e){u(e,"error")}s.saveDecisionTree=function(){if(!s.decisionTreeForm.$valid)return!1;s.decisionTreeSaving=!0,t.updateDecisionTree(s.decisionTree).then(function(e){s.decisionTree=e.data,c(),u(r("translate")("feedback.messages.ok")),s.decisionTreeSaving=!1},function(e){400===e.data.error.code&&e.data.error.message?d(e.data.error.message):d(r("translate")("feedback.messages.error")),s.decisionTreeSaving=!1})},s.deleteDecisionTree=function(){s.deletingDecisionTree=!0,s.showDeleteConfirm=!1;var e=s.decisionTree.id;t.deleteDecisionTree(e).then(function(){s.deletingDecisionTree=!1,u(r("translate")("feedback.messages.ok")),i.go("console.decision-tree")},function(){s.deletingDecisionTree=!1,d(r("translate")("feedback.messages.error"))})},s.toggleSearchDatasourceId=function(){s.searchDatasourceActive=!s.searchDatasourceActive},s.selectDatasourceId=function(e){s.selectedTestDatasource=e,s.selectedTestDatasource.channels.length>0&&(s.selectedChannel=s.selectedTestDatasource.channels[0].id),s.searchDatasourceActive=!1,s.testDecisionTree()},s.testDecisionTree=function(){if(s.selectedTestDatasource){s.decisionTreeTesting=!0;var e={datasourceId:s.selectedTestDatasource.id,sourceChannelId:s.selectedChannel,pythonCode:s.decisionTree.pythonCode};t.testDecisionTree(e).then(function(e){s.decisionTreeTesting=!1,e.data.result?u("Result: "+e.data.result):d("Decision Tree didn't generate a result")},function(e){s.decisionTreeTesting=!1,e.data.error.message?d(e.data.error.message):d(r("translate")("feedback.messages.error"))})}else s.searchDatasourceActive=!0}}angular.module("console.decision-tree").controller("DecisionTreeDetailsController",e),e.$inject=["UserService","DecisionTreeService","$stateParams","feedbackService","$filter","$state","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e,a){t.addMessage({type:a,message:e})}l.tagValidationPattern="^[a-zA-Z0-9-_]+$",l.tags=[],a.files&&(l.files=a.files,function(){l.readOnlyFiles=[];var e=[];l.files.forEach(function(t){t.readOnly?l.readOnlyFiles.push(t):e.push(t)}),l.files=e}()),l.addTag=function(){if(l.hasDuplicateName=!1,!l.addTagForm.$valid)return!1;l.tags.indexOf(l.tag)>-1?l.hasDuplicateName=!0:(l.tags.push(l.tag),l.addTagForm.$submitted=!1)},l.removeTag=function(e){l.tags.splice(e,1)},l.tagNameChanged=function(){l.hasDuplicateName=!1},l.saveTags=function(){if(l.addTagLoading=!0,!l.addTagForm.$valid)return l.addTagLoading=!1,!1;var t=[];l.files.forEach(function(e){e.tags||(e.tags=[]),t.push(e.blobKey)});for(var i=[];t.length>0;)i.push(t.splice(0,15));var o=0;i.forEach(function(t){o++,function(t,i,o,u){e.addTags(t,i).then(function(){o===u&&s(function(){l.addTagLoading=!1,c(n("translate")("feedback.messages.ok")),a.results&&(l.originalResults=a.results,l.files.forEach(function(e){l.originalResults.forEach(function(t){e.blobKey===t.blobKey&&(t.tags||(t.tags=[]),l.tags.forEach(function(e){t.tags.push(e)}))})})),r.go("console.file-management",{updatedResults:l.originalResults,originalPageToken:a.pageToken,originalMoreResultsAvailable:a.moreResultsAvailable,originalLimitQuantity:a.limitQuantity})},2e3)},function(e){l.addTagLoading=!1,c(n("translate")("feedback.messages.error"),"error")})}(t,l.tags,i.length,o)})},angular.element(i).bind("keydown",function(e){27===e.keyCode&&"console.file-management.add-tags"===r.$current.name&&(e.preventDefault(),r.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.file-management").controller("FileManagementAddTagsController",e),e.$inject=["StorageService","feedbackService","$stateParams","$filter","$state","$window","$scope","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;function u(){n.go("^")}function d(e){c.marketAdapterType=e,c.searchMarketAdaptersActive=!c.searchMarketAdaptersActive}c.assignMarketAdapter=function(){if(!c.overrideMarketAdapter&&c.files.length>1){var t=0;c.files.forEach(function(e){e.marketAdapterId&&t++}),t===c.files.length&&(c.validMarketAdapter=!0)}if(c.assignMarketAdapterForm.$valid&&c.validMarketAdapter){c.isSaving=!0;var a=[];c.files.forEach(function(e){a.push(e.blobKey)}),e.assignMarketAdapter(a,c.selectedMarketAdapter.id).then(function(e){l(function(){a.length>1?m(s("translate")("feedback.messages.updatedFilesOk",{length:c.files.length})):m(s("translate")("feedback.messages.updatedFileOk",{file:c.files[0].filename})),c.isSaving=!1,u(),n.go("console.file-management",{},{reload:!0})},2e3)},function(e){e.data&&e.data.error&&e.data.error.message?g(s("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):g(s("translate")("feedback.messages.error")),c.isSaving=!1})}},c.closeSheet=u,c.toggleSearchMarketAdapter=d,c.setSelectedMarketAdapter=function(e){c.manualCheckMarketAdapter=!1,c.selectedMarketAdapter=e,c.validMarketAdapter=!0,c.invalidMarketAdapterId=!1,d()},c.selectedMarketAdapterCheck=function(){c.manualCheckMarketAdapter=!0,c.selectedMarketAdapter&&c.selectedMarketAdapter.id&&function(e){f&&f.cancel();c.isLoadingMarketAdapter=!0,c.invalidMarketAdapterId=!1,c.validMarketAdapter=!1,(f=o.getMarketAdapterDetails(e)).then(function(e){c.selectedMarketAdapter=e.data,c.isLoadingMarketAdapter=!1,c.manualCheckMarketAdapter=!1,c.validMarketAdapter=!0},function(e){c.isLoadingMarketAdapter=!1,400!==e.status&&404!==e.status||(c.invalidMarketAdapterId=!0)})}(c.selectedMarketAdapter.id)},c.selectedMarketAdapterChange=function(){c.validMarketAdapter=!1,c.invalidMarketAdapterId=!1},c.resetMarketAdapter=function(){c.selectedMarketAdapter={}},c.loadingMarketAdapters=!0,c.isSaving=!1,c.useStreaming=!1,c.validMarketAdapter=!1,a.files?(c.files=a.files,function(e){c.readOnlyFiles=[];var t=[];e.forEach(function(e){e.readOnly?c.readOnlyFiles.push(e):t.push(e)}),c.files=t,function(e){c.filesWithMarketAdapter=[],e.forEach(function(e){e.marketAdapterId&&c.filesWithMarketAdapter.push(e)}),c.readOnlyFiles.length>0&&0===c.files.length?c.onlyReadOnlyFilesSelected=!0:c.onlyReadOnlyFilesSelected=!1}(c.files)}(c.files)):n.go("^");var f=null;function m(e,a){t.addMessage({type:a,message:e})}function g(e){m(e,"error")}angular.element(r).bind("keydown",function(e){27===e.keyCode&&("console.file-management.assign-market-adapter"!==n.$current.name||c.searchMarketAdaptersActive?i.$apply(function(){d()}):(e.preventDefault(),n.go("^")))}),i.$on("$destroy",function(){angular.element(r).unbind("keydown")}),angular.element(document).ready(function(){c.selectedMarketAdapter&&c.selectedMarketAdapter.id||document.getElementById("fileIngestMarketAdapterId")&&document.getElementById("fileIngestMarketAdapterId").focus()})}angular.module("console.file-management").controller("FileManagementAssignMarketAdapterController",e),e.$inject=["StorageService","feedbackService","$stateParams","$state","$window","$scope","MarketAdapterService","$filter","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s,l,c){var u=this;function d(){u.file.fileContentDescriptor&&u.file.blobKey&&(u.checkingSoapEndpoints=!0,u.operationList=[],u.file.fileContentDescriptor&&u.file.fileContentDescriptor.files&&u.file.fileContentDescriptor.files.length>0&&u.file.fileContentDescriptor.files.forEach(function(e){e.name&&u.operationList.push(e.name)}),u.soapEndpoints=[],function e(a){var n={blobKey:u.file.blobKey,limit:100};a&&(n.pageToken=a);t.getSoapEndpoints(n).then(function(t){var a=t.data;a.soapEndpoints&&a.soapEndpoints.forEach(function(e){u.soapEndpoints.push(e)}),a.pageToken?e(a.pageToken):u.checkingSoapEndpoints=!1},function(e){u.checkingSoapEndpoints=!1,u.errorDialog=!0})}())}function f(){u.newSoapEndpoint={},u.newSoapEndpointActive=!u.newSoapEndpointActive}function m(e){u.marketAdapterType=e,u.searchMarketAdaptersActive=!u.searchMarketAdaptersActive}function g(e,t){n.addMessage({type:t,message:e})}function p(e){g(e,"error")}u.tagValidationPattern="^[a-zA-Z0-9-_]+$",u.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",u.removeTag=function(t){var a=u.file.tags.indexOf(t);e.deleteTags(u.file.blobKey,t).then(function(){u.file.tags.splice(a,1),c(function(){o.go(o.current,{file:u.file},{reload:!0})},200)},function(e){})},u.addTag=function(){if(u.hasDuplicateName=!1,u.addTagLoading=!0,!u.addTagForm.$valid)return u.addTagLoading=!1,!1;u.file.tags||(u.file.tags=[]);if(u.file.tags.indexOf(u.newTag)>-1)return u.hasDuplicateName=!0,void(u.addTagLoading=!1);e.addTags(u.file.blobKey,u.newTag).then(function(){u.file.tags.push(u.newTag),c(function(){u.addTagLoading=!1,o.go(o.current,{file:u.file},{reload:!0})},200)},function(e){u.addTagLoading=!1,p(i("translate")("feedback.messages.error"))})},u.lockedTag=function(e){if("console"===e||"manual"===e)return!0},u.downloadFile=function(e){s.open(e+"?namespace_id="+active_namespace_id)},u.newSoapEndpointMode=f,u.closeSheet=function(){u.newSoapEndpointActive=!1,o.go("console.file-management")},u.toggleSearchMarketAdapter=m,u.selectedMarketAdapter=function(e){"marketAdapterIdOut"===u.marketAdapterType?u.newSoapEndpoint.marketAdapterIdOut=e.id:u.newSoapEndpoint.marketAdapterIdIn=e.id;m()},u.createSoapEndpoint=function(){if(!u.newSoapEndpointForm.$valid)return!1;u.isCreatingSoapEndpoint=!0,u.newSoapEndpoint.blobKey=u.file.blobKey,t.createSoapEndpoint(u.newSoapEndpoint).then(function(e){c(function(){u.isCreatingSoapEndpoint=!1,g(i("translate")("feedback.messages.ok")),f(),d()},200)},function(e){u.isCreatingSoapEndpoint=!1,p(i("translate")("feedback.messages.error"))})},r.file?(u.file=r.file,d()):o.go("^"),a.getUserSettings().then(function(e){u.userSettings=e,u.userSettings.defaultDateTime&&(u.userDateTimeFormat=u.userSettings.defaultDateTime.date+" "+u.userSettings.defaultDateTime.time)},function(e){}),angular.element(s).bind("keydown",function(e){27===e.keyCode&&("console.file-management.details"!==o.$current.name||u.searchMarketAdaptersActive?l.$apply(function(){m()}):(e.preventDefault(),o.go("^")))}),l.$on("$destroy",function(){angular.element(s).unbind("keydown")})}angular.module("console.file-management").controller("FileManagementDetailsController",e),e.$inject=["StorageService","SoapService","UserService","feedbackService","$stateParams","$filter","$state","$window","$scope","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;function u(e){c.loadingTransformationConfiguration=!0,t.getTransformationConfiguration(e).then(function(e){c.loadingTransformationConfiguration=!1,c.transformationConfiguration=e.data},function(e){c.loadingTransformationConfiguration=!1})}c.closeSheet=m,c.toggleSearchMarketAdapter=g,c.setSelectedMarketAdapter=function(e){c.manualCheckMarketAdapter=!1,c.selectedMarketAdapter=e,c.validMarketAdapter=!0,c.invalidMarketAdapterId=!1,g(),u(c.selectedMarketAdapter.transformationConfigurationId)},c.selectedMarketAdapterCheck=function(){c.manualCheckMarketAdapter=!0,c.selectedMarketAdapter&&c.selectedMarketAdapter.id&&f(c.selectedMarketAdapter.id)},c.selectedMarketAdapterChange=function(){c.validMarketAdapter=!1,c.invalidMarketAdapterId=!1},c.ingestFiles=function(){if(!c.overrideMarketAdapter&&c.files.length>1){var t=0;c.files.forEach(function(e){e.marketAdapterId&&t++}),t===c.files.length&&(c.validMarketAdapter=!0)}if(c.ingestFilesForm.$valid&&c.validMarketAdapter){c.ingestingFile=!0;var a=[];c.files.forEach(function(e){a.push(e.blobKey)}),c.selectedMarketAdapter&&c.selectedMarketAdapter.id||(c.selectedMarketAdapter={id:null}),e.ingestFiles(a,c.selectedMarketAdapter.id,c.useStreaming).then(function(e){a.length>1?p(l("translate")("feedback.messages.ingestFilesOk",{length:c.files.length})):p(l("translate")("feedback.messages.ingestFileOk",{file:c.files[0].filename})),c.ingestingFile=!1,m()},function(e){e.data&&e.data.error&&e.data.error.message?h(l("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):h(l("translate")("feedback.messages.error")),c.ingestingFile=!1})}},c.resetMarketAdapter=function(){c.selectedMarketAdapter={}},c.loadingMarketAdapters=!0,c.ingestingFile=!1,c.useStreaming=!1,c.validMarketAdapter=!1,n.files?(c.files=n.files,1===c.files.length&&c.files[0].marketAdapterId?(c.selectedMarketAdapter={id:c.files[0].marketAdapterId},f(c.selectedMarketAdapter.id)):(c.filesWithoutMarketAdapter=[],c.files.forEach(function(e){e.marketAdapterId||c.filesWithoutMarketAdapter.push(e)}))):r.go("^");var d=null;function f(e){d&&d.cancel(),c.isLoadingMarketAdapter=!0,c.invalidMarketAdapterId=!1,c.validMarketAdapter=!1,(d=s.getMarketAdapterDetails(e)).then(function(e){c.selectedMarketAdapter=e.data,c.isLoadingMarketAdapter=!1,c.manualCheckMarketAdapter=!1,c.validMarketAdapter=!0,u(c.selectedMarketAdapter.transformationConfigurationId)},function(e){c.isLoadingMarketAdapter=!1,400!==e.status&&404!==e.status||(c.invalidMarketAdapterId=!0)})}function m(){r.go("^")}function g(e){c.marketAdapterType=e,c.searchMarketAdaptersActive=!c.searchMarketAdaptersActive}function p(e,t){a.addMessage({type:t,message:e})}function h(e){p(e,"error")}angular.element(i).bind("keydown",function(e){27===e.keyCode&&("console.file-management.ingest"!==r.$current.name||c.searchMarketAdaptersActive?o.$apply(function(){g()}):(e.preventDefault(),r.go("^")))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")}),angular.element(document).ready(function(){c.selectedMarketAdapter&&c.selectedMarketAdapter.id||document.getElementById("fileIngestMarketAdapterId")&&document.getElementById("fileIngestMarketAdapterId").focus()})}angular.module("console.file-management").controller("FileManagementIngestController",e),e.$inject=["StorageService","IngestService","feedbackService","$stateParams","$state","$window","$scope","MarketAdapterService","$filter"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e){if("console"===e||"manual"===e)return!0}function u(e,a){t.addMessage({type:a,message:e})}l.tagList=[],l.selectAll=function(){l.tagList.forEach(function(e){c(e.tag)||(e.selected=!0)})},l.unSelectAll=function(){l.tagList.forEach(function(e){e.selected=!1})},l.removeTags=function(){l.removeTagLoading=!0;var t=[];l.tagList.forEach(function(e){e.selected&&t.push(e.tag)}),l.selectedTags=t;var i=[];l.files.forEach(function(e){e.readOnly||i.push(e.blobKey)});var o=[];for(;i.length>0;)o.push(i.splice(0,15));var c=0;o.forEach(function(i){c++,function(t,i,o,c){e.deleteTags(t,i).then(function(){o===c&&s(function(){a.results&&(l.originalResults=a.results,l.files.forEach(function(e){l.originalResults.forEach(function(t){e.blobKey===t.blobKey&&(t.tags||(t.tags=[]),l.selectedTags.forEach(function(e){var a=t.tags.indexOf(e);-1!==a&&t.tags.splice(a,1)}))})})),l.removeTagLoading=!1,u(n("translate")("feedback.messages.removed")),r.go("console.file-management",{updatedResults:l.originalResults,originalPageToken:a.pageToken,originalMoreResultsAvailable:a.moreResultsAvailable,originalLimitQuantity:a.limitQuantity})},2e3)},function(e){l.removeTagLoading=!1,u(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")","error")})}(i,t,o.length,c)})},l.lockedTag=c,a.files&&(l.files=a.files,function(){l.readOnlyFiles=[];var e=[];l.files.forEach(function(t){t.readOnly?l.readOnlyFiles.push(t):e.push(t)}),l.files=e,function(e){var t=[];e.forEach(function(e){e.tags&&!e.readOnly&&e.tags.forEach(function(e){t.push(e)})});var a=[];t.forEach(function(e){a.indexOf(e)<0&&a.push(e)}),a.forEach(function(e){var t={tag:e};l.tagList.push(t)})}(l.files)}()),o.$watch("vm.tagList",function(){l.tagList&&(l.selectedFilesDetected=!1,l.tagList.forEach(function(e){e.selected&&(l.selectedFilesDetected=!0)}))},!0),angular.element(i).bind("keydown",function(e){27===e.keyCode&&"console.file-management.remove-tags"===r.$current.name&&(e.preventDefault(),r.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.file-management").controller("FileManagementRemoveTagsController",e),e.$inject=["StorageService","feedbackService","$stateParams","$filter","$state","$window","$scope","$timeout"]}(),function(){function e(e){var t=this;t.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.getUserSettings().then(function(e){t.userSettings=e,t.userSettings.defaultDateTime&&(t.userDateTimeFormat=t.userSettings.defaultDateTime.date+" "+t.userSettings.defaultDateTime.time),t.userSettings.defaultChunkSize&&(t.queryLimit=parseInt(t.userSettings.defaultChunkSize)||20)},function(e){})}angular.module("console.flow-management").controller("RulesOverviewController",e),e.$inject=["UserService"]}(),angular.module("console.flow-management").constant("SearchFlowConstants",{chunkSizeOptions:[10,20,30,40,50,60,70,80,90,100],sourceList:[{key:"Tags",value:"TAG"},{key:"Flows",value:"FLOW"}],operatorList:["=","<",">","=<","=>"],searchFlowKeys:["approval.status","channelClassifierId","datasetMetadata.MERGED.avgLoad","datasetMetadata.MERGED.endDate","datasetMetadata.MERGED.loadFactor","datasetMetadata.MERGED.maxValue","datasetMetadata.MERGED.minValue","datasetMetadata.MERGED.nrValues","datasetMetadata.MERGED.startDate","datasetMetadata.MERGED.usage","datasetMetadata.predForecast.avgLoad","datasetMetadata.predForecast.endDate","datasetMetadata.predForecast.loadFactor","datasetMetadata.predForecast.maxValue","datasetMetadata.predForecast.minValue","datasetMetadata.predForecast.nrValues","datasetMetadata.predForecast.startDate","datasetMetadata.predForecast.usage","datasetMetadata.RAW.avgLoad","datasetMetadata.RAW.endDate","datasetMetadata.RAW.loadFactor","datasetMetadata.RAW.maxValue","datasetMetadata.RAW.minValue","datasetMetadata.RAW.nrValues","datasetMetadata.RAW.startDate","datasetMetadata.RAW.usage","datasourceId","duration","heartbeat","loadShapeType","origin","prAdjustment","qualityScore","status.complete","status.succeeded","timezone"]}),function(){function e(e,t,a,n,r,i,o){var s=this;function l(e){var t,a,n="SELECT\r\n   datasource_id,\r\n   channel_id,\r\n   flow_id,\r\n   CAST(flow_timestamp AS DATETIME) AS flow_timestamp,\r\n   flow_type,\r\n   flow_config,\r\n   channel_classifier_id,\r\n   ARRAY_AGG( STRUCT( props.key AS key, props.value AS value ) ) as properties,\r\n   ARRAY_AGG( STRUCT( CAST(approval_timestamp AS DATETIME) AS approval_timestamp, approved_by, approved_comment ) \r\nORDER BY\r\n   approval_timestamp) AS approvals \r\nFROM\r\n   flow_metadata AS m1 \r\n   LEFT JOIN\r\n      approval USING (flow_id) \r\nWHERE\r\n  STRUCT (flow_timestamp,\r\n    datasource_id,\r\n    channel_classifier_id) IN (\r\n  SELECT\r\n    AS STRUCT MAX(flow_timestamp) AS flow_timestamp,\r\n    datasource_id,\r\n    channel_classifier_id\r\n  FROM\r\n    flow_metadata\r\n  GROUP BY\r\n    datasource_id,\r\n    channel_classifier_id)  \r\n",r="   GROUP BY\r\n      approval_timestamp,\r\n      approved_by,\r\n      approved_comment,\r\n      datasource_id,\r\n      channel_id,\r\n      flow_id,\r\n      flow_timestamp,\r\n      flow_type,\r\n      flow_config,\r\n      channel_classifier_id,\r\n      completed \r\n   ORDER BY\r\n      flow_timestamp DESC,\r\n      approval_timestamp,\r\n      approved_by,\r\n      approved_comment,\r\n      datasource_id,\r\n      channel_classifier_id,\r\n      flow_type,\r\n      completed",i=" AND ";if("all"!==e.flowType&&(i=i+("flow_type = '"+e.flowType+"'")+" \r\n AND "),"approved"===e.approvalStatus?t="\r\n AND approval_timestamp is not NULL \r\n":"unapproved"===e.approvalStatus&&(t="\r\n AND approval_timestamp is NULL \r\n"),e.approvedBy&&"approved"===e.approvalStatus&&(i=i+("approved_by = '"+e.approvedBy+"'")+" \r\n AND "),"all"!==e.flowStatus&&(i=i+("completed = "+e.flowStatus)+" \r\n AND "),e.channelClassifiers.length>0){var o=e.channelClassifiers,l=[];o.forEach(function(e){l.push("'"+e.name+"'")}),i=i+("channel_classifier_id IN ("+l.toString()+")")+" \r\n AND "}if(e.flowStartTimeStamp&&e.flowEndTimeStamp){(a="flow_timestamp >= '"+moment.utc(e.flowStartTimeStamp).format("YYYY-MM-DDTHH:mm:ss.SSS")+"' \r\n AND flow_timestamp <=  '"+moment.utc(e.flowEndTimeStamp).format("YYYY-MM-DDTHH:mm:ss.SSS")+"' \r\n")&&(i+=a);var c,d={query:n+i+r,limit:s.limitQuantity};t&&(d.query=n+i+t+r),s.eqlParams=d,c=d.query,s.advancedQuery=c,u(d)}}function c(e){e?u({query:s.advancedQuery,limit:s.limitQuantity}):l(s.flowSearchConfig)}function u(e,a){s.moreLoading=!0,a||(s.isLoading=!0),s.queryContainsApprovables=!0,t.eqlQuery(e).then(function(e){s.isLoading=!1,s.moreLoading=!1,e&&e.parsed?(a?e.parsed.forEach(function(e){s.queryResults.push(e)}):s.queryResults=e.parsed,e.more?(s.moreResultsAvailable=!0,s.pageToken=e.pageToken):(s.moreResultsAvailable=!1,s.pageToken=null)):s.queryResults=[]},function(e){s.isLoading=!1,s.moreLoading=!1,s.resultAvailable=!1,e.data.error&&e.data.error.message?h(e.data.error.message):h(i("translate")("feedback.messages.error"))})}function d(e){for(var t=!1,a=e.properties.length-1;a>=0;--a)"completed"===e.properties[a].key&&"True"===e.properties[a].value&&(t=!0);return e.approvals.length>0&&e.approvals.forEach(function(e){e.approval_timestamp&&null!==e.approval_timestamp&&(t=!1)}),t}function f(e,t,a){var n=e.properties.filter(function(e){return e.key===t&&e.value===a});return n&&n.length>0}function m(e){s.tab=e}function g(e){return s.tab===e}function p(e,t){r.addMessage({type:t,message:e})}function h(e){p(e,"error")}s.tab=1,s.isLoading=!1,s.moreLoading=!1,s.loadingTagKeys=!0,s.selectActive=!0,s.approveLoading=!1,s.showApproveSelectionDialog=!1,s.unApproved=!0,s.currentStateName=o.current.name,s.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",s.limitQuantity=20,s.setTab=m,s.tabIsSet=g,s.searchFlows=c,s.flowPropertyKeyCheck=f,s.approvableCheck=d,s.flowSearchConfig={flowType:"all",approvalStatus:"all",flowStatus:"all",channelClassifiers:[],flowStartTimeStamp:moment().subtract(1,"month").format(),flowEndTimeStamp:moment().format(),version:"v1"},s.advancedQueryOptions={lineNumbers:!0,indentWithTabs:!0,readOnly:!1,mode:"text/x-sql",theme:"ewx-light-duotone"},s.advancedQuery="SELECT\r\n   datasource_id,\r\n   channel_id,\r\n   flow_id,\r\n   CAST(flow_timestamp AS DATETIME) AS flow_timestamp,\r\n   flow_type,\r\n   flow_config,\r\n   channel_classifier_id,\r\n   ARRAY_AGG( STRUCT( props.key AS key, props.value AS value ) ) as properties,\r\n   ARRAY_AGG( STRUCT( CAST(approval_timestamp AS DATETIME) AS approval_timestamp, approved_by, approved_comment ) \r\nORDER BY\r\n   approval_timestamp) AS approvals \r\nFROM\r\n   flow_metadata AS m1 \r\n   LEFT JOIN\r\n      approval USING (flow_id) \r\nWHERE\r\n   STRUCT (flow_timestamp, datasource_id, channel_classifier_id) IN \r\n   (\r\n      SELECT\r\n         AS STRUCT MAX(flow_timestamp) AS flow_timestamp,\r\n         datasource_id,\r\n         channel_classifier_id \r\n      FROM\r\n         flow_metadata \r\n      GROUP BY\r\n         datasource_id,\r\n         channel_classifier_id\r\n   )\r\n   AND flow_timestamp >= '2018-07-13T13:21:45.000' \r\n   AND flow_timestamp <= '2018-08-13T13:21:45.000' \r\nGROUP BY\r\n   approval_timestamp,\r\n   approved_by,\r\n   approved_comment,\r\n   datasource_id,\r\n   channel_id,\r\n   flow_id,\r\n   flow_timestamp,\r\n   flow_type,\r\n   flow_config,\r\n   channel_classifier_id,\r\n   completed \r\nORDER BY\r\n   flow_timestamp DESC,\r\n   approval_timestamp,\r\n   approved_by,\r\n   approved_comment,\r\n   datasource_id,\r\n   channel_classifier_id,\r\n   flow_type,\r\n   completed",n.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time),s.userSettings.defaultChunkSize&&(s.limitQuantity=s.userSettings.defaultChunkSize)},function(e){}),function t(a,n){s.loadingChannelClassifiers=!0;var r={limit:100};n||(s.availableChannels=[]),a&&(r.pageToken=a),e.getChannelClassifiers(r).then(function(e){if(e.data.items){var a=e.data.items;a.forEach(function(e){s.availableChannels.push(e)})}e.data.nextPageToken?t(e.data.nextPageToken,!0):s.loadingChannelClassifiers=!1},function(e){s.loadingChannelClassifiers=!1,h(i("translate")("feedback.messages.error"))})}(),s.showMoreResults=function(){s.moreLoading||s.pageToken&&s.moreResultsAvailable&&(s.moreLoading=!0,s.eqlParams.pageToken=s.pageToken,u(s.eqlParams,!0))},s.checkAll=function(){s.queryResults.forEach(function(e){d(e)&&(e.selected=!0)})},s.unCheckAll=function(){s.queryResults.forEach(function(e){e.selected=!1})},s.toggleApproveSelectionDialog=function(){s.showApproveSelectionDialog=!s.showApproveSelectionDialog,s.noSelection=!0;var e=s.queryResults.filter(function(e){return!0===e.selected});e&&e.length>0&&(s.noSelection=!1)},s.approveSelection=function(e){if(!s.approveForm.$valid)return s.approveLoading=!1,!1;s.approveLoading=!0;var t={comment:e,runIds:[]};s.queryResults.forEach(function(e){!0===e.selected&&t.runIds.push(e.flow_id)}),a.approveFlow(t).then(function(){s.approveLoading=!1,s.showApproveSelectionDialog=!s.showApproveSelectionDialog;var e=s.queryResults.filter(function(e){return t.runIds.indexOf(e.flow_id)>-1});e&&e.length>0&&e.forEach(function(e){e.properties.forEach(function(e){"approval.status"===e.key&&"approved"!==e.value&&(e.value="approved")})}),p(i("translate")("feedback.messages.approvalsOk"))},function(){s.approveLoading=!1,s.showApproveSelectionDialog=!s.showApproveSelectionDialog,h(i("translate")("feedback.messages.error"))})},s.toggleApproveSingleDialog=function(e){e.dialog=!e.dialog},s.approveSingleFlow=function(e){if(!e.approveForm.$valid)return e.approveLoading=!1,!1;e.approveLoading=!0;var t={comment:e.approveComment,runIds:[e.flow_id]};a.approveFlow(t).then(function(t){e.approveLoading=!1,e.dialog=!e.dialog;for(var a=s.queryResults.indexOf(e),n=s.queryResults[a].properties.length-1;n>=0;--n)"approval.status"===s.queryResults[a].properties[n].key&&(s.queryResults[a].properties[n].value="approved");p(i("translate")("feedback.messages.approvalsOk"))},function(){e.approveLoading=!1,e.dialog=!e.dialog,h(i("translate")("feedback.messages.error"))})},s.deSelectAllChannels=function(){s.flowSearchConfig.channelClassifiers=[]}}angular.module("console.flow-management").controller("SearchFlowsController",e),e.$inject=["DataSourceService","QueryService","FlowService","UserService","feedbackService","$filter","$state"]}(),function(){function e(e,t,a){this.closeHelp=function(){if("console"===t.$current.parent.name)return t.go(t.current,{},{reload:!0}),!1;t.go("^")},angular.element(e).bind("keydown",function(e){if(27===e.keyCode){if(e.preventDefault(),"console"===t.$current.parent.name)return t.go(t.current,{},{reload:!0}),!1;t.go("^")}}),a.$on("$destroy",function(){angular.element(e).unbind("keydown")})}angular.module("console.help").controller("HelpSearchController",e),e.$inject=["$window","$state","$scope"]}(),function(){function e(e,t,a,n,r,i,o){var s=this;function l(){e.getScopes().then(function(e){if(s.resourcePermissions=e.data,s.resourcePermissions.roles&&s.resourcePermissions.roles.length>0){s.resourcePermissions.roles.push("disabled");for(var t=["viewer","editor","owner","disabled"],a=[],n=0;n<t.length;n++)s.resourcePermissions.roles.indexOf(t[n])>-1&&a.push(t[n]);s.resourcePermissions.roles=a}var r;s.isLoading=!1,r=s.resourcePermissions,s.groupSettings={resourcePermissions:{}},r.scopes.forEach(function(e){if(s.groupSettings.resourcePermissions[e]="disabled",s.groupDetails&&s.groupDetails.scopes){var t=s.groupDetails.scopes.filter(function(t){return t.resource===e});t&&t.length>0&&(s.groupSettings.resourcePermissions[e]=t[0].permission)}})},function(e){d(r("translate")("feedback.messages.errorNotFound")),i.go("^")})}function c(){t.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time)},function(e){})}function u(e,t){a.addMessage({type:t,message:e})}function d(e){u(e,"error")}s.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",s.saveGroup=function(){if(!s.editGroupsForm.$valid)return!1;var t=[];Object.keys(s.groupSettings.resourcePermissions).forEach(function(e){if("disabled"!==s.groupSettings.resourcePermissions[e]){var a={resource:e,permission:s.groupSettings.resourcePermissions[e]};t.push(a)}}),s.groupDetails.scopes=t,s.isSaving=!0,s.newGroup?e.createGroup(s.groupDetails).then(function(){s.isSaving=!1,u(r("translate")("feedback.messages.ok")),i.go("console.iam.groups",{},{reload:!0})},function(){s.isSaving=!1,d(r("translate")("feedback.messages.error"))}):e.updateGroup(s.groupDetails).then(function(){s.isSaving=!1,u(r("translate")("feedback.messages.ok"))},function(){s.isSaving=!1,d(r("translate")("feedback.messages.error"))})},s.deleteGroup=function(t){s.isDeleting=!0,e.deleteGroup(t).then(function(){s.isDeleting=!1,u(r("translate")("feedback.messages.ok")),i.go("console.iam.groups",{},{reload:!0})},function(){s.isDeleting=!1,d(r("translate")("feedback.messages.error"))})},s.setFocus=function(e){o(function(){document.getElementById(e).focus()},100)},s.closeEdit=function(e){s.newGroup||("groupDescriptionInput"===e?s.editGroupsForm.groupDescription.$valid?s.editDescription=!1:s.editDescription=!0:"groupNameInput"===e&&(s.editGroupsForm.groupName.$valid?s.editName=!1:s.editName=!0))},s.disabledCheck=function(e){var t=!1;s.adminMode||(s.groupDetails.id&&"2"===s.groupDetails.id&&("billingaccount"!==e&&"iam"!==e||(t=!0)),s.groupDetails.id&&"3"===s.groupDetails.id&&(t=!0),"flowenginemetrics"===e&&(t=!0));return t},s.overrideDisabledControls=function(){s.adminMode=!0;var e=document.getElementById("editGroupsForm").elements;Object.keys(e).forEach(function(t){e[t].readOnly=!1})},n.groupId?(s.groupId=n.groupId,s.isLoading=!0,e.getGroupById(s.groupId).then(function(e){s.groupDetails=e,l(),c()},function(e){d(r("translate")("feedback.messages.errorNotFound")),i.go("^")})):"console.iam.groups.create"===i.current.name?(s.isLoading=!0,s.newGroup=!0,s.groupDetails={},l(),c()):(d(r("translate")("feedback.messages.errorNotFound")),i.go("^"))}angular.module("console.iam").controller("IamGroupDetailsController",e),e.$inject=["IamService","UserService","feedbackService","$stateParams","$filter","$state","$timeout"]}(),function(){function e(e,t,a){var n=this;function r(t){var a={limit:100};t&&(a.pageToken=t),e.getGroups(a).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){n.listing.push(e)}),t.nextPageToken?r(t.nextPageToken):n.isLoading=!1},function(e){n.isLoading=!1,n.errorDialog=!0})}n.isLoading=!0,n.errorDialog=!1,n.resultLimit=20,n.resultLimitDefault=20,n.listing=[],n.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",n.updateStorageSearchKey=function(){a.sessionStorage.setItem("iamGroupsSearchKey",n.filterListing)},a.sessionStorage.getItem("iamGroupsSearchKey")&&(n.filterListing=a.sessionStorage.getItem("iamGroupsSearchKey")),t.getUserSettings().then(function(e){n.userSettings=e,n.userSettings.defaultDateTime&&(n.userDateTimeFormat=n.userSettings.defaultDateTime.date+" "+n.userSettings.defaultDateTime.time),n.userSettings.defaultChunkSize&&(n.resultLimit=parseInt(n.userSettings.defaultChunkSize)||20,n.resultLimitDefault=parseInt(n.userSettings.defaultChunkSize)||20),r()},function(e){r()}),n.showMoreResults=function(){n.resultLimit=n.resultLimit+n.resultLimitDefault},n.resetResultLimit=function(){n.resultLimit=n.resultLimitDefault},n.resetFilter=function(){n.filterListing="",n.resultLimit=n.resultLimitDefault,a.sessionStorage.removeItem("iamGroupsSearchKey")}}angular.module("console.iam").controller("IamGroupsController",e),e.$inject=["IamService","UserService","$window"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e){!function(e,t){a.addMessage({type:t,message:e})}(e,"error")}l.state=n,l.filterByGroup=!1,l.newUserProperties=[],l.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",n.groupId&&(l.filterByGroup=!0),n.userId?(l.userId=n.userId,l.userDetailsLoading=!0,e.getUserById(l.userId).then(function(t){l.userDetails=t,l.userDetailsLoading=!1,function(){l.groupsLoading=!0,l.userGroups=[];var t=l.userDetails.groupIds;t&&t.length>0?t.forEach(function(a){var n={};e.getGroupById(a).then(function(e){n=e,l.userGroups.push(n),l.userGroups.length===t.length&&(l.groupsLoading=!1)},function(e){l.groupsLoading=!1})}):l.groupsLoading=!1}()},function(e){l.userDetailsLoading=!1,c(r("translate")("feedback.messages.errorNotFound"))})):c(r("translate")("feedback.messages.errorNotFound")),t.getUserSettings().then(function(e){l.userSettings=e,l.userSettings.defaultDateTime&&(l.userDateTimeFormat=l.userSettings.defaultDateTime.date+" "+l.userSettings.defaultDateTime.time)},function(e){}),l.toggleAddGroup=function(){l.addGroupActive=!l.addGroupActive,l.addGroupActive&&e.getGroups("","100","createdDatetime").then(function(e){l.groups=e.data.items},function(e){})},l.isAddingGroup=!1,l.addUserToGroup=function(){if(l.isAddingGroup=!0,!l.addGroupForm.$valid)return l.isAddingGroup=!1,!1;var t={userIds:[l.userDetails.id],id:l.selectedGroup};e.addUsersToGroup(t).then(function(){l.isAddingGroup=!1,l.addGroupActive=!1,i.go(i.current,{},{reload:!0})},function(){l.isAddingGroup=!1,c(r("translate")("feedback.messages.error"))})},l.removeUserFromGroup=function(t){l.isRemovingGroup=!0;var a={id:t,userIds:[l.userDetails.id]};e.removeUsersFromGroup(a).then(function(){l.isRemovingGroup=!1,i.go(i.current,{},{reload:!0})},function(){l.isRemovingGroup=!1,c(r("translate")("feedback.messages.error"))})},l.deleteProperty=function(e,a){e.isDeletingProperty=!0;var n={properties:[e]};t.removeUserProperties(n).then(function(){i.go(i.current,{},{reload:!0}),e.isDeletingProperty=!1},function(){c(r("translate")("feedback.messages.error")),e.isDeletingProperty=!1})},l.addNewProperty=function(){l.newUserProperties.push({value:"",key:""})},l.deleteNewProperty=function(e){l.newUserProperties.splice(e,1)},l.submitNewProperties=function(){if(l.isSubmitting=!0,!l.submitPropertiesForm.$valid)return l.isSubmitting=!1,!1;var e={properties:l.newUserProperties};t.updateUserProperties(e).then(function(){l.userDetails.properties||(l.userDetails.properties=[]),l.isSubmitting=!1,l.newUserProperties=[],i.go(i.current,{},{reload:!0})},function(){l.isSubmitting=!1,c(r("translate")("feedback.messages.error"))})},l.resetAddNewProperty=function(){l.newUserProperties=[]},l.stateUp=function(){var e=i.$current.name;"console.iam.users.detail"!==e&&"console.iam.users.group.detail"!==e||i.go("^")},angular.element(o).bind("keydown",function(e){var t=i.$current.name;27===e.keyCode&&("console.iam.users.detail"!==t&&"console.iam.users.group.detail"!==t||(e.preventDefault(),i.go("^")))}),s.$on("$destroy",function(){angular.element(o).unbind("keydown")})}angular.module("console.iam").controller("IamUserDetailsController",e),e.$inject=["IamService","UserService","feedbackService","$stateParams","$filter","$state","$window","$scope"]}(),function(){function e(e,t,a,n){var r=this;function i(t){var n={limit:100};t&&(n.pageToken=t),a.groupId&&a.groupId.length>0&&(n.groupIds=a.groupId,r.groupId=a.groupId,r.filterByGroup=!0,a.groupName?r.groupName=a.groupName:e.getGroupById(r.groupId).then(function(e){r.groupName=e.name},function(e){})),e.getUsers(n).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){r.listing.push(e)}),t.nextPageToken?i(t.nextPageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.filterByGroup=!1,r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.updateStorageSearchKey=function(){n.sessionStorage.setItem("iamUserSearchKey",r.filterListing)},n.sessionStorage.getItem("iamUserSearchKey")&&(r.filterListing=n.sessionStorage.getItem("iamUserSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("iamUserSearchKey")}}angular.module("console.iam").controller("IamUsersController",e),e.$inject=["IamService","UserService","$stateParams","$window"]}(),function(){function e(e,t,a,n,r,i){var o=this;function s(e,t){a.addMessage({type:t,message:e})}o.validationPatternEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,o.whitelistAccount=function(){if(o.isSubmitting=!0,!o.addWhitelistForm.$valid)return o.isSubmitting=!1,!1;e.whitelistAccount(o.newAccount).then(function(){o.isSubmitting=!1,s(t("translate")("feedback.messages.ok")),n.go("console.iam.whitelist",{},{reload:!0})},function(){o.isSubmitting=!1,s(t("translate")("feedback.messages.error"),"error")})},o.isLoading=!0,e.getBillingAccount().then(function(e){o.isLoadingBillingAccount=!1,o.availableNamespaces=e.data.namespaceModels},function(e){o.isLoadingBillingAccount=!1,o.errorDialog=!0}),angular.element(r).bind("keydown",function(e){27===e.keyCode&&"console.iam.whitelist.add"===n.current.name&&(e.preventDefault(),n.go("^"))}),i.$on("$destroy",function(){angular.element(r).unbind("keydown")})}angular.module("console.iam").controller("AddToWhitelistController",e),e.$inject=["BillingService","$filter","feedbackService","$state","$window","$scope"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;l.isSubmitting=!1,n.whitelistedAccount?(l.whitelistDetails=n.whitelistedAccount,t.getUser().then(function(e){l.whitelistDetails.email===e.email?u(!0):u(!1)},function(){l.errorDialog=!0})):i.go("console.iam.whitelist");var c=angular.copy(l.whitelistDetails);function u(t){l.isLoadingBillingAccount=!0,e.getBillingAccount().then(function(e){l.isLoadingBillingAccount=!1;var a=e.data.namespaceModels,n=[];if(a.forEach(function(e){l.whitelistDetails.namespaces.indexOf(e.id)>=0?n.push({name:e,selected:!0}):n.push({name:e})}),t){var r=s.active_namespace_id;n.forEach(function(e){e.name===r&&(e.disabled=!0)})}l.availableNamespaces=n},function(e){l.isLoadingBillingAccount=!1,l.errorDialog=!0})}function d(e,t){a.addMessage({type:t,message:e})}l.reset=function(){angular.copy(c,l.whitelistDetails)},l.updateWhitelistAccount=function(){l.isSubmitting=!0;var t=[];l.availableNamespaces.forEach(function(e){e.selected&&t.push(e.name.id)});var a={disabled:l.whitelistDetails.disabled,namespaces:t,email:l.whitelistDetails.email};e.updateWhitelistAccount(a).then(function(){l.isSubmitting=!1,d(r("translate")("feedback.messages.ok")),i.go("console.iam.whitelist",{},{reload:!0})},function(){l.isSubmitting=!1,d(r("translate")("feedback.messages.error"),"error")})},l.stateUp=function(){l.reset(),i.go("^")},angular.element(s).bind("keydown",function(e){27===e.keyCode&&"console.iam.whitelist.details"===i.current.name&&(e.preventDefault(),l.reset(),i.go("^"))}),o.$on("$destroy",function(){angular.element(s).unbind("keydown")})}angular.module("console.iam").controller("WhitelistDetailsController",e),e.$inject=["BillingService","UserService","feedbackService","$stateParams","$filter","$state","$scope","$window"]}(),function(){function e(e,t,a){var n=this;function r(t){n.isLoading=!0;var a={limit:100};t&&(a.pageToken=t),n.searchStatus&&(a.status=n.searchStatus),e.getWhitelist(a).then(function(e){var t=e.data;t.whitelistedAccounts&&t.whitelistedAccounts.forEach(function(e){n.listing.push(e)}),t.pageToken?r(t.pageToken):n.isLoading=!1},function(e){n.isLoading=!1,n.errorDialog=!0})}n.isLoading=!0,n.errorDialog=!1,n.resultLimit=20,n.resultLimitDefault=20,n.listing=[],n.searchStatus=null,n.updateStorageSearchKey=function(){a.sessionStorage.setItem("iamWhitelistSearchKey",n.filterListing)},a.sessionStorage.getItem("iamWhitelistSearchKey")&&(n.filterListing=a.sessionStorage.getItem("iamWhitelistSearchKey")),t.getUserSettings().then(function(e){n.userSettings=e,n.userSettings.defaultDateTime&&(n.userDateTimeFormat=n.userSettings.defaultDateTime.date+" "+n.userSettings.defaultDateTime.time),n.userSettings.defaultChunkSize&&(n.resultLimit=parseInt(n.userSettings.defaultChunkSize)||20,n.resultLimitDefault=parseInt(n.userSettings.defaultChunkSize)||20),r()},function(e){r()}),n.statusChanged=function(){n.listing=[],r()},n.showMoreResults=function(){n.resultLimit=n.resultLimit+n.resultLimitDefault},n.resetResultLimit=function(){n.resultLimit=n.resultLimitDefault},n.resetFilter=function(){n.filterListing="",n.resultLimit=n.resultLimitDefault,a.sessionStorage.removeItem("iamWhitelistSearchKey")}}angular.module("console.iam").controller("WhitelistController",e),e.$inject=["BillingAdminService","UserService","$window"]}(),function(){function e(e,t,a,n,r,i,o){var s=this;function l(e,t){a.addMessage({type:t,message:e})}function c(e){l(e,"error")}s.marketAdapter={},s.availableFileRegex=e,s.selectedTransformationConfiguration=function(e){s.marketAdapter.transformationConfigurationId=e.id,s.searchTransformationConfigurationActive=!1},s.addProperty=function(){s.marketAdapter.properties||(s.marketAdapter.properties=[]);s.marketAdapter.properties.push({key:"",value:""}),o(function(){var e="propertyKey_"+(s.marketAdapter.properties.length-1).toString(),t=document.getElementById(e);t&&t.focus()},100)},s.removeProperty=function(e){s.marketAdapter.properties.splice(e,1)},s.saveMarketAdapter=function(){if(!s.marketAdapterForm.$valid||!s.marketAdapter.transformationConfigurationId)return s.formErrorDialog=!0,!1;s.formErrorDialog=!1,s.isSaving=!0,t.createMarketAdapter(s.marketAdapter).then(function(e){s.isSaving=!1,s.editMode=!1,e.data&&e.data.id?r.go("console.market-adapters.details",{marketAdapterId:e.data.id}):r.go("console.market-adapters"),l(i("translate")("feedback.messages.ok"))},function(e){s.isSaving=!1,e.data&&e.data.error&&e.data.error.message?c(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(i("translate")("feedback.messages.error"))})},n.copiedMarketAdapter&&(s.marketAdapter=n.copiedMarketAdapter,s.marketAdapter.id=null)}angular.module("console.market-adapters").controller("MarketAdapterCreateController",e),e.$inject=["FileRegexOptions","MarketAdapterService","feedbackService","$stateParams","$state","$filter","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s){var l,c=this;function u(e){c.loadingTransformationConfiguration=!0,a.getTransformationConfiguration(e).then(function(e){c.loadingTransformationConfiguration=!1,c.transformationConfiguration=e.data},function(e){c.loadingTransformationConfiguration=!1})}function d(e,t){n.addMessage({type:t,message:e})}function f(e){d(e,"error")}c.availableFileRegex=e,c.toggleEditMode=function(){c.editMode=!c.editMode},c.cancelEditMode=function(){c.marketAdapter=angular.copy(c.originalMarketAdapter),c.editMode=!1,c.formErrorDialog=!1,c.marketAdapterForm.$setPristine()},c.selectedTransformationConfiguration=function(e){c.marketAdapter.transformationConfigurationId=e.id,c.searchTransformationConfigurationActive=!1},c.addProperty=function(){c.marketAdapter.properties||(c.marketAdapter.properties=[]);c.marketAdapter.properties.push({key:"",value:""}),s(function(){var e="propertyKey_"+(c.marketAdapter.properties.length-1).toString(),t=document.getElementById(e);t&&t.focus()},100)},c.removeProperty=function(e){c.marketAdapter.properties.splice(e,1)},c.saveMarketAdapter=function(){if(!c.marketAdapterForm.$valid)return c.formErrorDialog=!0,!1;c.formErrorDialog=!1,c.isSaving=!0,t.updateMarketAdapter(c.marketAdapter).then(function(e){c.isSaving=!1,c.editMode=!1,d(o("translate")("feedback.messages.ok"))},function(e){c.isSaving=!1,e.data&&e.data.error&&e.data.error.message?f(o("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):f(o("translate")("feedback.messages.error"))})},c.deleteMarketAdapter=function(e){if(!e)return c.confirmDelete=!0,!1;c.isSaving=!0,t.deleteMarketAdapter(c.marketAdapter.id).then(function(e){c.isSaving=!1,c.editMode=!1,c.confirmDelete=!1,i.go("console.market-adapters"),d(o("translate")("feedback.messages.deleted"))},function(e){c.isSaving=!1,c.confirmDelete=!1,e.data&&e.data.error&&e.data.error.message?f(o("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):f(o("translate")("feedback.messages.error"))})},r.marketAdapter?(c.originalMarketAdapter=angular.copy(r.marketAdapter),c.marketAdapter=r.marketAdapter,u(c.marketAdapter.transformationConfigurationId)):r.marketAdapterId?(l=r.marketAdapterId,c.isLoading=!0,t.getMarketAdapterDetails(l).then(function(e){c.originalMarketAdapter=angular.copy(e.data),c.marketAdapter=e.data,c.isLoading=!1,u(c.marketAdapter.transformationConfigurationId)},function(e){c.isLoading=!1,c.errorDialog=!0})):i.go("console.market-adapters")}angular.module("console.market-adapters").controller("MarketAdapterDetailsController",e),e.$inject=["FileRegexOptions","MarketAdapterService","IngestService","feedbackService","$stateParams","$state","$filter","$timeout"]}(),function(){var e=angular.module("console.core"),t={appTitle:"Console"};function a(e,a,n,r){e.configure({docTitle:"· "+t.appTitle}),r.html5Mode(!0),a.useStaticFilesLoader({prefix:"console/content/i18n/locale-",suffix:".json"}),a.preferredLanguage("en"),a.fallbackLanguage("en"),a.useSanitizeValueStrategy("escaped"),a.usePostCompiling(!0),n.interceptors.push("xCSRFTokenInterceptor")}e.value("config",t),e.config(a),agGrid.initialiseAgGridWithAngular1(angular),agGrid.LicenseManager.setLicenseKey("Energyworx_B.V._Energyworx_Console_1Devs_1Deployment_4_September_2020__MTU5OTE3NDAwMDAwMA==34f268fea352faead8718c9d198fcba4"),a.$inject=["routerHelperProvider","$translateProvider","$httpProvider","$locationProvider"],e.factory("xCSRFTokenInterceptor",["$rootScope","$q","$injector","restUrl","$window",function(e,t,a,n,r){return e.origin=window.location.origin,{request:function(t){return(t.url.indexOf(n)>-1||t.url.indexOf("https://www.googleapis.com")>-1||t.url.indexOf("/files")>-1||t.url.indexOf("appspot.com")>-1)&&(t.headers.Authorization=bearer_token,active_namespace_id&&active_namespace_id.length>0&&-1===t.url.indexOf("https://www.googleapis.com")&&(t.headers["X-NAMESPACE"]=active_namespace_id),t&&t.params&&t.params.namespace&&(t.headers["X-NAMESPACE"]=t.params.namespace)),"GET"!==t.method&&"HEAD"!==t.method&&(e.xcsrfToken&&(t.headers["X-CSRF-TOKEN"]=e.xcsrfToken),(!t.headers["Content-Type"]||t.headers["Content-Type"].indexOf("application/json")>-1)&&-1===t.url.indexOf("_ah/upload/")&&(t.headers["Content-Type"]="application/json")),t.url.indexOf("https://www.googleapis.com")>-1?t.headers.Accept="application/json":t.headers.Accept="application/json,application/vnd.ewx.v2",t},response:function(t){return t.headers("X-CSRF-TOKEN")&&(e.xcsrfToken=t.headers("X-CSRF-TOKEN")),t},responseError:function(n){if(n.status&&403===n.status&&(n.config.url.endsWith("/user/scopes")||n.config.url.endsWith("/user/get"))&&(active_namespace_id=""),n.status&&401===n.status){if(n.config.retry&&n.config.retry>=3)return window.location.href=window.location.origin+"/logout",t.reject();n.config.retry?n.config.retry++:n.config.retry=1;var r=a.get("$http");return r.get("/refresh").then(function(e){return bearer_token="Bearer "+e.data.accessToken,n.config.headers.Authorization=bearer_token,r(n.config)},function(e){return window.location.href=window.location.origin,t.reject(n)})}return n.headers&&n.headers("X-CSRF-TOKEN")&&(e.xcsrfToken=n.headers("X-CSRF-TOKEN")),t.reject(n)}}}]),e.config(["uiGmapGoogleMapApiProvider",function(e){e.configure({key:"AIzaSyAKir4AbUzf4iOQTmLAvK1e5tL-Fx8EGnU",libraries:"weather,geometry,visualization"})}])}(),angular.module("console.core").constant("restUrl","https://api.cloud.energyworx.com/_ah/api"),function(){function e(e,t){e.$state=t,Highcharts.setOptions({global:{timezone:null}})}angular.module("console.core").controller("CoreController",e),e.$inject=["$scope","$state"]}(),function(){function e(e,a,n){e.configureStates([{state:"console",config:{abstract:!0,url:"",resolve:{namespace:t}}},{state:"404",config:{url:"/404",templateUrl:"shared/core/404.html",title:"404",views:{"main@":{templateUrl:"shared/core/404.html"}}}},{state:"root",config:{url:"/",onEnter:["$rootScope","$state",function(e,t){t.go("console.dashboard")}]}}],"/dashboard")}function t(e){var t=window.localStorage.getItem("selectedNamespace");t&&(active_namespace_id=t),e&&e.search()&&e.search().namespace&&(active_namespace_id=e.search().namespace)}angular.module("console.core").run(e),e.$inject=["routerHelper","$rootScope","$state"],t.$inject=["$location"]}(),function(){function e(e,t,a){var n={docTitle:"",resolveAlways:{}};function r(e,r,i,o){var s=!1,l={errors:0,changes:0},c={configureStates:function(e,r){e.forEach(function(e){e.config.resolve=angular.extend(e.config.resolve||{},n.resolveAlways),t.state(e.state,e.config)}),r&&!s&&(s=!0,a.otherwise(r))},getStates:function(){return r.get()},stateCounts:l};return e.$on("$stateChangeError",function(e,t){e.preventDefault(),r.go("console.dashboard")}),e.$on("$stateChangeSuccess",function(t,a){var i=a;l.changes++,a.title||(i=r.get("^"));var o=(i.title||"")+" "+n.docTitle;e.title=o}),e.$on("$stateChangeSuccess",function(e){i.ga("send","pageview",o.path())}),c}e.html5Mode(!1),this.configure=function(e){angular.extend(n,e)},this.$get=r,r.$inject=["$rootScope","$state","$window","$location"]}angular.module("blocks.router").provider("routerHelper",e),e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(t){return e.getCountryByCode(t)}function u(e,t){n.addMessage({type:t,message:e})}function d(e){u(e,"error")}l.billingAccount={},l.fullname=r.auth_fullname,l.countryList=e.getCountries(),l.supportLevels=e.getSupportLevels(),l.currencyList=e.getCurrencies(),"None"===l.fullname&&(l.fullname=!1),l.acceptConditions=function(){if(!l.acceptConditionsForm.$valid)return l.isSubmitting=!1,!1;l.isSubmitting=!0,t.updateBillingAccount(l.billingAccount).then(function(e){l.isSubmitting=!1,u(o("translate")("feedback.messages.conditionsAccepted")),i.go("console.dashboard")},function(e){d(o("translate")("feedback.messages.error")),l.isSubmitting=!1})},l.toggleTierLevels=function(){l.tierLevelsVisible=!l.tierLevelsVisible},l.logout=function(){a.logout()},l.isLoading=!0,t.getBillingAccount().then(function(t){if(l.isLoading=!1,l.billingAccount=t.data,l.billingAccount.properties&&l.billingAccount.properties.length>0){var a=l.billingAccount.properties.filter(function(e){return"additionalpriorityfeatures"===e.key.toLowerCase()});a.length>0&&(l.additionalPriorityFeatures=a[0].value)}var n;l.billingAccount.supportLevel||(l.billingAccount.supportLevel="bestEffortSupport"),l.billingAccountCurrency=(n=l.billingAccount.commercialElements.currency,e.getCurrency(n)),l.companyCountry=c(l.billingAccount.companyAddress.country),l.billingAccount.invoiceAddress&&l.billingAccount.invoiceAddress.country&&(l.invoiceAddressCountry=c(l.billingAccount.invoiceAddress.country))},function(e){404===e.status?i.go("console.signup"):d(o("translate")("feedback.messages.error")),l.isLoading=!1,l.errorDialog=!0}),angular.element(r).bind("keydown",function(e){27===e.keyCode&&l.tierLevelsVisible&&(e.preventDefault(),l.tierLevelsVisible=!1,s.$evalAsync())}),s.$on("$destroy",function(){angular.element(r).unbind("keydown")})}angular.module("console.signup").controller("ActivateController",e),e.$inject=["ConstantsService","BillingService","LoginService","feedbackService","$window","$state","$filter","$scope"]}(),function(){function e(e){this.logout=function(){e.logout()}}angular.module("console.signup").controller("DisabledController",e),e.$inject=["LoginService"]}(),function(){function e(e,t,a,n,r,i,o,s){var l,c=this;function u(){r.go("^")}function d(e,t){a.addMessage({type:t,message:e})}function f(e){d(e,"error")}c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",c.toggleEditMode=function(){c.editMode=!c.editMode},c.cancelEditMode=function(){c.soapEndpoint=angular.copy(c.originalSoapEndpoint),c.editMode=!1},c.selectedMarketAdapter=function(e){"marketAdapterIdOut"===c.marketAdapterType?c.soapEndpoint.marketAdapterIdOut=e.id:c.soapEndpoint.marketAdapterIdIn=e.id;c.searchMarketAdaptersActive=!1},c.saveSoapEndpoint=function(){if(!c.soapEndpointForm.$valid)return!1;c.isSaving=!0,e.updateSoapEndpoint(c.soapEndpoint).then(function(e){c.isSaving=!1,c.editMode=!1,d(i("translate")("feedback.messages.ok")),r.reload()},function(e){c.isSaving=!1,e.data&&e.data.error&&e.data.error.message?f(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):f(i("translate")("feedback.messages.error"))})},c.deleteSoapEndpoint=function(t){if(!t)return c.confirmDelete=!0,!1;c.isDeleting=!0,e.deleteSoapEndpoint(c.soapEndpoint.id).then(function(e){c.isDeleting=!1,c.editMode=!1,c.confirmDelete=!1,r.go("console.soap-endpoints",{},{reload:!0}),d(i("translate")("feedback.messages.deleted"))},function(e){c.isDeleting=!1,c.confirmDelete=!1,e.data&&e.data.error&&e.data.error.message?f(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):f(i("translate")("feedback.messages.error"))})},c.stateUp=u,c.toggleSearchMarketAdapter=function(e){c.marketAdapterType=e,c.searchMarketAdaptersActive=!c.searchMarketAdaptersActive},n.soapEndpointId?(l=n.soapEndpointId,c.isLoading=!0,e.getSoapEndpoint(l).then(function(e){c.originalSoapEndpoint=angular.copy(e.data),c.soapEndpoint=e.data,c.isLoading=!1},function(e){c.isLoading=!1,c.errorDialog=!0})):r.go("console.soap-endpoints"),t.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time)},function(e){}),angular.element(s).bind("keydown",function(e){27===e.keyCode&&"console.soap-endpoints.details"===r.$current.name&&(e.preventDefault(),u())}),o.$on("$destroy",function(){angular.element(s).unbind("keydown")})}angular.module("console.soap-endpoints").controller("SoapEndpointDetailsController",e),e.$inject=["SoapService","UserService","feedbackService","$stateParams","$state","$filter","$scope","$window"]}(),function(){function e(e,t,a,n,r,i,o,s,l,c){var u,d,f=this;function m(e,t){n.addMessage({type:t,message:e})}function g(e){m(e,"error")}f.timezone=moment.tz.guess(),f.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",f.task={priority:"low",ranking:0},f.types=[],f.statuses=[],f.priorities=e.getPriorities(),f.subjects=e.getTaskSubjects(),f.newSubjectValue=f.subjects[0],f.closeModal=function(){r.go("^")},f.createTask=function(){if(f.isSaving=!0,!f.newTaskForm.$valid||f.newTagFocussed)return f.isSaving=!1,!1;f.addTagInvalid=!1;var e=f.task;e.endDatetime&&(e.endDatetime=moment(e.endDatetime).set({second:0,millisecond:0}).format("YYYY-MM-DDTHH:mm:ss.SSS"));if(!f.editRankingForm.$valid)return;t.createTask(e).then(function(e){f.isSaving=!1,m(l("translate")("feedback.messages.ok")),r.go("^",{},{reload:!0})},function(e){f.isSaving=!1,e.data&&e.data.error&&e.data.error.message?g(l("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):g(l("translate")("feedback.messages.error"))})},f.toggleSearchUsers=function(){f.searchUsersActive=!f.searchUsersActive},f.selectedUser=function(e){f.task.assignee=e.email,f.searchUsersActive=!1},f.addTag=function(){f.task.tags||(f.task.tags=[]);f.newTagInput?(f.task.tags.push(f.newTagInput),f.newTagInput="",f.addTagInvalid=!1):f.addTagInvalid=!0},f.removeTag=function(e){f.task.tags.splice(e,1)},f.focusSwitch=function(e){f.newTagFocussed=e},f.selectTaskFlow=function(e){f.task.flowIds||(f.task.flowIds=[]);var t=void 0;f.task.flowIds.forEach(function(a){e.id===a&&(t=!0)}),t||(f.task.flowIds.push(e.id),f.enrichedTaskFlows||(f.enrichedTaskFlows={}),f.enrichedTaskFlows[e.id]=e);f.searchTaskFlowsActive=!1},f.toggleSearchTaskFlows=function(){f.searchTaskFlowsActive=!f.searchTaskFlowsActive},f.unLinkTaskFlow=function(e){f.task.flowIds.splice(e,1)},f.taskDueDateEditMode=function(){f.editTaskDueDate=!0,f.task.endDatetime?(f.task.newEndDatetime=angular.copy(f.task.endDatetime),f.task.newEndDatetime=moment(f.task.newEndDatetime)):(f.task.newEndDatetime=moment(),f.task.newEndDatetime.set({minute:0,second:0}))},f.taskDueDateEditCancel=function(){delete f.task.newEndDatetime,f.editTaskDueDate=!1},f.applyTaskDueDateEdit=function(){f.task.endDatetime=f.task.newEndDatetime,delete f.task.newEndDatetime,f.editTaskDueDate=!1},f.addSubject=function(){f.task.subjects||(f.task.subjects=[]);var e={deleted:!1,readOnly:!1,value:f.newSubjectValue,key:f.newSubjectKey};f.task.subjects.push(e),f.newSubjectKey="",f.addSubjectActive=!1},f.deleteSubject=function(e,t){f.task.subjects.splice(t,1)},f.toggleSearchDatasources=function(){f.searchDatasourcesActive=!f.searchDatasourcesActive},f.selectedDatasource=function(e){f.newSubjectKey=e.id,f.searchDatasourcesActive=!1},f.toggleSearchFlowDesigns=function(){f.searchFlowDesignsActive=!f.searchFlowDesignsActive},f.selectedFlowDesign=function(e){f.newSubjectKey=e.id,f.searchFlowDesignsActive=!1},s.taskFlowId&&(f.task.flowIds=[s.taskFlowId],u=f.task.flowIds,d=[],f.enrichedTaskFlows={},f.isLoadingTaskFlows=!0,u.forEach(function(e){d.push(t.getTaskFlow({id:e,includeTasks:!1}))}),c.all(d).then(function(e){for(var t=0;t<e.length;t++)e[t]&&e[t].data&&e[t].data.id&&(f.enrichedTaskFlows[e[t].data.id]=e[t].data);f.isLoadingTaskFlows=!1,s.taskFlowId&&f.enrichedTaskFlows[s.taskFlowId]&&f.enrichedTaskFlows[s.taskFlowId].orderByRanking?(f.hidePriority=!0,f.hideRanking=!1):s.taskFlowId&&f.enrichedTaskFlows[s.taskFlowId]&&(f.hideRanking=!0)},function(e){f.isLoadingTaskFlows=!1})),auth_email&&(f.task.assignee=auth_email),a.getUserSettings().then(function(e){f.userSettings=e,f.userSettings.defaultDateTime&&(f.userDateTimeFormat=f.userSettings.defaultDateTime.date+" "+f.userSettings.defaultDateTime.time)},function(e){}),function e(a){f.isLoadingTypes=!0;var n={limit:100};a&&(n.pageToken=a),t.getTypes(n).then(function(t){var a=t.data;a.taskTypes&&a.taskTypes.length>0&&a.taskTypes.forEach(function(e){var t={type:e.type};f.types.push(t)}),a.pageToken?e(a.pageToken):f.isLoadingTypes=!1,0===f.types.length&&(f.setupNeeded=!0)},function(e){f.isLoadingTypes=!1,f.errorDialogTypes=!0})}(),function e(a){f.isLoadingStatuses=!0;var n={limit:100};a&&(n.pageToken=a),t.getStatuses(n).then(function(t){var a=t.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){var t={status:e.status};f.statuses.push(t)}),a.pageToken?e(a.pageToken):f.isLoadingStatuses=!1,0===f.statuses.length&&(f.setupNeeded=!0)},function(e){f.isLoadingStatuses=!1,f.errorDialogstatuses=!0})}(),angular.element(i).bind("keydown",function(e){27!==e.keyCode||"console.tasks.flows.details.create"!==r.current.name&&"console.tasks.search.create"!==r.current.name||(e.preventDefault(),f.searchUsersActive?(f.searchUsersActive=!1,o.$evalAsync()):r.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.tasks").controller("TaskCreateController",e),e.$inject=["ConstantsService","TasksService","UserService","feedbackService","$state","$window","$scope","$stateParams","$filter","$q"]}(),function(){function e(e,t,a,n,r,i,o,s,l,c,u){var d=this;function f(e){d.isLoading=!0,t.getTask(e).then(function(e){var a,n;d.task=e.data,d.timezone=moment.tz.guess(),d.isLoading=!1,d.task.taskItemsCount&&d.task.taskItemsCount>0&&m(d.task.id),d.task.ranking||(d.task.ranking=0),l.taskFlowId&&l.orderByRanking?d.hidePriority=!0:l.taskFlowId&&(d.hideRanking=!0),delete d.task.type.id,delete d.task.status.id,p(),d.task.flowIds&&d.task.flowIds.length>0&&(a=d.task.flowIds,n=[],d.enrichedTaskFlows={},d.isLoadingTaskFlows=!0,a.forEach(function(e){n.push(t.getTaskFlow({id:e,includeTasks:!1}))}),u.all(n).then(function(e){for(var t=0;t<e.length;t++)e[t]&&e[t].data&&e[t].data.id&&(d.enrichedTaskFlows[e[t].data.id]=e[t].data);d.isLoadingTaskFlows=!1,l.taskFlowId&&d.enrichedTaskFlows[l.taskFlowId]&&d.enrichedTaskFlows[l.taskFlowId].orderByRanking?(d.hidePriority=!0,d.hideRanking=!1):l.taskFlowId&&d.enrichedTaskFlows[l.taskFlowId]&&(d.hideRanking=!0)},function(e){d.isLoadingTaskFlows=!1})),g(d.task)},function(e){d.isLoading=!1,e&&404===e.status?d.nothingFoundDialog=!0:d.errorDialog=!0})}function m(e,a){d.isLoadingSubTasks=!0;var n={parentTaskId:e,order:"-createdDatetime",limit:d.groupedTasksResultLimit};a&&(n.pageToken=a),t.getSubTasks(n).then(function(e){a&&e.data.items?e.data.items.forEach(function(e){d.subTasks.push(e)}):d.subTasks=e.data.items,d.isLoadingSubTasks=!1,d.nextPageToken=!1,e.data.nextPageToken&&(d.nextPageToken=e.data.nextPageToken)},function(e){d.isLoadingSubTasks=!1})}function g(e){d.enableFlowTrigger=!1,e.subjects&&e.subjects.length>0&&e.subjects.forEach(function(e){"datasource"!==e.value&&"source:datasource"!==e.value||(d.enableFlowTrigger=!0)})}function p(e){d.task.comments&&d.task.comments.length>d.commentsResultLimit&&(d.allCommentsShown=!1,d.hiddenCommentsCount=d.task.comments.length-d.commentsResultLimit,d.task.comments.forEach(function(t,a){e&&(d.allCommentsShown=!0),!e&&a<d.hiddenCommentsCount?t.hidden=!0:t.hidden=!1}))}function h(){var e=d.task;e.endDatetime&&(e.endDatetime=moment(e.endDatetime).set({second:0,millisecond:0}).format("YYYY-MM-DDTHH:mm:ss.SSS")),d.isUpdating=!0,d.editRankingForm.$valid?(d.editTaskRanking=!1,delete d.task.type.id,delete d.task.status.id,t.updateTask(e).then(function(e){d.isUpdating=!1,d.taskChanged=!0,d.newComment="",d.addCommentActive=!1,g(d.task)},function(e){d.isUpdating=!1,e.data&&e.data.error&&e.data.error.message?v(c("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):v(c("translate")("feedback.messages.error"))})):d.isUpdating=!1}function v(e){!function(e,t){n.addMessage({type:t,message:e})}(e,"error")}d.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",d.isLoading=!0,d.types=[],d.statuses=[],d.priorities=e.getPriorities(),d.subjects=e.getTaskSubjects(),d.newSubjectValue=d.subjects[0],d.commentsResultLimit=5,d.groupedTasksResultLimit=5,d.closeModal=function(){i(function(){d.taskChanged?r.go("^",{},{reload:!0}):r.go("^")},100)},d.editElement=function(e){i(function(){document.getElementById(e).focus()},100)},d.saveTask=h,d.createPropertyCopy=function(e,t){"description"===t&&(d.originalDescription=e)},d.revertChange=function(e){"description"===e&&(d.task.description=angular.copy(d.originalDescription))},d.toggleSearchUsers=function(){d.searchUsersActive=!d.searchUsersActive},d.selectedUser=function(e){d.task.assignee=e.email,d.searchUsersActive=!1,h()},d.addComment=function(){var e={taskId:d.task.id,comment:d.newComment};d.isAddingComment=!0,t.addComment(e).then(function(e){d.task.comments||(d.task.comments=[]),d.isAddingComment=!1;var t={createdBy:e.data.createdBy,createdDatetime:e.data.createdDatetime,comment:d.newComment};d.task.comments.push(t),d.newComment="",d.addCommentActive=!1,d.taskChanged=!0,p()},function(e){d.isAddingComment=!1,e.data&&e.data.error&&e.data.error.message?v(c("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):v(c("translate")("feedback.messages.error"))})},d.addTag=function(){d.task.tags||(d.task.tags=[]);d.newTagInput?(d.task.tags.push(d.newTagInput),d.newTagInput="",d.addTagInvalid=!1,h()):d.addTagInvalid=!0},d.removeTag=function(e){d.task.tags.splice(e,1),h()},d.focusSwitch=function(e){d.newTagFocussed=e},d.removeAssignee=function(){d.task.assignee=null,h()},d.removeDuedate=function(){d.task.endDatetime=null,h()},d.selectTaskFlow=function(e){(function(e){var a={taskIds:[d.task.id],flowId:e.id};d.task.flowIds||(d.task.flowIds=[]);var n=void 0;d.task.flowIds.forEach(function(t){e.id===t&&(n=!0)}),n||(d.isUpdating=!0,t.linkTasksFlow(a).then(function(t){d.isUpdating=!1,d.taskChanged=!0,d.task.flowIds.push(e.id),d.enrichedTaskFlows||(d.enrichedTaskFlows={}),d.enrichedTaskFlows[e.id]=e},function(e){d.isUpdating=!1,e.data&&e.data.error&&e.data.error.message?v(c("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):v(c("translate")("feedback.messages.error"))}))})(e),d.searchTaskFlowsActive=!1},d.toggleSearchTaskFlows=function(){d.searchTaskFlowsActive=!d.searchTaskFlowsActive},d.unLinkTaskFlow=function(e,a){var n={taskIds:[d.task.id],flowId:e};d.isUpdating=!0,t.unlinkTasksFlow(n).then(function(e){d.isUpdating=!1,d.taskChanged=!0,d.task.flowIds.splice(a,1)},function(e){d.isUpdating=!1,e.data&&e.data.error&&e.data.error.message?v(c("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):v(c("translate")("feedback.messages.error"))})},d.toggleOldercomments=p,d.taskDueDateEditMode=function(){d.editTaskDueDate=!0,d.task.endDatetime?(d.task.newEndDatetime=angular.copy(d.task.endDatetime),d.task.newEndDatetime=moment(d.task.newEndDatetime)):(d.task.newEndDatetime=moment(),d.task.newEndDatetime.set({minute:0,second:0}))},d.taskDueDateEditCancel=function(){delete d.task.newEndDatetime,d.editTaskDueDate=!1},d.applyTaskDueDateEdit=function(){d.task.endDatetime=d.task.newEndDatetime,h(),delete d.task.newEndDatetime,d.editTaskDueDate=!1},d.addSubject=function(){d.task.subjects||(d.task.subjects=[]);var e={deleted:!1,readOnly:!1,value:d.newSubjectValue,key:d.newSubjectKey};d.task.subjects.push(e),h(),d.newSubjectKey="",d.addSubjectActive=!1},d.deleteSubject=function(e,t){d.task.subjects.splice(t,1),h()},d.toggleSearchDatasources=function(){d.searchDatasourcesActive=!d.searchDatasourcesActive},d.selectedDatasource=function(e){d.newSubjectKey=e.id,d.searchDatasourcesActive=!1},d.toggleSearchFlowDesigns=function(){d.searchFlowDesignsActive=!d.searchFlowDesignsActive},d.selectedFlowDesign=function(e){d.newSubjectKey=e.id,d.searchFlowDesignsActive=!1},d.startFlow=function(){d.task.subjects&&d.task.subjects.length>0&&(d.flowProperties={key:"taskId",value:d.task.id},d.taskDatasources=[],d.taskFlowConfigs=[],d.selectedFlowConfig="",d.task.subjects.forEach(function(e){"datasource"===e.value||"source:datasource"===e.value?d.taskDatasources.push({id:e.key}):"flowConfiguration"!==e.value&&"source:flowConfiguration"!==e.value||d.taskFlowConfigs.push(e.key)}),d.taskFlowConfigs.length>0&&(d.selectedFlowConfig=d.taskFlowConfigs[0]));d.triggerFlow=!0},d.showMoreSubTasks=function(e,t){e&&t&&m(e,t)},d.returnStartEnd=function(e,t){if(e){var a=e.filter(function(e){return"data:startDate"===e.value}),n=e.filter(function(e){return"data:endDate"===e.value});if(a.length>0&&n.length>0){var r=a[0].key,i=n[0].key;return"start"===t?r:i}}},l.taskId?a.getUserSettings().then(function(e){d.userSettings=e,d.userSettings.defaultDateTime&&(d.userDateTimeFormat=d.userSettings.defaultDateTime.date+" "+d.userSettings.defaultDateTime.time),d.userSettings.commentCountTasks&&(d.commentsResultLimit=d.userSettings.commentCountTasks),d.userSettings.groupedTasksCount&&(d.groupedTasksResultLimit=d.userSettings.groupedTasksCount),f(l.taskId)},function(e){f(l.taskId)}):(d.errorDialog=!0,d.isLoading=!1),function e(a){d.isLoadingTypes=!0;var n={limit:100};a&&(n.pageToken=a),t.getTypes(n).then(function(t){var a=t.data;a.taskTypes&&a.taskTypes.length>0&&a.taskTypes.forEach(function(e){var t={type:e.type};d.types.push(t)}),a.pageToken?e(a.pageToken):d.isLoadingTypes=!1},function(e){d.isLoadingTypes=!1,d.errorDialogTypes=!0})}(),function e(a){d.isLoadingStatuses=!0;var n={limit:100};a&&(n.pageToken=a),t.getStatuses(n).then(function(t){var a=t.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){var t={status:e.status};d.statuses.push(t)}),a.pageToken?e(a.pageToken):d.isLoadingStatuses=!1},function(e){d.isLoadingStatuses=!1,d.errorDialogstatuses=!0})}(),angular.element(o).bind("keydown",function(e){27!==e.keyCode||"console.tasks.flows.details.task"!==r.current.name&&"console.tasks.search.details"!==r.current.name||(e.preventDefault(),d.searchUsersActive?(d.searchUsersActive=!1,s.$evalAsync()):r.go("^"))}),s.$on("$destroy",function(){angular.element(o).unbind("keydown")})}angular.module("console.tasks").controller("TaskDetailsController",e),e.$inject=["ConstantsService","TasksService","UserService","feedbackService","$state","$timeout","$window","$scope","$stateParams","$filter","$q"]}(),function(){function e(e,t,a,n,r,i,o,s,l,c){var u=this;function d(){var e=s.sessionStorage.getItem(active_namespace_id+"searchTasksCriteria");if(e&&(u.searchCriteria=JSON.parse(e),(u.searchCriteria.assignee||u.searchCriteria.createdBy)&&(u.moreSearchOptions=!0),u.datePropertyActive)){u.searchCriteria.dateProperty=u.dateProperties[0],u.datePropertyActive=!0,u.moreSearchOptions=!0;var a=moment(u.searchCriteria.dateProperty,"YYYY-MM-DD").format("YYYY");u.years.forEach(function(e,t){parseFloat(a)===e&&(u.selectedYear=e)})}c.updatedResults?(u.tasks=c.updatedResults,u.pageToken=c.originalPageToken,u.moreResultsAvailable=c.originalMoreResultsAvailable,u.limitQuantity=c.originalLimitQuantity,u.searchActive=!1):f(u.searchCriteria),function e(a){u.isLoadingTypes=!0;var n={limit:100};a&&(n.pageToken=a);t.getTypes(n).then(function(t){var a=t.data;a.taskTypes&&a.taskTypes.length>0&&a.taskTypes.forEach(function(e){var t={type:e.type};u.types.push(t)}),a.pageToken?e(a.pageToken):u.isLoadingTypes=!1},function(e){u.isLoadingTypes=!1,u.errorDialogTypes=!0})}(),function e(a){u.isLoadingstatuses=!0;var n={limit:100};a&&(n.pageToken=a);t.getStatuses(n).then(function(t){var a=t.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){var t={status:e.status};u.statuses.push(t)}),a.pageToken?e(a.pageToken):u.isLoadingstatuses=!1},function(e){u.isLoadingstatuses=!1,u.errorDialogstatuses=!0})}(),v()}function f(e,a){if(e=angular.copy(e),u.isLoading=!0,e.tags)if("string"==typeof e.tags){e.tags=e.tags.split(",");for(var n=0;n<e.tags.length;n++)e.tags[n]=e.tags[n].trim()}else for(var r=0;r<e.tags.length;r++)e.tags[r]=e.tags[r].trim();i(function(){t.searchTasks(e,a).then(function(e){e.data.tasks&&(a?(u.tasks=u.tasks.concat(e.data.tasks),u.limitQuantity+=e.data.tasks.length):(u.tasks=e.data.tasks,u.limitQuantity=e.data.tasks.length)),u.pageToken=e.data.pageToken,u.moreResultsAvailable=e.data.more,u.isLoading=!1,u.searchActive=!1},function(e){u.isLoading=!1,u.searchActive=!1,u.moreResultsAvailable=!1})},500)}function m(){u.searchCriteria.tags||delete u.searchCriteria.tags,u.searchCriteria.type||delete u.searchCriteria.type,u.searchCriteria.status||delete u.searchCriteria.status,u.searchCriteria.dateProperty&&u.datePropertyActive||delete u.searchCriteria.dateProperty,delete u.searchCriteria.pageToken,u.datePropertyActive?(u.searchCriteria.startDate=moment(u.selectedYear+"-"+u.selectedMonth.month+"-"+u.selectedDay.day,"YYYY-MMMM-D").startOf("day").format("YYYY-MM-DDTHH:mm:ss.SSS"),u.searchCriteria.endDate=moment(u.selectedYear+"-"+u.selectedMonth.month+"-"+u.selectedDay.day,"YYYY-MMMM-D").endOf("day").format("YYYY-MM-DDTHH:mm:ss.SSS")):(delete u.searchCriteria.dateProperty,delete u.searchCriteria.startDate,delete u.searchCriteria.endDate),u.searchActive=!0,u.tasks=null,s.sessionStorage.setItem(active_namespace_id+"searchTasksCriteria",JSON.stringify(u.searchCriteria)),g(),f(u.searchCriteria)}function g(){u.tasks&&u.tasks&&u.tasks.forEach(function(e){e.selected=!1})}function p(){u.selectedTasks=[],u.selectedReadOnlyTasks=[],u.tasks.forEach(function(e){e.selected&&u.selectedTasks.push(e)}),u.selectedTasks.forEach(function(e){e.readOnly&&u.selectedReadOnlyTasks.push(e)})}function h(e){var t=(new Date).getFullYear(),a=[];for(e=e||1980;e<=t;)a.push(e++);if("endDatetime"===u.searchCriteria.dateProperty){var n=a.slice(-1).pop();n&&a.push(n+1)}return u.selectedYear=moment().year(),a}function v(){var e=moment.months(),t=moment().format("MMMM");if(u.months=[],e.forEach(function(e,a){var n=moment(u.selectedYear+"-"+e,"YYYY-MMMM"),r=moment().isBefore(n);"endDatetime"===u.searchCriteria.dateProperty&&(r=!1),u.months.push({month:e,disabled:r}),e!==t||u.searchCriteria.startDate||(u.selectedMonth=u.months[a])}),u.searchCriteria.startDate){var a=moment(u.searchCriteria.startDate,"YYYY-MM-DD").format("MMMM");u.months.forEach(function(e,t){a===e.month&&(u.selectedMonth=e)})}S()}function S(){for(var e=moment(u.selectedYear+"-"+u.selectedMonth.month,"YYYY-MMM").daysInMonth(),t=[],a=1;a<=e;a++){var n=moment(u.selectedYear+"-"+u.selectedMonth.month+"-"+a,"YYYY-MMM-D"),r=moment().isBefore(n);"endDatetime"===u.searchCriteria.dateProperty&&(r=!1),t.push({day:a,name:a,disabled:r})}u.days=t;var i=void 0;i=u.searchCriteria.startDate?moment(u.searchCriteria.startDate,"YYYY-MM-DD").format("D"):moment().format("D"),u.days.forEach(function(e){parseFloat(i)===e.day&&(u.selectedDay=e)})}function w(e){u.searchUserMode=!1,e&&(u.searchUserMode=e),u.searchUserActive=!u.searchUserActive}function T(e,t){n.addMessage({type:t,message:e})}function C(e){T(e,"error")}u.isLoading=!1,u.tasks=[],u.types=[],u.statuses=[],u.priorities=e.getPriorities(),u.selectedTasks=[],u.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],u.searchCriteria={},u.searchCriteria.limit=20,u.searchActive=!0,u.showDeleteTasksConfirmation=!1,u.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",u.years=h("2018"),u.selectedYear=moment().year(),u.datePropertyActive=!1,u.dateProperties=["updatedDatetime","createdDatetime","endDatetime"],u.toggleSearchUser=w,u.loadMoreTasks=function(){f(u.searchCriteria,u.pageToken)},u.deleteTask=function(e,a){a?(e.showTaskDeleteConfirmation=!1,e.disableControls=!0,t.deleteTasks([e.id]).then(function(){var t=u.tasks.filter(function(t){return t.id===e.id});t&&1===t.length&&(e.isRemoving=!0,i(function(){e.disableControls=!1,u.tasks.splice(u.tasks.indexOf(t[0]),1),u.limitQuantity--},235))},function(t){e.disableControls=!1,t.data&&t.data.error&&t.data.error.message?C(l("translate")("feedback.messages.errorIntro")+" "+t.data.error.message):C(l("translate")("feedback.messages.error"))})):e.showTaskDeleteConfirmation=!0},u.deleteTasks=function(){u.deletingTasks=!0;var e=[];u.tasks.forEach(function(t){t.selected&&!t.readOnly&&e.push(t.id)});var a=[];for(;e.length>0;)a.push(e.splice(0,15));var n=0;a.forEach(function(e){n++,function(e,a,n){t.deleteTasks(e).then(function(){a===n&&i(function(){u.deletingTasks=!1,o.reload(),T(l("translate")("feedback.messages.deleted")),u.limitQuantity=u.tasks.length,u.showDeleteTasksConfirmation=!1,u.moreResultsAvailable&&0===u.tasks.length?f(u.searchCriteria,u.pageToken):f(u.searchCriteria)},3e3)},function(e){u.deletingTasks=!1,C(l("translate")("feedback.messages.error"))})}(e,a.length,n)})},u.selectAll=function(){u.tasks.forEach(function(e){e.selected=!0})},u.unSelectAll=g,u.searchTasks=m,u.toggleDeleteConfirmation=function(){p(),u.showDeleteTasksConfirmation=!u.showDeleteTasksConfirmation},u.toggleDeleteTaskConfirmation=function(e){e.showTaskDeleteConfirmation=!e.showTaskDeleteConfirmation},u.selectedTasksAction=function(e){p(),o.go(e,{tasks:u.selectedTasks,results:u.tasks,pageToken:u.pageToken,moreResultsAvailable:u.moreResultsAvailable,limitQuantity:u.limitQuantity})},u.getDaysInMonth=S,u.getMonthsInYear=v,u.disableDateSearch=function(){u.datePropertyActive&&(u.datePropertyActive=!1,m())},u.enableDateSearch=function(){u.datePropertyActive||(u.datePropertyActive=!0,u.searchCriteria.dateProperty=u.dateProperties[0],m())},u.openTaskDetails=function(e){o.go("console.tasks.search.details",{taskId:e},{})},u.setSelectedUser=function(e){"assignee"===u.searchUserMode?u.searchCriteria.assignee=e.email:"createdBy"===u.searchUserMode&&(u.searchCriteria.createdBy=e.email);w()},u.setAllowedDateRange=function(){u.years=h("2018"),v()},a.getUserSettings().then(function(e){u.userSettings=e,u.userSettings.defaultDateTime&&(u.userDateTimeFormat=u.userSettings.defaultDateTime.date+" "+u.userSettings.defaultDateTime.time),u.userSettings.defaultChunkSize&&(u.searchCriteria.limit=u.userSettings.defaultChunkSize),d()},function(e){d()}),r.$watch("vm.tasks",function(){!u.isLoading&&u.tasks&&(u.selectedTasksDetected=!1,u.tasks.forEach(function(e){e.selected&&(u.selectedTasksDetected=!0)}))},!0)}angular.module("console.tasks").controller("TasksSearchController",e),e.$inject=["ConstantsService","TasksService","UserService","feedbackService","$scope","$timeout","$state","$window","$filter","$stateParams"]}(),function(){function e(e,t,a){var n=this;function r(t){n.types=[],n.isLoadingTypes=!0;var a={limit:100};t&&(a.pageToken=t),e.getTypes(a).then(function(e){var t=e.data;t.taskTypes&&t.taskTypes.length>0&&t.taskTypes.forEach(function(e){n.types.push(e)}),t.pageToken?r(t.pageToken):n.isLoadingTypes=!1},function(e){n.isLoadingTypes=!1,n.errorDialogTypes=!0})}function i(t){n.statuses=[],n.isLoadingstatuses=!0;var a={limit:100};t&&(a.pageToken=t),e.getStatuses(a).then(function(e){var t=e.data;t.taskStatuses&&t.taskStatuses.length>0&&t.taskStatuses.forEach(function(e){n.statuses.push(e)}),t.pageToken?i(t.pageToken):n.isLoadingstatuses=!1},function(e){n.isLoadingstatuses=!1,n.errorDialogstatuses=!0})}function o(e,a){t.addMessage({type:a,message:e})}function s(e){o(e,"error")}n.statuses=[],n.types=[],n.setTab=function(e){n.tab=e},n.tabIsSet=function(e){return n.tab===e},n.tab=0,n.addStatus=function(t){if(n.confirmAddStatus=!1,!n.addStatusForm.$valid)return;if(!t)return void(n.confirmAddStatus=!0);n.addingStatus=!0;var r={status:n.newStatus,aggregationAllowed:n.aggregateStatus};e.addStatus(r).then(function(e){e.data.id&&(r.id=e.data.id),n.statuses.push(r),n.addingStatus=!1,n.newStatus="",n.addStatusForm.$setPristine(),o(a("translate")("feedback.messages.ok"))},function(e){n.addingStatus=!1,e.data&&e.data.error&&e.data.error.message?s(a("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):s(a("translate")("feedback.messages.error"))})},n.addType=function(t){if(n.confirmAddType=!1,!n.addTypeForm.$valid)return;if(!t)return void(n.confirmAddType=!0);var r={type:n.newType};n.addingType=!0,e.addType(r).then(function(e){e.data.id&&(r.id=e.data.id),n.types.push(r),n.addingType=!1,n.newType="",n.addTypeForm.$setPristine(),o(a("translate")("feedback.messages.ok"))},function(e){n.addingType=!1,e.data&&e.data.error&&e.data.error.message?s(a("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):s(a("translate")("feedback.messages.error"))})},n.editStatus=function(e){n.editStatusMode=!0,n.statusToEdit=angular.copy(e)},n.cancelEdit=function(){n.editStatusMode=!1,n.editTypeMode=!1},n.updateStatus=function(){if(!n.editStatusForm.$valid)return;n.updatingStatus=!0;var t=n.statusToEdit;e.updateStatus(t).then(function(e){n.updatingStatus=!1,n.statusToEdit="",n.editStatusMode=!1,n.editStatusForm.$setPristine(),o(a("translate")("feedback.messages.ok")),i()},function(e){n.updatingStatus=!1,e.data&&e.data.error&&e.data.error.message?s(a("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):s(a("translate")("feedback.messages.error"))})},n.editType=function(e){n.editTypeMode=!0,n.typeToEdit=angular.copy(e)},n.updateType=function(){if(!n.editTypeForm.$valid)return;n.updatingType=!0;var t=n.typeToEdit;e.updateType(t).then(function(e){n.updatingType=!1,n.typeToEdit="",n.editTypeMode=!1,n.editTypeForm.$setPristine(),o(a("translate")("feedback.messages.ok")),r()},function(e){n.updatingType=!1,e.data&&e.data.error&&e.data.error.message?s(a("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):s(a("translate")("feedback.messages.error"))})},n.aggregateStatus=!0,r(),i()}angular.module("console.tasks").controller("TasksSettingsController",e),e.$inject=["TasksService","feedbackService","$filter"]}(),function(){function e(e,t,a,n,r,i,o,s){var l,c=this;function u(e){var t={};if(e&&e.pillType&&"merge"===e.pillType){if(t={field:e.field,functionParams:e.functionParams,function:"composite"},e.fields&&e.fields.length>0){for(var a=[],n=!1,r=0;r<e.fields.length;r++)e.fields[r].namespacePaths&&(n=!0,a.push(e.fields[r].namespacePaths.join(".")));n&&(t.field=a.map(function(e){return e}).join(","))}}else if(e&&e.pillType&&"split"===e.pillType){if(t={field:e.field,functionParams:e.functionParams,function:"split"},e.fields&&e.fields.length>0){for(var i=[],o=!1,s=0;s<e.fields.length;s++)e.fields[s].namespacePaths&&(o=!0,i.push(e.fields[s].namespacePaths.join(".")));o&&(t.field=i.map(function(e){return e}).join(","))}}else e&&e.pillType&&"generateId"===e.pillType?t={function:"generate_id"}:e&&e.pillType&&"static"===e.pillType?t={staticValue:e.staticValue,type:e.type}:e&&e.staticValue?t={staticValue:e.staticValue}:e&&e.namespacePaths?t={field:e.namespacePaths.join("."),type:e.type}:e&&e.field&&(t={field:e.field,type:e.type});return t}function d(e){c.chooseConfigurationSheet=!1,c.existingTransformationConfiguration=!0,c.datasource={},c.datasource.datasourceId=angular.equals(e.datasourcesMapping.datasourceId,{})?null:e.datasourcesMapping.datasourceId,c.datasource.name=angular.equals(e.datasourcesMapping.name,{})?null:e.datasourcesMapping.name,c.datasource.classifier=angular.equals(e.datasourcesMapping.classifier,{})?null:e.datasourcesMapping.classifier,c.datasource.description=angular.equals(e.datasourcesMapping.description,{})?null:e.datasourcesMapping.description,c.datasource.timezone=angular.equals(e.datasourcesMapping.timezone,{})?null:e.datasourcesMapping.timezone,c.tags=[],e.tagsMapping&&e.tagsMapping.forEach(function(e){var t={tag:e.tag,type:e.type,properties:[]};e.validFrom&&(t.validFrom=e.validFrom,e.validFrom.field&&(t.validFrom.pillType="column")),e.properties&&e.properties.forEach(function(e){t.properties.push(e)}),c.tags.push(t)}),c.channels=[],e.datasourcesMapping&&e.datasourcesMapping.channelsMapping&&(e.datasourcesMapping.channelsMapping.forEach(function(e){e.startOfPeriod&&(e.indexActive=!0,e.start=e.startOfPeriod,e.stop=e.index),e.selectedChannelClassifier=e.channelClassifier}),c.channels=e.datasourcesMapping.channelsMapping),e.id&&(c.configurationId=e.id),c.configurationType=e.type,e.name&&(c.configurationName=e.name),e.description&&(c.configurationDescription=e.description),e.readOnly&&(c.readOnly=!0)}function f(){c.configurationType||(c.configurationType="inbound"),c.detailsTabTags=[{name:n("translate")("tcm.type."+c.configurationType),status:"primary"},{name:n("translate")("tcm.componentStatus.configured"),status:"ok"}],c.configurationName&&c.configurationId?c.detailsTabTitle=c.configurationName:!c.configurationName&&c.configurationId?c.detailsTabTitle=n("translate")("tcm.componentStatus.provideName"):c.detailsTabTitle=n("translate")("tcm.componentStatus.newTransformationConfiguration"),c.configurationName||(c.detailsTabTags=[{name:n("translate")("tcm.type."+c.configurationType),status:"primary"},{name:n("translate")("tcm.componentStatus.configurationPending"),status:"warning"}])}function m(e,a){t.addMessage({type:a,message:e})}function g(e){m(e,"error")}if(c.helperColumns={columns:[{name:"addMergedColumns",pillType:"merge",description:"mergedDescription"},{name:"addSplitColumn",pillType:"split",description:"splitDescription"},{name:"addStaticValue",pillType:"static",description:"staticDescription"},{name:"addId",pillType:"generateId",description:"idDescription"}]},c.tags=[],c.channels=[],c.datasource={},c.detectedColumns=!1,c.savingTransformationConfiguration=!1,c.chooseConfigurationSheet=!1,c.existingTransformationConfiguration=!1,c.loadingTransformationConfiguration=!1,c.detectedSwitch="all",c.copyTransformationConfiguration=function(){c.existingTransformationConfiguration=!1,c.configurationId=null,c.configurationName=c.configurationName+"_copy",c.readOnly=!1,e=n("translate")("feedback.messages.copied"),m(e,"informational");var e},c.checkAndSaveTransformationConfiguration=function(t){c.invalidItems=[],c.datasource.validated||c.invalidItems.push({datasource:c.datasource});c.tags&&c.tags.length>0&&c.tags.forEach(function(e){e.validated||c.invalidItems.push({tag:e})});c.channels&&c.channels.length>0&&c.channels.forEach(function(e){e.validated||c.invalidItems.push({channel:e})});c.configurationName||c.invalidItems.push({details:!1});0===c.invalidItems.length&&function(t){if(!c.configurationForm.$valid)return;c.savingTransformationConfiguration=!0,c.showSaveDialog=!1;var a={datasourcesMapping:{channelsMapping:[],datasourceId:{},description:{},name:{},timezone:{}},tagsMapping:[]};c.datasource&&c.datasource.datasourceId&&(a.datasourcesMapping.datasourceId=u(c.datasource.datasourceId));c.datasource&&c.datasource.name&&(a.datasourcesMapping.name=u(c.datasource.name));c.datasource&&c.datasource.classifier&&(a.datasourcesMapping.classifier=u(c.datasource.classifier));c.datasource&&c.datasource.description&&(a.datasourcesMapping.description=u(c.datasource.description));c.datasource&&c.datasource.timezone&&(a.datasourcesMapping.timezone=u(c.datasource.timezone));c.tags.forEach(function(e){var t={type:e.type,tag:e.tag,properties:[]};e.validFrom&&(t.validFrom=e.validFrom,(t.validFrom.field||t.validFrom.fields&&t.validFrom.fields.length>0)&&delete t.validFrom.staticValue,t.validFrom.namespacePaths&&(t.validFrom.field=t.validFrom.namespacePaths.join(".")),e.validFrom.staticValue&&(e.validFrom.staticValue=moment.utc(e.validFrom.staticValue).format())),e.tag.staticValue?t.tag={staticValue:e.tag.staticValue}:e.tag.namespacePaths?t.tag={field:e.tag.namespacePaths.join(".")}:e.tag.field&&(t.tag={field:e.tag.field}),e.tag.function&&(t.tag.function=e.tag.function),e.properties.forEach(function(e){var a=u(e);a.key=""===e.key?e.field:e.key,e.function&&(e.type=null),(""!==e.field||e.fields.length>0)&&delete e.staticValue,t.properties.push(a)}),a.tagsMapping.push(t)}),c.channels.forEach(function(e){var t={properties:e.properties?e.properties:[],channelClassifier:e.channelClassifier?e.channelClassifier:{staticValue:e.channelClassifier.staticValue},name:{staticValue:e.name?e.name.staticValue:e.channelClassifier.staticValue},description:{staticValue:e.description?e.description.staticValue:""}};e.name||(e.name={staticValue:e.channelClassifier.staticValue}),!e.channelId&&e.channelClassifier.staticValue?(t.channelId=e.channelClassifier.staticValue,e.channelId=e.channelClassifier.staticValue):t.channelId=e.channelId,e.channelClassifier.namespacePaths&&(t.channelClassifier={field:e.channelClassifier.namespacePaths.join(".")},t.channelId=e.channelClassifier.namespacePaths.join(".")),e.value&&(t.value={field:e.value&&e.value.field?e.value.field:null},e.value.namespacePaths&&(t.value={field:e.value.namespacePaths.join(".")})),t.channelClassifier.field&&""===t.channelClassifier.staticValue&&(t.channelId="",delete t.channelClassifier.staticValue),""===e.channelClassifier.function&&(delete t.channelClassifier.function,delete t.channelClassifier.functionParams),e.indexActive?(t.startOfPeriod={field:e.start&&e.start.field?e.start.field:null,function:e.index&&e.index.function?e.index.function:null,functionParams:e.index&&e.index.functionParams?e.index.functionParams:[]},e.start.namespacePaths&&(t.startOfPeriod.field=e.start.namespacePaths.join(".")),delete t.startOfPeriod.staticValue,t.index={field:e.stop&&e.stop.field?e.stop.field:null,function:e.index&&e.index.function?e.index.function:null,functionParams:e.index&&e.index.functionParams?e.index.functionParams:[]},e.stop.namespacePaths&&(t.index.field=e.stop.namespacePaths.join(".")),delete t.index.staticValue):(t.index={field:e.index&&e.index.field?e.index.field:null,function:e.index&&e.index.function?e.index.function:null,functionParams:e.index&&e.index.functionParams?e.index.functionParams:[],properties:e.index.properties},e.index.properties&&(t.index.properties=e.index.properties),delete t.index.staticValue,t.startOfPeriod&&delete t.startOfPeriod,e.index.namespacePaths&&(t.index.field=e.index.namespacePaths.join("."))),e.flowConfigurationId&&(t.flowConfigurationId=e.flowConfigurationId),e.annotations&&(t.annotations=e.annotations,delete t.annotations.staticValue,delete t.annotations.fields,t.annotations.function||(delete t.annotations.function,delete t.annotations.functionParams),e.annotations.namespacePaths&&(t.annotations.field=e.annotations.namespacePaths.join("."))),e.cleansingConfigurations&&(t.cleansingConfigurations=e.cleansingConfigurations),a.datasourcesMapping.channelsMapping.push(t)}),a.name=c.configurationName,a.description=c.configurationDescription,a.type=c.configurationType,t?(a.id=t,c.configurationId=t,e.updateTransformationConfiguration(a).then(function(e){c.savingTransformationConfiguration=!1,m(n("translate")("feedback.messages.ok"))},function(e){c.savingTransformationConfiguration=!1,e.data?g(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")"):g(n("translate")("feedback.messages.error"))})):e.createTransformationConfiguration(a).then(function(e){c.configurationId=e.data.id,c.savingTransformationConfiguration=!1,c.existingTransformationConfiguration=!0,m(n("translate")("feedback.messages.ok")),i.go("console.tcm.details",{configId:e.data.id,configuration:e.data})},function(e){c.savingTransformationConfiguration=!1,g(n("translate")("feedback.messages.error"))})}(t)},c.deleteTransformationConfiguration=function(t,a){a?(c.deletingTransformationConfiguration=!0,e.deleteTransformationConfiguration(t).then(function(e){c.deletingTransformationConfiguration=!1,m(n("translate")("feedback.messages.deleted")),i.go("console.tcm")},function(e){c.deletingTransformationConfiguration=!1,g(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")")})):c.confirmDelete=!0},c.importMapping=d,c.toggleSaveDialog=function(){c.showSaveDialog=!c.showSaveDialog},c.toggleChooseConfigurationSheet=function(){c.chooseConfigurationSheet=!c.chooseConfigurationSheet},c.selectExistingConfiguration=function(e){i.go("console.tcm.details",{configId:e.id,configuration:e})},c.checkDetails=f,a.$watch("vm.chooseConfigurationSheet",function(){c.chooseConfigurationSheet&&angular.element(s).bind("keydown",function(e){27===e.keyCode&&(e.preventDefault(),a.$apply(function(){c.chooseConfigurationSheet=!1}))})}),a.$on("$destroy",function(){angular.element(s).unbind("keydown")}),r.file){if(c.filename=r.file.filename,c.file=r.file,r.configuration&&d(r.configuration),c.file.fileContentDescriptor){var p=c.file.fileContentDescriptor;c.filesColumnData=[],p&&p.files&&p.files.length>0&&(p.files.forEach(function(e){var t={name:e.name,columns:[],timeseries:[]};e.timeseries&&e.timeseries.forEach(function(a){t.timeseries.push({field:a.path[a.path.length-1],preview:a.types,filename:e.name,paths:a.path,namespacePaths:a.namespacePath})}),e.fields&&e.fields.forEach(function(a){t.columns.push({field:a.path[a.path.length-1],preview:a.types,filename:e.name,paths:a.path,namespacePaths:a.namespacePath})}),c.filesColumnData.push(t)}),c.detectedColumns=!0)}else!function(e){c.loadingFile=!0;var t="/files/get/"+e.blobKey;o.get(t).then(function(e){var t=function(e){var t={};return function e(a,n,r){if(Object(a)===a||r)if(Object(a)!==a&&r)t[n]||(t[n]=[]),t[n].push(a);else if(a instanceof Array)for(var i=0,o=a.length;i<o;i++)e(a[i],n,!0);else{var s=!0;for(var l in a)a.hasOwnProperty(l)&&(s=!1,e(a[l],n?n+"."+l:l,!0));s&&n&&(t[n]={})}else t[n]=a}(e,""),t}(e.data);if(1===Object.keys(t).length&&void 0!==t[""]){var a=t[""].split("\n");if(a.length>0){var n=a[0],r=(n.match(/\,/g)||[]).length,i=(n.match(/\;/g)||[]).length,o=(n.match(/\t/g)||[]).length,s=(n.match(/\|/g)||[]).length,l=(n.match(/\~/g)||[]).length;if(r+i+o+s>0){var u=",",d=r;i>d&&(d=i,u=";"),o>d&&(d=o,u="\t"),s>d&&(u="|"),l>d&&(u="~");var f=n.split(u),m=new Array(f.length);a.length>1&&(m=a[1].split(u)),delete t[""];for(var g=0;g<f.length;g++)m[g]&&(t[f[g].trim()]=[m[g].trim()])}}}for(var p in c.columnData={columns:[],timeseries:[]},t)p&&t[p].length>1?c.columnData.timeseries.push({field:p,preview:t[p]}):p&&c.columnData.columns.push({field:p,preview:t[p]});c.loadingFile=!1,c.detectedColumns=!0},function(e){c.loadingFile=!1,g(n("translate")("feedback.messages.error")+" (Error: "+e.data+")")})}(c.file);f()}else r.configuration?(c.transformationConfiguration=r.configuration,d(r.configuration),f()):r.configId?(l=r.configId,c.loadingTransformationConfiguration=!0,e.getTransformationConfiguration(l).then(function(e){c.existingTransformationConfiguration=!0,c.loadingTransformationConfiguration=!1,d(e.data),f()},function(e){c.loadingTransformationConfiguration=!1,i.go("console.tcm",{},{reload:!0}),g(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")")})):i.go("console.tcm")}angular.module("console.tcm").controller("TcmDetailsController",e),e.$inject=["IngestService","feedbackService","$scope","$filter","$stateParams","$state","$http","$window"]}(),function(){function e(e,t,a,n,r,i,o){var s=this;if(s.selectDatasource=function(e){s.selectedDatasource=e,s.selectedDatasource.channels.length>0&&(s.availableChannels=s.selectedDatasource.channels);s.searchDatasourceActive=!1},s.selectChannelClassifier=function(e){s.searchChannelClassifierActive=!1,s.selectedChannelClassifier=e},s.assignToDatasourceChannel=function(){s.isSaving=!0;var t={channelName:s.selectedDatasourceChannel.id,datasourceId:s.selectedDatasource.id,timesliceGroupId:s.timesliceGroup.id};e.assignToDatasourceChannel(t).then(function(e){s.isSaving=!1,u(n("translate")("feedback.messages.ok")),c()},function(e){s.isSaving=!1,s.errorDialog=!0,e.data&&e.data.error&&e.data.error.message?d(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):d(n("translate")("feedback.messages.error"))})},s.assignToChannelClassifier=function(){s.isSaving=!0;var t={channelClassifierName:s.selectedChannelClassifier.name,timesliceGroupId:s.timesliceGroup.id};e.assignToChannelClassifier(t).then(function(e){s.isSaving=!1,u(n("translate")("feedback.messages.ok")),c()},function(e){s.isSaving=!1,s.errorDialog=!0,e.data&&e.data.error&&e.data.error.message?d(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):d(n("translate")("feedback.messages.error"))})},s.stateUp=c,a.timesliceGroup)s.timesliceGroup=a.timesliceGroup;else{s.errorDialog=!1;var l=a.timesliceGroupId;s.isLoading=!0,e.getTimesliceGroup(l).then(function(e){s.isLoading=!1,s.timesliceGroup=e.data},function(e){s.isLoading=!1,s.errorDialog=!0})}function c(){r.go("^")}function u(e,a){t.addMessage({type:a,message:e})}function d(e){u(e,"error")}s.assignContext="assignToChannelClassifier",s.selectedChannelClassifier={},s.selectedDatasource={},angular.element(o).bind("keydown",function(e){27===e.keyCode&&"console.timeslice-groups.details.assign"===r.current.name&&(e.preventDefault(),r.go("^"))}),i.$on("$destroy",function(){angular.element(o).unbind("keydown")})}angular.module("console.timeslice-groups").controller("TimesliceGroupAssignController",e),e.$inject=["TimesliceService","feedbackService","$stateParams","$filter","$state","$scope","$window"]}(),function(){function e(e,t,a,n,r,i){var o=this;function s(e){if(e.intervals){e.valid=!0;var t={endHour:"",endMinutes:"",value:""};e.intervals.forEach(function(a,n){var r=e.intervals[n+1];r&&a.endHour>r.endHour&&n<e.intervals.length&&(e.intervals.length=n+1,e.intervals.push(t)),a.endHour&&a.endMinutes?a.valid=!0:a.valid=!1,a.valid&&a.value||(e.valid=!1),"24"===a.endHour&&(a.endMinutes="00",e.intervals.length=n+1)})}}function l(e,a){t.addMessage({type:a,message:e})}function c(e){l(e,"error")}function u(e,t){var a={},n=[],r="00:00";return e.intervals.forEach(function(e){a[e.value]||(a[e.value]=[]);var t=e.endHour+":"+e.endMinutes;a[e.value].push({start:r,end:t}),r=t}),Object.keys(a).forEach(function(r){var i=[],o=[];a[r].forEach(function(e){i.push(e.start),o.push(e.end)}),n.push({priority:t,value:r,periodType:e.type,starts:i,ends:o})}),n}o.templates=[{template:["daily"]},{template:["daily","holiday"]},{template:["weekdays","weekend"]},{template:["weekdays","weekend","holiday"]},{template:["weekdays","saturday","sunday"]},{template:["weekdays","saturday","sunday","holiday"]},{template:["weekdays","saturday","sunday_holiday"]}],o.timesliceGroup={dst:!1},o.checkTimeInterval=function(e,t,a,n){if(!n){var r={endHour:"",endMinutes:"",value:""},i=void 0;if(t.intervals&&t.intervals.length>0&&(i=t.intervals[a-1]),e.endHour&&2===e.endHour.length&&e.endMinutes&&2===e.endMinutes.length){if(i){if("24"===e.endHour)return e.endMinutes="00",e.valid=!0,t.intervals.length=a+1,void s(t);if("24"===e.endHour&&"00"!==i.endHour)return e.endMinutes="00",e.valid=!0,t.intervals.length=a+1,void s(t);if(i.endHour>e.endHour&&(e.endHour=i.endHour),i.endHour===e.endHour&&i.endMinutes>e.endMinutes&&(e.endMinutes=i.endMinutes),i.endHour===e.endHour&&i.endMinutes===e.endMinutes){var o=parseInt(i.endMinutes)+1;60===o&&(o="00",e.endHour=parseInt(e.endHour)+1,e.endHour=e.endHour.toString()),1===(o=o.toString()).length&&(o="0"+o),e.endMinutes=o}var l=t.intervals.slice(-1)[0];l.endHour&&l.endMinutes&&"24"!==l.endHour&&t.intervals.push(r)}else if("24"===e.endHour)e.endMinutes="00",t.intervals.length=a+1,e.valid=!0;else if("00"!==e.endHour&&"00"!==e.endMinutes)e.valid=!0,t.intervals.push(r);else if("00"===e.endHour&&"00"===e.endMinutes){var c=parseInt(e.endMinutes)+1;1===(c=c.toString()).length&&(c="0"+c),e.endMinutes=c,e.valid=!0,1===t.intervals.length&&t.intervals.push(r)}else t.intervals.length=1,t.intervals.push(r);var u=parseInt(e.endHour),d=parseInt(e.endMinutes);u&&d&&(e.valid=!0)}}s(t)},o.selectTemplate=function(e,t,a){t?(o.activeTemplateDst=a,o.timesliceGroup.dstTimeslices=[],e.template.forEach(function(e){o.timesliceGroup.dstTimeslices.push({type:e,intervals:[{endHour:"",endMinutes:"",value:""}]})})):(o.activeTemplate=a,o.timesliceGroup.standardTimeslices=[],e.template.forEach(function(e){o.timesliceGroup.standardTimeslices.push({type:e,intervals:[{endHour:"",endMinutes:"",value:""}]})}))},o.checkSelectedTemplate=function(e,t){t||(o.timesliceGroup.standardTimeslices=[],e.forEach(function(e){o.timesliceGroup.standardTimeslices.push({type:e,intervals:[{endHour:"",endMinutes:"",value:""}]})}))},o.templateIsSet=function(e,t){return t?o.activeTemplateDst===e:o.activeTemplate===e},o.createTimesliceGroup=function(){o.isSaving=!0;var t=!o.activeTemplate&&0!==o.activeTemplate,a=!o.activeTemplateDst&&0!==o.activeTemplateDst;if(!o.createTimesliceGroupForm.$valid||t||a&&o.timesliceGroup.dst)return o.isSaving=!1,!1;var i=function(e){var t={description:e.description,id:"",name:e.name,timeslices:[]};if(e.dst){t.timeslices.push({priority:1,starts:["True"],ends:["False"],value:"",periodType:"dst"}),e.dstTimeslices&&e.dstTimeslices.forEach(function(e){var a=u(e,2);t.timeslices=t.timeslices.concat(a)});t.timeslices.push({priority:1,starts:["False"],ends:["True"],value:"",periodType:"dst"})}e.standardTimeslices&&e.standardTimeslices.forEach(function(a){var n=e.dst?2:1,r=u(a,n);t.timeslices=t.timeslices.concat(r)});return t}(o.timesliceGroup);e.createTimesliceGroup(i).then(function(e){o.isSaving=!1,l(n("translate")("feedback.messages.ok")),e.data.id?r.go("console.timeslice-groups.details",{timesliceGroupId:e.data.id}):r.go("^")},function(e){o.isSaving=!1,o.errorDialog=!0,e.data&&e.data.error&&e.data.error.message?c(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(n("translate")("feedback.messages.error"))})},a.$watch("vm.timesliceGroup.dst",function(e,t){})}angular.module("console.timeslice-groups").controller("TimesliceGroupCreateController",e),e.$inject=["TimesliceService","feedbackService","$scope","$filter","$state","$timeout"]}(),function(){function e(e,t,a,n,r){var i=this;if(i.deleteTimesliceGroup=function(){i.isSaving=!0,e.deleteTimesliceGroup(i.timesliceGroup.id).then(function(e){i.isSaving=!1,r.go("console.timeslice-groups"),f(n("translate")("feedback.messages.deleted"))},function(e){i.isSaving=!1,i.showDeleteConfirm=!1,e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):m(n("translate")("feedback.messages.error"))})},i.toggleEditMode=c,i.updateTimesliceGroup=function(){if(i.formErrorDialog=!1,i.isSaving=!0,!i.editTimesliceGroupForm.$valid)return i.formErrorDialog=!0,i.isSaving=!1,!1;if(i.timesliceGroup.dst&&i.timesliceGroup.dstTimeslices&&0===i.timesliceGroup.dstTimeslices.length)return i.formErrorDialog=!0,i.isSaving=!1,!1;var t=function(e){var t={description:e.description,id:e.id,name:e.name,timeslices:[]};if(e.dst){t.timeslices.push({priority:1,starts:["True"],ends:["False"],value:"",periodType:"dst"}),e.dstTimeslices&&e.dstTimeslices.forEach(function(e){var a=l(e,2);t.timeslices=t.timeslices.concat(a)});t.timeslices.push({priority:1,starts:["False"],ends:["True"],value:"",periodType:"dst"})}e.standardTimeslices&&e.standardTimeslices.forEach(function(a){var n=e.dst?2:1,r=l(a,n);t.timeslices=t.timeslices.concat(r)});return t}(i.timesliceGroup);e.updateTimesliceGroup(t).then(function(e){i.isSaving=!1,f(n("translate")("feedback.messages.ok")),c()},function(e){i.isSaving=!1,i.errorDialog=!0,e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):m(n("translate")("feedback.messages.error"))})},i.selectTemplate=u,i.templateIsSet=function(e,t){return t?i.activeTemplateDst===e:i.activeTemplate===e},i.checkTimeInterval=function(e,t,a,n){if(!n){var r={endHour:"",endMinutes:"",value:""},i=void 0;if(t.intervals&&t.intervals.length>0&&(i=t.intervals[a-1]),e.endHour&&2===e.endHour.length&&e.endMinutes&&2===e.endMinutes.length){if(i){if("24"===e.endHour)return e.endMinutes="00",e.valid=!0,t.intervals.length=a+1,void d(t);if("24"===e.endHour&&"00"!==i.endHour)return e.endMinutes="00",e.valid=!0,t.intervals.length=a+1,void d(t);if(i.endHour>e.endHour&&(e.endHour=i.endHour),i.endHour===e.endHour&&i.endMinutes>e.endMinutes&&(e.endMinutes=i.endMinutes),i.endHour===e.endHour&&i.endMinutes===e.endMinutes){var o=parseInt(i.endMinutes)+1;60===o&&(o="00",e.endHour=parseInt(e.endHour)+1,e.endHour=e.endHour.toString()),1===(o=o.toString()).length&&(o="0"+o),e.endMinutes=o}var s=t.intervals.slice(-1)[0];s.endHour&&s.endMinutes&&"24"!==s.endHour&&t.intervals.push(r)}else if("24"===e.endHour)e.endMinutes="00",t.intervals.length=a+1,e.valid=!0;else if("00"!==e.endHour&&"00"!==e.endMinutes)e.valid=!0,t.intervals.push(r);else if("00"===e.endHour&&"00"===e.endMinutes){var l=parseInt(e.endMinutes)+1;1===(l=l.toString()).length&&(l="0"+l),e.endMinutes=l,e.valid=!0,1===t.intervals.length&&t.intervals.push(r)}else t.intervals.length=1,t.intervals.push(r);var c=parseInt(e.endHour),u=parseInt(e.endMinutes);c&&u&&(e.valid=!0)}}d(t)},i.changeTemplate=function(e){e?i.changeDstTemplate=!0:i.changeStandardTemplate=!0;!function(e){if(e){var t=[];i.timesliceGroup.dstTimeslices&&i.timesliceGroup.dstTimeslices.length>0&&i.timesliceGroup.dstTimeslices.forEach(function(e){e.type&&t.push(e.type)}),i.templates.forEach(function(e,a){e.template.sort().join(",")===t.sort().join(",")&&u(e,!0,a)})}var a=[];i.timesliceGroup.standardTimeslices&&i.timesliceGroup.standardTimeslices.length>0&&i.timesliceGroup.standardTimeslices.forEach(function(e){e.type&&a.push(e.type)});i.templates.forEach(function(e,t){e.template.sort().join(",")===a.sort().join(",")&&u(e,!1,t)})}(e)},i.templates=[{template:["daily"]},{template:["daily","holiday"]},{template:["weekdays","weekend"]},{template:["weekdays","weekend","holiday"]},{template:["weekdays","saturday","sunday"]},{template:["weekdays","saturday","sunday","holiday"]},{template:["weekdays","saturday","sunday_holiday"]}],i.timesliceGroup={dst:!1},a.timeSliceGroup)i.timesliceGroup=a.timeSliceGroup;else if(a.timesliceGroupId){i.errorDialog=!1;var o=a.timesliceGroupId;i.isLoading=!0,e.getTimesliceGroup(o).then(function(e){i.isLoading=!1,i.timesliceGroup=function(e){var t={id:e.id,dst:!1,name:e.name,description:e.description,standardTimeslices:[],dstTimeslices:[]},a={},n={},r=!1;e.timeslices&&e.timeslices.forEach(function(e){if("dst"===e.periodType)t.dst=!0,r=!1,"True"===e.starts[0]&&(r=!0);else{var i=a;r&&(i=n),i[e.periodType]||(i[e.periodType]={type:e.periodType,intervals:[],valid:!0}),e.ends.forEach(function(t){i[e.periodType].intervals.push({endHour:t.split(":")[0],endMinutes:t.split(":")[1],value:e.value,valid:!0})})}});return Object.keys(a).forEach(function(e){var n=a[e];n.intervals.sort(s),t.standardTimeslices.push(n)}),Object.keys(n).forEach(function(e){var a=n[e];a.intervals.sort(s),t.dstTimeslices.push(a)}),t}(e.data)},function(e){i.isLoading=!1,i.errorDialog=!0})}function s(e,t){return e.endHour===t.endHour?e.endMinutes<t.endMinutes&&"00"!==e.endMinutes?-1:e.endMinutes>t.endMinutes&&"00"===e.endMinutes?1:0:e.endHour<t.endHour&&"00"!==e.endHour?-1:1}function l(e,t){var a={},n=[],r="00:00";return e.intervals.forEach(function(e){a[e.value]||(a[e.value]=[]);var t=e.endHour+":"+e.endMinutes;a[e.value].push({start:r,end:t}),r=t}),Object.keys(a).forEach(function(r){var i=[],o=[];a[r].forEach(function(e){i.push(e.start),o.push(e.end)}),n.push({priority:t,value:r,periodType:e.type,starts:i,ends:o})}),n}function c(e){e?(i.timesliceGroup=angular.copy(i.originalTimesliceGroup),i.changeDstTemplate=!1,i.changeStandardTemplate=!1,i.formErrorDialog=!1,i.editTimesliceGroupForm.$setPristine()):(i.changeDstTemplate=!1,i.changeStandardTemplate=!1,i.originalTimesliceGroup=angular.copy(i.timesliceGroup)),i.editModeActive=!i.editModeActive}function u(e,t,a){var n=[],r=[];t?(i.activeTemplateDst=a,i.timesliceGroup.dstTimeslices&&i.timesliceGroup.dstTimeslices.length>0&&(r=i.timesliceGroup.dstTimeslices)):(i.activeTemplate=a,i.timesliceGroup.standardTimeslices&&i.timesliceGroup.standardTimeslices.length>0&&(r=i.timesliceGroup.standardTimeslices)),e.template.forEach(function(e){var t=[{endHour:"",endMinutes:"",value:""}],a=r.filter(function(t){return t.type===e});a.length>0&&(t=a[0].intervals),n.push({type:e,intervals:t})}),t?(i.timesliceGroup.dstTimeslices=n,i.timesliceGroup.dstTimeslices.forEach(function(e){d(e)})):(i.timesliceGroup.standardTimeslices=n,i.timesliceGroup.standardTimeslices.forEach(function(e){d(e)}))}function d(e){if(e.intervals){e.valid=!0;var t={endHour:"",endMinutes:"",value:""};e.intervals.forEach(function(a,n){var r=e.intervals[n+1];r&&a.endHour>r.endHour&&n<e.intervals.length&&(e.intervals.length=n+1,e.intervals.push(t)),a.endHour&&a.endMinutes?a.valid=!0:a.valid=!1,a.valid&&a.value||(e.valid=!1),"24"===a.endHour&&(a.endMinutes="00",e.intervals.length=n+1)})}}function f(e,a){t.addMessage({type:a,message:e})}function m(e){f(e,"error")}}angular.module("console.timeslice-groups").controller("TimesliceGroupDetailsController",e),e.$inject=["TimesliceService","feedbackService","$stateParams","$filter","$state"]}(),function(){function e(e,t,a,n,r,i){var o,s=this;function l(e,t){a.addMessage({type:t,message:e})}function c(e){l(e,"error")}s.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",s.toggleEditMode=function(){s.editMode=!s.editMode},s.cancelEditMode=function(){s.transportAdapter=angular.copy(s.originalTransportAdapter),s.editMode=!1},s.selectedMarketAdapter=function(e){s.transportAdapter.marketAdapterId=e.id,s.searchMarketAdapterActive=!1},s.addProperty=function(){s.transportAdapter.properties||(s.transportAdapter.properties=[]);s.transportAdapter.properties.push({key:"",value:""})},s.removeProperty=function(e){s.transportAdapter.properties.splice(e,1)},s.addTag=function(){s.transportAdapter.tags||(s.transportAdapter.tags=[]);s.transportAdapter.tags.push("")},s.removeTag=function(e){s.transportAdapter.tags.splice(e,1)},s.saveTransportAdapter=function(){if(!s.transportAdapterForm.$valid)return s.formErrorDialog=!0,!1;s.formErrorDialog=!1,s.isSaving=!0,e.updateTransportAdapter(s.transportAdapter).then(function(e){s.isSaving=!1,s.editMode=!1,l(i("translate")("feedback.messages.ok"))},function(e){s.isSaving=!1,e.data&&e.data.error&&e.data.error.message?c(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(i("translate")("feedback.messages.error"))})},s.deleteTransportAdapter=function(t){if(!t)return s.confirmDelete=!0,!1;s.isSaving=!0,e.deleteTransportAdapter(s.transportAdapter.id).then(function(e){s.isSaving=!1,s.editMode=!1,s.confirmDelete=!1,r.go("console.transport-adapters"),l(i("translate")("feedback.messages.deleted"))},function(e){s.isSaving=!1,s.confirmDelete=!1,e.data&&e.data.error&&e.data.error.message?c(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(i("translate")("feedback.messages.error"))})},s.triggerTransportAdapter=function(){s.isTriggering=!0,e.triggerTransportAdapter(s.transportAdapter.id).then(function(e){s.isTriggering=!1,l(i("translate")("feedback.messages.triggered"))},function(e){s.isTriggering=!1,e.data&&e.data.error&&e.data.error.message?c(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(i("translate")("feedback.messages.error"))})},t.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time)},function(e){}),n.transportAdapter?(s.originalTransportAdapter=angular.copy(n.transportAdapter),s.transportAdapter=n.transportAdapter):n.transportAdapterId?(o=n.transportAdapterId,s.isLoading=!0,e.getTransportAdapterDetails(o).then(function(e){s.originalTransportAdapter=angular.copy(e.data),s.transportAdapter=e.data,s.isLoading=!1},function(e){s.isLoading=!1,s.errorDialog=!0})):r.go("console.transport-adapters")}angular.module("console.transport-adapters").controller("TransportAdapterDetailsController",e),e.$inject=["TransportAdapterService","UserService","feedbackService","$stateParams","$state","$filter"]}(),function(){function e(e,t,a,n,r){var i=this;function o(e,a){t.addMessage({type:a,message:e})}function s(e){o(e,"error")}i.transportAdapter={},i.selectedMarketAdapter=function(e){i.transportAdapter.marketAdapterId=e.id,i.searchMarketAdapterActive=!1},i.addProperty=function(){i.transportAdapter.properties||(i.transportAdapter.properties=[]);i.transportAdapter.properties.push({key:"",value:""})},i.removeProperty=function(e){i.transportAdapter.properties.splice(e,1)},i.removeTag=function(e){i.transportAdapter.tags.splice(e,1)},i.addTag=function(){i.transportAdapter.tags||(i.transportAdapter.tags=[]);i.transportAdapter.tags.push("")},i.saveTransportAdapter=function(){if(!i.transportAdapterForm.$valid||!i.transportAdapter.marketAdapterId)return i.formErrorDialog=!0,!1;i.formErrorDialog=!1,i.isSaving=!0,e.createTransportAdapter(i.transportAdapter).then(function(e){i.isSaving=!1,i.editMode=!1,e.data&&e.data.id?n.go("console.transport-adapters.details",{transportAdapterId:e.data.id}):n.go("console.transport-adapters"),o(r("translate")("feedback.messages.ok"))},function(e){i.isSaving=!1,e.data&&e.data.error&&e.data.error.message?s(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):s(r("translate")("feedback.messages.error"))})},a.copiedTransportAdapter&&(i.transportAdapter=a.copiedTransportAdapter,i.transportAdapter.id=null)}angular.module("console.transport-adapters").controller("TransportAdapterCreateController",e),e.$inject=["TransportAdapterService","feedbackService","$stateParams","$state","$filter"]}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.getAvailableTriggers(a).then(function(e){var t=e.data;t.availableTriggers&&t.availableTriggers.forEach(function(e){r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.functionToExecuteOnAdd=a.onSelectTrigger(),r.updateStorageSearchKey=function(){n.sessionStorage.setItem("availableTriggersSearchKey",r.filterListing)},n.sessionStorage.getItem("availableTriggersSearchKey")&&(r.filterListing=n.sessionStorage.getItem("availableTriggersSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("availableTriggersSearchKey")}}angular.module("console.triggers").controller("TriggersAvailableController",e),e.$inject=["TriggersService","UserService","$scope","$window"]}(),function(){angular.module("console.triggers").directive("triggersAvailable",function(){return{scope:{onSelectTrigger:"&onSelectTrigger"},replace:!0,restrict:"AE",controller:"TriggersAvailableController",controllerAs:"vm",templateUrl:"triggers/available-triggers/available-triggers.html"}})}(),function(){function e(e,t,a,n,r,i){var o=this;function s(e,a){t.addMessage({type:a,message:e})}function l(e){s(e,"error")}o.trigger={disabled:!1},o.addProperty=function(){o.trigger.properties||(o.trigger.properties=[]);o.trigger.properties.push({key:"",value:""}),i(function(){var e="propertyKey_"+(o.trigger.properties.length-1).toString(),t=document.getElementById(e);t&&t.focus()},100)},o.removeProperty=function(e){o.trigger.properties.splice(e,1)},o.saveTrigger=function(){if(!o.triggerForm.$valid)return o.formErrorDialog=!0,!1;o.formErrorDialog=!1,o.isSaving=!0,e.createTrigger(o.trigger).then(function(e){o.isSaving=!1,o.editMode=!1,e.data&&e.data.id?n.go("console.triggers.details",{triggerId:e.data.id}):n.go("console.triggers"),s(r("translate")("feedback.messages.ok"))},function(e){o.isSaving=!1,e.data&&e.data.error&&e.data.error.message?l(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):l(r("translate")("feedback.messages.error"))})},a.copiedTrigger&&(o.trigger=a.copiedTrigger,o.trigger.id=null)}angular.module("console.triggers").controller("TriggerCreateController",e),e.$inject=["TriggersService","feedbackService","$stateParams","$state","$filter","$timeout"]}(),function(){function e(e,t,a,n,r,i){var o,s=this;function l(e,a){t.addMessage({type:a,message:e})}function c(e){l(e,"error")}s.toggleEditMode=function(){s.editMode=!s.editMode},s.cancelEditMode=function(){s.trigger=angular.copy(s.originalTrigger),s.editMode=!1,s.formErrorDialog=!1,s.triggerForm.$setPristine()},s.addProperty=function(){s.trigger.properties||(s.trigger.properties=[]);s.trigger.properties.push({key:"",value:""}),i(function(){var e="propertyKey_"+(s.trigger.properties.length-1).toString(),t=document.getElementById(e);t&&t.focus()},100)},s.removeProperty=function(e){s.trigger.properties.splice(e,1)},s.saveTrigger=function(){if(!s.triggerForm.$valid)return s.formErrorDialog=!0,!1;s.formErrorDialog=!1,s.isSaving=!0,e.updateTrigger(s.trigger).then(function(e){s.isSaving=!1,s.editMode=!1,l(r("translate")("feedback.messages.ok"))},function(e){s.isSaving=!1,e.data&&e.data.error&&e.data.error.message?c(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(r("translate")("feedback.messages.error"))})},s.deleteTrigger=function(t){if(!t)return s.confirmDelete=!0,!1;s.isSaving=!0,e.deleteTrigger(s.trigger.id).then(function(e){s.isSaving=!1,s.editMode=!1,s.confirmDelete=!1,n.go("console.triggers"),l(r("translate")("feedback.messages.deleted"))},function(e){s.isSaving=!1,s.confirmDelete=!1,e.data&&e.data.error&&e.data.error.message?c(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(r("translate")("feedback.messages.error"))})},a.trigger?(s.originalTrigger=angular.copy(a.trigger),s.trigger=a.trigger):a.triggerId?(o=a.triggerId,s.isLoading=!0,e.getTriggerDetails(o).then(function(e){s.originalTrigger=angular.copy(e.data),s.trigger=e.data,s.isLoading=!1},function(e){s.isLoading=!1,s.errorDialog=!0})):n.go("console.triggers")}angular.module("console.triggers").controller("TriggerDetailsController",e),e.$inject=["TriggersService","feedbackService","$stateParams","$state","$filter","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;if(i.activeTab){var c=parseInt(i.activeTab);l.tab=c||0}else l.tab=0;var u=e.getTimezones();function d(e){l.isLoading=!0,t.getUserSettings(e).then(function(e){var t;l.isLoading=!1,l.userSettings=e,l.userSettings.defaultChunkSize||(l.userSettings.defaultChunkSize=20),l.userSettings.defaultDateTime||(l.userSettings.defaultDateTime={date:"MMM DD, YYYY",time:"h:mm:ss a"}),l.userSettings.language||(l.userSettings.language="en"),l.userSettings.commentCountTasks||(l.userSettings.commentCountTasks=5),l.userSettings.groupedTasksCount||(l.userSettings.groupedTasksCount=5),l.userSettings.paginationCountTasks||(l.userSettings.paginationCountTasks=10),l.userSettings.favoriteTaskFlow&&function(e){l.isLoadingTaskFlow=!0;var t={id:e,includeTasks:!0};a.getTaskFlow(t).then(function(e){l.taskFlow=e.data,l.isLoadingTaskFlow=!1},function(e){l.isLoadingTaskFlow=!1})}(l.userSettings.favoriteTaskFlow),l.countries=(t=u.countries,Object.keys(t).forEach(function(e){if(t[e].timezones){var a=[];t[e].timezones.forEach(function(t){var n={timezone:t,selected:!1};l.userSettings.selectedTimezones&&l.userSettings.selectedTimezones[e]&&l.userSettings.selectedTimezones[e].length>0&&l.userSettings.selectedTimezones[e].forEach(function(e){e.timezone===t&&(n.selected=!0)}),a.push(n)}),t[e].selectableTimezones=a,p(e)}}),u.countries),f(),m()},function(e){l.isLoading=!1,l.errorDialog=!0})}function f(){var e=l.userSettings.defaultDateTime.date+" "+l.userSettings.defaultDateTime.time;l.currentDateTime=moment(),l.exampleDateTime=moment().format(e)}function m(){l.accordionTags={},l.userSettings.defaultDateRangeTimeseries&&(l.accordionTags.defaultDateRangeTimeseries=[{count:l.userSettings.defaultDateRangeTimeseries.backward.amount,name:o("translate")("timeSpanOptions."+l.userSettings.defaultDateRangeTimeseries.backward.timespan)+" "+o("translate")("user.settings.defaults.timeSeriesDateRange.labelBackward"),status:"primary"},{count:l.userSettings.defaultDateRangeTimeseries.forward.amount,name:o("translate")("timeSpanOptions."+l.userSettings.defaultDateRangeTimeseries.forward.timespan)+" "+o("translate")("user.settings.defaults.timeSeriesDateRange.labelForward"),status:"primary"}]),l.userSettings.defaultDateTime&&(l.accordionTags.defaultDateTime=[{name:o("translate")("generic.example")+": "+l.exampleDateTime,status:"primary"}]),l.userSettings.defaultChunkSize&&(l.accordionTags.defaultChunkSize=[{count:l.userSettings.defaultChunkSize,name:o("translate")("generic.results"),status:"primary"}]),l.userSettings.language&&(l.accordionTags.defaultLanguage=[{name:o("translate")("generic.betaFeature"),status:"secondary"},{name:o("translate")("generic.language")+": "+o("translate")("language."+l.userSettings.language),status:"primary"}]),l.userSettings.beta?l.accordionTags.defaultBeta=[{name:o("translate")("generic.enabled"),status:"primary"}]:l.accordionTags.defaultBeta=[{name:o("translate")("generic.disabled"),status:"secondary"}],l.accordionTags.commentCountTasks=[{count:l.userSettings.commentCountTasks,name:o("translate")("tasks.comments"),status:"primary"}],l.accordionTags.groupedTasksCount=[{count:l.userSettings.groupedTasksCount,name:o("translate")("tasks.taskItemsCount"),status:"primary"}],l.accordionTags.paginationCountTasks=[{count:l.userSettings.paginationCountTasks,name:o("translate")("tasks.tasks"),status:"primary"}]}function g(){l.userSettings.selectedTimezones={},Object.keys(l.countries).forEach(function(e){l.countries[e].selectableTimezones&&l.countries[e].selectableTimezones.forEach(function(t){var a,n;t.selected&&(l.userSettings.selectedTimezones[e]=(a=l.countries[e].selectableTimezones,n=[],a.forEach(function(e){e.selected&&n.push(e)}),n))}),p(e)})}function p(e){l.timezoneCount[e]=[],l.userSettings.selectedTimezones&&l.userSettings.selectedTimezones[e]&&(l.timezoneCount[e]=[{count:l.userSettings.selectedTimezones[e].length,name:o("translate")("generic.selected"),status:"primary"}])}function h(e,t){r.addMessage({type:t,message:e})}function v(e){h(e,"error")}l.timeSpanList=n.getTimeSpan(),l.availableLanguages=n.getAvailableLanguages(),l.timeSpanList.push("disabled"),l.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],l.commentCountList=[5,10,15,20,25,30],l.paginationCountList=l.commentCountList,l.groupedCountList=l.commentCountList,l.userSettings={},l.timezoneCount={},l.userSettings.beta=!1,l.setTab=function(e){l.tab=e},l.tabIsSet=function(e){return l.tab===e},l.saveUserSettings=function(e,a){if(!a.$valid)return;var n={properties:[{key:"usersettings",value:e=JSON.stringify(e)}]};l.isSaving=!0,t.updateUserProperties(n).then(function(){l.isSaving=!1,d(!0),m(),l.userSettings.language&&s.use(l.userSettings.language),h(o("translate")("feedback.messages.ok"))},function(e){l.isSaving=!1,e.data&&e.data.error&&e.data.error.message?v(o("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):v(o("translate")("feedback.messages.error"))})},l.checkTimespan=function(e){"disabled"===e.timespan&&(e.amount=null)},l.updateExampleDateTime=f,l.updateSelectedTimezones=g,l.resetTimezoneFilter=function(){l.filterListingTimezones=""},l.toggleSelectAllTimezones=function(e,t){e&&(e.forEach(function(e){e.selected=!1,t&&(e.selected=!0)}),g())},l.selectTaskFlow=function(e){l.userSettings.favoriteTaskFlow=e.id,l.taskFlow=e,l.searchTaskFlowsActive=!1},d()}angular.module("console.user").controller("UserSettingsController",e),e.$inject=["TimezonesService","UserService","TasksService","ConstantsService","feedbackService","$stateParams","$filter","$translate"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c,u=this;function d(t){u.billingAccountCurrency=e.getCurrency(t)}function f(e,t){n.addMessage({type:t,message:e})}function m(e){f(e,"error")}u.validationPatternEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,u.validationPatternNumberDigits=/^[0-9]+(.[0-9]{0,2})?$/,u.validationPatternNumber=/^(0|[1-9]\d*)(\.\d+)?$/,u.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",u.countryList=e.getCountries(),u.currencyList=e.getCurrencies(),u.supportLevels=e.getSupportLevels(),u.paymentMethods=e.getPaymentMethods(),u.getCurrencyInfo=d,u.updateBillingAccount=function(e,a){if(!u.billingAccountForm.$valid)return u.isSaving=!1,m(o("translate")("feedback.messages.requiredInputs")),!1;"ready_for_review"!==e||a?(u.isSaving=!0,t.updateBillingAccount(u.billingAccount).then(function(t){u.isSaving=!1,u.confirmApproval=!1,"ready_for_review"===e?(f(o("translate")("feedback.messages.accountApproved")),u.billingAccount.status="reviewed"):f(o("translate")("feedback.messages.ok")),i.reload()},function(e){u.confirmApproval=!1,u.isSaving=!1,m(o("translate")("feedback.messages.error"))})):u.confirmApproval=!0},u.resetCommercialElements=function(){u.billingAccount.commercialElements={tierRate:u.billingPriceDefaults.tierRate,currency:"USD",quotas:{cumulativeStoragePoints:u.billingPriceDefaults.maxStoragePoints,concurrentFlows:u.billingPriceDefaults.maxConcurrentFlows,concurrentRequests:u.billingPriceDefaults.maxConcurrentRequests,priorityFeatures:u.billingPriceDefaults.priorityFeatures,cumulativeStoragePointsFactor:u.billingPriceDefaults.maxStoragePointsFactor}}},u.toggleTierLevels=function(){u.tierLevelsVisible=!u.tierLevelsVisible},u.addBillingProperty=function(){u.billingAccount.properties||(u.billingAccount.properties=[]);u.billingAccount.properties.push({key:"",value:"",new:!0})},u.deleteBillingProperty=function(e){u.billingAccount.properties.splice(e,1)},r.billingAccountId?(c=r.billingAccountId,u.isLoading=!0,t.getBillingAccount(c).then(function(e){u.billingAccount=e.data,u.billingAccount.supportLevel||(u.billingAccount.supportLevel="best_effort"),t.getBillingDefaults().then(function(e){u.billingPriceDefaults=e.data,u.billingAccount.commercialElements?u.billingAccount.commercialElements.currency&&d(u.billingAccount.commercialElements.currency):(u.billingAccount.commercialElements={tierRate:u.billingPriceDefaults.tierRate,currency:"USD",quotas:{cumulativeStoragePoints:u.billingPriceDefaults.maxStoragePoints,concurrentFlows:u.billingPriceDefaults.maxConcurrentFlows,concurrentRequests:u.billingPriceDefaults.maxConcurrentRequests,priorityFeatures:u.billingPriceDefaults.priorityFeatures,cumulativeStoragePointsFactor:u.billingPriceDefaults.maxStoragePointsFactor}},d(u.billingAccount.commercialElements.currency)),u.isLoading=!1},function(e){u.isLoading=!1})},function(e){u.isLoading=!1,e&&404===e.status?u.nothingFoundDialog=!0:u.errorDialog=!0})):i.go("^"),a.getUserSettings().then(function(e){u.userSettings=e,u.userSettings.defaultDateTime&&(u.userDateTimeFormat=u.userSettings.defaultDateTime.date+" "+u.userSettings.defaultDateTime.time)},function(e){}),angular.element(s).bind("keydown",function(e){27===e.keyCode&&u.tierLevelsVisible&&(e.preventDefault(),u.tierLevelsVisible=!1,l.$evalAsync())}),l.$on("$destroy",function(){angular.element(s).unbind("keydown")})}angular.module("console.admin").controller("AdminBillingAccountController",e),e.$inject=["ConstantsService","BillingAdminService","UserService","feedbackService","$stateParams","$state","$filter","$window","$scope"]}(),function(){function e(e){var t,a,n,r=this;function i(e,t){if(r.sourceChannelForm.$submitted){var a=[],n=[];if(e.forEach(function(e){e.selected&&a.push(e)}),0===a.length?r.noDatasourceSelected=!0:r.noDatasourceSelected=!1,t.forEach(function(e){e.selected&&n.push(e)}),0===n.length?r.noChannelSelected=!0:r.noChannelSelected=!1,!r.noDatasourceSelected&&!r.noChannelSelected)return!0}}r.datasources=e.datasources,r.multipleDatasources=!1,r.functionToExecuteOnUpdate=e.onTriggerUpdated(),r.datasources&&r.datasources.length>1?r.multipleDatasources=!0:r.datasources&&1===r.datasources.length&&(r.datasources[0].selected=!0),t=r.datasources,a={},n=[],t&&(t.forEach(function(e){a[e.id]=[],e.channels&&e.channels.length>0&&e.channels.forEach(function(t){t.isSource&&(n.push(t),a[e.id].push(t))})}),r.sourceChannels=function(e,t){for(var a=[],n=[],r=void 0,i=0;i<e.length;i++)r=e[i][t],-1===n.indexOf(r)&&(a.push(e[i]),n.push(r));return a}(n,"id")),r.toggleSelection=function(e,t){e.forEach(function(e){t&&!e.loadedInChart?e.selected=!0:e.loadedInChart||(e.selected=!1)})},r.updateChart=function(e,t){r.noDatasourceSelected=!1,r.noChannelSelected=!1;var a=[],n=[];e.forEach(function(e){e.selected&&a.push(e)}),t.forEach(function(e){e.selected&&n.push(e)}),i(e,t)&&(r.channelsToLoad={selectedDatasources:a,selectedSourceChannels:n},r.functionToExecuteOnUpdate(r.channelsToLoad))},r.checkUserInput=i}angular.module("console.datasources").controller("DatasourceSourceChannelSelectorController",e),e.$inject=["$scope"]}(),function(){function e(){return{scope:{datasources:"=",onTriggerUpdated:"&onTriggerUpdated"},restrict:"AE",controller:"DatasourceSourceChannelSelectorController",controllerAs:"vm",templateUrl:"datasources/view/source-channel-selector/source-channel-selector.html"}}angular.module("console.datasources").directive("datasourceSourceChannelSelector",e),e.$inject=[]}(),function(){function e(e,t,a,n,r,i,o,s,l,c,u,d,f,m,g){var p=this;if(p.flowConfigLoading=!1,p.savingFlowConfiguration=!1,p.deletingFlowConfiguration=!1,p.newFlowConfiguration=!1,p.newChannelClassifier={},p.availableDatapointTypes=["interval","gauge","register"],p.validationPattern="^[a-zA-Z0-9-_]+$",p.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",p.collapseFlowDetails=!0,p.availableUnitTypes=function(e){for(var t=0;t<p.classifierTypes.length;t++)if(p.classifierTypes[t].datasourceType===e)return p.classifierTypes[t].unitTypes},p.createChannelClassifier=function(){if(p.isCreatingChannelClassifier=!0,p.hasDuplicateName=!1,!p.createChannelClassifierForm.$valid)return p.isCreatingChannelClassifier=!1,!1;p.availableChannelClassifiers?p.availableChannelClassifiers.forEach(function(e){e.name===p.newChannelClassifier.name&&(p.hasDuplicateName=!0)}):p.availableChannelClassifiers=[];if(p.hasDuplicateName)return p.isCreatingChannelClassifier=!1,!1;r.createChannelClassifier(p.newChannelClassifier).then(function(){p.isCreatingChannelClassifier=!1,p.createChannelClassifierSheetOpen=!1,p.availableChannelClassifiers.push(p.newChannelClassifier),p.flowConfig.destinationChannelClassifier=p.newChannelClassifier.name,A(s("translate")("feedback.messages.created"))},function(e){p.isCreatingChannelClassifier=!1,b(s("translate")("feedback.messages.error"))})},p.getAllChannelClassifiers=function(){(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!p.availableChannelClassifiers&&!p.loadingChannelClassifiers)&&y();return p.availableChannelClassifiers},p.toggleSequences=function(e,t){t.forEach(function(t){t.collapsed=!!e})},p.selectedChannelClassifier=function(e){p.searchChannelClassifierActive=!1,p.selectedSequenceForDestination.destinationColumn=e.name},p.selectedSourceChannelClassifier=function(e){p.searchSourceChannelClassifierActive=!1,p.selectedSequenceForSource.sourceColumn=e.name},p.toggleSearchChannelClassifier=function(e){e?(p.searchChannelClassifierActive=!0,p.selectedSequenceForDestination=e):(p.searchChannelClassifierActive=!1,p.selectedSequenceForDestination=null)},p.toggleSearchSourceChannelClassifier=function(e){e?(p.searchSourceChannelClassifierActive=!0,p.selectedSequenceForSource=e):(p.searchSourceChannelClassifierActive=!1,p.selectedSequenceForSource=null)},p.getRulesFromPreviousSequences=w,p.toggleSearchDecisionTree=function(){p.searchDecisionTreeActive=!p.searchDecisionTreeActive},p.selectedDecisionTree=function(e){p.flowConfig.decisionTreeId=e.id,p.decisionTreeName=e.name,p.searchDecisionTreeActive=!1},p.saveFlowConfiguration=v,p.getSourceColumns=function(e){var t=function(e){for(var t=[{sequence:-1,columns:[p.flowConfig.sequenceConfigs[0].sourceColumn]}],a=function(){var e=[];if(p.flowConfig.sequenceConfigs[n]&&p.flowConfig.sequenceConfigs[n].destinationColumn){p.flowConfig.sequenceConfigs[n].ruleConfigs&&p.flowConfig.sequenceConfigs[n].ruleConfigs.length>0&&p.flowConfig.sequenceConfigs[n].ruleConfigs.forEach(function(t){"store"===t.function&&t.params&&t.params.length>0&&t.params.forEach(function(t){"classifier"===t.key&&t.value&&e.push(t.value)})});var a=null;(a=p.flowConfig.sequenceConfigs[n].destinationColumn&&p.flowConfig.sequenceConfigs[n].destinationColumn.name?p.flowConfig.sequenceConfigs[n].destinationColumn.name:p.flowConfig.sequenceConfigs[n].destinationColumn)&&-1===e.indexOf(a)&&e.push(a)}e.length>0&&t.push({sequence:n,columns:e})},n=0;n<e;n++)a();return t}(e),a=[];return t.forEach(function(e){e.columns.forEach(function(e){-1===a.indexOf(e)&&a.push(e)})}),a},p.deleteFlowConfiguration=function(){p.deletingFlowConfiguration=!0,p.showDeleteConfirm=!1;var e=p.flowConfig.id;t.deleteFlowConfig(e).then(function(){p.deletingFlowConfiguration=!1,A(s("translate")("feedback.messages.ok")),l.go("console.flow-design")},function(){p.deletingFlowConfiguration=!1,b(s("translate")("feedback.messages.error"))})},p.selectSequence=function(e){p.selectedSequence=e},p.addSequence=function(){p.flowConfig.sequenceConfigs||(p.flowConfig.sequenceConfigs=[]);p.flowConfig.sequenceConfigs.push({name:"Sequence",ruleConfigs:[]}),p.selectedSequence=p.flowConfig.sequenceConfigs.length},p.deleteSequence=function(e){if(!p.flowConfig.sequenceConfigs)return;p.flowConfig.sequenceConfigs.splice(e,1),T()},p.selectRule=function(e){p.ruleSelected=e},p.toggleConfigSheet=function(e){var t=p.selectedSequence;p.configSheetOpen?C():S(e,t)},p.openConfigSheet=S,p.addRuleToSequence=function(e){var t=angular.copy(e),a=!1;t.params&&t.params.forEach(function(e){"alert_threshold"===e.name&&(e.value="0",a=e.minDefaultValue&&e.maxDefaultValue?{warning_threshold:e.minDefaultValue,error_threshold:e.maxDefaultValue,errorThresholdAbortFlag:!1}:{warning_threshold:"0",error_threshold:"0",errorThresholdAbortFlag:!1}),e.name&&!e.key&&(e.key=e.name,delete e.name),e.value||(e.value=e.defaultValue)});var n={displayName:t.displayName,description:t.description,function:t.name,type:t.ruleType,params:t.params};a&&(n.warningThreshold=a.warning_threshold,n.errorThreshold=a.error_threshold,n.errorThresholdAbortFlag=a.errorThresholdAbortFlag);var r=p.selectedSequence-1,i=p.flowConfig.sequenceConfigs[r];i.collapsed=!1,i.ruleConfigs||(i.ruleConfigs=[]);i.ruleConfigs.push(n)},p.removeRuleFromSequence=function(e,t){var a=p.flowConfig.sequenceConfigs[e].ruleConfigs.indexOf(t);a>-1&&p.flowConfig.sequenceConfigs[e].ruleConfigs.splice(a,1);T()},p.toggleCreateChannelClassifierSheet=function(){p.createChannelClassifierSheetOpen=!p.createChannelClassifierSheetOpen,p.createChannelClassifierForm.$setPristine(!0)},p.closeConfigSheet=C,p.closeConfigureTaskModal=k,p.openConfigureTask=function(){p.originalFlowConfig=angular.copy(p.flowConfig),p.showConfigureTask=!0,p.priorities=e.getPriorities(),p.subjects=e.getTaskSubjects(),p.newSubjectValue=p.subjects[0],p.types=[],p.statuses=[],p.validTask=!0,function e(t){p.isLoadingTypes=!0;var a={limit:100};t&&(a.pageToken=t),f.getTypes(a).then(function(t){var a=t.data;a.taskTypes&&a.taskTypes.length>0&&a.taskTypes.forEach(function(e){var t={type:e.type};p.types.push(t)}),a.pageToken?e(a.pageToken):p.isLoadingTypes=!1,0===p.types.length&&(p.setupNeeded=!0)},function(e){p.isLoadingTypes=!1,p.errorDialogTypes=!0})}(),function e(t){p.isLoadingstatuses=!0;var a={limit:100};t&&(a.pageToken=t),f.getStatuses(a).then(function(t){var a=t.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){var t={status:e.status};p.statuses.push(t)}),a.pageToken?e(a.pageToken):p.isLoadingstatuses=!1,0===p.statuses.length&&(p.setupNeeded=!0)},function(e){p.isLoadingstatuses=!1,p.errorDialogstatuses=!0})}(),p.flowConfig.taskCreate||(p.flowConfig.taskCreate={});p.flowConfig.taskCreate.priority||(p.flowConfig.taskCreate.priority=p.priorities[0]);p.flowConfig.taskCreate.title&&p.flowConfig.taskCreate.type&&p.flowConfig.taskCreate.status||(p.validTask=!1);p.flowConfig.taskCreate.flowIds&&p.flowConfig.taskCreate.flowIds.length>0&&(t=p.flowConfig.taskCreate.flowIds,a=[],p.enrichedTaskFlows={},p.isLoadingTaskFlows=!0,t.forEach(function(e){a.push(f.getTaskFlow({id:e,includeTasks:!1}))}),m.all(a).then(function(e){for(var t=0;t<e.length;t++)e[t]&&e[t].data&&e[t].data.id&&(p.enrichedTaskFlows[e[t].data.id]=e[t].data);p.isLoadingTaskFlows=!1},function(e){p.isLoadingTaskFlows=!1}));var t,a;var n=e.getTaskAggregationOptions();p.taskAggregationOptions=[],n.forEach(function(e){p.taskAggregationOptions.push({option:e,checked:!1})}),p.flowConfig.taskCreate.aggregationConfiguration&&p.flowConfig.taskCreate.aggregationConfiguration.length>0&&p.flowConfig.taskCreate.aggregationConfiguration.forEach(function(e){p.taskAggregationOptions.forEach(function(t){e===t.option&&(t.checked=!0)})})},p.selectTaskFlow=function(e){p.flowConfig.taskCreate.flowIds||(p.flowConfig.taskCreate.flowIds=[]);var t=void 0;p.flowConfig.taskCreate.flowIds.forEach(function(a){e.id===a&&(t=!0)}),t||(p.flowConfig.taskCreate.flowIds.push(e.id),p.enrichedTaskFlows||(p.enrichedTaskFlows={}),p.enrichedTaskFlows[e.id]=e);p.searchTaskFlowsActive=!1},p.toggleSearchTaskFlows=function(){p.searchTaskFlowsActive=!p.searchTaskFlowsActive},p.unLinkTaskFlow=function(e){p.flowConfig.taskCreate.flowIds.splice(e,1)},p.toggleSearchUsers=function(){p.searchUsersActive=!p.searchUsersActive},p.selectedUser=function(e){p.flowConfig.taskCreate.assignee=e.email,p.searchUsersActive=!1},p.applyConfiguredTask=function(){if(!p.configureTaskForm.$valid)return!1;k()},p.removeTask=function(){p.flowConfig.taskCreate=null,v(),k()},p.addSubject=function(){p.flowConfig.taskCreate.subjects||(p.flowConfig.taskCreate.subjects=[]);var e={deleted:!1,readOnly:!1,value:p.newSubjectValue,key:p.newSubjectKey};p.flowConfig.taskCreate.subjects.push(e),p.newSubjectKey="",p.addSubjectActive=!1},p.deleteSubject=function(e,t){p.flowConfig.taskCreate.subjects.splice(t,1)},p.toggleSearchDatasources=function(){p.searchDatasourcesActive=!p.searchDatasourcesActive},p.selectedDatasource=function(e){p.newSubjectKey=e.id,p.searchDatasourcesActive=!1},p.toggleSearchFlowDesigns=function(){p.searchFlowDesignsActive=!p.searchFlowDesignsActive},p.selectedFlowDesign=function(e){p.newSubjectKey=e.id,p.searchFlowDesignsActive=!1},p.addTag=function(){p.flowConfig.taskCreate.tags||(p.flowConfig.taskCreate.tags=[]);p.newTagInput?(p.flowConfig.taskCreate.tags.push(p.newTagInput),p.newTagInput="",p.addTagInvalid=!1):p.addTagInvalid=!0},p.removeTag=function(e){p.flowConfig.taskCreate.tags.splice(e,1)},p.focusSwitch=function(e){p.newTagFocussed=e},y(),p.loadingClassifierTypes=!0,n.getDatasourceAndUnitTypes().then(function(e){p.loadingClassifierTypes=!1;var t=e.data.items;if(t){var a=[];t.forEach(function(e){a.push(e.datasourceType)}),p.availableDatasourceTypes=a}p.classifierTypes=t},function(e){p.loadingClassifierTypes=!1}),d.getUserSettings().then(function(e){p.userSettings=e,p.userSettings.defaultDateTime&&(p.userDateTimeFormat=p.userSettings.defaultDateTime.date+" "+p.userSettings.defaultDateTime.time)},function(e){}),i.configId)!function(e){p.flowConfigLoading=!0,t.getFlowConfig(e).then(function(e){p.flowConfig=e.data,p.flowConfig.flowType||(p.flowConfig.flowType="scenario"),p.flowConfig.destinationChannelClassifier||(p.flowConfig.destinationChannelClassifier="MERGED"),p.flowConfigLoading=!1,angular.element(document).ready(function(){p.flowConfig.name&&(document.title=p.flowConfig.name+" · Flow Design · Console")}),p.flowConfig.decisionTreeId&&(p.decisionTreeName=null,g.getDecisionTree(p.flowConfig.decisionTreeId).then(function(e){e.data&&e.data.name&&(p.decisionTreeName=e.data.name)},function(e){}))},function(e){p.flowConfigLoading=!1,b(s("translate")("feedback.messages.errorNotFound")),l.go("console.flow-design")})}(i.configId);else if(p.newFlowConfiguration=!0,p.collapseFlowDetails=!1,i.copiedFlowConfig){var h=i.copiedFlowConfig;p.flowConfig={deleted:!1,enabled:!0,flowType:h.flowType,name:h.name,description:h.description,destinationChannelClassifier:h.destinationChannelClassifier,decisionTreeID:h.decisionTreeID,sequenceConfigs:h.sequenceConfigs}}else p.flowConfig={deleted:!1,enabled:!0,flowType:"scenario",sequenceConfigs:[{name:"Sequence",ruleConfigs:[]}]};function v(){if(!p.flowConfigForm.$valid)return p.collapseFlowDetails=!1,!1;p.savingFlowConfiguration=!0,p.configSheetOpen&&C();var e=!0;if(p.flowConfig.sequenceConfigs.forEach(function(t){t.ruleConfigs&&t.ruleConfigs.forEach(function(e){var t=!1;if(e.params){var a=[];e.params.forEach(function(e,n){"alert_threshold"===e.name&&(t={warning_threshold:e.warning_threshold,error_threshold:e.error_threshold,errorThresholdAbortFlag:e.errorThresholdAbortFlag},delete e.warning_threshold,delete e.error_threshold,delete e.errorThresholdAbortFlag);var r=angular.isNumber(e.value);for(var i in r&&(e.value=e.value.toString()),e)e.hasOwnProperty(i)&&e[i]&&"number"==typeof e[i]&&(e[i]=e[i]+"");(e.optional&&!e.value&&!e.values||e.optional&&e.disabled)&&a.push(n),e.valueType&&"list"===e.valueType&&!e.values&&e.value&&(e.values=e.value,delete e.value)}),a.sort(function(e,t){return t-e}),a.forEach(function(t){e.params.splice(t,1)})}t&&(t.warning_threshold&&(e.warningThreshold=t.warning_threshold.toString()),t.error_threshold&&(e.errorThreshold=t.error_threshold.toString()),e.errorThresholdAbortFlag=t.errorThresholdAbortFlag)}),t.sourceColumn&&t.destinationColumn||(e=!1),p.flowConfig.destinationChannelClassifier=t.destinationColumn}),!e)return b("Configuration is incomplete, please fill in the required fields"),void(p.savingFlowConfiguration=!1);p.newFlowConfiguration?t.createFlowConfig(p.flowConfig).then(function(e){p.savingFlowConfiguration=!1,A(s("translate")("feedback.messages.ok")),l.go("console.flow-design.details",{configId:e.data.id})},function(e){p.savingFlowConfiguration=!1,b(s("translate")("feedback.messages.error"))}):t.updateFlowConfig(p.flowConfig).then(function(){p.savingFlowConfiguration=!1,A(s("translate")("feedback.messages.ok"))},function(e){p.savingFlowConfiguration=!1,b(e.data.error.code+": "+e.data.error.message)})}function S(e,t){if(!p.configSheetOpen||e!==p.selectedRuleConfig){p.configSheetOpen&&C(),e.ruleSelected=!0,p.configSheetOpen=!0,p.selectedRuleConfigLoading=!0,p.selectedRuleConfig=e;var n={name:p.selectedRuleConfig.function,ruleType:p.selectedRuleConfig.type};w(t,p.selectedRuleConfig),a.getRule(n).then(function(t){var a=void 0;if(t.data&&(p.selectedRuleConfig.description=t.data.description,t.data.params)){a=t.data.params;var n=[];a.forEach(function(t){p.selectedRuleConfig.params&&p.selectedRuleConfig.params.length>0?p.selectedRuleConfig.params.forEach(function(a){if("alert_threshold"===a.key&&(a.warning_threshold>0?e.warningThreshold=a.warning_threshold:e.warningThreshold&&(a.warning_threshold=e.warningThreshold),a.error_threshold>0?e.errorThreshold=a.error_threshold:e.errorThreshold&&(a.error_threshold=e.errorThreshold),angular.isDefined(a.errorThresholdAbortFlag)?e.errorThresholdAbortFlag=a.errorThresholdAbortFlag:angular.isDefined(e.errorThresholdAbortFlag)?a.errorThresholdAbortFlag=e.errorThresholdAbortFlag:a.errorThresholdAbortFlag=!1),t.displayName===a.displayName)for(var r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);t.optional&&n.push(t)}):t.optional&&n.push(t)}),(n=_.uniq(n)).forEach(function(e){_.findWhere(p.selectedRuleConfig.params,{name:e.name})||("Text"!==e.widgetType&&"DatePicker"!==e.widgetType&&(e.disabled=!0),e.key=e.name,p.selectedRuleConfig.params||(p.selectedRuleConfig.params=[]),p.selectedRuleConfig.params.push(e))})}p.selectedRuleConfig.params&&p.selectedRuleConfig.params.length>0&&(p.selectedRuleConfig.params.forEach(function(e){e.valueType&&"list"===e.valueType&&(e.value=[],e.value=e.values)}),p.selectedRuleConfig.params=function(e,t){if(p.selectedRuleConfig.outDated=!1,e.length===t.length){var a=e.map(function(e){return e.key}).sort().toString(),n=t.map(function(e){return e.name}).sort().toString();if(a===n){var r=[];return t.forEach(function(t){e.forEach(function(e){e.key===t.name&&(e.widgetType!==t.widgetType&&(p.selectedRuleConfig.outDated=!0),e.displayName=t.displayName,e.description=t.description,e.optional=t.optional,e.valueType=t.valueType,e.resourceType&&t.resourceType&&(e.resourceType=t.resourceType),r.push(e))})}),r}return p.selectedRuleConfig.outDated=!0,e}return p.selectedRuleConfig.outDated=!0,e}(p.selectedRuleConfig.params,a)),p.selectedRuleConfigLoading=!1},function(e){p.getRuleFailed=!0,p.selectedRuleConfigLoading=!1})}}function w(e,t){p.enableFilterRules=!1,p.showEnableFilterRules=!0;var a=[],n=[];p.flowConfig.sequenceConfigs.forEach(function(t,r){e>r&&t.ruleConfigs.forEach(function(e){a.push({function:e.function+":"+r}),n.push(e.function+":"+r)})}),a.forEach(function(e){t.filterWhitelist&&t.filterWhitelist.length>0&&t.filterWhitelist.indexOf(e.function)>-1&&(e.whitelist=!0,p.enableFilterRules=!0),t.filterBlacklist&&t.filterBlacklist.length>0&&t.filterBlacklist.indexOf(e.function)>-1&&(e.blacklist=!0,p.enableFilterRules=!0)});var r=[],i=[];if(t.filterWhitelist){t.filterWhitelist.forEach(function(e,a){n.indexOf(e)<0&&(r.push(e),delete t.filterWhitelist[a])});var o=t.filterWhitelist.filter(function(e){return null!==e});t.filterWhitelist=o}if(t.filterBlacklist){t.filterBlacklist.forEach(function(e,a){n.indexOf(e)<0&&(i.push(e),delete t.filterBlacklist[a])});var s=t.filterBlacklist.filter(function(e){return null!==e});t.filterBlacklist=s}(r.length>0||i>0)&&(p.warningModal||(p.warningModal=[]),p.warningModal[e]={sequenceIndex:e,sequenceName:p.flowConfig.sequenceConfigs[e].name,rule:t,deletedWhitelist:r,deletedBlacklist:i}),p.warningModal&&p.warningModal.length>0&&(p.warningModal=p.warningModal.filter(function(e){return null!==e})),p.selectableFilterRules=a,0===e&&(p.enableFilterRules=!1,p.showEnableFilterRules=!1,t.filterWhitelist=[],t.filterBlacklist=[],p.selectableFilterRules.forEach(function(e){e.whitelist=!1,e.blacklist=!1}))}function T(){p.flowConfig.sequenceConfigs.forEach(function(e,t){e.ruleConfigs&&e.ruleConfigs.length>0&&e.ruleConfigs.forEach(function(e){w(t,e)})});var e=_.groupBy(p.warningModal,function(e){return e.sequenceIndex});p.warnings=e}function C(){p.ruleSelected=!1,p.configSheetOpen=!1,p.selectedRuleConfig.ruleSelected=!1,p.selectedRuleConfig={},p.flowConfig.sequenceConfigs.forEach(function(e){e.ruleConfigs&&e.ruleConfigs.forEach(function(e){if(e.params){var t=void 0;e.params.forEach(function(a){!a.optional||a.value||a.values||(t=!0,a.remove=!0),a.valueType&&"list"===a.valueType&&a.value&&(a.values=a.value,delete a.value),"alert_threshold"===a.key&&(e.warningThreshold=a.warning_threshold,e.errorThreshold=a.error_threshold,e.errorThresholdAbortFlag=a.errorThresholdAbortFlag)}),t&&(e.params=e.params.filter(function(e){return!e.remove}))}})})}function y(e,t){p.loadingChannelClassifiers=!0;var a={limit:100};t||(p.availableChannelClassifiers=[]),e&&(a.pageToken=e),n.getChannelClassifiers(a).then(function(e){e.data.items&&e.data.items.forEach(function(e){p.availableChannelClassifiers.push(e)});e.data.nextPageToken?y(e.data.nextPageToken,!0):p.loadingChannelClassifiers=!1},function(e){p.loadingChannelClassifiers=!1})}function k(e){e&&p.showConfigureTask?p.flowConfig=angular.copy(p.originalFlowConfig):p.flowConfig.taskCreate&&function(){if(p.flowConfig.taskCreate){var e=[];p.taskAggregationOptions.forEach(function(t){t.checked&&e.push(t.option)}),p.flowConfig.taskCreate.aggregationConfiguration=e}v()}(),p.showConfigureTask=!1}function A(e,t){o.addMessage({type:t,message:e})}function b(e){A(e,"error")}p.selectedSequence=1,p.ruleSelected=0,p.dndMoveItem=function(e,t){p.warningModal=[],e.splice(t,1),T()},p.createCopy=function(){p.backupFlowConfig=angular.copy(p.flowConfig)},p.toggleWarningModal=function(e){e||(p.flowConfig=angular.copy(p.backupFlowConfig)),p.warningModal=[],p.warnings=[],p.backupFlowConfig=null},p.enableFilterRulesChange=function(e){e||(p.selectedRuleConfig.filterWhitelist=[],p.selectedRuleConfig.filterBlacklist=[],p.selectableFilterRules.forEach(function(e){e.whitelist=!1,e.blacklist=!1}))},p.filterRuleChange=function(e,t){"whitelist"===t&&e.whitelist?e.blacklist=!1:e.blacklist&&(e.whitelist=!1);var a=[],n=[];p.selectableFilterRules.forEach(function(e){e.whitelist?a.push(e.function):e.blacklist&&n.push(e.function)}),p.selectedRuleConfig.filterWhitelist=a,p.selectedRuleConfig.filterBlacklist=n},u.$watch("vm.configSheetOpen",function(){p.configSheetOpen&&angular.element(c).bind("keydown",function(e){27===e.keyCode&&(e.preventDefault(),u.$apply(function(){p.ruleSelected=!1,p.configSheetOpen=!1,p.selectedRuleConfig.ruleSelected=!1,p.selectedRuleConfig={}}))})}),angular.element(c).bind("keydown",function(e){27===e.keyCode&&(e.preventDefault(),p.createChannelClassifierSheetOpen=!1,p.configSheetOpen=!1,p.showConfigureTask&&p.searchUsersActive?p.searchUsersActive=!1:p.showConfigureTask&&p.searchTaskFlowsActive?p.searchTaskFlowsActive=!1:p.showConfigureTask&&k(!0),u.$apply())}),u.$on("$destroy",function(){angular.element(c).unbind("keydown")})}angular.module("console.flow-management").controller("FlowDesignDetailsController",e),e.$inject=["ConstantsService","FlowConfigService","RulesService","DataSourceService","ChannelService","$stateParams","feedbackService","$filter","$state","$window","$scope","UserService","TasksService","$q","DecisionTreeService"]}(),function(){function e(e,t,a,n,r,i,o,s,l,c,u){var d=this;(d.flowConfigLoading=!1,d.limitSelectionCount=20,d.channelOptions=[],d.initiateFlow=!0,d.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",d.clearCollection=f,d.clearCollection(),n.getUserSettings().then(function(e){d.userSettings=e,d.userSettings.defaultDateTime&&(d.userDateTimeFormat=d.userSettings.defaultDateTime.date+" "+d.userSettings.defaultDateTime.time)},function(e){}),r.configId)&&function(t){d.flowConfigLoading=!0,e.getFlowConfig(t).then(function(e){d.flowConfig=e.data,d.flowConfigLoading=!1},function(e){d.flowConfigLoading=!1,g(o("translate")("feedback.messages.errorNotFound")),s.go("console.flow-design")})}(r.configId);function f(){l.localStorage.removeItem("ewxCollectedDatasources"),d.selectedDataSources=[]}function m(e,t){i.addMessage({type:t,message:e})}function g(e){m(e,"error")}d.toggleAllSelected=function(){d.limitSelectionCount>0?d.limitSelectionCount=!1:d.limitSelectionCount=20},d.applyConfigToCollection=function(){var e=[];if(d.selectedDataSources.forEach(function(t){e.push(t.id)}),d.initiateFlow){d.applyIsLoading=!0;var t={datasourceIds:e,persist:!0,flowConfigurationId:d.flowConfig.id,sourceClassifier:d.selectedChannel.id,startDatetime:"1970-01-01T00:00:00.000",endDatetime:"2100-01-01T00:00:00.000"};a.startFlow(t).then(function(){d.applyIsLoading=!1,m(o("translate")("Flow configuration applied to "+d.selectedDataSources.length+" datasource(s) and initiated new flow(s).")),f(),d.toggleSelectionSheet(),s.reload()},function(e){d.applyIsLoading=!1,e.data&&e.data.error&&e.data.error.message?g(o("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):g(o("translate")("feedback.messages.error"))})}},r.searchFilters&&(d.searchFilters=r.searchFilters,d.searchOnLoad=!0),d.searchTermChanged=function(e,t){d.searchFilters=e,0===d.searchFilters.length&&(d.searchFilters=""),d.activeSearch=t,s.transitionTo("console.flow-design.details.start-flow",{configId:d.flowConfig.id,active:d.activeSearch,searchFilters:d.searchFilters},{notify:!1,location:"replace"})}}angular.module("console.flow-management").controller("FlowDesignStartFlowController",e),e.$inject=["FlowConfigService","TagService","FlowService","UserService","$stateParams","feedbackService","$filter","$state","$window","$scope","$q"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;if(c.rule={},c.cmOption={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!1,readOnly:!0,indentUnit:4,mode:"python",theme:"ewx-dark"},o.ruleName&&o.ruleType){c.isLoadingRule=!0;var u={name:o.ruleName,ruleType:o.ruleType};t.getRule(u).then(function(e){c.rule=e.data,c.isLoadingRule=!1,d()},function(e){e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):m(n("translate")("feedback.messages.error")),r.go("^"),c.isLoadingRule=!1})}else c.rule.params=[],c.rule.isPluggable=!0,c.newRuleMode=!0,c.cmOption.readOnly=!1;function d(){c.rule.params&&c.rule.params.length>0&&c.rule.params.forEach(function(e){"AlertThreshold"===e.widgetType?(c.widgetTypeList.forEach(function(e){"AlertThreshold"===e.widgetType&&(e.disabled=!0)}),e.minValue=0,e.maxDefaultValue&&(e.maxDefaultValue=0),e.minDefaultValue&&(e.minDefaultValue=0)):c.widgetTypeList.forEach(function(e){"AlertThreshold"===e.widgetType&&(e.disabled=!1)})})}function f(e,t){a.addMessage({type:t,message:e})}function m(e){f(e,"error")}o.prevStateFlowConfig&&(c.prevStateFlowConfig=o.prevStateFlowConfig),c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",c.valueTypes=["string","int","float","bool","datetime"],c.paramResourceTypes=["Datasource","Flowconfig","Rule","ChannelClassifier"],c.requirementList=["amount_of_previous_datapoints","minimum_period","full_period"],c.widgetTypeList=[{resourceType:"Datasource",placeholder:"",defaultValue:"",widgetType:"ResourceInput",namespaces:[],optional:!0,valueType:"string"},{placeholder:"",defaultValue:"",widgetType:"Text",optional:!0,valueType:"string"},{defaultValue:"false",widgetType:"Bool",optional:!0,valueType:"bool"},{defaultValue:"",widgetType:"Select",optional:!0,options:[],valueType:"string"},{defaultValue:"",widgetType:"MultiSelect",optional:!0,options:[],valueType:"string"},{defaultValue:"",widgetType:"DatePicker",optional:!0,valueType:"datetime"},{defaultValue:4,maxValue:10,minValue:1,widgetType:"IntSlider",step:1,optional:!0,valueType:"int"},{defaultValue:2.5,maxValue:10,minValue:1,widgetType:"FloatSlider",step:.01,optional:!0,valueType:"float"},{displayName:"Warning and error alerting",description:"Warning and error alerting thresholds based on the number of annotations",name:"alert_threshold",widgetType:"AlertThreshold",optional:!1,valueType:"int",step:10,minDefaultValue:0,maxDefaultValue:0,maxValue:500,minValue:0}],c.originalWidgetTypeList=angular.copy(c.widgetTypeList),c.isLoading=!0,c.mutateRule=function(e){if(!c.mutateRuleForm.$valid||c.duplicateName)return c.isSubmitting=!1,c.formErrorDialog=!0,c.formParam&&Object.keys(c.formParam).forEach(function(e,t){c.rule.params[e]&&(c.rule.params[e].open=!0)}),l.scrollTo(0,0),!1;c.formErrorDialog=!1,d(),c.rule.params&&c.rule.params.length>0&&c.rule.params.forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&(angular.isNumber(e[t])&&(e[t]=e[t]+""),"Bool"===e[t]&&(e.defaultValue=e.defaultValue.toString().toLowerCase()))});if("console.flow-rules-management.edit"===r.current.name)e?(c.isSubmitting=!0,c.showConfirmationDialog=!1,t.updateRule(c.rule).then(function(e){c.isSubmitting=!1,c.mutateRuleForm.$setPristine(),f(n("translate")("feedback.messages.ok"))},function(e){c.isSubmitting=!1,e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):m(n("translate")("feedback.messages.error"))})):c.showConfirmationDialog=!0;else{var a={items:[c.rule]};c.isSubmitting=!0,t.createRule(a).then(function(e){i(function(){c.isSubmitting=!1,c.mutateRuleForm.$setPristine(),f(n("translate")("feedback.messages.ok")),r.go("console.flow-rules-management.edit",{ruleName:c.rule.name,ruleType:c.rule.ruleType},{})},200)},function(e){c.isSubmitting=!1,e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):m(n("translate")("feedback.messages.error"))})}},c.addParam=function(e){var t=angular.copy(e);t.open=!0,c.rule.params||(c.rule.params=[]);c.rule.params.push(t),c.newParamType=null,d()},c.deleteParam=function(e){c.rule.params.splice(e,1),d()},c.previewRule=function(){c.previewRuleActive=!0,c.selectedRuleConfig=angular.copy(c.rule),c.selectedRuleConfig.params&&c.selectedRuleConfig.params.length>0&&c.selectedRuleConfig.params.forEach(function(e){e.value||(e.value=e.defaultValue)})},c.addNewOptionSelect=function(e,t){e&&(t.push(e),c.newOptionSelect=null)},c.deleteSelectOption=function(e,t){e.splice(t,1)},c.unlockCodeBlob=function(e){c.codeBlobEditMode?(c.cmOption.readOnly=!0,c.codeBlobEditMode=!1,c.showUnlockCodeBlobDialog=!1):e?(c.showUnlockCodeBlobDialog=!1,c.cmOption.readOnly=!1,c.codeBlobEditMode=!0):(c.showUnlockCodeBlobDialog=!0,c.cmOption.readOnly=!0,c.codeBlobEditMode=!1)},c.cancel=function(){c.prevStateFlowConfig?r.go("console.flow-design.details",{configId:c.prevStateFlowConfig}):r.go("^")},c.refreshCodeMirrorFn=function(){c.refreshCodemirror=!0,i(function(){c.refreshCodemirror=!1})},c.changeParamWidgetType=function(e,t){var a={};c.widgetTypeList.forEach(function(t){t.widgetType===e.widgetType&&(a=angular.copy(t))}),a.name=e.name,a.displayName=e.displayName,a.description=e.description,a.open=!0,c.rule.params[t]=a,d()},c.checkParamName=function(e){c.duplicateName=!1,c.rule.params.forEach(function(e){e.duplicateName=!1});var t=c.rule.params.filter(function(t){return t.name===e.name});t&&t.length>1&&t.forEach(function(e){e.duplicateName=!0,c.duplicateName=!0})},c.addRequirement=function(e){c.rule.requirements||(c.rule.requirements=[]);c.rule.requirements.push(e)},c.removeRequirement=function(e){c.rule.requirements.splice(e,1)},e.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time)},function(e){}),e.getUser().then(function(e){c.availableNamespaces=e.namespaces},function(e){}),c.typesLoading=!0,t.getRuleTypes({limit:100}).then(function(e){c.isLoading=!1,e.data.items?(c.ruleTypeList=e.data.items,c.rule.ruleType||(c.rule.ruleType=c.ruleTypeList[0])):(c.newRuleType=!0,c.noRuleTypesAvailable=!0)},function(e){c.isLoading=!1,m(n("translate")("feedback.messages.error"))}),angular.element(l).bind("keydown",function(e){27===e.keyCode&&c.previewRuleActive&&(e.preventDefault(),c.previewRuleActive=!1,c.selectedRuleConfig=null,s.$evalAsync())}),s.$on("$destroy",function(){angular.element(l).unbind("keydown")})}angular.module("console.flow-management").controller("MutateRuleController",e),e.$inject=["UserService","RulesService","feedbackService","$filter","$state","$timeout","$stateParams","$scope","$window"]}(),function(){function e(){return{require:"^ewxAccordion",transclude:!0,restrict:"EA",templateUrl:"shared/components/accordion/accordion-slide.html",replace:!0,scope:!0,bindToController:{title:"@tabTitle",tags:"=tabTags",date:"=tabDate",loading:"=tabLoading",isOpen:"=?",isDisabled:"=?",indicators:"=tabIndicators"},controllerAs:"ewxAccordionSlideCtrl",controller:function(){},link:function(e,t,a,n){var r=e.ewxAccordionSlideCtrl;n.addSlide(e),r.toggleOpen=function(t){if(function e(t,a){return!!(t.className&&t.className.split(" ").indexOf(a)>=0)||t.parentNode&&e(t.parentNode,a)}(t.target,"js-disable-accordion-toggle"))return!1;e.isDisabled||(r.isOpen=!r.isOpen)},e.$watch("ewxAccordionSlideCtrl.isOpen",function(t){t&&n.closeOthers(e)})}}}e.$inject=[],angular.module("ewx-components-accordion").directive("ewxAccordionSlide",e)}(),function(){function e(e,t){var a=this;a.slides=[],a.closeOthers=function(e){angular.isDefined(a.closeOthers)&&!a.closeOthers||a.multipleOpen||angular.forEach(a.slides,function(t){t!==e&&(t.ewxAccordionSlideCtrl.isOpen=!1)})},a.addSlide=function(e){a.slides.push(e),e.$on("$destroy",function(t){!function(e){var t=a.slides.indexOf(e);-1!==t&&a.slides.splice(t,1)}(e)})},a.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",a.multipleOpen=t.multipleOpen,e.getUserSettings().then(function(e){a.userSettings=e,a.userSettings.defaultDateTime&&(a.userDateTimeFormat=a.userSettings.defaultDateTime.date+" "+a.userSettings.defaultDateTime.time)},function(e){})}angular.module("ewx-components-accordion").controller("EwxAccordionController",e),e.$inject=["UserService","$scope"]}(),function(){function e(){return{transclude:!0,scope:!0,restrict:"EA",controller:"EwxAccordionController",controllerAs:"ewxAccordionCtrl",templateUrl:"shared/components/accordion/accordion.html",bindToController:{multipleOpen:"=?"}}}e.$inject=[],angular.module("ewx-components-accordion").directive("ewxAccordion",e)}(),function(){function e(e,t,a,n){var r=this;function i(t){var n={limit:r.resultLimit},i="";a.limitToDatasource?(r.selectedSeverity&&(i=" AND severity = '"+r.selectedSeverity+"'"),r.searchTerm?n.query="SELECT * FROM audit_events, UNNEST (subjects) as subs WHERE subs.subject_type = 'datasource' AND subs.subject = '"+a.limitToDatasource+"' AND (message LIKE '%"+r.searchTerm+"%') "+i+" ORDER BY timestamp DESC LIMIT 2000":n.query="SELECT * FROM audit_events, UNNEST (subjects) as subs WHERE subs.subject_type = 'datasource' AND subs.subject = '"+a.limitToDatasource+"'  "+i+"ORDER BY timestamp DESC LIMIT 2000"):r.searchTerm?(r.selectedSeverity&&(i=" AND severity = '"+r.selectedSeverity+"'"),n.query="SELECT * FROM audit_events, UNNEST (subjects) as subs WHERE (subs.subject LIKE '%"+r.searchTerm+"%' OR message LIKE '%"+r.searchTerm+"%') "+i+" ORDER BY timestamp DESC LIMIT 2000"):r.selectedSeverity?n.query="SELECT * FROM audit_events WHERE severity = '"+r.selectedSeverity+"' ORDER BY timestamp DESC LIMIT 2000":n.query="SELECT * FROM audit_events ORDER BY timestamp DESC LIMIT 2000",t&&(n.jobId=r.jobId,n.pageToken=r.pageToken),r.isLoading=!0,e.eqlQuery(n).then(function(e){r.isLoading=!1,r.callComplete=!0,e.parsed&&t?r.events=r.events.concat(e.parsed):e.parsed?r.events=e.parsed:r.events=[],e.metadata&&e.metadata.totalCount?r.maxResults=e.metadata.totalCount:r.maxResults=-1,e.more&&e.pageToken&&e.reference.jobId?(r.moreAvailable=!0,r.pageToken=e.pageToken,r.jobId=e.reference.jobId):(r.moreAvailable=!1,r.pageToken=null)},function(e){r.isLoading=!1,r.moreAvailable=!1,r.callComplete=!0,r.pageToken=null,r.jobId=null})}r.isLoading=!1,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.updateStorageSearchKey=function(){n.sessionStorage.setItem("auditEventSearchKey",r.searchTerm)},r.loadList=i,r.downloadFile=function(e){var t=e.filter(function(e){return"blob_key"===e.key});t&&t[0]&&t[0].value&&n.open("/files/get/"+t[0].value)},r.checkIfDate=function(e,t){return a=e,n=t,moment(a,n,!0).isValid();var a,n},r.resetFilter=function(){r.searchTerm="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("auditEventSearchKey")},r.downloadList=function(){var e="audit-events-"+moment().format();!function(e,t){var a=function(e){(e=angular.copy(e)).forEach(function(e){e.subjects&&e.subjects.length>0&&e.subjects.forEach(function(t){e["subject: "+t.subject_type]=t.subject}),e.properties&&e.properties.length>0&&e.properties.forEach(function(t){e["property: "+t.key]=t.value}),delete e.properties,delete e.subjects});var t=[];e.forEach(function(e){Object.keys(e).forEach(function(e){t.push(e)})});var a=Array.from(new Set(t)),n=[];e.forEach(function(e){var t={};a.forEach(function(a){var n="";Object.keys(e).forEach(function(t){a===t&&(n=e[t],"timestamp"!==a&&"created_datetime"!==a&&"flow_timestamp"!==a||(n=moment(n).format()))}),t[a]=n}),n.push(t)});var r=function(e,t){return null===t?"":t},i=n.map(function(e){return a.map(function(t){return JSON.stringify(e[t],r)}).join("\t")});return i.unshift(a.join("\t")),i=i.join("\r\n")}(e),n=encodeURI(a),r=document.createElement("a");r.style.visibility="hidden",r.setAttribute("href","data:text/plain;charset=utf-8,"+n),r.setAttribute("download","export-"+t+".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}(r.events,e)},n.sessionStorage.getItem("auditEventSearchKey")&&!a.limitToDatasource&&(r.searchTerm=n.sessionStorage.getItem("auditEventSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize?(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20):a.limitResults&&(r.resultLimit=a.limitResults,r.resultLimitDefault=a.limitResults),r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),i()},function(e){i()});var o=a.onClickSelect();r.onClickSelect=function(e){o&&o(e)}}angular.module("ewx-components-audit-event-search").controller("AuditEventSearchController",e),e.$inject=["QueryService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-audit-event-search").directive("auditEventSearch",function(){return{scope:{onClickSelect:"&onClickSelect",enableClickSelect:"@",limitResults:"=",searchQuery:"=?",presetFilter:"=?",showSearchArea:"@?",maxResults:"=?",limitToDatasource:"=?"},replace:!0,restrict:"AE",controller:"AuditEventSearchController",controllerAs:"vm",templateUrl:"shared/components/audit-event-search/audit-event-search.html"}})}(),function(){function e(e,t,a,n){var r=this;function i(t){r.isLoading=!0;var a={limit:100};t&&(a.pageToken=t),r.searchStatus&&(a.status=r.searchStatus),e.getBillingAccounts(a).then(function(e){var t=e.data;t.billingAccounts&&t.billingAccounts.forEach(function(e){r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.updateStorageSearchKey=function(){n.sessionStorage.setItem("billingAccountSearchKey",r.filterListing)},n.sessionStorage.getItem("billingAccountSearchKey")&&(r.filterListing=n.sessionStorage.getItem("billingAccountSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize?(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20):a.limitResults&&(r.resultLimit=a.limitResults,r.resultLimitDefault=a.limitResults),i()},function(e){i()}),r.statusChanged=function(){r.listing=[],i()},r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("billingAccountSearchKey")};var o=a.onClickSelect();r.onClickSelect=function(e){o&&o(e)}}angular.module("ewx-components-billing-account-search").controller("BillingAccountSearchController",e),e.$inject=["BillingAdminService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-billing-account-search").directive("billingAccountSearch",function(){return{scope:{onClickSelect:"&onClickSelect",onAddSelection:"&onAddSelection",enableClickSelect:"@",limitResults:"="},replace:!0,restrict:"AE",controller:"BillingAccountSearchController",controllerAs:"vm",templateUrl:"shared/components/billing-account-search/billing-account-search.html",link:function(e){}}})}(),function(){function e(e){return{restrict:"AC",link:function(t,a){a&&e(function(){a[0].focus()},0)}}}angular.module("ewx-components-auto-focus").directive("autoFocus",e),e.$inject=["$timeout"]}(),function(){function e(e,t,a,n,r){var i=this;function o(){i.types=[r.DAY,r.WEEK,r.MONTH,r.YEAR]}function s(){if(i.endOfPeriod=!1,i.lastUpdated="-",i.lastDatapoint={},i.periodRangeValueString="",i.periodValueString="",i.selectedDay="",i.currentDay="",e.period={type:r.MONTH,value:new Date},i.currentPeriod=e.period,t.types&&t.types.length>0){i.types=t.types;var a=!0,n=_(r).values();_(t.types).forEach(function(e){-1===n.indexOf(e)&&(a=!1)}),a||o()}else o()}function l(t){var a=e.period.value;switch(e.period.type){case r.DAY:a=moment(a).add(t,"days").toDate();break;case r.WEEK:a=moment(a).add(7*t,"days").toDate();break;case r.MONTH:a=moment(a).add(t,"months").toDate();break;case r.YEAR:a=moment(a).add(t,"years").toDate();break;default:return}e.period.value=a}s(),i.setPeriodType=function(t){e.period.type=t},i.next=function(){i.selectedDay!==i.currentDay&&l(1)},i.previous=function(){l(-1)},i.reset=function(){s()},t.$watch(function(){return e.period},function(){i.periodValueString=n.getPeriodValueString(e.period),i.periodRangeValueString="",e.period.type===r.WEEK&&(i.periodRangeValueString="("+a("date")(moment(e.period.value).weekday(1).toDate(),"d MMMM")+" - "+a("date")(moment(e.period.value).weekday(7).toDate(),"d MMMM")+")"),i.currentDay=a("date")(new Date,"yyyy-MM-dd"),i.selectedDay=a("date")(e.period.value,"yyyy-MM-dd"),i.endOfPeriod=i.selectedDay===i.currentDay,e.$broadcast("period-changed")},!0)}angular.module("ewx-components-card-period-navigation").controller("CardPeriodNavigationController",e),e.$inject=["$rootScope","$scope","$filter","PeriodService","PERIOD_TYPE"]}(),function(){angular.module("ewx-components-card-period-navigation").directive("cardPeriodNavigation",function(){return{scope:{types:"=",directiveId:"@"},replace:!0,restrict:"AE",controller:"CardPeriodNavigationController",controllerAs:"vm",templateUrl:"shared/components/card-period-navigation/card-period-navigation.html"}})}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(t){var a={limit:100};t&&(a.pageToken=t),e.getChannelClassifiers(a).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){l.listing.push(e)}),t.nextPageToken?c(t.nextPageToken):l.isLoading=!1},function(e){l.isLoading=!1,l.errorDialog=!0})}l.isLoading=!0,l.errorDialog=!1,l.resultLimit=20,l.resultLimitDefault=20,l.listing=[],l.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",l.validationPattern="^[A-Z0-9-_]+$",l.updateStorageSearchKey=function(){r.sessionStorage.setItem("channelClassifierSearchKey",l.filterListing)},r.sessionStorage.getItem("channelClassifierSearchKey")&&(l.filterListing=r.sessionStorage.getItem("channelClassifierSearchKey")),t.getUserSettings().then(function(e){l.userSettings=e,l.userSettings.defaultDateTime&&(l.userDateTimeFormat=l.userSettings.defaultDateTime.date+" "+l.userSettings.defaultDateTime.time),l.userSettings.defaultChunkSize&&(l.resultLimit=parseInt(l.userSettings.defaultChunkSize)||20,l.resultLimitDefault=parseInt(l.userSettings.defaultChunkSize)||20),c()},function(e){c()}),l.showMoreResults=function(){l.resultLimit=l.resultLimit+l.resultLimitDefault},l.resetResultLimit=function(){l.resultLimit=l.resultLimitDefault},l.resetFilter=function(){l.filterListing="",l.resultLimit=l.resultLimitDefault,r.sessionStorage.removeItem("channelClassifierSearchKey")},l.openDetails=function(e){l.detailSheet=!0,l.editMode=!1,l.deleteDialog=!1,l.selectedClassifierOriginal=angular.copy(e),l.selectedClassifier=angular.copy(e)},l.closeDetails=function(){l.detailSheet=!1},l.toggleEditMode=function(e){l.editMode=!l.editMode,l.selectedClassifier.newName=l.selectedClassifier.name,e&&(l.selectedClassifier=angular.copy(l.selectedClassifierOriginal))},l.updateChannelClassifier=function(){if(l.isSaving=!0,l.hasDuplicateName=!1,!l.updateChannelClassifierForm.$valid)return l.isSaving=!1,!1;if(l.listing&&l.listing.forEach(function(e){e.name===l.selectedClassifier.newName&&e.name!==l.selectedClassifier.name&&(l.hasDuplicateName=!0)}),l.hasDuplicateName)return l.isSaving=!1,!1;var t={newName:l.selectedClassifier.newName,description:l.selectedClassifier.description,name:l.selectedClassifier.name};e.updateChannelClassifier(t).then(function(e){s(function(){l.isSaving=!1,d(o("translate")("feedback.messages.ok")),i.go("console.channel-classifiers",{},{reload:!0})},500)},function(){l.isSaving=!1,d(o("translate")("feedback.messages.error"),"error")})};var u=n.onClickSelect();function d(e,t){a.addMessage({type:t,message:e})}l.onClickSelect=function(e){u&&u(e)},angular.element(r).bind("keydown",function(e){27===e.keyCode&&"console.channel-classifiers"===i.current.name&&(e.preventDefault(),n.$apply(function(){l.closeDetails()}))}),n.$on("$destroy",function(){angular.element(r).unbind("keydown")})}angular.module("ewx-components-channel-classifier-search").controller("ChannelClassifierSearchController",e),e.$inject=["DataSourceService","UserService","feedbackService","$scope","$window","$state","$filter","$timeout"]}(),function(){angular.module("ewx-components-channel-classifier-search").directive("channelClassifierSearch",function(){return{scope:{onClickSelect:"&onClickSelect",onAddSelection:"&onAddSelection",enableClickSelect:"@",limitResults:"="},replace:!0,restrict:"AE",controller:"ChannelClassifierSearchController",controllerAs:"vm",templateUrl:"shared/components/channel-classifier-search/channel-classifier-search.html",link:function(e){}}})}(),angular.module("ewx-components-chart").constant("ChartConfig",{useHighStocks:!0,colors:["#019beb","#014e76","#0b7300","#6ab6de","#72c126","#8f4f24","#d4bc07","#5571c0","#8d4653","#0ea397"],chart:{zoomKey:"shift",zoomType:"x",height:600,resetZoomButton:{position:{align:"right",verticalAlign:"top"},relativeTo:"chart"},marginLeft:80,marginRight:20},boost:{enabled:!0,allowForce:!0},plotOptions:{series:{cursor:void 0,stickyTracking:!1,dragDrop:{draggableY:!1},point:{events:{click:function(e,t){},drop:function(e){}}}}},exporting:{buttons:{contextButton:{menuItems:["downloadPNG","downloadSVG","separator","downloadCSV","downloadXLS"],symbolStroke:"#019BEC",symbolStrokeWidth:2}}},rangeSelector:{enabled:!0,inputEnabled:!1},scrollbar:{enabled:!1,liveRedraw:!1},navigator:{enabled:!0,maskFill:"rgba(114, 193, 38, 0.15)",handles:{backgroundColor:"rgb(255, 255, 255)",borderColor:"rgb(1, 155, 235)"},outlineColor:"rgb(1, 155, 235)",outlineWidth:1},navigation:{enabled:!0},legend:{enabled:!1},yAxis:{title:{text:"Unit"}},xAxis:{type:"datetime",title:{text:"Date (utc)"}},series:[{}],title:{text:""},credits:{enabled:!1}}).constant("HeatMapConfig",{chart:{type:"heatmap",marginTop:40},exporting:{buttons:{contextButton:{menuItems:["downloadPNG","downloadSVG","separator","downloadCSV","downloadXLS"],symbolStroke:"#019BEC",symbolStrokeWidth:2}}},legend:{enabled:!0},credits:{enabled:!1},title:{text:""},xAxis:{type:"datetime",min:Date.UTC(2e3,0,1),max:Date.UTC(2022,0,2)},yAxis:{title:{text:null},labels:{formatter:function(){return Math.floor(this.value)+":00"}},minPadding:0,maxPadding:0,startOnTick:!1,endOnTick:!1,tickWidth:1,min:0,max:23,reversed:!0},colorAxis:{stops:[[0,"#FF5841"],[.5,"#FFA241"],[.7,"#FFd161"],[.75,"#FFDF90"],[.8,"#C7E6A8"],[.85,"#CCEBFB"],[.9,"#B3E1F9"],[.95,"#80CDF5"],[1,"#019BEB"]],min:0,max:10,startOnTick:!1,endOnTick:!1,labels:{format:"{value}"}},series:[]}),function(){function e(e,t,a,n,r,i,o,s,l,c,u,d){var f=this;function m(e){var t=e.split(":");if(t.length<=1)return!0;var a=t[0].trim(),n=t[1].trim();return!r.chartData[a]||!r.chartData[a][n]||r.chartData[a][n].isSource}function g(e,t){var a=null;return o.getChartObject(e).series.forEach(function(e){e.name===t.series&&e.data.forEach(function(e){e.x===t.x&&(a=e)})}),a}function p(e,t){o.getChartObject(f.chartConfigEditMode).series.forEach(function(a){a.name===e.series&&a.data.forEach(function(a){a.x===e.x&&a.setState(t)})})}function h(){f.showChart=!1,f.showHeatmapChart=!1,f.plotData={},f.plottedData=[]}f.selectedPoint=null,f.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",f.showTableGrid=r.showTableGrid,a.getUserSettings().then(function(e){f.userSettings=e,f.userSettings.defaultDateTime&&(f.userDateTimeFormat=f.userSettings.defaultDateTime.date+" "+f.userSettings.defaultDateTime.time)},function(e){}),Highcharts.SVGRenderer.prototype.symbols.menu=function(e,t,a,n){return["M",e+.5*a,t,"L",e+.5*a,t+.7*n,"M",e+.3*a,t+.5*n,"L",e+.5*a,t+.7*n,"L",e+.7*a,t+.5*n,"M",e,t+.9*n,"L",e,t+n,"L",e+a,t+n,"L",e+a,t+.9*n]},f.chartConfig=angular.copy(e),f.chartConfigEditMode=angular.copy(e),f.chartConfigEditMode.plotOptions.series.dragDrop.draggableY=!0,f.chartConfigEditMode.plotOptions.series.cursor="ns-resize",f.chartConfigEditMode.plotOptions.series.point.events.click=function(e){f.selectedPoint=e.point,f.originalValue=e.point.y},f.chartConfigEditMode.plotOptions.series.point.events.drag=function(e){if(m(e.origin.points[e.newPointId].point.series.name))return!1},f.chartConfigEditMode.plotOptions.series.point.events.drop=function(e){var t=e.origin.points[e.newPointId],a=e.origin.points[e.newPointId].point.series.name;if(m(a))return!1;var n=f.modifiedPoints.filter(function(e){return e.x===t.x&&e.series===a});n.length>0?n[0].y=e.newPoint.y:(f.modifiedPoints.push({x:t.x,originalValue:t.y,y:e.newPoint.y,series:a,originalColor:e.target.color}),e.newPoints[e.newPointId].point.update({marker:{fillColor:"red"}}))},f.chartConfig.plotOptions={series:{allowPointSelect:!0,point:{events:{select:function(e){var t,a;a=m((t=this).series.name),f.selectedDatapoint={symbolType:t&&t.series&&t.series.symbol?t.series.symbol:null,pointColor:t&&t.color?t.color:null,series:t&&t.series&&t.series.name?t.series.name:null,x:t&&t.x?"utc"===r.timezone.toLowerCase()?moment(t.x).utc():moment(t.x).tz(r.timezone):null,y:t&&t.y?t.y:null,isSource:a}},unselect:function(e){var t;t=this,f.selectedDatapoint&&t&&t.y&&t.y===f.selectedDatapoint.y&&(f.selectedDatapoint=null)}}}}},f.isSourceChannel=m,f.chartConfigHeatMap=angular.copy(t),f.chartConfig.tooltip={shared:!1,formatter:S},f.chartLoading=!1,_.isUndefined(r.showLegend)?f.showLegend=!0:f.showLegend=r.showLegend,f.allowHeatMapToRender=r.allowHeatmap,r.$watch("showLegendAsOverlay",function(){!_.isUndefined(r.showLegendAsOverlay)&&f.showLegend?(r.showLegendAsOverlay&&(f.showLegendOverlayToggle=!0),f.showLegendAsOverlay=r.showLegendAsOverlay):(f.showLegendOverlayToggle=!1,f.showLegendAsOverlay=!1)}),f.updatePointValue=function(e){var t=f.modifiedPoints.filter(function(t){return t.x===e.x&&(t.series===e.series.name||t.series===e.series)});if(t.length>0)if((null===e.y||angular.isUndefined(e.y))&&(e.y=0),t[0].y=e.y,e.update)e.update({y:e.y,marker:{fillColor:"red"}});else{var a=g(f.chartConfigEditMode,e);a&&a.update({y:e.y,marker:{fillColor:"red"}})}else f.modifiedPoints.push({x:e.x,originalValue:f.originalValue,y:e.y,series:e.series.name,originalColor:e.color}),e.update({y:e.y,marker:{fillColor:"red"}})},f.selectPointFromTable=function(e){var t=g(f.chartConfigEditMode,e);t&&(f.selectedPoint=t)},f.modifiedPoints=[],f.toggleChartEdit=function(){f.editReason="",f.chartEditable?(f.selectedPoint=null,f.chartEditable=!1):(f.modifiedPoints=[],f.chartEditable=!0,f.editChartLoading=!0,c(function(){var e=o.getChartObject(f.chartConfig),t=o.getChartObject(f.chartConfigEditMode),a=e.axes[0].getExtremes();o.clearChart(f.chartConfigEditMode),e.series.forEach(function(e){t.addSeries(angular.copy(e.userOptions),!1)}),t&&t.xAxis&&t.xAxis.length>0&&t.xAxis[0].axisTitle&&e&&e.xAxis&&e.xAxis.length>0&&e.xAxis[0].axisTitle&&t.xAxis[0].axisTitle.attr({text:e.xAxis[0].axisTitle.textStr});try{a.userMin&&a.userMax&&t.axes[0].setExtremes(a.userMin,a.userMax)}catch(e){}f.editChartLoading=!1,t.redraw()}))},f.resetPoint=function(e){o.getChartObject(f.chartConfigEditMode).series.forEach(function(t){t.name===e.series&&t.data.forEach(function(t){t.x===e.x&&t.update({y:e.originalValue,marker:{fillColor:e.originalColor}})})}),f.modifiedPoints.splice(f.modifiedPoints.indexOf(e),1),p(e,"")},f.highlightPoint=p,h();var v=r.onLoaded();function S(){var e=[],t=[],a=void 0,n=void 0,i=void 0,o=void 0;if(this.points&&this.points.length>0)for(var s=0;s<this.points.length;s++)n=(a=this.points[s].series.name.split(":"))[0].trim(),i=a[1].trim(),f.plotData[n][i]&&f.plotData[n][i].unitType&&(o=f.plotData[n][i].unitType),e.push(this.points[s].series.name),t.push(this.points[s].y);else this.series.name&&(e=[this.series.name],n=(a=this.series.name.split(":"))[0].trim(),i="flags"===this.series.type&&this.series.userOptions.flowChannelId?this.series.userOptions.flowChannelId:a[1].trim(),f.plotData[n][i]&&f.plotData[n][i].unitType&&(o=f.plotData[n][i].unitType),t=[this.y]);var l="<strong>"+e.join(", ")+"</strong>";if(t&&"NaN"!==t.join(", ")){var c=d("translate")("generic.value");l=l+"<br><strong>"+c+":</strong> "+t.join(", ")}o&&(l=l+" "+o);var u=moment(this.x).format(f.userDateTimeFormat);if(r.timezone&&(u="utc"===r.timezone.toLowerCase()?moment(this.x).utc().format(f.userDateTimeFormat):moment(this.x).tz(r.timezone).format(f.userDateTimeFormat)),u){var m=d("translate")("generic.time");l=l+"<br><strong>"+m+":</strong> "+u}if(r.timezone){var g=d("translate")("generic.timezone");l=l+"<br><strong>"+g+":</strong> "+r.timezone}if(this.point&&this.point.options&&this.point.options.text)try{var p=JSON.parse(this.point.options.text);if(p.length>0){var h=d("translate")("generic.properties");l+="<br/><br/><strong>"+h+":</strong>"}p.forEach(function(e){l+="<br/><strong>"+e.key.replace(/_/g," ")+":</strong> "+e.value})}catch(e){}return l}function w(e){T(f.chartConfig,e),T(f.chartConfigHeatMap,e)}function T(e,t){var a,n,r=o.getChartObject(e);a=s[0].offsetHeight,n=s[0].offsetWidth,t?r&&n&&r.setSize(n):r&&a&&n&&r.setSize(n,a)}function C(e,t,a){for(e=""+e;e.length<t;)e=a+e;return e}function y(e,t){var a=0;return t.values.filter(function(t){t[0]===e&&(a=t[1])}),a}function k(e,t){n.addMessage({type:t,message:e})}function A(e){k(e,"error")}r.$watch("timezone",function(){if(r.timezone){var e=f.chartConfig.getChartObj();f.chartConfig.tooltip={shared:!1,formatter:S},f.chartConfigEditMode.tooltip={shared:!1,formatter:S},e&&e.xAxis&&e.xAxis.length>0&&e.xAxis[0].axisTitle&&e.xAxis[0].axisTitle.attr({text:"Date ("+r.timezone.replace("_"," ")+")"}),"utc"===r.timezone.toLowerCase()?Highcharts.setOptions({global:{timezone:null}}):Highcharts.setOptions({global:{timezone:r.timezone}}),e.redraw()}}),r.$watch("isLoading",function(){r.isLoading?f.showChart=!1:f.showChart=!0,f.chartLoading=r.isLoading},!0),r.$watch("chartData",function(){r.chartData&&angular.equals(r.chartData,{})&&(h(),o.clearChart(f.chartConfig),f.noDataAvailable=!0),r.chartData&&!angular.equals(r.chartData,{})&&(f.plotData=angular.copy(r.chartData),function(e){r.disableResize?w(!0):w();f.plottedData=[],f.heatmapSerieIds=[],f.showHeatmapChart=!1;var t=!1,a=0,n=0,i=new Date(2900,0),s=new Date(1900,0);if(Object.keys(e).forEach(function(l){var c=e[l];if(!_.isFunction(c)){var u=[],d=!1;Object.keys(c).forEach(function(e){var m=c[e];if(e.endsWith("_COUNT")&&f.allowHeatMapToRender){var g=function(e,t,a,n){var i=[],o=function(e){var t=null,a=null;return e.forEach(function(e){if(t){var n=(new Date(e[0])-t)/1e3;(!a||a>n)&&(a=n),t=new Date(e[0])}else t=new Date(e[0])}),a}(a.values),s=0,l=0,c=new Date(2900,0),u=new Date(1900,0);return a.values.forEach(function(e){var t=new Date(e[0]);r.timezone;var a=moment(t).utc(),n=0;900===o?(n=4*a.hours()+a.minutes()/60*4,a.hour(0).minute(0).second(0).millisecond(0)):1800===o?(n=2*a.hours()+a.minutes()/60*2,a.hour(0).minute(0).second(0).millisecond(0)):o>=60&&o<3600?(n=a.minutes(),a.minute(0).second(0).millisecond(0)):o>=3600&&o<86400?(n=a.hours(),a.hour(0).minute(0).second(0).millisecond(0)):o>=86400&&(n=0,a.hour(0).minute(0).second(0).millisecond(0));var d=moment(a).utc(),f=e[1];i.push([d.valueOf(),n,f]),f<s&&(s=f),l<f&&(l=f),t<c&&(c=t),t>u&&(u=t)}),{serie:{type:"heatmap",borderWidth:0,nullColor:"#FFFFFF",colsize:864e5,id:e+"_"+t,name:e+", "+t,interval:o,data:i,visible:n},minValue:s,maxValue:l,firstDate:c,lastDate:u,smallestInterval:o}}(l,e,m,!d);g.minValue<a&&(a=g.minValue),n<g.maxValue&&(n=g.maxValue),g.firstDate<i&&(i=g.firstDate),s<g.lastDate&&(s=g.lastDate),o.appendSeriesToChart(f.chartConfigHeatMap,[g.serie],!1),f.heatmapSerieIds.push(g.serie.id),d=!0}if(_.isFunction(m)||m.deleted)m.deleted&&o.removeSeriesFromChart(f.chartConfig,["id_"+l+"_"+m.flowId+"_"+e]);else{var p={id:e,flowId:m.flowId,isSource:m.isSource,valueCount:m.values.length,annotations:[]};if(m.unitType&&(p.unitType=m.unitType),m.values&&m.values.length>0){var h=function(e,t,a){return{id:"id_"+e+"_"+a.flowId+"_"+t,name:e+": "+t,type:"line",connectNulls:!1,data:a.values,visible:!0,showInNavigator:!0}}(l,e,m);o.appendSeriesToChart(f.chartConfig,[h],!1),t=!0}if(m.annotations&&m.annotations.length>0){m.annotations.forEach(function(e){p.annotations.push({id:e.id,sequenceId:e.sequenceId,valueCount:e.values.length})});var v=function(e,t,a){var n=[];return a.annotations.forEach(function(r){var i=[];r.values.forEach(function(e){i.push({x:e[0],title:r.id,text:JSON.stringify(e[1]),y:y(e[0],a)})}),n.push({id:"id_"+e+"_"+a.flowId+"_"+r.id+"_"+r.sequenceId,name:e+": "+r.id+" ("+Number(r.values.length).toLocaleString()+")",type:"flags",data:i,shadow:!0,visible:!1,shape:"flag",allowOverlapX:!0,turboThreshold:i.length+1,flowChannelId:t})}),n}(l,e,m);o.appendSeriesToChart(f.chartConfig,v,!1),t=!0}u.push(p)}}),f.plottedData.push({id:l,channels:u})}}),t){if(r.chartType){var l=o.getChartObject(f.chartConfig);"line"!==r.chartType&&l.update({navigator:{enabled:!1},chart:{marginBottom:40}}),l.series&&l.series.length>0&&l.series.forEach(function(e,t){l.series[t].update({type:r.chartType})})}o.redrawChart(f.chartConfig)}if(f.heatmapSerieIds.length>0){var c=o.getChartObject(f.chartConfigHeatMap),u=23,d=function(){return C(Math.floor(this.value),2,"0")+":00"};c.xAxis[0].series[0].userOptions.interval>=84e3?(u=0,d=function(){return"Day"}):1800===c.xAxis[0].series[0].userOptions.interval?(u=48,d=function(){return C(Math.floor(this.value/2),2,"0")+":"+C(this.value%2*30,2,"0")}):900===c.xAxis[0].series[0].userOptions.interval&&(u=96,d=function(){return C(Math.floor(this.value/4),2,"0")+":"+C(this.value%4*15,2,"0")}),c.update({colorAxis:{min:a,max:n},yAxis:{max:u,labels:{formatter:d}}}),f.heatMapChartTitle=c.series[0].name,c.xAxis[0].update({min:i.getTime(),max:s.getTime()}),c.redraw(),f.showHeatmapChart=!0}f.showChart=!0,f.chartLoading=!1,f.noDataAvailable=!t,v&&v()}(f.plotData))},!0),f.getSeriesDetails=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={};try{var o=null;if(!(o=r?f.chartConfigEditMode.getChartObj():f.chartConfig.getChartObj()))return i;var s="id_"+e+"_"+t+"_"+a;null!==n&&(s+="_"+n),o.series.forEach(function(e){e.userOptions.id===s&&(i.isShowing=e.visible,i.color=e.color,i.count=e.xData.length)})}catch(e){}return i},f.onMouse=function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{var i=null;if(!(i=r?f.chartConfigEditMode.getChartObj():f.chartConfig.getChartObj()))return;var o="id_"+e+"_"+t+"_"+a;i.series.forEach(function(e){e.userOptions.id===o&&("enter"===n?e.onMouseOver():"leave"===n&&e.onMouseOut())})}catch(e){}},f.toggleShowing=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{var i=null;if(!(i=r?o.getChartObject(f.chartConfigEditMode):o.getChartObject(f.chartConfig)))return;var s="id_"+e+"_"+t+"_"+a;null!==n&&(s+="_"+n),i.series.forEach(function(e){e.userOptions.id===s&&(e.visible?e.hide():e.show())})}catch(e){}},f.toggleAllChannels=function(e,t){o.getChartObject(f.chartConfig).series.forEach(function(a){if(a.userOptions.name){var n=a.userOptions.name.split(":")[0];"flags"!==a.userOptions.type&&n===e?a.visible&&!t?a.hide():!a.visible&&t&&a.show():t||n!==e||a.hide()}})},f.deslectSelectedPoint=function(){o.getChartObject(f.chartConfig).getSelectedPoints().forEach(function(e){e.select(!1)})},r.disableResize?angular.element(window).on("resize",function(){w(!0)}):(r.$watch(function(){return[s[0].offsetWidth,s[0].offsetHeight].join("x")},function(e){w()}),angular.element(l).on("resize",w)),f.nextHeatmapChannel=function(){for(var e=o.getChartObject(f.chartConfigHeatMap),t=e.series.length-1,a=0;a<e.series.length;a++)if(e.series[a].visible)t=a,e.series[a].hide();else if(a>t){e.series[a].show(),f.heatMapChartTitle=e.series[a].name;break}t===e.series.length-1&&(e.series[0].show(),f.heatMapChartTitle=e.series[0].name)},f.previousHeatmapChannel=function(){for(var e=o.getChartObject(f.chartConfigHeatMap),t=0,a=e.series.length;a>0;a--)if(e.series[a].visible)t=a,e.series[a].hide();else if(a<t){e.series[a].show(),f.heatMapChartTitle=e.series[a].name;break}0===t&&(e.series[0].show(),f.heatMapChartTitle=e.series[0].name)},f.getDatasourceNameBasedOnFlowId=function(e){var t="";return Object.keys(f.flowMapping).forEach(function(a){!_.isFunction(f.flowMapping[a])&&f.flowMapping.hasOwnProperty(a)&&"selectedFlowIds"!==a&&f.flowMapping[a]&&Object.keys(f.flowMapping[a]).forEach(function(n){_.isFunction(f.flowMapping[a][n])||f.flowMapping[a][n].forEach(function(n){n&&n.flowId&&n.flowId===e&&(t=a)})})}),t},r.$on("chartAction",function(e,t){"plotLine"===t.action?function(e,t,a){for(var n=o.getChartObject(f.chartConfig),r=0;r<n.yAxis[0].plotLinesAndBands.length;r++)n.yAxis[0].removePlotLine(t+"_"+a);n.yAxis[0].addPlotLine({zIndex:10,value:e,color:"ICAP"===t?"#ff5841":"#c1267a",width:2,id:t+"_"+a,label:{align:"left",text:t+" - "+a}})}(t.value,t.subject,t.datasourceId):"clearLines"===t.action&&function(e,t){for(var a=o.getChartObject(f.chartConfig),n=0;n<a.yAxis[0].plotLinesAndBands.length;n++)a.yAxis[0].removePlotLine(e+"_"+t)}(t.subject,t.datasourceId)}),f.toggleChangeChartType=function(e,t){f.getSeriesDetails(e.id,t.flowId,t.id).isShowing||f.toggleShowing(e.id,t.flowId,t.id),t.chartType||(t.chartType="line"),t.chartSwitch=!0},f.changeChartType=function(e,t){var a=o.getChartObject(f.chartConfig);a.series&&a.series.length>0&&a.series.forEach(function(n,r){var i=e.id+": "+t.id;n.name===i&&(a.series[r].update({type:t.chartType}),t.chartSwitch=!1)})},f.toggleEditConfirmation=function(){f.showEditConfirmation=!f.showEditConfirmation},f.applyEdit=function(){if(!f.editConfirmForm.$valid)return!1;f.savingEdits=!0;var e,t,a,n=(e=f.modifiedPoints,t={streaming:!0,datasources:[],editReason:f.editReason},a={},e.forEach(function(e){var t=e.series.split(":"),n=t[0].trim(),r=t[1].trim(),i=r.split(" - ")[1],o=f.plotData[n][r].flowId;a[n]||(a[n]={flowId:o}),a[n][i]||(a[n][i]={values:[]}),a[n][i].values.push({timestamp:e.x,value:e.y})}),Object.keys(a).forEach(function(e){var n={flowId:a[e].flowId,datasourceId:e,channels:[]};Object.keys(a[e]).forEach(function(t){"flowId"!==t&&n.channels.push({channelClassifier:t,values:a[e][t].values})}),t.datasources.push(n)}),t);u.editDataPoints(n).then(function(e){f.savingEdits=!1,k(d("translate")("feedback.messages.okProcessing")),f.toggleChartEdit()},function(e){f.savingEdits=!1,e.data&&e.data.error&&e.data.error.message?A(d("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):A(d("translate")("feedback.messages.error"))}),f.showEditConfirmation=!f.showEditConfirmation},r.$on("chartEditToggle",function(){f.toggleChartEdit()}),r.$watch("onDownload",function(e,t){if(t!==e&&null!==t){var a=o.getChartObject(f.chartConfig);a&&a.downloadCSV()}}),i.$watch("navOpen",function(){r.disableResize&&c(function(){w(!0)},50)})}angular.module("ewx-components-chart").controller("ChartController",e),e.$inject=["ChartConfig","HeatMapConfig","UserService","feedbackService","$scope","$rootScope","ChartService","$element","$window","$timeout","DataPointService","$filter"]}(),function(){angular.module("ewx-components-chart").directive("chart",function(){return{scope:{chartData:"=",isLoading:"=",onLoaded:"&",timezone:"=",showLegend:"=",showLegendAsOverlay:"=",disableResize:"=",allowHeatmap:"=",chartType:"@",onDownload:"="},replace:!0,restrict:"AE",controller:"ChartController",controllerAs:"vm",templateUrl:"shared/components/chart/chart.html"}})}(),function(){angular.module("ewx-components-combo-box").directive("comboBox",function(){return{scope:{listId:"@",listing:"=",model:"=",currentItem:"=current",placeholder:"@",size:"@",fieldRequired:"=?",submitted:"=?",loading:"=?",listMatchValue:"=?"},replace:!0,restrict:"AE",templateUrl:"shared/components/combo-box/combo-box.html",link:function(e){e.checkValue=function(t){if(e.valueInvalid=!1,t&&e.listMatchValue){var a=_.includes(e.listing,t);a||(e.valueInvalid=!0)}},!0!==e.fieldRequired&&(e.fieldRequired=!1)}}})}(),function(){function e(e){var t=this;if(t.rzOptions={},e.id&&(t.id=e.id),e.model.optional&&(t.optional=!0,"DatePicker"!==e.model.widgetType||e.model.disabled||e.model.value?e.model.disabled?e.model.disabled=!0:e.model.disabled=!1:e.model.disabled=!0),e.model.disabled&&(t.rzOptions.disabled=!0),e.widgetType?(t.widgetType=e.widgetType,"FloatSlider"===e.widgetType?(t.rzOptions.enforceStep=!1,t.rzOptions.precision=2):"Bool"!==e.widgetType||e.model.value||(e.model.value="false")):t.widgetType="default",e.step&&(t.rzOptions.step=Number(e.step)),e.minValue&&(t.rzOptions.floor=Number(e.minValue)),e.maxValue&&(t.rzOptions.ceil=Number(e.maxValue)),e.options){var a=e.options.replace(/"/g,"").replace("[","").replace("]","").split(",");t.options=a,t.options.length<=10?t.optionsSize=t.options.length:t.optionsSize=10}"FloatRange"!==e.widgetType&&"IntRange"!==e.widgetType||(e.model.defaultValue&&(e.model.minValue=Number(e.model.defaultValue)),e.model.maxDefaultValue&&(e.model.maxValue=Number(e.model.maxDefaultValue))),"FloatSlider"!==e.widgetType&&"IntSlider"!==e.widgetType||0===e.model.value||e.model.value||(e.model.value=e.model.defaultValue),"AlertThreshold"===e.widgetType&&(t.rzOptionsWarning={showSelectionBar:!0,selectionBarGradient:{from:"#fbe1ac",to:"#ffaa00"},id:"warningSlider",onEnd:function(e){t.checkAlertTresholdValue("warning")}},t.rzOptionsError={showSelectionBar:!0,selectionBarGradient:{from:"#febbb2",to:"#ff5841"},id:"errorSlider",onEnd:function(e){t.checkAlertTresholdValue("error")}},t.warningTreshold=!0,t.errorTreshold=!0,e.model.warning_threshold&&"0"!==e.model.warning_threshold||(e.model.warning_threshold="0",t.warningTreshold=!1,t.rzOptionsWarning.disabled=!0),e.model.error_threshold&&"0"!==e.model.error_threshold||(e.model.error_threshold="0",t.errorTreshold=!1,t.rzOptionsError.disabled=!0),t.errorTreshold&&0!==e.model.error_threshold&&"0"!==e.model.error_threshold||(e.model.errorThresholdAbortFlag=!1),e.step&&(t.rzOptionsWarning.step=Number(e.step),t.rzOptionsError.step=Number(e.step)),e.minValue&&(t.rzOptionsWarning.floor=Number(e.minValue),t.rzOptionsError.floor=Number(e.minValue)),e.maxValue&&(t.rzOptionsWarning.ceil=Number(e.maxValue),t.rzOptionsError.ceil=Number(e.maxValue))),t.toggleWarning=function(){e.model.warning_threshold="0",t.rzOptionsWarning.disabled=!0,t.warningTreshold&&(t.rzOptionsWarning.disabled=!1)},t.toggleError=function(){t.warningExceedsError=!1,e.model.error_threshold="0",t.checkAlertTresholdValue(),t.rzOptionsError.disabled=!0,t.errorTreshold&&(t.rzOptionsError.disabled=!1)},t.checkAlertTresholdValue=function(a){var n=Number(e.model.warning_threshold),r=Number(e.model.error_threshold);if(t.warningFeedback=!1,t.warningExceedsError=!1,t.warningExceedsMin=!1,t.warningExceedsMax=!1,t.errorFeedback=!1,t.errorExceedsMax=!1,t.errorExceedsMin=!1,t.errorTreshold||(e.model.errorThresholdAbortFlag=!1),t.warningTreshold&&e.model.minValue&&n<e.model.minValue&&(t.warningFeedback=!0,t.warningExceedsMin=!0,e.model.warning_threshold=e.model.minValue.toString()),t.warningTreshold&&e.model.maxValue&&n>e.model.maxValue&&(t.warningFeedback=!0,t.warningExceedsMax=!0,e.model.warning_threshold=e.model.maxValue.toString()),t.warningTreshold&&n>r){if(!t.errorTreshold||0===r)return!1;t.warningFeedback=!0,t.warningExceedsError=!0,e.model.minValue&&r<e.model.minValue?e.model.warning_threshold=e.model.minValue.toString():e.model.warning_threshold=r.toString()}t.errorTreshold&&e.model.minValue&&r<e.model.minValue&&(t.errorFeedback=!0,t.errorExceedsMin=!0,e.model.error_threshold=e.model.minValue.toString()),t.errorTreshold&&e.model.maxValue&&r>e.model.maxValue&&(t.errorFeedback=!0,t.errorExceedsMax=!0,e.model.error_threshold=e.model.maxValue.toString())},t.checkCeilFloor=function(a){t.rzOptions.floor&&a<t.rzOptions.floor&&(e.model.value=t.rzOptions.floor),t.rzOptions.ceil&&a>t.rzOptions.ceil&&(e.model.value=t.rzOptions.ceil)},t.checkValue=function(){e.model.disabled?t.rzOptions.disabled=!0:t.rzOptions.disabled=!1},e.$watch("[widgetType, model]",function(a,n){e.widgetType&&t.widgetType!==e.widgetType&&e.widgetType&&e.widgetType.length>0&&(t.widgetType=e.widgetType),!e.model.optional||"Text"!==e.widgetType&&"ResourceInput"!==e.widgetType||(e.model.disabled=!0,e.model.value&&(e.model.disabled=!1))},!0)}angular.module("ewx-components-control-widgets").controller("ControlWidgetsController",e),e.$inject=["$scope"]}(),function(){angular.module("ewx-components-control-widgets").directive("controlWidgets",function(){return{scope:{id:"@",widgetType:"@",field:"@",fieldMin:"@",fieldMax:"@",model:"=",size:"@",step:"@",minValue:"@",maxValue:"@",options:"@"},replace:!0,restrict:"AE",controller:"ControlWidgetsController",controllerAs:"vm",templateUrl:"shared/components/control-widgets/control-widgets.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r,i){var o=this;function s(t,a){e.addMessage({type:a,message:t})}o.newChannelClassifier={},o.availableDatapointTypes=["interval","gauge","register"],o.validationPattern="^[A-Z0-9-_]+$",o.closeSheet=function(){n.sheetActive=!1},o.availableUnitTypes=function(e){for(var t=0;t<o.classifierTypes.length;t++)if(o.classifierTypes[t].datasourceType===e)return o.classifierTypes[t].unitTypes},o.createChannelClassifier=function(){if(o.isCreatingChannelClassifier=!0,o.hasDuplicateName=!1,!o.createChannelClassifierForm.$valid)return o.isCreatingChannelClassifier=!1,!1;o.availableChannelClassifiers?o.availableChannelClassifiers.forEach(function(e){e.name===o.newChannelClassifier.name&&(o.hasDuplicateName=!0)}):o.availableChannelClassifiers=[];if(o.hasDuplicateName)return o.isCreatingChannelClassifier=!1,!1;t.createChannelClassifier(o.newChannelClassifier).then(function(){o.isCreatingChannelClassifier=!1,o.newChannelClassifier={},o.availableChannelClassifiers=[],o.createChannelClassifierForm.$setPristine(),o.closeSheet(),o.availableChannelClassifiers.push(o.newChannelClassifier),n.reloadOnAdd&&i.reload(),s(r("translate")("feedback.messages.created"))},function(e){o.isCreatingChannelClassifier=!1,s(r("translate")("feedback.messages.error"),"error")})},n.$watch("sheetActive",function(e,t){e?(o.sheetOpen=!0,function e(t,n){o.loadingChannelClassifiers=!0;var r={limit:100};n||(o.availableChannelClassifiers=[]),t&&(r.pageToken=t),a.getChannelClassifiers(r).then(function(t){t.data.items&&t.data.items.forEach(function(e){o.availableChannelClassifiers.push(e)}),t.data.nextPageToken?e(t.data.nextPageToken,!0):o.loadingChannelClassifiers=!1},function(e){o.loadingChannelClassifiers=!1})}(),o.loadingClassifierTypes=!0,a.getDatasourceAndUnitTypes().then(function(e){o.loadingClassifierTypes=!1;var t=e.data.items;if(t){var a=[];t.forEach(function(e){a.push(e.datasourceType)}),o.availableDatasourceTypes=a}o.classifierTypes=t},function(e){o.loadingClassifierTypes=!1})):o.sheetOpen=!1},!0)}angular.module("ewx-components-create-channel-classifier").controller("CreateChannelClassifierController",e),e.$inject=["feedbackService","ChannelService","DataSourceService","$scope","$filter","$state"]}(),function(){function e(){return{scope:{sheetActive:"=",reloadOnAdd:"@"},restrict:"AE",controller:"CreateChannelClassifierController",controllerAs:"vm",templateUrl:"shared/components/create-channel-classifier/create-channel-classifier.html",link:function(e){}}}angular.module("ewx-components-create-channel-classifier").directive("createChannelClassifier",e),e.$inject=[]}(),function(){function e(e,t,a,n,r,i){var o=this;function s(e,t){a.addMessage({type:t,message:e})}function l(e){s(e,"error")}o.datasource={triggerNow:!0,useStreaming:!1},o.nameValidationPattern="^[a-zA-Z0-9-_]+$",o.availableConsolidations=["AVG","MIN","MAX","SUM","COUNT"],o.datasourceClassifierList=[],o.closeSheet=function(){n.eql=null,o.datasource={type:"static",triggerNow:!0}},o.createVirtualDatasource=function(){if(function(){o.noChannelsSelected=!1;var e=[];o.availableChannels.forEach(function(t){t.selected&&e.push(t)}),0===e.length&&(o.noChannelsSelected=!0),o.selectedChannels=e}(),!o.createVirtualDatasourceForm.$valid||o.noChannelsSelected)return!1;var t=[];o.availableChannels.forEach(function(e){e.selected&&t.push(e.name)}),o.datasource.channelClassifiers=t,o.isCreating=!0,e.createVirtualDatasource(o.datasource).then(function(e){o.isCreating=!1,s(r("translate")("feedback.messages.created")),i.go("console.datasources.view",{channels:o.datasource.channelClassifiers.toString(),datasourceIds:o.datasource.name})},function(e){l(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message),o.isCreating=!1})},o.selectAllChannels=function(e){e.forEach(function(e){e.selected=!0}),o.noChannelsSelected=!1},o.unSelectAllChannels=function(e){e.forEach(function(e){e.selected=!1})},o.addConsolidation=function(){},o.removeConsolidation=function(e){},function e(a){var n={limit:60};a&&(n.pageToken=a),t.getDatasourceClassifiers(n).then(function(t){var a=t.data;a.items&&a.items.forEach(function(e){"virtual"===e.source&&o.datasourceClassifierList.push(e)}),a.nextPageToken&&e(a.nextPageToken)},function(e){})}(),n.$watch("eql",function(e,a){e?(o.sheetOpen=!0,n.eql&&(n.eql instanceof Array?o.datasource.filter=n.eql.join(" "):o.datasource.filter=n.eql),function e(a,n){o.loadingChannelClassifiers=!0;var i={limit:100};n||(o.availableChannels=[]),a&&(i.pageToken=a),t.getChannelClassifiers(i).then(function(t){t.data.items&&t.data.items.forEach(function(e){"register"!==e.datapointType&&o.availableChannels.push(e)}),t.data.nextPageToken?e(t.data.nextPageToken,!0):o.loadingChannelClassifiers=!1},function(e){o.loadingChannelClassifiers=!1,l(r("translate")("feedback.messages.error"))})}()):o.sheetOpen=!1},!0)}angular.module("ewx-components-create-virtual-datasource").controller("CreateVirtualDatasourceController",e),e.$inject=["VirtualDataSourceService","DataSourceService","feedbackService","$scope","$filter","$state"]}(),function(){function e(){return{scope:{byPassCreate:"=",eql:"="},replace:!0,restrict:"A",controller:"CreateVirtualDatasourceController",controllerAs:"vm",templateUrl:"shared/components/create-virtual-datasource/create-virtual-datasource.html",link:function(e){}}}angular.module("ewx-components-create-virtual-datasource").directive("createVirtualDatasource",e),e.$inject=[]}(),function(){function e(e,t){var a=",";function n(e,t,a){t||(t=0),a||(a={});var r=0;return Object.keys(e).forEach(function(i){!_.isFunction(e[i])&&e[i]instanceof Array&&(e[i].forEach(function(e){n(e,t+1,a)}),a[t]||(a[t]={}),a[t][r]?a[t][r].count+=e[i].length:a[t][r]={count:e[i].length},r++)}),a}function r(e,t){return t||(t=0),Object.keys(e).forEach(function(a){e[a]&&e[a].count?e[a].count>t&&(t=e[a].count):t=r(e[a],t)}),t}angular.isUndefined(e.buttonText)&&(e.buttonText=t("translate")("generic.downloadCsv")),this.generateCSV=function(){var t=e.inputArray;angular.isUndefined(e.fileName)&&(e.fileName="export.csv");var i=function e(t){return t.reduce(function(t,a){return t.concat(Array.isArray(a)?e(a):a)},[])}(function e(t,a){var n=[];t instanceof Array&&t.forEach(function(t){n.push(e(t,a))});t.items&&t.field?a?n.push(e(t.items,a+"."+t.field)):n.push(e(t.items,t.field)):t.field?a?n.push(a+"."+t.field):n.push(t.field):t.v?n.push(e(t.v,a)):t.f&&n.push(e(t.f,a));return n}(t.metadata.fields)),o=function(e,t){var i=[];return e.parsed.forEach(function(e){for(var o=[],s=r(n(e)),l=0;l<s;l++){for(var c=[],u=0;u<t.length;u++)c.push(null);o.push(c)}t.forEach(function(t,i){!function e(t,i,o,s,l){if(i&&t){var c=i.split(".");if(t instanceof Array){var u=0;t.forEach(function(t,a){var c=a+u;e(t,i,o,s,l+c);var d=r(n(t));d>0&&(d-=1),u+=d})}else if(1===c.length){var d=t[c[0]];"string"==typeof d&&d.indexOf(a)>-1&&(d='"'+d+'"'),o[l]||(o[l]=[]),o[l][s]=d}else{var f=c.slice(1,c.length).join(".");e(t[c[0]],f,o,s,l)}}}(e,t,o,i,0)}),i.push(o)}),i}(t,i),s=i.join(a)+"\n";o.forEach(function(e){e.forEach(function(e){s+=e.join(a)+"\n"})});var l="data:text/csv;charset=utf-8,"+s,c=document.createElement("a");c.setAttribute("href",encodeURI(l)),c.setAttribute("download",e.fileName),document.body.appendChild(c),c.click()}}angular.module("ewx-components-csv-export").controller("CsvExportController",e),e.$inject=["$scope","$filter"]}(),function(){function e(){return{scope:{buttonClasses:"@",inputArray:"=",fileName:"@fileName",hrefLink:"@hrefLink",buttonText:"@buttonText",buttonIcon:"=buttonIcon"},restrict:"E",transclude:!0,controller:"CsvExportController",controllerAs:"vm",templateUrl:"shared/components/csv-export/csv-export.html",link:function(e){}}}angular.module("ewx-components-csv-export").directive("csvExport",e),e.$inject=[]}(),function(){function e(e,t,a,n,r,i){var o=this;function s(e,a){t.addMessage({type:a,message:e})}o.newDatasourceClassifier={},o.nameValidationPattern="^[a-zA-Z0-9-_]+$",o.sourceTypes=["physical","virtual"],o.loadingDatasourceClassifierTypes=!0,e.getDatasourceAndUnitTypes().then(function(e){o.loadingDatasourceClassifierTypes=!1;var t=e.data.items;if(t){var a=[];t.forEach(function(e){a.push(e.datasourceType)}),o.availableDatasourceTypes=a}},function(e){o.loadingDatasourceClassifierTypes=!1}),o.createDatasourceClassifier=function(){if(!o.createDatasourceClassifierForm.$valid)return!1;o.isSubmitting=!0,e.createDatasourceClassifier(o.newDatasourceClassifier).then(function(e){o.isSubmitting=!1,s(i("translate")("feedback.messages.created")),a.reloadView&&r.go(r.current,{},{reload:!0})},function(e){s(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message,"error"),o.isSubmitting=!1})}}angular.module("ewx-components-datasource-classifiers-create").controller("DatasourceClassifierCreateController",e),e.$inject=["DataSourceService","feedbackService","$scope","$window","$state","$filter"]}(),function(){angular.module("ewx-components-datasource-classifiers-create").directive("datasourceClassifierCreate",function(){return{scope:{reloadView:"="},replace:!0,restrict:"AE",controller:"DatasourceClassifierCreateController",controllerAs:"vm",templateUrl:"shared/components/datasource-classifier-create/datasource-classifier-create.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r,i,o){var s=this;function l(e,t){a.addMessage({type:t,message:e})}function c(e){l(e,"error")}s.isLoading=!0,s.errorDialog=!1,s.resultLimit=20,s.resultLimitDefault=20,s.listing=[],s.functionToExecuteOnAdd=n.onSelectClassifier(),s.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",s.updateStorageSearchKey=function(){r.sessionStorage.setItem("datasourceClassifierSearchKey",s.filterListing)},r.sessionStorage.getItem("datasourceClassifierSearchKey")&&(s.filterListing=r.sessionStorage.getItem("datasourceClassifierSearchKey")),t.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time),s.userSettings.defaultChunkSize&&(s.resultLimit=parseInt(s.userSettings.defaultChunkSize)||20,s.resultLimitDefault=parseInt(s.userSettings.defaultChunkSize)||20)},function(e){}),function t(a){var n={limit:100};a&&(n.pageToken=a),e.getDatasourceClassifiers(n).then(function(e){var a=e.data;a.items&&a.items.forEach(function(e){s.listing.push(e)}),a.nextPageToken?t(a.nextPageToken):s.isLoading=!1},function(e){s.isLoading=!1,s.errorDialog=!0})}(),s.showMoreResults=function(){s.resultLimit=s.resultLimit+s.resultLimitDefault},s.resetResultLimit=function(){s.resultLimit=s.resultLimitDefault},s.resetFilter=function(){s.filterListing="",s.resultLimit=s.resultLimitDefault,r.sessionStorage.removeItem("datasourceClassifierSearchKey")},s.openDetails=function(e){s.detailSheet=!0,s.editMode=!1,s.deleteDialog=!1,s.selectedClassifierOriginal=angular.copy(e),s.selectedClassifier=angular.copy(e)},s.closeDetails=function(){s.detailSheet=!1},s.toggleEditMode=function(e){s.editMode=!s.editMode,e&&(s.selectedClassifier=angular.copy(s.selectedClassifierOriginal))},s.updateDatasourceClassifier=function(){s.isSaving=!0,e.updateDatasourceClassifier(s.selectedClassifier).then(function(e){s.isSaving=!1,l(o("translate")("feedback.messages.ok")),i.go("console.datasources-classifiers",{},{reload:!0})},function(){s.isSaving=!1,c(o("translate")("feedback.messages.error"))})},s.deleteDatasourceClassifier=function(){s.isDeleting=!0,e.deleteDatasourceClassifier(s.selectedClassifier.name).then(function(e){s.isDeleting=!1,l(o("translate")("feedback.messages.ok")),i.go("console.datasources-classifiers",{},{reload:!0})},function(){s.isDeleting=!1,c(o("translate")("feedback.messages.error"))})},angular.element(r).bind("keydown",function(e){27===e.keyCode&&"console.datasources-classifiers"===i.current.name&&(e.preventDefault(),n.$apply(function(){s.closeDetails()}))}),n.$on("$destroy",function(){angular.element(r).unbind("keydown")})}angular.module("ewx-components-datasource-classifiers-search").controller("DatasourceClassifierSearchController",e),e.$inject=["DataSourceService","UserService","feedbackService","$scope","$window","$state","$filter"]}(),function(){angular.module("ewx-components-datasource-classifiers-search").directive("datasourceClassifierSearch",function(){return{scope:{onSelectClassifier:"&onSelectClassifier"},replace:!0,restrict:"AE",controller:"DatasourceClassifierSearchController",controllerAs:"vm",templateUrl:"shared/components/datasource-classifier-search/datasource-classifier-search.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r){var i,o=this,s=[];function l(e){a.model&&(o.dashboardIndex=a.dashboardIndex,o.widget=a.model,o.widget&&(a.fromCache&&o.widget.configured?function(e){if(o.widget.fromCacheTimeStamp){var t=moment(o.widget.fromCacheTimeStamp).isAfter(moment().subtract(4,"hours"));if(o.widget.refresh&&!e){var n=moment(o.widget.fromCacheTimeStamp).subtract(5,"seconds");t=moment(n).isAfter(moment().subtract(o.widget.refresh.value,o.widget.refresh.unit))}if(t){if(!a.fromCache.results)return a.fromCache=null,void l();o.queryResults=a.fromCache.results,o.metadataQueryResults=a.fromCache.metadata,o.resultAvailable=!0,o.refreshActive=!1}else a.fromCache=null,l()}else a.fromCache=null,l()}(e):o.widget.configured&&m()),a.preview&&(o.preview=!0),o.widget&&o.widget.refresh&&c())}function c(){u();var e=moment.duration(o.widget.refresh.value,o.widget.refresh.unit).asMilliseconds();e<6e4&&(e=6e4),i=r(function(){o.refreshActive=!0,l()},e)}function u(){i&&r.cancel(i)}o.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",o.openWidgetSetup=function(e){e?n.go("console.dashboard",{widgetConfig:o.widget,dashboardIndex:o.dashboardIndex,widgetContent:e}):n.go("console.dashboard",{widgetConfig:o.widget,dashboardIndex:o.dashboardIndex})},o.manualRefresh=function(){if(o.refreshActive)return;o.refreshActive=!0,o.widget&&o.widget.refresh&&c();m()},o.loadMoreResults=function(e){if(!o.isLoading){o.refreshActive=!0;m(!0)}},o.updateWidget=function(e){return e},o.openQuickSettings=function(){o.quickSettingsActive=!0},o.applyQuicksettings=function(e){a.model=e,a.fromCache=null,o.quickSettingsActive=!1,l()},o.exportDownload=function(e){return e},t.getUserSettings().then(function(e){o.userSettings=e,o.userSettings.defaultDateTime&&(o.userDateTimeFormat=o.userSettings.defaultDateTime.date+" "+o.userSettings.defaultDateTime.time)},function(e){}),l(!0),a.$on("$destroy",function(){u()});var d=a.onLoaded();function f(t,a,n){var r={query:t.query,limit:a.limit};a.queryStrings&&a.queryStrings.length>0&&(r.query=function(e,t){return t.forEach(function(t){e.includes("{"+t.key+"}")&&(e=e.replace("{"+t.key+"}",t.value))}),e}(r.query,a.queryStrings)),n&&a.fromCache&&a.fromCache.pageToken?(r.pageToken=a.fromCache.pageToken,r.jobId=a.fromCache.jobId):r.jobId=null,o.refreshActive||(o.isLoading=!0);var i=e.eqlQuery(r);s.push(i),i.then(function(e){e&&e.parsed?(o.resultAvailable=!0,o.metadataQueryResults=e.metadata,n?e.parsed.forEach(function(e){o.queryResults.push(e)}):o.queryResults=e.parsed):(o.resultAvailable=!1,o.queryResults=[],o.metadataQueryResults=null),o.queryResults&&(o.widget.fromCache={},o.widget.fromCache.results=o.queryResults,o.widget.fromCache.metadata=o.metadataQueryResults,o.widget.fromCacheTimeStamp=moment().format(),e.pageToken&&e.more&&(o.widget.fromCache.pageToken=e.pageToken),e.reference&&e.reference.jobId?o.widget.fromCache.jobId=e.reference.jobId:o.widget.fromCache.jobId=null),o.widget.configured=!0},function(e){o.resultAvailable=!0,o.queryResults=[],o.metadataQueryResults=null}).finally(function(){s.splice(s.indexOf(i),1),s.length<=0&&(o.isLoading=!1,o.refreshActive=!1,o.updateWidget(o.queryResults),d&&o.queryResults.length>0&&d())})}function m(e){var t=angular.copy(o.widget),a=(new Date).toISOString(),n=(new Date).toISOString();if("static"===t.period.periodType)a=t.period.static.startTimestamp,n=t.period.static.endTimestamp;else if("dynamic"===t.period.periodType){var r=(new Date).toISOString();t.period.dynamic.end&&t.period.dynamic.end.subtractionValue>0&&(n="future"===t.period.dynamic.end.substractionTense?moment(r).add(t.period.dynamic.end.subtractionValue,t.period.dynamic.end.subtractionUnit).toDate().toISOString():moment(r).subtract(t.period.dynamic.end.subtractionValue,t.period.dynamic.end.subtractionUnit).toDate().toISOString()),a="future"===t.period.dynamic.start.substractionTense?moment(r).add(t.period.dynamic.start.subtractionValue,t.period.dynamic.start.subtractionUnit).toDate().toISOString():moment(r).subtract(t.period.dynamic.start.subtractionValue,t.period.dynamic.start.subtractionUnit).toDate().toISOString(),n<a&&(n=moment(a).add(10,"year").toDate().toISOString())}a=a.slice(0,19),n=n.slice(0,19),o.startDate=a,o.endDate=n,t.queries&&t.queries.forEach(function(e){e.query?(e.query=e.query.replace(/{start_date}/g,a),e.query=e.query.replace(/{end_date}/g,n)):e.query=""}),"timeseries"===t.view.dataType?t.queries.forEach(function(a){f(a,t,e)}):f(t.queries[0],t,e)}a.$watch("vm.isLoading",function(){o.widget.isLoading=o.isLoading}),a.$on("applySettings",function(){m()})}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetController",e),e.$inject=["QueryService","UserService","$scope","$state","$interval"]}(),function(){function e(){return{scope:{model:"=",dashboardIndex:"@",preview:"@",fromCache:"=",onLoaded:"&onLoaded",fullScreen:"="},replace:!0,restrict:"A",controller:"DashboardWidgetController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/dashboard-widget.html"}}angular.module("ewx-components-dashboard-widget").directive("dashboardWidget",e),e.$inject=[]}(),function(){function e(e,t){var a=this;a.startTime=e.startTime,a.endTime=e.endTime,a.timezone=e.timezone,a.changeDateRangeFn=function(){e.startTime=a.startTime,e.endTime=a.endTime,e.timezone=a.timezone,r(),t.go(".",{endTime:a.endTime,startTime:a.startTime,timezone:a.timezone},{notify:!1}),n(a.startTime,a.endTime)},a.handheldtoggle=r;var n=e.changeDateRange();function r(){a.handheldOpen=!a.handheldOpen}e.$watch("timezone",function(){_.isUndefined(e.timezone)||e.timezone===a.timezone||(a.timezone=e.timezone)})}angular.module("ewx-components-datasource-navigator").controller("DatasourceNavigatorController",e),e.$inject=["$scope","$state"]}(),function(){angular.module("ewx-components-datasource-navigator").directive("datasourceNavigator",function(){return{scope:{loading:"=",startTime:"=",endTime:"=",changeDateRange:"&",timezone:"="},replace:!0,restrict:"AE",controller:"DatasourceNavigatorController",controllerAs:"vm",templateUrl:"shared/components/datasource-navigator/datasource-navigator.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r,i){var o=this;o.noData=!1,o.noTags=!1,o.validationPattern="^[a-zA-Z0-9-_]+$",o.showRemovedTags=!1,o.redrawProperties=a.redraw,o.mutatedTagNames=[],o.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",o.checkIfDate=function(e,t){return a=e,n=t,moment(a,n,!0).isValid();var a,n};var s=a.onFinished();function l(e,t){if(e&&e.tags){o.tags=angular.copy(e.tags);o.excludeTagsWithName&&o.excludeTagsWithName.forEach(function(e){for(var t=o.tags.length-1;t>=0;t--)o.tags[t].tag.toLowerCase()===e.toLowerCase()&&o.tags.splice(t,1)}),o.excludeTagsWithDescription&&o.excludeTagsWithDescription.forEach(function(e){for(var t=o.tags.length-1;t>=0;t--)o.tags[t].description&&o.tags[t].description.toLowerCase()===e.toLowerCase()&&o.tags.splice(t,1)}),c(t),o.tagRowCount=Math.ceil(o.activeTags.length/3),o.getTagRowCount=function(e){return new Array(e)},o.getTagRowItems=function(e){return o.activeTags.slice(3*e,3*(e+1))}}o.channelProperties={},e&&e.channels&&e.channel_properties&&e.channels.forEach(function(t){e.channel_properties.forEach(function(e){e.channel_id===t.id&&(o.channelProperties[t.id]||(o.channelProperties[t.id]=[]),o.channelProperties[t.id].push(e))})})}function c(e){if(o.tags){o.tags.sort(u),o.tags.forEach(function(e){e.properties&&e.properties.length>0&&e.properties.sort(function(e,t){var a=0;return e.key<t.key&&(a=-1),e.key>t.key&&(a=1),a})});for(var t=o.tags.length-1;t>=0;t--)o.tags[t].validFrom&&new Date(o.tags[t].validFrom)>new Date("1900-01-01T00:00:00.000Z")&&(o.tags[t].showDate=!0),o.tags[t].properties&&o.tags[t].properties.length>o.propertyLimit&&(o.tags[t].moreProperties=!0);o.activeTags=[],o.groupedTagsByTagName=_.groupBy(o.tags,"tag"),a.showVersions?Object.keys(o.groupedTagsByTagName).forEach(function(t){var a=angular.copy(o.groupedTagsByTagName[t]);a&&a.length>0&&function(e,t){"version"===e&&t.sort(function(e,t){return e=new Date(e.version),(t=new Date(t.version))-e});"validFrom"===e&&t.sort(function(e,t){return e=new Date(e.validFrom),(t=new Date(t.validFrom))-e})}("version",a);var n=a.filter(function(e){return new Date(e.validFrom)<new Date}).sort(function(e,t){return new Date(t.version)-new Date(e.version)}),r=null;n.length>0&&((r=n[0]).currentActive=!0),r&&((e||!e&&!r.removed)&&o.activeTags.push(r),r.removed&&(o.removedTagsAvailable=!0))}):o.tags.forEach(function(e,t){e.removed||o.activeTags.push(e)})}}function u(e,t){var a=e.tag.toUpperCase(),n=t.tag.toUpperCase(),r=0;return a>n?r=1:a<n&&(r=-1),r}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t&&t.length<=0||e.tagsGetAll(t).then(function(e){e.data&&e.data.datasources.length>0&&(o.datasource=e.data.datasources[0],o.originalDatasource=angular.copy(o.datasource)),o.confirmDeleteTagDialog=!1,c(),function(e,t){if(e&&t){var a=i.localStorage.getItem("ewxCollectedDatasources");(a=JSON.parse(a))&&(a.forEach(function(a){a.id===e&&(a.tags=t)}),i.localStorage.setItem("ewxCollectedDatasources",JSON.stringify(a)))}}(o.datasource.id,o.datasource.tags),s&&s(o.datasource,o.datasource.tags),f(n("translate")("feedback.messages.ok")),l(o.datasource),o.addTagModeActive=!1,o.editModeActive=!1,o.addTaggLoading=!1,o.showRemovedTags=!1,o.isSaving=!1},function(e){})}function f(e,a){t.addMessage({type:a,message:e})}function m(e){f(e,"error")}o.newTag={properties:[],validFrom:moment.utc().format("YYYY-MM-DDTHH:mm:ss.SSS")},a.excludeTagsWithName&&(o.excludeTagsWithName=a.excludeTagsWithName),a.editModeActive&&(o.editModeActive=a.editModeActive),a.showEditButton&&(o.showEditButton=a.showEditButton),a.excludeTagsWithDescription&&(o.excludeTagsWithDescription=a.excludeTagsWithDescription),a.propertyLimit?o.propertyLimit=a.propertyLimit:o.propertyLimit=7,a.model?((!a.model.tags||a.model.tags&&0===a.model.tags.length)&&(o.noTags=!0),o.datasource=a.model,o.originalDatasource=angular.copy(a.model),l(o.datasource)):o.noData=!0,r.getUserSettings().then(function(e){o.userSettings=e,o.userSettings.defaultDateTime&&(o.userDateTimeFormat=o.userSettings.defaultDateTime.date+" "+o.userSettings.defaultDateTime.time)},function(e){}),o.toggleRemovedTags=function(e){e?(l(o.datasource,!0),o.showRemovedTags=!0):(l(o.datasource),o.showRemovedTags=!1)},o.switchEditMode=function(){o.editModeActive?a.propertyLimit?o.propertyLimit=a.propertyLimit:o.propertyLimit=7:o.propertyLimit=100,l(o.datasource,o.showRemovedTags),o.editModeActive=!o.editModeActive},o.switchAddTagMode=function(){o.addTagModeActive=!o.addTagModeActive,o.tagAlreadyExists=!1,o.newTag={name:"",description:"",properties:[]},o.newTagPropertyKey="",o.newTagPropertyValue=""},o.propertyChanged=function(e){o.mutatedTagNames.push(e.tag)},o.deleteProperty=function(e,t){e.properties.splice(t,1),o.mutatedTagNames.push(e.tag)},o.addProperty=function(e,t,a){if(a.duplicateKey=!1,a&&a.$invalid)return a.submitted=!0,!1;if(function(e,t){var a=!1;e&&e.forEach(function(e){e.key===t&&(a=!0)});return a}(e.properties,t.key))return a.duplicateKey=!0,a.submitted=!0,!1;var n=angular.copy(t);e.properties||(e.properties=[]),e.properties.push(n),e.addProperty=!e.addProperty,o.mutatedTagNames.push(e.tag)},o.cancelUpdateTags=function(){s&&s(o.datasource),o.tags=angular.copy(o.originalDatasource.tags),o.tags.sort(u),o.mutatedTagNames=[],o.switchEditMode()},o.updateTags=function(){o.isSaving=!0;var t=[];if(new Set(o.mutatedTagNames).forEach(function(e){o.activeTags.forEach(function(a){e===a.tag&&(delete a.version,delete a.removed,delete a.showLimit,delete a.addProperty,delete a.editValidFrom,a.validFrom=moment.utc(a.validFrom).format("YYYY-MM-DDTHH:mm:ss.SSS"),t.push(a))})}),0===t.length)return o.noChangesDetected=!0,void(o.isSaving=!1);var a=[{datasourceId:o.datasource.id,tags:t}];e.updateTags(a).then(function(e){d([o.datasource.id])},function e(){o.isSaving=!1,o.mutatedTagNames=Array.from(o.mutatedTagNames),e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")"):m(n("translate")("feedback.messages.error"))})},o.newTagAddProperty=function(){var e;o.addTagkeyAlreadyExists=!1,o.newTag.properties.forEach(function(t){t.key===o.newTagPropertyKey&&(e=!0)}),e?o.addTagkeyAlreadyExists=!0:o.newTagPropertyKey&&o.newTagPropertyValue&&!o.newTagPropertyCheck.keyInput.$error.pattern?(o.newTag.properties.push({key:o.newTagPropertyKey,value:o.newTagPropertyValue}),o.newTagPropertyHasErrors=!1,o.newTagPropertyKey="",o.newTagPropertyValue=""):o.newTagPropertyHasErrors=!0},o.newTagDeleteProperty=function(e){o.newTag.properties.splice(e,1)},o.checkTagName=function(){o.tagAlreadyExists=!1,o.newTag.name&&o.datasource.tags&&o.datasource.tags.length>0&&o.datasource.tags.forEach(function(e){e.tag===o.newTag.name.toLowerCase()&&(o.tagAlreadyExists=!0)})},o.addTag=function(t){if(!o.addTagForm.$valid||o.tagAlreadyExists)return!1;if(0===o.newTag.properties.length)return o.noProperties=!0,!1;o.addTaggLoading=!0;var a={properties:o.newTag.properties,tag:o.newTag.name.toLowerCase(),description:o.newTag.description,validFrom:moment.utc(o.newTag.validFrom).format("YYYY-MM-DDTHH:mm:ss.SSS")},r=[{datasourceId:o.datasource.id,tags:[a]}];e.addTags(r).then(function(){o.noTags=!1,d(o.datasource.id)},function(e){o.addTaggLoading=!1,e.data&&e.data.error?m(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")"):m(n("translate")("feedback.messages.error"))})},o.toggleDeleteTagDialog=function(e){e&&(o.tagToDelete=e,o.tagToDelete.validFrom=moment.utc().format("YYYY-MM-DDTHH:mm:ss.SSS")),o.confirmDeleteTagDialog=!o.confirmDeleteTagDialog},o.confirmDeleteTag=function(t,a){a.validFrom=moment.utc(a.validFrom).format("YYYY-MM-DDTHH:mm:ss.SSS");var r=[{datasourceId:t,tags:[a]}];o.deleteTagLoading=!0,e.removeTags(r).then(function(){o.deleteTagLoading=!1,o.datasource.tags.forEach(function(e,t){a.tag===e.tag&&o.datasource.tags.splice(t,1)}),o.mutatedTagNames=[],d(o.datasource.id)},function(e){o.deleteTagLoading=!1,o.toggleDeleteTagDialog(),e.data&&e.data.error&&e.data.error.message?m(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")"):m(n("translate")("feedback.messages.error"))})},o.toggleTagTimelineDialog=function(e){o.selectedTagVersions=e,o.showTagTimeLine=!o.showTagTimeLine},a.$watch("redraw",function(){a.redraw&&(a.redraw=!1,l(o.datasource))}),a.$watch("vm.newTag.properties",function(){o.newTag.properties.length>0&&(o.noProperties=!1)},!0)}angular.module("ewx-components-datasource-properties").controller("DatasourcePropertiesController",e),e.$inject=["TagService","feedbackService","$scope","$filter","UserService","$window"]}(),function(){function e(){return{scope:{model:"=",excludeTagsWithName:"=",excludeTagsWithDescription:"=",showVersions:"=",redraw:"=",editModeActive:"=",showEditButton:"=",propertyLimit:"@",onFinished:"&"},replace:!0,restrict:"A",controller:"DatasourcePropertiesController",controllerAs:"vm",templateUrl:"shared/components/datasource-properties/datasource-properties.html",link:function(e){}}}angular.module("ewx-components-datasource-properties").directive("datasourceProperties",e),e.$inject=[]}(),function(){function e(e,t,a,n){var r=this;function i(){r.noChannelsSelected=!1;var e=[];r.availableChannels.forEach(function(t){t.selected&&e.push(t)}),0===e.length&&(r.noChannelsSelected=!0),r.selectedChannels=e}function o(){t.selectedDatasources=null}function s(e){r.tab=e,1===r.tab&&(r.userSettings&&r.userSettings.defaultDateRangeTimeseries&&r.userSettings.defaultDateRangeTimeseries.backward.timespan?r.startTime=moment.tz(r.timezone).startOf("day").add(1,"day").subtract(r.userSettings.defaultDateRangeTimeseries.backward.amount,r.userSettings.defaultDateRangeTimeseries.backward.timespan).format():r.startTime=moment.tz(r.timezone).startOf("day").add(1,"day").subtract(1,"month").format(),r.userSettings&&r.userSettings.defaultDateRangeTimeseries&&r.userSettings.defaultDateRangeTimeseries.forward.timespan?r.endTime=moment.tz(r.timezone).startOf("day").add(1,"day").add(r.userSettings.defaultDateRangeTimeseries.forward.amount,r.userSettings.defaultDateRangeTimeseries.forward.timespan).format():r.endTime=moment.tz(r.timezone).startOf("day").add(1,"day").add(1,"month").format())}function l(e){return r.tab===e}r.availableChannels=[],r.timeFrameOptions=["hours","days","weeks","months","years"],r.timeFrameValue=30,r.selectedTimeSpan="days",r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.closeSheet=o,r.selectAllChannels=function(){r.availableChannels.forEach(function(e){e.selected=!0}),r.noChannelsSelected=!1},r.unSelectAllChannels=function(){r.availableChannels.forEach(function(e){e.selected=!1})},r.createView=function(){if(i(),!r.createViewForm.$valid||r.noChannelsSelected)return!1;if(r.timezone=r.selectedDatasources[0].timezone,l(2)){var e=r.timeFrameValue,t=r.selectedTimeSpan;r.startTime=moment().tz(r.timezone).subtract(e,t).format(),r.endTime=moment().tz(r.timezone).format()}var n=[];r.selectedChannels.forEach(function(e){n.push(e.classifier)});var o=[];r.selectedDatasources.forEach(function(e){o.push(e.id)}),a.go("console.datasources.view",{channels:n.toString(),datasourceIds:o.toString(),startTime:r.startTime,endTime:r.endTime,timezone:r.timezone})},r.checkChannelSelection=i,r.setTab=s,r.tabIsSet=l,r.isLoading=!0,e.getUserSettings().then(function(e){r.isLoading=!1,r.userSettings=e,s(1)},function(e){r.isLoading=!1,s(1)}),t.$watch("selectedDatasources",function(e,a){var n,i;e?(r.sheetOpen=!0,r.selectedDatasources=t.selectedDatasources,n=r.selectedDatasources,i=[],n.forEach(function(e){e.channels&&e.channels.forEach(function(e){e&&!e.classifier.toUpperCase().endsWith("_HEARTBEAT")&&i.push(e)})}),r.availableChannels=function(e,t){for(var a=[],n=[],r=void 0,i=0;i<e.length;i++)r=e[i][t],-1===n.indexOf(r)&&(a.push(e[i]),n.push(r));return a}(i,"classifier")):r.sheetOpen=!1},!0),angular.element(n).bind("keydown",function(e){27===e.keyCode&&(e.preventDefault(),t.$apply(function(){o()}))}),t.$on("$destroy",function(){angular.element(n).unbind("keydown")})}angular.module("ewx-components-datasource-view-configurator").controller("DatasourceViewConfiguratorController",e),e.$inject=["UserService","$scope","$state","$window"]}(),function(){function e(){return{scope:{selectedDatasources:"="},replace:!0,restrict:"A",controller:"DatasourceViewConfiguratorController",controllerAs:"vm",templateUrl:"shared/components/datasource-view-configurator/datasource-view-configurator.html"}}angular.module("ewx-components-datasource-view-configurator").directive("datasourceViewConfigurator",e),e.$inject=[]}(),function(){function e(e,t,a,n){var r=this;a.datetimeFormat=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i;var i=e.getTimezones();r.showpicker=!1,r.allCountries=c(),a.timezone?(r.providedTimezone=a.timezone,r.selectedTimeZone=a.timezone):r.selectedTimeZone="UTC",a.maxView?r.maxView=a.maxView:r.maxView="hour",a.datetime?r.datetime=moment.utc(a.datetime).tz(r.selectedTimeZone).set({second:0,millisecond:0}).format():r.datetime=moment.utc().tz(r.selectedTimeZone).set({second:0,millisecond:0}).format();var o=window.localStorage.getItem("datetimepicker.selectedCountry");if(r.selectedCountry=o||"US",r.availableTimezones=d(r.selectedCountry),!r.selectedTimeZone){var s=window.localStorage.getItem("datetimepicker.selectedTimeZone");r.selectedTimeZone=s||r.availableTimezones[0].name}function l(){a.changeDetected()}function c(e,t){if(e&&Object.keys(e).length>0){var a={};return Object.keys(i.countries).forEach(function(t){Object.keys(e).forEach(function(e){t===e&&(a[t]=i.countries[t])})}),t&&(a[t]=i.countries[t]),a.UTC||(a.UTC=i.countries.UTC),a}return i.countries}function u(){return i.timezones}function d(e){var t=void 0;t=r.userSettings&&r.userSettings.selectedTimezones&&!r.userSettings.selectedTimezones[e]?c(r.userSettings.selectedTimezones,e):r.userSettings&&r.userSettings.selectedTimezones?c(r.userSettings.selectedTimezones):c(),r.allCountries=t;var a=u();return((t[e]||{}).timezones||[]).map(function(e){return a[e]})}function f(e){var t=u();if(t[e]&&t[e].countries)return t[e].countries}t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),r.userSettings.selectedTimezones&&(r.allCountries=c(r.userSettings.selectedTimezones))},function(e){}),r.datetimePickerChange=function(e,t){r.providedTimezone?r.datetimePickerPreview=moment(e).tz(r.providedTimezone).set({second:0,millisecond:0}).format():r.selectedTimezone?r.datetimePickerPreview=moment(e).tz(r.selectedTimezone).set({second:0,millisecond:0}).format():r.datetimePickerPreview=moment(e).utc().set({second:0,millisecond:0}).format()},r.directInputChangeDetected=function(){l()},r.updateTimeZones=function(e){r.availableTimezones=d(e),r.selectedTimeZone=r.availableTimezones[0].name},r.toggleTimeZoneSelector=function(){r.showTimeZoneSelector=!0;var e=[];r.providedTimezone?e=f(r.providedTimezone):r.selectedTimezone?e=f(r.selectedTimezone):(r.selectedTimezone=moment.tz.guess(),e=f(r.selectedTimezone)),e&&e.length>0?r.selectedCountry=e[0]:r.selectedCountry=r.allCountries[0].id,r.providedTimezone=null,r.updateTimeZones(r.selectedCountry)},r.openDateTimePicker=function(){r.disabled||(r.showpicker=!0)},r.closeDateTimePicker=function(e){e&&(r.providedTimezone=a.timezone),r.showpicker=!1,r.showTimeZoneSelector=!1},r.applyDateTime=function(e){e?(l(),"UTC"===r.selectedTimeZone?r.datetime=moment(e).set({second:0,millisecond:0}).format("YYYY-MM-DDTHH:mm:ss")+"Z":r.datetime=moment(e).set({second:0,millisecond:0}).tz(r.selectedTimeZone).format(),n.localStorage.setItem("datetimepicker.selectedCountry",r.selectedCountry),n.localStorage.setItem("datetimepicker.selectedTimeZone",r.selectedTimeZone),r.closeDateTimePicker()):r.closeDateTimePicker()},a.$watch("timezone",function(){_.isUndefined(a.timezone)||a.timezone===r.selectedTimeZone||(r.providedTimezone=a.timezone,r.selectedTimeZone=a.timezone,r.datetime&&(r.datetimePickerPreview=moment(r.datetime).tz(r.providedTimezone).set({minute:0,second:0,millisecond:0}).format()))}),a.$watch("vm.datetime",function(){a.datetime=r.datetime,r.datetimePickerValue=moment(a.datetime).tz(r.selectedTimeZone).set({minute:0,second:0,millisecond:0}).format()}),a.$watch("submitted",function(){r.submitted=a.submitted}),a.$watch("disabled",function(){r.disabled=a.disabled}),r.providedTimezone?r.datetimePickerPreview=moment(r.datetime).tz(r.providedTimezone).set({minute:0,second:0,millisecond:0}).format():r.datetimePickerPreview=moment(r.datetime).tz(r.selectedTimeZone).set({minute:0,second:0,millisecond:0}).format()}angular.module("ewx-components-datetime-zone").controller("DateTimeZoneController",e),e.$inject=["TimezonesService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-datetime-zone").directive("datetimeZone",function(){return{scope:{id:"@",size:"@",invert:"=",datetime:"=",requiredDateTime:"=",timezone:"=",submitted:"=",disabled:"=",changeDetected:"&",maxView:"@"},replace:!0,restrict:"AE",controller:"DateTimeZoneController",controllerAs:"vm",templateUrl:"shared/components/datetime-zone/datetime-zone.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;function i(t){var n={limit:100};t&&(n.pageToken=t),e.listDecisionTrees(n).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){a.decisionTreeTypes&&Array.isArray(a.decisionTreeTypes)?a.decisionTreeTypes.forEach(function(t){t===e.decisionTreeType&&r.listing.push(e)}):r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.validationPattern="^[A-Z0-9-_]+$",r.updateStorageSearchKey=function(){n.sessionStorage.setItem("decisionTreeSearchKey",r.filterListing)},n.sessionStorage.getItem("decisionTreeSearchKey")&&(r.filterListing=n.sessionStorage.getItem("decisionTreeSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("decisionTreeSearchKey")};var o=a.onClickSelect();r.onClickSelect=function(e){o&&o(e)}}angular.module("ewx-components-decision-tree-search").controller("DecisionTreeSearchController",e),e.$inject=["DecisionTreeService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-decision-tree-search").directive("decisionTreeSearch",function(){return{scope:{onClickSelect:"&onClickSelect",enableClickSelect:"@",decisionTreeTypes:"="},replace:!0,restrict:"AE",controller:"DecisionTreeSearchController",controllerAs:"vm",templateUrl:"shared/components/decision-tree-search/decision-tree-search.html",link:function(e){}}})}(),function(){function e(e,t,a){var n=this,r=e.getTcmFunctions(),i=e.getTcmValueTypes();if(r.length>0){var o=[];r.forEach(function(e){"split"!==e&&"composite"!==e&&"generate_id"!==e&&o.push(e)}),n.functionList=o}function s(){if("column"===n.column.pillType&&n.column.field)n.column.valid=!0;else if("static"===n.column.pillType&&n.column.staticValue)n.column.valid=!0;else if(("merge"===n.column.pillType||"composite"===n.column.function)&&n.column.fields.length>0&&(n.column.key||n.column.field))n.column.valid=!0;else if("split"===n.column.pillType){if(n.column.functionParams&&n.column.functionParams.length>0)n.column.functionParams.filter(function(e){return"separator"===e.key})[0].value&&(n.column.valid=!0);else n.column.valid=!1}else"generateId"===n.column.pillType?(n.column.function="generate_id",(n.column.key||n.column.field)&&(n.column.valid=!0)):n.column.valid=!1}function l(){s(),t.model=n.column}n.valueTypeList=i,n.column={},n.validatePill=s,t.model&&(n.column=t.model,n.column.pillType=n.column.pillType?n.column.pillType:function(e){e.hasOwnProperty("staticValue")||e.staticValue?(e.pillType="static",e.value=e.staticValue):e.hasOwnProperty("function")&&"composite"===e.function?(e.pillType="merge",e.fields=e.fields?e.fields:[],e.field.split(",").forEach(function(t){e.fields.push({field:t})})):e.hasOwnProperty("function")&&"split"===e.function?(e.pillType="split",e.fields=e.fields?e.fields:[{field:e.field}],e.keys=!e.keys&&e.key?e.key.split(","):[]):e.hasOwnProperty("function")&&"generate_id"===e.function?e.pillType="generateId":e.pillType="column";return e.pillType}(n.column),n.column.staticValue=n.column.staticValue?n.column.staticValue:"",n.column.key=n.column.key?n.column.key:"",n.column.fields=n.column.fields?n.column.fields:[],n.column.field=n.column.field?n.column.field:"",n.column.function=n.column.function?n.column.function:"",n.column.preview=n.column.preview?n.column.preview:[],n.column.functionParams=n.column.functionParams?n.column.functionParams:[],n.column.type=n.column.type?n.column.type:"string",n.column.valid=!1),t.key&&(n.key=t.key,n.column.field||(n.column.field=t.key)),t.timestamp&&(n.isTimestamp=t.timestamp,n.column.function||(n.column.function="to_date"),0===n.column.functionParams.length&&(n.column.functionParams=[{key:"dateformat",value:"%Y-%m-%d %H:%M:%S"}])),t.name&&(n.name=t.name),t.preview&&(n.preview=t.preview),s(),n.staticValueChange=function(e,t){n.column.valid=!1,e.$valid&&t?n.column.valid=!0:n.staticValueForm.$valid?n.column.valid=!0:n.column.valid=!1},n.removePill=function(){t.removeAction&&t.removeAction()},n.dropInMerge=function(e,t,a,r,i){n.column&&n.column.fields&&(n.column.fields.splice(e,0,t),n.column.field=n.column.fields.map(function(e){return e.field}).join(","),l())},n.dropInSplit=function(e,t,a,r,i){n.column&&n.column.fields&&(n.column.field=t.field,n.column.fields=[t],l())},n.defineField=function(){if(!(n.column.key&&n.column.key.length>0)&&n.column.fields&&n.column.fields[0].preview){for(var e=n.column.fields[0].preview[0].split(n.column.functionParams[0].value),t=[],a=0;a<e.length;a++)t.push(n.column.fields[0].field+"_"+a);n.column.keys=t,l()}},n.addToField=function(){var e=n.column.key.split(",");e&&1===e.length&&""===e[0]&&(e=[]);for(var t=n.column.fields[0].field+"_",a=e.length;e.indexOf(t+a)>-1;)a++;e.push(t+a),n.column.keys=e,n.column.key=e.join(","),l()},n.modifyField=function(e,t,a){if(t){var r=n.column.keys;r[e]=t,n.column.keys=r,n.column.key=n.column.keys.join(","),l()}},n.removeFromField=function(e){var t=n.column.keys.indexOf(e);n.column.keys.splice(t,1),n.column.key=n.column.keys.join(","),l()},n.toggleEditFunction=function(e){e.editFunction=!e.editFunction},n.removeFunctionParam=function(e,t){n.column.functionParams.splice(t,1)},angular.element(a).bind("keydown",function(e){27===e.keyCode&&(e.preventDefault(),n.column.editFunction=!1,t.$apply())}),t.$on("$destroy",function(){angular.element(a).unbind("keydown")})}angular.module("ewx-components-drag-pill").controller("DragPillController",e),e.$inject=["ConstantsService","$scope","$window"]}(),function(){function e(){return{scope:{single:"=",name:"@",preview:"@",removeAction:"&",model:"=",timestamp:"=",key:"@"},restrict:"AE",controller:"DragPillController",controllerAs:"vm",templateUrl:"shared/components/drag-pill/drag-pill.html"}}angular.module("ewx-components-drag-pill").directive("dragPill",e),e.$inject=[]}(),function(){function e(e,t,a){return{restrict:"A",link:function(n,r,i,o){var s,l,c,u,d=!0,f=5,m=!1,g=a(i.onDragStart),p=a(i.onDragEnd),h=i.axis||!1,v=i.dragScrollExcludedClasses?i.dragScrollExcludedClasses.split(","):[];function S(a){if(d){for(var r=0;r<v.length;r++)if(angular.element(a.target).hasClass(v[r]))return!1;n.$apply(function(){g(n)}),angular.element(t).on("mouseup",w),angular.element(t).on("mousemove",T),m=!0,c=s=a.clientX,u=l=a.clientY,t.getSelection?t.getSelection().empty?t.getSelection().empty():t.getSelection().removeAllRanges&&t.getSelection().removeAllRanges():e.selection&&e.selection.empty(),a.preventDefault(),a.stopPropagation()}}function w(e){if(d){var a=e.target.attributes&&"drag-scroll-text"in e.target.attributes,r=e.clientX>=s-f&&e.clientX<=s+f,i=e.clientY>=l-f&&e.clientY<=l+f;m=!1,a&&r&&i&&(o=e.target,t.document.selection?((c=t.document.body.createTextRange()).moveToElementText(o),c.select()):t.getSelection&&((c=t.document.createRange()).selectNode(o),t.getSelection().addRange(c))),n.$apply(function(){p(n)}),angular.element(t).off("mouseup",w),angular.element(t).off("mousemove",T)}var o,c}function T(e){d&&(m&&(h&&"x"!==h||(r[0].scrollLeft-=-c+(c=e.clientX)),h&&"y"!==h||(r[0].scrollTop-=-u+(u=e.clientY))),e.preventDefault())}n.$watch(i.dragScroll,function(e){d=!angular.isDefined(e)||e}),r.on("mousedown",S),n.$on("$destroy",function(){r.off("mousedown",S),angular.element(t).off("mouseup",w),angular.element(t).off("mousemove",T)})}}}angular.module("ewx-components-drag-scroll",[]).directive("dragScroll",e),e.$inject=["$document","$window","$parse"]}(),function(){function e(){this.docsUrl="/docs-eql"}angular.module("ewx-components-eql-docs").controller("EqlDocsController",e),e.$inject=[]}(),function(){angular.module("ewx-components-eql-docs").directive("eqlDocs",function(){return{scope:{},restrict:"AE",controller:"EqlDocsController",controllerAs:"vm",templateUrl:"shared/components/eql-docs/eql-docs.html",link:function(e){}}})}(),angular.module("ewx-components-eql-wizard").constant("eqlConstants",{chunkSizeOptions:[10,20,30,40,50,60,70,80,90,100],dataList:[{type:"datasource",name:"Datasource",visualizations:[{type:"list",name:"List"},{type:"statistic",name:"Statistic"},{type:"map",name:"Map"},{type:"table",name:"Table"}]},{type:"flow",name:"Flow",visualizations:[{type:"list",name:"List"},{type:"statistic",name:"Statistic"},{type:"table",name:"Table"}]},{type:"auditEvents",name:"Audit Events",visualizations:[{type:"list",name:"List"},{type:"statistic",name:"Statistic"},{type:"table",name:"Table"}]},{type:"timeseries",name:"Timeseries",visualizations:[{type:"chart",name:"Chart"},{type:"table",name:"Table"},{type:"aggregatedTable",name:"Aggregated Table"}]},{type:"generic",name:"Generic",visualizations:[{type:"list",name:"List"},{type:"statistic",name:"Statistic"},{type:"chart",name:"Chart"},{type:"table",name:"Table"}]}],visualizationConfiguration:{list:{configurations:[]},statistic:{configurations:[{key:"thresholdOperator",name:"Threshold Operator",type:"external",operatorList:["=","<",">","<=",">="]},{key:"thresholdValue",name:"Threshold Value",type:"external"}]},map:{configurations:[]},chart:{configurations:[{key:"datasourceId",name:"Datasource Id",type:"internal"}]},aggregatedTable:{configurations:[{key:"aggregationPeriod",name:"Aggregation Period",type:"external",values:[{name:"Day",value:"day"},{name:"Month",value:"month"},{name:"Year",value:"year"}]}]}},operatorList:["=","<",">","<=",">="],timeFrameOptions:["hours","days","weeks","months","years"],refreshIntervalOptions:["minutes","hours"]}).constant("exampleQueries",[{title:"titleSuccessfulFlowsSince",description:"descriptionSuccessfulFlowsSince",query:"SELECT *  \nFROM flow_metadata, UNNEST(properties) as props  \nWHERE props.key = 'completed'  \nAND props.value = 'True'  \nAND flow_timestamp > '{start_date}'"},{title:"titleSuccessfulFlowsToday",description:"descriptionSuccessfulFlowsToday",query:"SELECT COUNT(flow_id) as Successful_flows  \nFROM flow_metadata, UNNEST(properties) as props  \nWHERE props.key = 'completed'  \nAND props.value IN ('True')  \nAND CAST(flow_timestamp AS DATETIME) > DATETIME_TRUNC(CURRENT_DATETIME(), DAY)  "},{title:"titleDatasourcesAddedSince",description:"descriptionDatasourcesAddedSince",query:"SELECT *   \nFROM datasources  \nWHERE version >= '{start_date}'"}]),function(){function e(e,t,a,n,r,i,o,s,l,c,u,d){var f=this,m=o.onTestFunction,g=a.getEqlHints();CodeMirror.defineMIME("text/x-eql",g);var p={mode:"text/x-eql",extraKeys:{"Ctrl-Space":"autocomplete"},hint:CodeMirror.hint.sql,hintOptions:{tables:{}}};function h(){if(f.tab=2,f.chunkSizeOptions=e.chunkSizeOptions,f.operatorList=e.operatorList,f.timeFrameOptions=e.timeFrameOptions,f.refreshIntervalOptions=e.refreshIntervalOptions,f.dataList=e.dataList,f.visualizationConfiguration=e.visualizationConfiguration,f.futurePastOptions=["past","future"],o.configObject){if(f.model=o.configObject,f.model.period&&f.model.period.dynamic&&(f.model.period.dynamic.end||(f.model.period.dynamic.end={subtractionValue:0,subtractionUnit:"days",subtractionTense:"future"})),"statistic"!==f.model.view.type||f.model.view.colors||(f.model.view.colors=[{color:"green",value:0,active:!1},{color:"yellow",value:0,active:!1},{color:"red",value:0,active:!1}]),f.model.view.dataOptions){var t=Array.from(new Set(f.model.view.dataOptions.map(JSON.stringify))).map(JSON.parse);f.model.view.dataOptions=t;var a=f.model.view.dataOptions.filter(function(e){return"datasourceId"===e.key});if(a&&a.length>0)f.model.view.dataOptions.forEach(function(e){"datasourceId"===e.key&&(f.combinedViewDatasource=e.value)});var n=f.model.view.dataOptions.filter(function(e){return"sourceChannels"===e.key});if(n&&n.length>0&&n[0].value&&n[0].value.length>0){var i=n[0].value.filter(function(e){return null!==e});n[0].value=i}}o.recipes&&(f.recipes=o.recipes),f.hideStartEndControls=!1,f.model.queries&&f.model.queries.forEach(function(e){e.validDynamicTimestamps=C(e.query)})}f.advancedQueryOptions={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!0,readOnly:!1,mode:"text/x-eql",extraKeys:{"Ctrl-Space":"autocomplete"},hint:CodeMirror.hint.sql,hintOptions:{tables:{}},theme:"ewx-dark",onLoad:function(e){e.on("change",function(){c(function(){T()},200)})}},r.eqlMetadata().then(function(e){var t={};e&&e.data&&e.data.tables&&(e.data.tables.forEach(function(e){var a=[];t[e.name]||(e.fields.forEach(function(e){-1===a.indexOf(e.field)&&a.push(e.field)}),t[e.name]=a)}),f.metadata=e.data.tables),angular.extend(p.hintOptions.tables,t)},function(e){})}f.stringReplacementKeyPattern="^[a-zA-Z0-9-_]+$",f.combinedViewDatasource="",f.init=h,f.checkEqlQuery=T,f.setTab=S,f.tabIsSet=function(e){return f.tab===e},f.applyRecipe=function(e){e.isRecipe=!0,v&&(v(e),h());S(2)},f.deleteRecipe=function(e){f.recipes.splice(e,1),f.isDeletingRecipe=!0;var t={id:active_namespace_id,properties:[{key:"dashboardrecipes",value:JSON.stringify(f.recipes)}]};i.updateNamespaceProperties(t).then(function(e){f.isDeletingRecipe=!1},function(){(function(e,t){n.addMessage({type:t,message:e})})(u("translate")("feedback.messages.error"),"error"),f.isDeletingRecipe=!1})},f.setTimeFrame=function(){if(!f.editTimeframeForm.$valid)return!1;f.editTimeFrame=!f.editTimeFrame,f.editTimeframeForm.$setPristine()},f.toggleRefreshInterval=function(){f.editRefreshInterval=!f.editRefreshInterval,f.editRefreshInterval&&!f.model.refresh&&(f.model.refresh={value:5,unit:"minutes"})},f.setRefreshInterval=function(){if(!f.editRefreshIntervalForm.$valid)return!1;f.editRefreshInterval=!f.editRefreshInterval},f.resetEditRefreshIntervalForm=function(){f.model.refresh=null,f.editRefreshIntervalForm.$setPristine()},f.getViewTypesForDataType=function(e){var t=f.dataList.filter(function(t){return t.type===e});if(t.length>0)return t[0].visualizations;return[]},f.testConfiguration=function(){if("timeseries"===f.model.view.dataType){var e=f.model.view.dataOptions.filter(function(e){return"datasourceId"===e.key});e&&e.length>0?f.model.view.dataOptions.forEach(function(e){"datasourceId"===e.key&&(e.value=f.combinedViewDatasource)}):f.model.view.dataOptions.push({key:"datasourceId",value:f.combinedViewDatasource});var t=f.model.view.dataOptions.filter(function(e){return"flowIds"===e.key});if(t&&t.length>0?f.model.view.dataOptions.forEach(function(e){"flowIds"===e.key&&(e.value=f.combinedViewSelectedFlowIds)}):f.model.view.dataOptions.push({key:"flowIds",value:f.combinedViewSelectedFlowIds}),f.combinedViewSelectedFlowIds.length>0){f.model.queries=[];var a=[];f.combinedViewSelectedFlowIds.forEach(function(e){delete e.flowConfig,a.push(e.flowId)}),f.model.queries.push({type:"flowTimeseries",query:"SELECT STRUCT(timestamp, STRUCT(flow_id, ARRAY[STRUCT(channel_classifier_id, value, ARRAY(SELECT AS STRUCT annotation, sequence_id, ARRAY_AGG(STRUCT(key, value))))] AS channel) AS flow) AS row FROM flows WHERE flow_id IN ('"+a.join("', '")+"') AND timestamp > '{start_date}' AND timestamp <= '{end_date}' GROUP BY timestamp, flow_id, channel_classifier_id, value ORDER BY timestamp, flow_id "})}if(f.combinedViewSelectedChannelIds.length>0){0===f.combinedViewSelectedFlowIds.length&&(f.model.queries=[]);var n=[];if(f.combinedViewSelectedChannelIds.forEach(function(e){n.push(e.classifier)}),n&&n.length>0){var r=f.model.view.dataOptions.filter(function(e){return"sourceChannels"===e.key});r&&r.length>0?f.model.view.dataOptions.forEach(function(e){"sourceChannels"===e.key&&(e.value=n)}):f.model.view.dataOptions.push({key:"sourceChannels",value:n})}f.model.queries.push({type:"rawTimeseries",query:"SELECT datasource_id, timestamp, ARRAY[STRUCT(channel AS channel_classifier, value AS value)] AS raw FROM INGEST WHERE timestamp > '{start_date}' AND timestamp <= '{end_date}' AND datasource_id IN ('"+f.combinedViewDatasource+"') AND channel_classifier_id IN ('"+n.join("', '")+"') GROUP BY timestamp, channel, value ORDER BY timestamp"})}f.model.limit=99999}else f.model.limit;m&&m()},f.addStringReplacement=function(e){if(f.stringReplacementReserved=!1,!f.stringReplacementsForm.$valid)return!1;if("start_date"===e.key||"end_date"===e.key)return f.stringReplacementsForm.$valid=!1,f.stringReplacementsForm.newStringReplacementKey.$invalid=!0,f.stringReplacementReserved=!0,!1;f.model.queryStrings||(f.model.queryStrings=[]);var t={key:e.key,value:e.value};f.model.queryStrings.push(t),f.stringReplacementsForm.$setPristine(),f.newStringReplacement={}},f.removeStringReplacement=function(e){f.model.queryStrings.splice(e,1)},f.showValidatorInfo=function(){f.showValidatorFeedback=!0},f.hideValidatorInfo=function(){f.showValidatorFeedback=!1},f.toggleExample=function(){f.exampleQueries=t,f.showExample=!f.showExample,f.showExample&&(f.exampleEditorOptions={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!0,readOnly:!0,mode:"text/x-eql",theme:"ewx-dark"})},h();var v=o.onRecipeSelected;function S(e){f.tab=e}function w(e){f.loadingDatasource=!0,s.getDataSource(e).then(function(t){if(f.loadingDatasource=!1,t&&t.channels){if(f.combinedViewFlowChannels=t.channels.filter(function(e){return!e.isSource}),f.combinedViewSourceChannels=t.channels.filter(function(e){return e.isSource}),f.model.view.dataOptions){var a=f.model.view.dataOptions.filter(function(e){return"sourceChannels"===e.key});if(a&&a.length>0){var n=a[0].value;f.combinedViewSourceChannels.forEach(function(e){n.forEach(function(t){t===e.classifier&&f.combinedViewSelectedChannelIds.push(e)})})}}!function(e,t){var a=[];t.forEach(function(e){a.push(e.classifier)}),f.loadingFlows=!0,f.nofFlows=!1,l.getAllFlows({datasourceIds:[e],channelClassifierIds:a}).then(function(e){if(f.loadingFlows=!1,e&&e.data&&e.data.items){f.combinedViewFlows=e.data.items;var t=f.model.view.dataOptions.filter(function(e){return"flowIds"===e.key});if(t&&t.length>0){var a=t[0].value;f.combinedViewFlows.forEach(function(e){a.forEach(function(t){delete e.flowConfig,t.flowId===e.flowId&&f.combinedViewSelectedFlowIds.push(e)})})}}else f.nofFlows=!0},function(){f.loadingFlows=!1,f.combinedViewFlows=[]})}(e,f.combinedViewFlowChannels),f.hideStartEndControls=!1}},function(){f.loadingDatasource=!1,f.combinedViewSourceChannels=[],f.combinedViewFlowChannels=[],f.combinedViewFlows=[]})}function T(){f.hideStartEndControls=!1,f.onlyStartDate=!1,f.model.queries&&f.model.queries.forEach(function(e){C(e.query)})}function C(e){var t=!1;return e&&e.includes("{start_date}")?(t=!0,f.onlyStartDate=!0,e.includes("{end_date}")&&(f.onlyStartDate=!1)):f.hideStartEndControls=!0,t}function y(e){f.model.queryStrings&&(e=function(e,t){return t.forEach(function(t){e.includes("{"+t.key+"}")&&(e=e.replace("{"+t.key+"}",t.value))}),e}(e,f.model.queryStrings));var t=moment().format("YYYY-MM-DDTHH:mm:ss");return e.includes("{start_date}")&&(e=e.replace(/{start_date}/g,t)),e.includes("{end_date}")&&(e=e.replace(/{end_date}/g,t)),e}f.combinedViewSourceChannels=[],f.combinedViewFlowChannels=[],f.combinedViewFlows=[],f.combinedViewFlowIds=[],f.combinedViewChannelIds=[],f.combinedViewSelectedFlowIds=[],f.combinedViewSelectedChannelIds=[],f.combinedViewAggregationPeriod="DAY",o.$watch("vm.combinedViewDatasource",function(e){e&&(f.combinedViewSourceChannels=[],f.combinedViewFlowChannels=[],f.combinedViewFlows=[],f.combinedViewSelectedFlowIds=[],f.combinedViewSelectedChannelIds=[],w(e))},!0);var k=null,A=null;o.$watch("vm.model.queries[0].query",function(e,t){t&&t!==e&&(k&&c.cancel(k),f.model.queries&&f.model.queries[0].query&&"timeseries"!==f.model.view.dataType&&(f.queryValidationStatus="validating",k=c(function(){A&&A.cancel();var e={query:y(f.model.queries[0].query),validateOnly:!0};(A=r.eqlQuery(e)).then(function(e){e.reference.errors&&e.reference.errors.length>0?(f.queryValidationResponseText=e.reference.errors[0].message+"\n",f.queryValidationStatus="invalid"):(f.queryValidationStatus="valid",f.errorDialog=!1)},function(e){(400===e.status||404===e.status)&&e.data&&e.data.error&&e.data.error.message?(f.queryValidationResponseText=e.data.error.message,f.queryValidationStatus="invalid"):f.queryValidationStatus="unavailable"})},1e3)))})}angular.module("ewx-components-eql-wizard").controller("EqlWizardController",e),e.$inject=["eqlConstants","exampleQueries","ConstantsService","feedbackService","QueryService","AdminService","$scope","DataSourceService","FlowService","$timeout","$filter","$window"]}(),function(){function e(){return{scope:{configObject:"=",timeFrame:"=",timestamp:"=",limitEqlTo:"=",recipes:"=",onTestFunction:"=",onRecipeSelected:"="},replace:!0,restrict:"A",controller:"EqlWizardController",controllerAs:"vm",templateUrl:"shared/components/eql-wizard/eql-wizard.html",link:function(e){}}}angular.module("ewx-components-eql-wizard").directive("eqlWizard",e),e.$inject=[]}(),function(){function e(e){var t=this;t.messages=e,t.isVisible=function(){return t.messages.queue[0]}}angular.module("ewx-components-feedback-bar").controller("EwxFeedbackBarController",e),e.$inject=["feedbackService"]}(),function(){function e(){return{scope:!0,bindToController:{},transclude:!0,restrict:"EA",controller:"EwxFeedbackBarController",controllerAs:"vm",templateUrl:"shared/components/feedback-bar/feedback-bar.html"}}angular.module("ewx-components-feedback-bar").directive("ewxFeedbackBar",e),e.$inject=[]}(),function(){function e(e){var t=3e3,a={message:"",autoArchive:!0,closable:!0},n={queue:[],history:[],addMessage:function(i){i=angular.extend({},a,i),n.queue.push(i),function(){var a=n.queue[0],i=t;angular.isNumber(a.autoArchive)&&(i=a.autoArchive);"autoArchive"in a&&a.autoArchive&&("error"!==a.type&&"informational"!==a.type||(i=8e3),e(function(){r()},i))}()},archiveCurrentMessage:r,archiveAll:function(){n.history=n.history.concat(n.queue),n.queue=[]}};return n;function r(){n.history.push(n.queue[0]),n.queue.shift()}}angular.module("ewx-components-feedback-bar").factory("feedbackService",e),e.$inject=["$timeout"]}(),angular.module("ewx-components-filters").filter("capitalize",function(){return function(e,t){var a=t?/([^\W_]+[^\s-]*) */g:/([^\W_]+[^\s-]*)/;return e?e.replace(a,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}),angular.module("ewx-components-filters").filter("toArray",function(){return function(e,t){return angular.isObject(e)?!1===t?Object.keys(e).map(function(t){return e[t]}):Object.keys(e).map(function(t){var a=e[t];return angular.isObject(a)?Object.defineProperty(a,"$key",{enumerable:!1,value:t}):{$key:t,$value:a}}):e}}),angular.module("ewx-components-filters").filter("propsFilter",function(){return function(e,t){var a=[];if(angular.isArray(e)){var n=Object.keys(t);e.forEach(function(e){for(var r=!1,i=0;i<n.length;i++){var o=n[i],s=t[o].toLowerCase();if(-1!==e[o].toString().toLowerCase().indexOf(s)){r=!0;break}}r&&a.push(e)})}else a=e;return a}}),angular.module("ewx-components-filters").filter("rulename",function(){return function(e){return angular.isString(e)?e.replace(/rule_/g,"").replace(/_/g," "):e}}),angular.module("ewx-components-filters").filter("sanitize",function(){return function(e){return angular.isString(e)?e.replace(/["~!@#$%^&*\(\)_+=`{}\[\]\|\\:;'<>,.\/?"\- \t\r\n]+/g,"-").replace(/^-+/,"").replace(/-+$/,""):e}}),angular.module("ewx-components-filters").filter("secondsToTime",function(){return function(e){return new Date(1970,0,1).setSeconds(e)}}),angular.module("ewx-components-filters").filter("truncate",function(){return function(e,t,a,n){if(!e)return"";if(!(a=parseInt(a,10)))return e;if(e.length<=a)return e;if(e=e.substr(0,a),t){var r=e.lastIndexOf(" ");-1!==r&&(e=e.substr(0,r))}return e+(n||" …")}}),function(){function e(e,t,a,n,r,i,o){var s=this,l=r.onSelected();function c(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!1;return e?(e.forEach(function(e){n?e.key===t&&e.value===a&&(r=!0):e.key.toLowerCase()===t.toLowerCase()&&e.value.toLowerCase()===a.toLowerCase()&&(r=!0)}),r):r}function u(e){var t=[];if(e)for(var a=0;a<e.length;a++)t.push(e[a].name);return new Set(t).size}function d(e){var t=0;if(e)for(var a=0;a<e.length;a++){var n=e[a].ruleConfigs;n&&n.forEach(function(e){t++})}return t}function f(e,t){n.addMessage({type:t,message:e})}function m(e){f(e,"error")}s.annotationMap={},s.propertyMap={},s.filteredPoperties={},s.filteredPopertiesLimit=6,s.loadingFlows=r.flowsLoading,s.noFlowMetaData=!0,s.channels={},s.selectedFlow={},s.datasource=r.datasource,s.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",s.datasource&&s.datasource.timezone?s.timezone=s.datasource.timezone:s.timezone="utc",s.triggerVirtualDatasource=function(e,a){if(a){var n={name:e,useExistingTable:!1};s.triggerActive=!0,s.showConfirmTriggerVirtualDatasource=!1,t.triggerVirtualDatasource(n).then(function(){s.triggerActive=!1,f(i("translate")("feedback.messages.triggered"))},function(e){s.triggerActive=!1,e.data&&e.data.error&&e.data.error.message?m(i("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):m(i("translate")("feedback.messages.error"))})}else s.showConfirmTriggerVirtualDatasource=!0},a.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultDateTime&&(s.userDateTimeFormat=s.userSettings.defaultDateTime.date+" "+s.userSettings.defaultDateTime.time)},function(e){}),r.$watch("flows",function(){r.flows&&!angular.equals(r.flows,{})&&(_.isEqual(s.channels,r.flows)||function(e){var t=!1;e.getChannelClassifiers().forEach(function(a){e[a].flows.length>0&&(t=!0)}),t&&(s.channels=angular.copy(e),s.channels.getChannelClassifiers().forEach(function(e){var t=s.channels[e];t.selectedFlow&&t.annotations&&(s.annotationMap[e]=t.annotations)}),s.channels.getChannelClassifiers().forEach(function(e){s.channels[e].selectedFlow.flowId&&Object.keys(s.annotationMap).forEach(function(t){Object.keys(s.annotationMap[t]).forEach(function(a){if(a===s.channels[e].selectedFlow.flowId){var n=s.annotationMap[t][Object.keys(s.annotationMap[t])[0]].annotations;Object.keys(n).length>0&&(s.annotationMap[e]?_.assign(s.annotationMap[e],n):s.annotationMap[e]=n)}})})}),s.channels.getChannelClassifiers().forEach(function(e){var t=s.channels[e];t.selectedFlow.flowTags=[],t.selectedFlow.flowType&&t.selectedFlow.flowTags.push({name:"Type: "+t.selectedFlow.flowType,status:"primary"});var a={name:"Completed",status:"ok"};if(c(t.selectedFlow.properties,"completed","true",!1)||(a.name="Not completed",a.status="alert"),t.selectedFlow.flowTags.push(a),t&&t.selectedFlow&&t.selectedFlow.flowConfig){var n={count:d(t.selectedFlow.flowConfig.sequenceConfigs)+" rules",name:"in "+u(t.selectedFlow.flowConfig.sequenceConfigs)+" sequences",status:"primary"};if(s.annotationMap[e]){var r=0,i=s.annotationMap[e];Object.keys(i).forEach(function(e){Object.keys(i[e]).forEach(function(t){var a=i[e][t],n=c(a.properties,"informational","true",!1),o=c(a.properties,"stop_happy_flow","true",!1);o&&!n&&a.indexes.length>0&&2>r?r=2:!n&&a.indexes&&a.indexes.length>0&&1>r&&(r=1)})}),1===r?n.status="warning":2===r&&(n.status="alert")}t.selectedFlow.flowTags.push(n)}if(t.sequenceWarnings>0){var o=t.sequenceWarnings>1?"Warnings":"Warning";t.selectedFlow.flowTags.push({count:t.sequenceWarnings,name:o,status:"warning"})}else if(t.sequenceErrors>0){var l=t.sequenceErrors>1?"Errors":"Error";t.selectedFlow.flowTags.push({count:t.sequenceErrors,name:l,status:"alert"})}t.selectedFlow.approvals&&t.selectedFlow.flowTags.push({name:"approved",status:"ok"})}),s.channels.getChannelClassifiers().forEach(function(e){s.propertyMap[e]={},s.filteredPoperties[e]=[];var t=["succeeded","statistics","datasetMetadata","load_shape_type","loadShapeType","qualityScore","status","flowSucceeded","flowComplete","completed"];s.channels[e].selectedFlow&&s.channels[e].selectedFlow.properties&&s.channels[e].selectedFlow.properties.forEach(function(a){var n=a.key.split("."),r=t.indexOf(n[0])<0;r&&s.filteredPoperties[e].push(a),function e(t,a,n){if(1===a.length)return t[a[0]]=n,t;if(a.length>1){t[a[0]]||(t[a[0]]={});var r=t[a[0]];return a.shift(),e(r,a,n)}}(s.propertyMap[e],n,a.value)})}),s.noFlowMetaData=!1);s.loadingFlows=!1}(r.flows))},!0),s.isChannelsSet=function(){return!angular.equals(s.channels,{})},s.getAnnotationProperties=function(e,t,a){var n=[];return s.annotationMap[e]&&s.annotationMap[e][t]&&s.annotationMap[e][t][a]&&s.annotationMap[e][t][a].properties&&s.annotationMap[e][t][a].properties.forEach(function(e){n.push(e)}),n},s.changeFlow=function(e,t,a){r.flows[e].flows.forEach(function(n){n.flowId===t&&r.flows[e].selectedFlow.flowId===a&&(r.flows[e].selectedFlow=n,s.selectedFlows[e]=t,l&&l(n.datasourceId,e,a,t))})},s.toggleApproveDialog=function(){s.approveForm.$setPristine(),s.showApproveDialog=!s.showApproveDialog},s.approveFlow=function(t){if(t.flowId){s.approveLoading=!0;var a={comment:s.approveComment,runIds:[t.flowId]};if(!s.approveForm.$valid)return s.approveLoading=!1,!1;e.approveFlow(a).then(function(e){"[object Array]"!==Object.prototype.toString.call(t.approvals)&&(t.approvals=[]),s.approveLoading=!1,t.approvals.push(e.approval),s.showApproveDialog=!s.showApproveDialog},function(){s.approveLoading=!1,m(i("translate")("feedback.messages.error"))})}else m(i("translate")("feedback.messages.error"))},s.getCountForRule=function(e,t,a){if(e&&t>=0&&a&&s.annotationMap[e]&&s.annotationMap[e][t]&&s.annotationMap[e][t][a]&&s.annotationMap[e][t][a].indexes)return s.annotationMap[e][t][a].indexes.length},s.checkRuleState=function(e,t,a,n){if(n&&"detection"===n&&e&&s.channels[e]&&s.channels[e].selectedFlow&&s.channels[e].selectedFlow.detectors){var r=s.channels[e].selectedFlow.detectors.filter(function(e){return e.function===a}),i=!1;return r&&r.forEach(function(e){"true"===e.value.toLowerCase()&&(i=!0)}),i?"detected":"not-detected"}if(e&&t>=0&&a&&s.annotationMap[e]&&s.annotationMap[e][t]&&s.annotationMap[e][t][a]){var o=!1,l=!1;return s.annotationMap[e][t][a].properties.forEach(function(e){"stop_happy_flow"===e.key.toLowerCase()?o="true"===e.value.toLowerCase():"informational"===e.key.toLowerCase()&&(l="true"===e.value.toLowerCase())}),o&&!l&&s.annotationMap[e][t][a].indexes.length>0?"error":!l&&s.annotationMap[e][t][a].indexes.length>0?"warning":"ok"}return"ok"},s.getDetectorProperties=function(e,t,a,n){if(n&&"detection"===n&&s.channels[e].selectedFlow.detectors){var r=s.channels[e].selectedFlow.detectors.filter(function(e){return e.function===a});if(r.length>0){if(r[0].properties&&r[0].properties.length>0){var i=(o=r[0].properties,l="key",o.sort(function(e,t){var a=e[l],n=t[l];return a>n?-1:a<n?1:0}));r[0].properties=i}return r[0]}return[]}var o,l},s.parseValues=function(e){var t=JSON.parse(e);for(var a in t)t.hasOwnProperty(a)&&Array.isArray(t[a])&&(t[a]=t[a].join(", "));return t},s.viewRuleInfo=function(e,t,a,n,r){s.selectedRule=e,s.selectedRule.detectorInfo=s.getDetectorProperties(t,a,n,r),s.selectedRule.annotationCount=s.getCountForRule(t,a,n)},s.closeRulemodal=function(e){e&&(s.selectedRule=null)}}angular.module("ewx-components-flow-metadata").controller("FlowMetaDataController",e),e.$inject=["FlowService","VirtualDataSourceService","UserService","feedbackService","$scope","$filter","$state"]}(),function(){function e(){return{scope:{annotations:"=",flows:"=",datasource:"=",onSelected:"&",flowsLoading:"=",annotationsLoading:"="},replace:!0,restrict:"A",controller:"FlowMetaDataController",controllerAs:"vm",templateUrl:"shared/components/flow-metadata/flow-metadata.html",link:function(e){}}}angular.module("ewx-components-flow-metadata").directive("flowMetadata",e),e.$inject=[]}(),function(){function e(e,t,a,n,r){var i,o=this;function s(e,a){a=parseInt(a);var n=o.flowConfig.sequenceConfigs[a].ruleConfigs;n&&n.forEach(function(e){e.ruleSelected=!1}),e.ruleSelected=!0,o.selectedRuleConfigLoading=!0,o.selectedRuleConfig=e;var r={name:o.selectedRuleConfig.function,ruleType:o.selectedRuleConfig.type};!function(e,t){o.enableFilterRules=!1,o.showEnableFilterRules=!0;var a=[],n=[];o.flowConfig.sequenceConfigs.forEach(function(t,r){e>r&&t.ruleConfigs.forEach(function(e){a.push({function:e.function+":"+r}),n.push(e.function+":"+r)})}),a.forEach(function(e){t.filterWhitelist&&t.filterWhitelist.length>0&&t.filterWhitelist.indexOf(e.function)>-1&&(e.whitelist=!0,o.enableFilterRules=!0),t.filterBlacklist&&t.filterBlacklist.length>0&&t.filterBlacklist.indexOf(e.function)>-1&&(e.blacklist=!0,o.enableFilterRules=!0)});var r=[],i=[];if(t.filterWhitelist){t.filterWhitelist.forEach(function(e,a){n.indexOf(e)<0&&(r.push(e),delete t.filterWhitelist[a])});var s=t.filterWhitelist.filter(function(e){return null!==e});t.filterWhitelist=s}if(t.filterBlacklist){t.filterBlacklist.forEach(function(e,a){n.indexOf(e)<0&&(i.push(e),delete t.filterBlacklist[a])});var l=t.filterBlacklist.filter(function(e){return null!==e});t.filterBlacklist=l}(r.length>0||i>0)&&(o.warningModal||(o.warningModal=[]),o.warningModal[e]={sequenceIndex:e,sequenceName:o.flowConfig.sequenceConfigs[e].name,rule:t,deletedWhitelist:r,deletedBlacklist:i});o.warningModal&&o.warningModal.length>0&&(o.warningModal=o.warningModal.filter(function(e){return null!==e}));o.selectableFilterRules=a,0===e&&(o.enableFilterRules=!1,o.showEnableFilterRules=!1,t.filterWhitelist=[],t.filterBlacklist=[],o.selectableFilterRules.forEach(function(e){e.whitelist=!1,e.blacklist=!1}))}(a,o.selectedRuleConfig),t.getRule(r).then(function(t){var a=void 0;if(t.data&&(o.selectedRuleConfig.description=t.data.description,t.data.params)){a=t.data.params;var n=[];a.forEach(function(t){o.selectedRuleConfig.params&&o.selectedRuleConfig.params.length>0?o.selectedRuleConfig.params.forEach(function(a){if("alert_threshold"===a.key&&(a.warning_threshold>0?e.warningThreshold=a.warning_threshold:e.warningThreshold&&(a.warning_threshold=e.warningThreshold),a.error_threshold>0?e.errorThreshold=a.error_threshold:e.errorThreshold&&(a.error_threshold=e.errorThreshold),angular.isDefined(a.errorThresholdAbortFlag)?e.errorThresholdAbortFlag=a.errorThresholdAbortFlag:angular.isDefined(e.errorThresholdAbortFlag)?a.errorThresholdAbortFlag=e.errorThresholdAbortFlag:a.errorThresholdAbortFlag=!1),t.displayName===a.displayName)for(var r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);t.optional&&n.push(t)}):t.optional&&n.push(t)}),(n=_.uniq(n)).forEach(function(e){_.findWhere(o.selectedRuleConfig.params,{name:e.name})||("Text"!==e.widgetType&&"DatePicker"!==e.widgetType&&(e.disabled=!0),e.key=e.name,o.selectedRuleConfig.params||(o.selectedRuleConfig.params=[]),o.selectedRuleConfig.params.push(e))})}o.selectedRuleConfig.params&&o.selectedRuleConfig.params.length>0&&(o.selectedRuleConfig.params.forEach(function(e){e.valueType&&"list"===e.valueType&&(e.value=[],e.value=e.values)}),o.selectedRuleConfig.params=function(e,t){if(o.selectedRuleConfig.outDated=!1,e.length===t.length){var a=e.map(function(e){return e.key}).sort().toString(),n=t.map(function(e){return e.name}).sort().toString();if(a===n){var r=[];return t.forEach(function(t){e.forEach(function(e){e.key===t.name&&(e.widgetType!==t.widgetType&&(o.selectedRuleConfig.outDated=!0),e.displayName=t.displayName,e.description=t.description,e.optional=t.optional,e.valueType=t.valueType,e.resourceType&&t.resourceType&&(e.resourceType=t.resourceType),r.push(e))})}),r}return o.selectedRuleConfig.outDated=!0,e}return o.selectedRuleConfig.outDated=!0,e}(o.selectedRuleConfig.params,a)),o.selectedRuleConfigLoading=!1},function(e){o.getRuleFailed=!0,o.selectedRuleConfigLoading=!1})}function l(e,t){a.addMessage({type:t,message:e})}function c(e){l(e,"error")}o.openRuleParams=s,o.saveFlowConfiguration=function(){o.savingFlowConfiguration=!0,o.flowConfig.sequenceConfigs.forEach(function(e){e.ruleConfigs&&e.ruleConfigs.forEach(function(e){var t=!1;if(e.params){var a=[];e.params.forEach(function(e,n){"alert_threshold"===e.name&&(t={warning_threshold:e.warning_threshold,error_threshold:e.error_threshold,errorThresholdAbortFlag:e.errorThresholdAbortFlag},delete e.warning_threshold,delete e.error_threshold,delete e.errorThresholdAbortFlag);var r=angular.isNumber(e.value);for(var i in r&&(e.value=e.value.toString()),e)e.hasOwnProperty(i)&&e[i]&&angular.isNumber(e[i])&&(e[i]=e[i]+"");(e.optional&&!e.value&&!e.values||e.optional&&e.disabled)&&a.push(n),e.valueType&&"list"===e.valueType&&!e.values&&e.value&&(e.values=e.value,delete e.value)}),a.sort(function(e,t){return t-e}),a.forEach(function(t){e.params.splice(t,1)})}t&&(e.warningThreshold=t.warning_threshold.toString(),e.errorThreshold=t.error_threshold.toString(),e.errorThresholdAbortFlag=t.errorThresholdAbortFlag)}),o.flowConfig.destinationChannelClassifier=e.destinationColumn}),e.updateFlowConfig(o.flowConfig).then(function(){var e;o.savingFlowConfiguration=!1,(e=n.onClose())&&e(!0),l(r("translate")("feedback.messages.ok"))},function(e){o.savingFlowConfiguration=!1,c(e.data.error.code+": "+e.data.error.message)})},o.selectedSequenceChanged=function(e){o.selectedRuleConfig=!1;var t=o.flowConfig.sequenceConfigs[e].ruleConfigs;if(t){t.forEach(function(e){e.ruleSelected=!1});var a=t[0];a&&s(a,e)}},o.enableFilterRulesChange=function(e){e||(o.selectedRuleConfig.filterWhitelist=[],o.selectedRuleConfig.filterBlacklist=[],o.selectableFilterRules.forEach(function(e){e.whitelist=!1,e.blacklist=!1}))},o.filterRuleChange=function(e,t){"whitelist"===t&&e.whitelist?e.blacklist=!1:e.blacklist&&(e.whitelist=!1);var a=[],n=[];o.selectableFilterRules.forEach(function(e){e.whitelist?a.push(e.function):e.blacklist&&n.push(e.function)}),o.selectedRuleConfig.filterWhitelist=a,o.selectedRuleConfig.filterBlacklist=n},n.flowConfigId?(i=n.flowConfigId,o.flowConfigLoading=!0,e.getFlowConfig(i).then(function(e){if(o.flowConfig=e.data,o.flowConfigLoading=!1,o.selectedSequenceIndex="0",o.flowConfig.sequenceConfigs[0].ruleConfigs&&o.flowConfig.sequenceConfigs[0].ruleConfigs.length>0){var t=o.flowConfig.sequenceConfigs[0].ruleConfigs[0];s(t,o.selectedSequenceIndex)}},function(e){o.flowConfigLoading=!1,o.errorDialog=!0,c(r("translate")("feedback.messages.errorNotFound"))})):o.errorDialog=!0}angular.module("ewx-components-flow-rule-parameters").controller("FlowRuleParametersController",e),e.$inject=["FlowConfigService","RulesService","feedbackService","$scope","$filter"]}(),function(){angular.module("ewx-components-flow-rule-parameters").directive("flowRuleParameters",function(){return{scope:{onClose:"&onClose",flowConfigId:"="},replace:!0,restrict:"AE",controller:"FlowRuleParametersController",controllerAs:"vm",templateUrl:"shared/components/flow-rule-parameters/flow-rule-parameters.html"}})}(),function(){function e(e,t,a,n,r,i,o,s,l,c){var u=this;function d(){i.datasources?(!function(e){var t=[],a=void 0,n=void 0;e.forEach(function(e){e.classifierType&&(a=!0,"virtual"===e.classifierType&&(n=!0)),t.push(e.id)}),(!a||n)&&(u.showVirtualDatasourceSettings=!0);u.flowInput.datasourceIds=t}(i.datasources),a.getUserSettings().then(function(e){u.userSettings=e,u.userSettings.defaultDateTime&&(u.userDateTimeFormat=u.userSettings.defaultDateTime.date+" "+u.userSettings.defaultDateTime.time),u.userSettings&&u.userSettings.defaultDateRangeTimeseries&&u.userSettings.defaultDateRangeTimeseries.backward.timespan?u.flowInput.startDatetime=moment().startOf("day").add(1,"day").subtract(u.userSettings.defaultDateRangeTimeseries.backward.amount,u.userSettings.defaultDateRangeTimeseries.backward.timespan).format():u.flowInput.startDatetime=moment().startOf("day").add(1,"day").subtract(1,"month").format(),u.userSettings&&u.userSettings.defaultDateRangeTimeseries&&u.userSettings.defaultDateRangeTimeseries.forward.timespan?u.flowInput.endDatetime=moment().startOf("day").add(1,"day").add(u.userSettings.defaultDateRangeTimeseries.forward.amount,u.userSettings.defaultDateRangeTimeseries.forward.timespan).format():u.flowInput.endDatetime=moment().startOf("day").add(1,"day").add(1,"month").format(),u.showControls=!0},function(e){u.showControls=!0}),u.datasources=i.datasources,i.flowConfigId?u.flowInput.flowConfigurationId=i.flowConfigId:c&&c.configId&&(u.flowInput.flowConfigurationId=c.configId,function(e){u.flowConfigLoading=!0;var t=void 0;n.getFlowConfig(e).then(function(e){var a=e.data;a.sequenceConfigs&&a.sequenceConfigs.length>0&&(t=a.sequenceConfigs[0].sourceColumn),u.flowConfigLoading=!1,u.flowInput.sourceClassifier=t},function(e){u.flowConfigLoading=!1})}(u.flowInput.flowConfigurationId)),i.sourceChannelId&&(u.flowInput.sourceClassifier=i.sourceChannelId),i.flowProperties&&(u.flowInput.flowProperties=i.flowProperties)):u.errorDialog=!0}function f(){i.sheetOpen=!1,angular.element(s).unbind("keydown")}function m(e,t){u.warningSourceChannel=!1;var a=e.name,n=void 0;a&&t&&t.sequenceConfigs&&t.sequenceConfigs.length>0&&(n=t.sequenceConfigs[0].sourceColumn,u.sourceColumn=n,a!==n&&(u.warningSourceChannel=!0))}function g(){if(!u.endDatetimeDisabled){u.invalidDateRange=!1;var e=void 0,t=void 0;return u.flowInput.startDatetime&&(e=moment.utc(u.flowInput.startDatetime).format("YYYY-MM-DDTHH:mm:ss.SSS")),u.flowInput.endDatetime&&(t=moment.utc(u.flowInput.endDatetime).format("YYYY-MM-DDTHH:mm:ss.SSS")),t&&e>t&&(u.invalidDateRange=!0),u.invalidDateRange}u.invalidDateRange=!0}function p(e,t){r.addMessage({type:t,message:e})}function h(e){p(e,"error")}function v(e){27===e.keyCode&&u.editFlowDesignActive?(e.preventDefault(),u.editFlowDesignActive=!1,i.$evalAsync()):27===e.keyCode&&u.searchChannelClassifierActive?(e.preventDefault(),u.searchChannelClassifierActive=!1,i.$evalAsync()):27===e.keyCode&&u.searchFlowDesignsActive?(e.preventDefault(),u.searchFlowDesignsActive=!1,i.$evalAsync()):27===e.keyCode&&(e.preventDefault(),f(),i.$evalAsync())}u.endDatetimeDisabled=!0,u.startDatetimeDisabled=!0,u.dataRetentionPolicies=e.getDataRetentionPolicies(),u.flowInput={startDatetime:moment().startOf("day"),endDatetime:moment().endOf("day"),waitForResult:!1,useStreaming:!1,datasourceIds:[],persist:!0,sourceClassifier:null,flowConfigurationId:null,flowProperties:null,dataRetentionPolicy:u.dataRetentionPolicies[0]},u.triggerFlow=function(){var e=angular.copy(u.flowInput);e.startDatetime&&!u.startDatetimeDisabled?e.startDatetime=moment.utc(e.startDatetime).format("YYYY-MM-DDTHH:mm:ss.SSS"):delete e.startDatetime;e.endDatetime&&!u.endDatetimeDisabled?e.endDatetime=moment.utc(e.endDatetime).format("YYYY-MM-DDTHH:mm:ss.SSS"):delete e.endDatetime;u.startingFlow=!0,t.startFlow(e).then(function(e){u.startingFlow=!1,p(o("translate")("feedback.messages.started")),i.sheetOpen=!1},function(e){u.startingFlow=!1,e.data&&e.data.error&&e.data.error.message?h(o("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):h(o("translate")("feedback.messages.error"))})},u.selectedChannelClassifier=function(e){u.chosenChannelClassifier=e,u.flowInput.sourceClassifier=e.name,u.searchChannelClassifierActive=!1,m(u.chosenChannelClassifier,u.chosenFlowConfiguration)},u.toggleSearchChannelClassifier=function(e){u.searchChannelClassifierActive=!1,e&&(u.searchChannelClassifierActive=!0)},u.selectedFlowConfigurationId=function(e){u.chosenFlowConfiguration=e,u.flowInput.flowConfigurationId=e.id,u.searchFlowDesignsActive=!1,u.chosenChannelClassifier?m(u.chosenChannelClassifier,u.chosenFlowConfiguration):e.sequenceConfigs&&e.sequenceConfigs.length>0&&(u.flowInput.sourceClassifier=e.sequenceConfigs[0].sourceColumn)},u.toggleSearchFlowConfigurationId=function(e){u.searchFlowDesignsActive=!1,e&&(u.searchFlowDesignsActive=!0)},u.checkDateRange=g,u.cancel=f,u.confirmDialog=function(){var e=g();if(!u.triggerFlowForm.$valid||e)return u.triggerFlowForm.$setSubmitted(),u.confirmStartFlow=!1,!1;u.confirmStartFlow=!0,l(function(){document.getElementById("confirmStartFlowDialog").scrollIntoView({behavior:"smooth"})})},u.closeEditFlowDesign=function(e){e&&(u.editFlowDesignActive=null)},i.$watch("sheetOpen",function(e,t){e&&d()}),s.addEventListener("keydown",v),i.$on("$destroy",function(){s.removeEventListener("keydown",v)})}angular.module("ewx-components-flow-trigger").controller("FlowTriggerController",e),e.$inject=["ConstantsService","FlowService","UserService","FlowConfigService","feedbackService","$scope","$filter","$window","$timeout","$stateParams"]}(),function(){angular.module("ewx-components-flow-trigger").directive("flowTrigger",function(){return{scope:{sheetOpen:"=",datasources:"=",flowConfigId:"=",sourceChannelId:"=",flowProperties:"="},replace:!0,restrict:"AE",controller:"FlowTriggerController",controllerAs:"vm",templateUrl:"shared/components/flow-trigger/flow-trigger.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.searchCriteria={status:"enabled"},r.updateStorageSearchKey=function(){n.sessionStorage.setItem("flowConfigSearchKey",r.filterListing)},r.changedSearchCriteria=function(){r.listing=[],r.isLoading=!0,o()},n.sessionStorage.getItem("flowConfigSearchKey")&&(r.filterListing=n.sessionStorage.getItem("flowConfigSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20)},function(e){}),a.limitResults&&(r.resultLimit=a.limitResults,r.resultLimitDefault=a.limitResults);var i=null;function o(t){var a={limit:250};"enabled"===r.searchCriteria.status?a.enabled=!0:"disabled"===r.searchCriteria.status&&(a.enabled=!1),t&&(a.pageToken=t),r.cancelled=!1,i&&(r.cancelled=!0,i.cancel()),(i=e.getFlowConfigList(a)).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){r.listing.push(e)}),t.pageToken?o(t.pageToken):r.isLoading=!1},function(e){r.cancelled||(r.isLoading=!1,r.errorDialog=!0)})}o(),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("flowConfigSearchKey")};var s=a.onClickSelect();r.onClickSelect=function(e){s&&s(e)}}angular.module("ewx-components-flowconfig-search").controller("FlowConfigSearchController",e),e.$inject=["FlowConfigService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-flowconfig-search").directive("flowconfigSearch",function(){return{scope:{onClickSelect:"&onClickSelect",onAddSelection:"&onAddSelection",enableClickSelect:"@",limitResults:"="},replace:!0,restrict:"AE",controller:"FlowConfigSearchController",controllerAs:"vm",templateUrl:"shared/components/flowconfig-search/flowconfig-search.html",link:function(e){}}})}(),function(){function e(e,t){var a=this;a.datasources=e.datasources,a.map={doSpider:!1,center:{latitude:52.025121,longitude:5.141675},zoom:14,events:{zoom_changed:function(e){a.mustFit&&(a.mustFit=!1),e.getZoom()>14?a.map.doSpider=!0:a.map.doSpider=!1}}},a.markers=[],a.markerOptions={icon:"./console/content/images/branding/energyworx/google-maps-marker.png"},a.click=function(e,t,n){var r=n.show;a.markers.forEach(function(e){e.show&&(e.show=!1)}),n.show=!r},a.options={scrollwheel:!1},t.then(function(e){a.googleLoaded=!0,a.infoBox=new google.maps.InfoWindow({disableAutoPan:!0,alignBottom:!0,content:document.getElementById("infobox"),pixelOffset:new google.maps.Size(0,0),maxWidth:350,zIndex:null,closeBoxURL:"",isHidden:!1,enableEventPropagation:!1}),a.spiderMarkersEvents={mouseover:function(e,t,n,r){a.infoBoxProperty=e.model,a.infoBox.open(e.map,e)},mouseout:function(e,t,n,r){a.infoBoxProperty=null,a.infoBox.close()}},a.clusterMarkersEvents={click:function(e,t,a,n){a.action&&a.action()},mouseover:function(e){a.infoBoxProperty=e.model,a.infoBox.open(e.map,e)},mouseout:function(e,t,n,r){a.infoBoxProperty=null,a.infoBox.close()}},a.typeEvents={click:function(e,t,a,n){a.action&&a.action()},spiderfy:function(e,t,a,n){}},a.clusterEvents={clusteringbegin:function(e){a.infoBox.close()}},a.spiderOptions={keepSpiderfied:!0},a.clusterOptions={maxZoom:15,keepSpiderfied:!1},a.map.type="cluster"}),a.mustFit=!1,a.tooltipClickAction=e.tooltipClickAction(),a.tooltipClickAction?a.tooltipClickable=!0:a.tooltipClickable=!1,e.cssClass&&(a.cssClass=e.cssClass),e.$watch("datasources",function(){e.datasources&&e.datasources.length>0&&(a.markers=[],a.ignoredDatasources=[],e.datasources.forEach(function(e){var t=!1;(function(e){if(!e)return;var t=[],a=[];return e.forEach(function(e){-1===a.indexOf(e.tag)&&a.push(e.tag)}),a.forEach(function(a){t.push(function(e,t){if(e){var a=[];return e.forEach(function(e){e.tag===t&&a.push(e)}),a.sort(function(e,t){return new Date(t.version)-new Date(e.version)}),a.length>0?a[0]:void 0}}(e,a))}),t})(e.tags).forEach(function(n){if("geopoint"===n.tag){var r={latitude:0,longitude:0,title:e.id,id:0,action:function(){a.tooltipClickAction&&a.tooltipClickAction(e.id)}};n.properties.forEach(function(e){"latitude"===e.key?r.latitude=e.value:"longitude"===e.key&&(r.longitude=e.value)}),r.id=a.markers.length,a.markers.push(r),t=!0}}),t||a.ignoredDatasources.push(e)}),a.markers.length>1?a.mustFit=!0:1===a.markers.length&&(a.map.center.latitude=a.markers[0].latitude,a.map.center.longitude=a.markers[0].longitude))},!0)}angular.module("ewx-components-google-maps").controller("GoogleMapsController",e),e.$inject=["$scope","uiGmapGoogleMapApi"]}(),function(){angular.module("ewx-components-google-maps").directive("googleMaps",function(){return{scope:{datasources:"=",viewListNotPlottedDatasources:"=",onSelected:"&",tooltipClickAction:"&",cssClass:"@"},replace:!0,restrict:"AE",controller:"GoogleMapsController",controllerAs:"vm",templateUrl:"shared/components/google-maps/google-maps.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;function i(e){if(e.data&&e.data.timestamp)return moment(e.data.timestamp).tz(e.data.timezone).format()}function o(e,t,a){var n=moment(e).valueOf(),r=moment(t).valueOf();return null===n&&null===r?0:null===n?-1:null===r?1:n-r}function s(){r.gridChanged=!0}function l(){r.gridOptions.api.setQuickFilter(r.gridTableFilter)}function c(e){var a={name:"Reset",action:function(){u()}},n={name:"Pivot Channels to Columns",action:function(){d()}},r=["copy","copyWithHeaders","separator","csvExport","excelExport"];return t.gridTableOptions.pivotChannelsToColumns?r.push("separator",n,a):r.push("separator",a),r}function u(){r.gridOptions.columnApi.resetColumnState(),r.gridOptions.columnApi.setPivotMode(!1),r.gridOptions.api.closeToolPanel(),r.gridOptions.suppressAggFuncInHeader=!1,r.gridChanged=!1,n(function(){r.gridOptions.api.sizeColumnsToFit()},100)}function d(){r.gridOptions.suppressAggFuncInHeader=!0,r.gridOptions.columnApi.setPivotMode(!0),r.gridOptions.columnApi.setPivotColumns(["channel"]),r.gridOptions.columnApi.setRowGroupColumns(["timestamp"]),r.gridOptions.api.sizeColumnsToFit()}r.gridOptions={},r.showTable=!1,r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.displayFilter=t.displayFilter,r.onFilterTextBoxChanged=l,r.exportTable=function(e){var a={skipHeader:!1,skipFooters:!0,fileName:"export.csv"};"csv"===e?a.fileName="export.csv":"excel"===e&&(a.fileName="export.xlsx");if(t.datasources&&t.datasources.length>0){var n="export";t.datasources.forEach(function(e){n=n+"-"+e.id}),"csv"===e?n+=".csv":"excel"===e&&(n+=".xlsx"),a.fileName=n}"csv"===e?r.gridOptions.api.exportDataAsCsv(a):"excel"===e&&r.gridOptions.api.exportDataAsExcel(a)},r.resetColumnState=u,r.resetGridTableFilter=function(){r.gridTableFilter="",l()},r.toggleFullScreen=function(){if(r.fullScreen){r.fullScreen=!1;var e=r.gridOptions.rowData.length;r.tableHeight=e<21?25.25*(e+1)+200+"px":"724px"}else r.fullScreen=!0,r.tableHeight="100%";n(function(){r.gridOptions.api.sizeColumnsToFit()},100)},r.pivotChannelColumns=d,e.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time)},function(e){}),t.$watch("gridData",function(){t.gridData&&angular.equals(t.gridData,{})&&(r.noDataAvailable=!0,r.showTable=!1),t.gridData&&!angular.equals(t.gridData,{})&&function(e){r.showTable=!1,r.gridOptions={};var l=!0;Object.keys(e).length>1&&(l=!1);var u=[{headerName:a("translate")("generic.timestamp"),field:"timestamp",valueGetter:i,comparator:o},{headerName:a("translate")("generic.value"),field:"value",cellClass:"bold align-right",aggFunc:"first"},{headerName:a("translate")("generic.unitType"),field:"unitType",cellClass:"bold align-right",hide:!1},{headerName:a("translate")("generic.datasourceId"),field:"datasourceId",hide:l},{headerName:a("translate")("generic.channel"),field:"channel",pivot:!0},{headerName:a("translate")("datasourceProperties.sourceChannel"),field:"isSource"},{headerName:a("translate")("generic.timezone"),field:"timezone",hide:l},{headerName:a("translate")("generic.flowId"),field:"flowId",hide:!0}],d=[],f=t.datasources;f&&Object.keys(e).forEach(function(t){var n=f.filter(function(e){if(e.id===t)return e.timezone});n=n?n[0].timezone:"utc",Object.keys(e[t]).forEach(function(r){e[t][r].values&&e[t][r].values.forEach(function(i){var o={timestamp:i[0],value:i[1],datasourceId:t,channel:r,flowId:e[t][r].flowId,isSource:e[t][r].isSource,timezone:n};if(e[t][r].unitType&&(o.unitType=e[t][r].unitType),e[t][r].annotations&&e[t][r].annotations.length>0){var s=a("translate")("generic.annotations");u.filter(function(e){return e.headerName===s}).length<=0&&u.push({headerName:s,marryChildren:!0,children:[],headerClass:"is-bold"}),e[t][r].annotations.forEach(function(e){e.values&&e.values.length>0&&(u.forEach(function(t){t.headerName===s&&t.children.filter(function(t){return t.field===e.id}).length<=0&&t.children.push({field:e.id,colId:e.id,aggFunc:"first",cellClass:function(e){return e.value?"is-annotation":"is-empty"}})}),e.values.forEach(function(t,a){if(t[0]===o.timestamp){var n="";t[1]&&t[1].length>0&&t[1].forEach(function(e,t){n=n+e.key+": "+e.value+", "}),n=n.substring(0,n.length-2),o[e.id]=n}}))})}d.push(o)})})}),r.gridOptions={statusBar:{statusPanels:[{statusPanel:"agTotalAndFilteredRowCountComponent",align:"left"}]},defaultColDef:{enableValue:!0,enableRowGroup:!0,enablePivot:!0,sortable:!0,filter:!0,resizable:!0},getContextMenuItems:c,allowContextMenuWithControlKey:!0,sideBar:!0,suppressDragLeaveHidesColumns:!0,animateRows:!0,rowGroupPanelShow:"always",sortingOrder:["desc","asc",null],columnDefs:u,rowData:d,enableRangeSelection:!0,onGridReady:function(e){e.api.closeToolPanel();var t=r.gridOptions.rowData.length;r.tableHeight=t<21?25.25*(t+1)+200+"px":"724px",n(function(){e.api.sizeColumnsToFit()},100)},onColumnMoved:s},n(function(){r.showTable=!0},100)}(t.gridData)},!0)}angular.module("ewx-components-grid-table").controller("GridTableController",e),e.$inject=["UserService","$scope","$filter","$timeout"]}(),function(){angular.module("ewx-components-grid-table").directive("gridTable",function(){return{scope:{gridData:"=",datasources:"=",displayFilter:"=",gridTableOptions:"="},replace:!0,restrict:"AE",controller:"GridTableController",controllerAs:"vm",templateUrl:"shared/components/grid-table/grid-table.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r,i){var o=this;function s(e,t){var a=null;if(!t)return a;var n=t.filter(function(t){return t.id===e});return n.length>=1&&(a=n[0]),a}o.fullname=n.auth_fullname,o.isLoading=!0,"None"===o.fullname&&r.get("https://www.googleapis.com/oauth2/v1/userinfo?alt=json").then(function(e){n.auth_fullname=e.data.name,n.auth_email=e.data.email,n.avatar_url=e.data.picture,o.fullname=n.auth_fullname,o.picture=n.avatar_url,o.email=n.auth_email},function(e){a.getUser().then(function(e){o.fullname=e.email.split("@")[0].replace(/\./g," ")})}),o.email=n.auth_email,"None"!==n.avatar_url&&(o.picture=n.avatar_url),o.domain=n.auth_domain,a.getUser().then(function(e){if(o.isLoading=!1,o.user=e,o.user.properties){var t=o.user.properties.filter(function(e){return"usersettings"===e.key.toLowerCase()});t&&t.length>0&&(o.userSettings=JSON.parse(t[0].value),o.userSettings&&o.userSettings.language&&"en"!==o.userSettings.language&&i.use(o.userSettings.language))}o.user.namespaces&&(o.user.namespaces.forEach(function(e){o.availableNamespaces||(o.availableNamespaces=[]),o.availableNamespaces.filter(function(t){return t.id===e.id}).length<=0&&o.availableNamespaces.push(e)}),o.activeNamespace=s(n.active_namespace_id,o.availableNamespaces)),o.selectedNamespaceId=n.active_namespace_id;var a=n.localStorage.getItem("selectedNamespace");a&&(o.selectedNamespaceId=a)},function(){}),o.toggleAccountInfo=function(e){o.showApplyButton=!1,o.accountInfo=!o.accountInfo,e&&n.location.reload()},o.logout=function(){t.logout()},o.switchNamespace=function(){n.active_namespace_id=o.selectedNamespaceId,o.activeNamespace=s(n.active_namespace_id,o.availableNamespaces),r.pendingRequests.forEach(function(e){e.cancel&&e.cancel.resolve()}),n.localStorage.setItem("selectedNamespace",o.selectedNamespaceId),o.toggleAccountInfo(!0)},e.$watch("vm.selectedNamespaceId",function(){o.selectedNamespaceId&&o.selectedNamespaceId!==n.active_namespace_id&&(o.showApplyButton=!0)}),e.$watch("vm.accountInfo",function(){o.accountInfo&&angular.element(n).bind("keydown",function(t){27===t.keyCode&&(t.preventDefault(),e.$apply(function(){o.accountInfo=!1}))})})}angular.module("ewx-components-header-account").controller("HeaderAccountController",e),e.$inject=["$scope","LoginService","UserService","$window","$http","$translate"]}(),function(){angular.module("ewx-components-header-account").directive("headerAccount",function(){return{scope:!1,replace:!0,restrict:"A",controller:"HeaderAccountController",controllerAs:"vm",templateUrl:"shared/components/header-account/header-account.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;function i(t){r.releaseNotesLoading=!0;e.getReleaseNotes({limit:1}).then(function(e){e.data&&e.data.releases&&e.data.releases.length>0&&(r.releaseNotes=e.data.releases,r.latestReleaseNote=r.releaseNotes[0],a.localStorage.setItem("latestReleaseVersion",r.latestReleaseNote.version),a.sessionStorage.setItem("latestReleaseVersionCheckedOn",moment().format("YYYY-MM-DDTHH:mm:ss")),t&&a.localStorage.setItem("latestReleaseVersionClicked",r.latestReleaseNote.version),o()),r.releaseNotesLoading=!1},function(e){r.releaseNotesLoading=!1})}function o(){var e=a.localStorage.getItem("latestReleaseVersion"),t=a.localStorage.getItem("latestReleaseVersionClicked"),n=e;r.latestReleaseNote&&r.latestReleaseNote.version&&(n=r.latestReleaseNote.version),r.showNewReleaseAlert=e!==n||t!==e}r.showLatesReleaseNote=!1,r.releaseNotesLoading=!1,r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.toggleReleaseNotesPanel=function(){if(!r.showLatesReleaseNote){r.showNewReleaseAlert=!1;i(!0)}r.showLatesReleaseNote=!r.showLatesReleaseNote},r.getDeployTimestamp=function(){try{return angular.element(document).find("body")[0].dataset}catch(e){return{}}},t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time);var t=a.sessionStorage.getItem("latestReleaseVersionCheckedOn");t&&(t=moment(t).format("YYYY-MM-DDTHH:mm:ss"));var n=moment().subtract(30,"minutes").format("YYYY-MM-DDTHH:mm:ss");!t||t<n?i():o()},function(e){}),angular.element(a).bind("keydown",function(e){27===e.keyCode&&r.showLatesReleaseNote&&(e.preventDefault(),r.showLatesReleaseNote=!r.showLatesReleaseNote,n.$evalAsync())}),n.$on("$destroy",function(){angular.element(a).unbind("keydown")})}angular.module("ewx-components-header-menu").controller("HeaderMenuController",e),e.$inject=["SystemService","UserService","$window","$scope"]}(),function(){angular.module("ewx-components-header-menu").directive("headerMenu",function(){return{scope:!0,replace:!0,restrict:"A",controller:"HeaderMenuController",controllerAs:"vm",templateUrl:"shared/components/header-menu/header-menu.html",link:function(e){}}})}(),function(){function e(e,t,a){var n=this;function r(e){e&&e.forEach(function(e){e.tags&&function(e){if(!e)return;var t=[],a=[];return e.forEach(function(e){-1===a.indexOf(e.tag)&&a.push(e.tag)}),a.forEach(function(a){t.push(function(e,t){if(e){var a=[];return e.forEach(function(e){e.tag===t&&a.push(e)}),a.sort(function(e,t){return new Date(t.version)-new Date(e.version)}),a.length>0?a[0]:void 0}}(e,a))}),t}(e.tags).forEach(function(t){if("icap"===t.description){n.datasources[e.id]||(n.datasources.ids.push(e.id),n.datasources[e.id]={icapTags:[],nitsTags:[]});var a=angular.copy(t);a.propertyMap=i(t.properties),n.datasources[e.id].icapTags.push(a),n.datasources[e.id].icapTags.sort(function(e,t){return new Date(e.validFrom)-new Date(t.validFrom)})}else if("nits"===t.description){n.datasources[e.id]||(n.datasources.ids.push(e.id),n.datasources[e.id]={icapTags:[],nitsTags:[]});var r=angular.copy(t);r.propertyMap=i(t.properties),n.datasources[e.id].nitsTags.push(r),n.datasources[e.id].nitsTags.sort(function(e,t){return new Date(e.validFrom)-new Date(t.validFrom)})}})})}function i(e){if(e){var t={};return e.forEach(function(e){t[e.key]=e.value}),t}}n.datasources={ids:[]},n.chart=t.chart,n.activeIcap={},n.activeNits={},n.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.getUserSettings().then(function(e){n.userSettings=e,n.userSettings.defaultDateTime&&(n.userDateTimeFormat=n.userSettings.defaultDateTime.date+" "+n.userSettings.defaultDateTime.time)},function(e){}),n.determineTagPeriod=function(e){var t=new Date,a=new Date(e.validFrom),n=moment(a).startOf("day").add(1,"year").subtract(1,"day");return a<t&&n<t?"PREVIOUS":a<t&&n>t?"CURRENT":(t.setFullYear(t.getFullYear()+1),a<t&&n>t?"NEXT":a>t&&n>t?"FUTURE":"UNCATEGORIZED")},n.plotICAPInChart=function(e,t,r){n.activeIcap[r]=t,a.$broadcast("chartAction",{action:"plotLine",subject:"ICAP",value:e,datasourceId:r})},n.plotNITSInChart=function(e,t,r){n.activeNits[r]=t,a.$broadcast("chartAction",{action:"plotLine",subject:"NITS",value:e,datasourceId:r})},n.clearICAPChart=function(e){a.$broadcast("chartAction",{action:"clearLines",subject:"ICAP",datasourceId:e}),n.activeIcap[e]=null},n.clearNITSChart=function(e){a.$broadcast("chartAction",{action:"clearLines",subject:"NITS",datasourceId:e}),n.activeNits[e]=null},t.$watch("datasources",function(e){t.datasources&&r(t.datasources)},!0)}angular.module("ewx-components-icap-nits").controller("IcapNitsController",e),e.$inject=["UserService","$scope","$rootScope"]}(),function(){angular.module("ewx-components-icap-nits").directive("icapNits",function(){return{scope:{datasources:"=",chart:"="},replace:!0,restrict:"AE",controller:"IcapNitsController",controllerAs:"vm",templateUrl:"shared/components/icap-nits/icap-nits.html",link:function(e){}}})}(),function(){function e(e,t){var a=this;a.showAuditEventsInModal=!1,a.clickLabel=function(){"audit_events"===a.labelIndicators.type&&t.useModal&&(a.showAuditEventsInModal=!0)},a.isLoading=!0,a.queryError=!1,a.queryParams={compressed:!0},a.labelIndicators=t.input;var n,r,i,o=null;function s(e,t){var a=0;if(e&&e.length>0)for(var n=0;n<e.length;++n)e[n].severity===t&&a++;return a}"audit_events"===a.labelIndicators.type&&(i="SELECT * FROM audit_events, UNNEST (subjects) as subs WHERE subs.subject_type = 'datasource' AND subs.subject = '"+a.labelIndicators.datasourceId+"' ORDER BY timestamp DESC LIMIT 2000",a.queryParams.query=i,n=a.queryParams,r||(a.queryParams.pageToken=null,a.queryParams.jobId=null,a.queryParams.limit=500),o&&o.cancel(),(o=e.eqlQuery(n)).then(function(e){var t;e&&e.parsed&&e.parsed.length>0?(e.reference&&e.reference.jobId?a.queryParams.jobId=e.reference.jobId:a.queryParams.jobId=null,e.pageToken?(a.queryParams.pageToken=e.pageToken,a.isLoading=!1):(a.queryParams.pageToken=null,a.isLoading=!1),r?(e.rows.forEach(function(e){l.rows.push(e)}),e.parsed.forEach(function(e){l.parsed.push(e)}),l.pageToken=e.pagetoken,l.reference=e.reference,l.metadata=e.metadata):l=e):(a.noResults=!0,a.isLoading=!1),"audit_events"===a.labelIndicators.type&&(t=l,a.auditEvents=t.parsed,a.auditEvents?(a.auditEvents.errorCount=s(a.auditEvents,"ERROR"),a.auditEvents.warningCount=s(a.auditEvents,"WARNING"),a.auditEvents.infoCount=s(a.auditEvents,"INFO"),a.auditEvents.debugCount=s(a.auditEvents,"DEBUG")):a.auditEvents=[])},function(e){a.queryIsCancelled||(a.queryError=!0,e.data&&e.data.error&&e.data.error.message&&(a.errorMessage=e.data.error.message),a.queryParams.jobId=null),a.isLoading=!1}));var l=[]}angular.module("ewx-components-label-indicators").controller("LabelIndicatorsController",e),e.$inject=["QueryService","$scope"]}(),function(){angular.module("ewx-components-label-indicators").directive("labelIndicators",function(){return{scope:{input:"=labelIndicatorsInput",useModal:"=useModal"},replace:!0,restrict:"AE",controller:"LabelIndicatorsController",controllerAs:"vm",templateUrl:"shared/components/label-indicators/label-indicators.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.getMarketAdapters(a).then(function(e){var t=e.data;t.marketAdapters&&t.marketAdapters.forEach(function(e){r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.functionToExecuteOnAdd=a.onSelectMarketAdapter(),r.updateStorageSearchKey=function(){n.sessionStorage.setItem("marketAdapterSearchKey",r.filterListing)},n.sessionStorage.getItem("marketAdapterSearchKey")&&(r.filterListing=n.sessionStorage.getItem("marketAdapterSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("marketAdapterSearchKey")}}angular.module("ewx-components-market-adapters-search").controller("MarketAdaptersSearchController",e),e.$inject=["MarketAdapterService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-market-adapters-search").directive("marketAdaptersSearch",function(){return{scope:{onSelectMarketAdapter:"&onSelectMarketAdapter"},restrict:"E",controller:"MarketAdaptersSearchController",controllerAs:"vm",templateUrl:"shared/components/market-adapters-search/market-adapters-search.html",link:function(e){}}})}(),function(){function e(){return{scope:{selectedNamespaceId:"=",namespaces:"="},restrict:"AE",templateUrl:"shared/components/namespace-selector/namespace-selector.html"}}angular.module("ewx-components-namespace-selector").directive("namespaceSelector",e),e.$inject=[]}(),function(){function e(e,t,a,n,r){var i,o=this;if(t.navOpen||!1===t.navOpen||(r.innerWidth>1280?t.navOpen=!0:t.navOpen=!1),o.navDoOpen=function(e){(e=e||!0)&&(t.navOpen=!0);n[0].focus()},o.navDoClose=u,o.navToggle=function(){t.navOpen=!1===t.navOpen},o.toggleNavItem=function(e){o.navItemState[e]=!o.navItemState[e],r.localStorage.setItem("navItemState",JSON.stringify(o.navItemState))},e.getUserSettings(i).then(function(e){o.userSettings=e,o.favoriteTaskFlow=!1,o.userSettings.favoriteTaskFlow&&(o.favoriteTaskFlow=o.userSettings.favoriteTaskFlow)},function(e){}),r.iss){var s=r.iss,l=s.indexOf("microsoft"),c=s.indexOf("windows");(l>=0||c>=0)&&(o.microsoftAccount=!0)}function u(){t.navOpen=!1}r.localStorage.navItemState?o.navItemState=JSON.parse(r.localStorage.navItemState):o.navItemState={};var d=window.innerWidth;window.addEventListener("resize",function(){d>(d=window.innerWidth)&&window.matchMedia&&window.matchMedia("(max-width: 1280px)").matches&&t.navOpen&&(u(),a.$apply())})}angular.module("ewx-components-navigation").controller("NavigationController",e),e.$inject=["UserService","$rootScope","$scope","$element","$window"]}(),function(){angular.module("ewx-components-navigation").directive("navigation",function(){return{replace:!0,restrict:"A",controller:"NavigationController",controllerAs:"navigationCtrl",templateUrl:"shared/components/navigation/navigation.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r){var i=this;function o(){i.types=[r.DAY,r.WEEK,r.MONTH,r.YEAR]}function s(){if(i.endOfPeriod=!1,i.lastUpdated="-",i.lastDatapoint={},i.periodRangeValueString="",i.periodValueString="",i.selectedDay="",i.currentDay="",e.period={type:r.MONTH,value:new Date},i.currentPeriod=e.period,t.types&&t.types.length>0){i.types=t.types;var a=!0,n=_(r).values();_(t.types).forEach(function(e){-1===n.indexOf(e)&&(a=!1)}),a||o()}else o()}function l(t){var a=e.period.value;switch(e.period.type){case r.DAY:a=moment(a).add(t,"days").toDate();break;case r.WEEK:a=moment(a).add(7*t,"days").toDate();break;case r.MONTH:a=moment(a).add(t,"months").toDate();break;case r.YEAR:a=moment(a).add(t,"years").toDate();break;default:return}e.period.value=a}s(),i.setPeriodType=function(t){e.period.type=t},i.next=function(){i.selectedDay!==i.currentDay&&l(1)},i.previous=function(){l(-1)},i.reset=function(){s()},t.$watch(function(){return e.period},function(){i.periodValueString=n.getPeriodValueString(e.period),i.periodRangeValueString="",e.period.type===r.WEEK&&(i.periodRangeValueString="("+a("date")(moment(e.period.value).weekday(1).toDate(),"d MMMM")+" - "+a("date")(moment(e.period.value).weekday(7).toDate(),"d MMMM")+")"),i.currentDay=a("date")(new Date,"yyyy-MM-dd"),i.selectedDay=a("date")(e.period.value,"yyyy-MM-dd"),i.endOfPeriod=i.selectedDay===i.currentDay,e.$broadcast("period-changed")},!0)}angular.module("ewx-components-period-navigation").controller("PeriodNavigationController",e),e.$inject=["$rootScope","$scope","$filter","PeriodService","PERIOD_TYPE"]}(),function(){angular.module("ewx-components-period-navigation").directive("periodNavigation",function(){return{scope:{types:"="},replace:!0,restrict:"AE",controller:"PeriodNavigationController",controllerAs:"periodNavCtrl",templateUrl:"shared/components/period-navigation/period-navigation.html"}})}(),function(){function e(e,t){return{restrict:"A",replace:!1,link:function(a,n,r){var i=JSON.parse(r.permission.replace(/'/g,'"'));function o(e,t){return"viewer"===e?1:"editor"===e?2:"owner"===e?3:t}e.checkingPermissions=!0,t.getUserScopes().then(function(t){e.checkingPermissions=!1;var a=!1;t.scopes.forEach(function(e){var t;e.resource===i.resource&&(t=i.permission,o(e.permission,-1)>=o(t,99)&&(a=!0))}),a||n.remove(),e.checkingPermissions=!1},function(){n.remove(),e.checkingPermissions=!1})}}}angular.module("ewx-components-permission").directive("permission",e),e.$inject=["$rootScope","UserService"]}(),function(){function e(e){return{scope:{},restrict:"A",link:function(e,t){t.on("click",function(){window.print()})}}}angular.module("ewx-components-print").directive("print",e),e.$inject=["$window"]}(),function(){function e(e,t,a,n,r,i,o){var s=this,l=e.getEqlHints(),c=50;s.isLoading=!0,s.errorDialog=!1,s.resultLimit=20,s.resultLimitDefault=20,s.saveProperty=function(e){if(e){if(!s.newPropertyForm.$valid)return!1}else if(!s.editPropertyForm.$valid)return!1;e?(s.newProperty.timestamp=moment().format(),s.propertyList.push(s.newProperty)):(s.editProperty.timestamp=moment().format(),s.propertyList.push(s.editProperty));var a=void 0;if("advancedSearchFavorites"===r.context){var n=JSON.stringify(s.propertyList);a={properties:[{key:"advancedsearchfavorites",value:n}]}}s.errorDialog=!1,s.isSavingProperty=!0,t.updateUserProperties(a).then(function(){s.isSavingProperty=!1,s.propertyList.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)}),r.onFinished&&(r.onFinished=!r.onFinished),s.showEditForm=!1},function(e){s.isSavingProperty=!1,s.errorDialog=!0})},s.deleteProperty=function(e){s.errorDialog=!1;var a=s.propertyList.filter(function(t,a,n){return t!==e});s.propertyList=a;var i={properties:[{key:"advancedsearchfavorites",value:JSON.stringify(s.propertyList)}]};s.isDeletingProperty=!0,t.updateUserProperties(i).then(function(){var e,t;e=o("translate")("feedback.messages.deleted"),n.addMessage({type:t,message:e}),s.isDeletingProperty=!1,s.propertyList.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)}),s.propertyList.length>=c?s.maxStoredItems=s.propertyList.length:s.maxStoredItems=null,r.propertyList=s.propertyList,0===s.propertyList.length&&r.onFinished&&(r.onFinished=!r.onFinished)},function(e){s.isDeletingProperty=!1,s.errorDialog=!0})},s.addProperty=function(){s.newProperty={}},s.editPropertyFromList=function(e,t){s.originalList=angular.copy(t),t.forEach(function(a,n){e===a&&t.splice(n,1)}),s.editProperty=e,s.showEditForm=!0,s.refreshCodemirror=!0,i(function(){s.refreshCodemirror=!1})},s.resetListToOriginal=function(){s.propertyList=angular.copy(s.originalList),r.propertyList=s.propertyList},s.showMoreResults=function(){s.resultLimit=s.resultLimit+s.resultLimitDefault},s.resetResultLimit=function(){s.resultLimit=s.resultLimitDefault},s.resetFilter=function(){s.filterListingFavorites="",s.resultLimit=s.resultLimitDefault},"userProperties"===r.topic&&(s.errorDialog=!1,r.propertyList?(s.isLoading=!1,d(r.propertyList)):t.getUser().then(function(e){s.isLoading=!1,d(e.properties)},function(e){s.isLoading=!1,s.errorDialog=!1})),CodeMirror.defineMIME("text/x-eql",l);var u={mode:"text/x-eql",extraKeys:{"Ctrl-Space":"autocomplete"},hint:CodeMirror.hint.sql,hintOptions:{tables:{}}};function d(e){if("advancedSearchFavorites"===r.context){if(r.propertyList)s.propertyList=r.propertyList;else{var t=e.filter(function(e){return"advancedsearchfavorites"===e.key.toLowerCase()});t&&t.length>0?(s.propertyList=JSON.parse(t[0].value),s.propertyList.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)})):s.propertyList=[]}s.propertyList.length>=c?s.maxStoredItems=s.propertyList.length:s.maxStoredItems=null}r.newProperty&&(s.newProperty=r.newProperty)}t.getUserSettings().then(function(e){s.userSettings=e,s.userSettings.defaultChunkSize&&(s.resultLimit=parseInt(s.userSettings.defaultChunkSize)||20,s.resultLimitDefault=parseInt(s.userSettings.defaultChunkSize)||20)},function(e){}),a.eqlMetadata().then(function(e){var t={};e&&e.data&&e.data.tables&&(e.data.tables.forEach(function(e){var a=[];t[e.name]||(e.fields.forEach(function(e){-1===a.indexOf(e.field)&&a.push(e.field)}),t[e.name]=a)}),s.metadata=e.data.tables),angular.extend(u.hintOptions.tables,t)},function(e){}),s.cmOption=angular.extend(u,{lineNumbers:!0,indentWithTabs:!0,lineWrapping:!0,readOnly:!1,theme:"ewx-dark"})}angular.module("ewx-components-properties-manager").controller("PropertiesManagerController",e),e.$inject=["ConstantsService","UserService","QueryService","feedbackService","$scope","$timeout","$filter"]}(),function(){angular.module("ewx-components-properties-manager").directive("propertiesManager",function(){return{scope:{propertyList:"=",topic:"@",context:"@",newProperty:"=",onFinished:"="},restrict:"AE",controller:"PropertiesManagerController",controllerAs:"vm",templateUrl:"shared/components/properties-manager/properties-manager.html",link:function(){}}})}(),function(){function e(e,t){var a=this;a.data=null,a.flowPropertyKeyCheck=function(e,t,a){if(e.properties){var n=e.properties.filter(function(e){return e.key===t&&e.value===a});return n&&n.length>0}},t.$watch("data",function(){var e,n;e=t.data,n=void 0,e.forEach(function(e){var t;"tags"in e?(n="datasources",e.allTagProperties=(t=[],e.tags.forEach(function(e){e.properties&&e.properties.forEach(function(e){t.push(e)})}),t)):n="flow_id"in e?"flows":"unknown"}),a.data=e,a.listType=n},!0),a.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.getUserSettings().then(function(e){a.userSettings=e,a.userSettings.defaultDateTime&&(a.userDateTimeFormat=a.userSettings.defaultDateTime.date+" "+a.userSettings.defaultDateTime.time)},function(e){})}angular.module("ewx-components-result-list").controller("ResultListController",e),e.$inject=["UserService","$scope"]}(),function(){angular.module("ewx-components-result-list").directive("resultList",function(){return{scope:{data:"="},replace:!0,restrict:"AE",controller:"ResultListController",controllerAs:"vm",templateUrl:"shared/components/result-list/result-list.html",link:function(e){}}})}(),function(){function e(e){var t=this;function a(e,t,n){t||(t=0),n||(n={});var r=0;return Object.keys(e).forEach(function(i){!_.isFunction(e[i])&&e[i]instanceof Array&&(e[i].forEach(function(e){a(e,t+1,n)}),n[t]||(n[t]={}),n[t][r]?n[t][r].count+=e[i].length:n[t][r]={count:e[i].length},r++)}),n}function n(e,t){return t||(t=0),Object.keys(e).forEach(function(a){e[a]&&e[a].count?e[a].count>t&&(t=e[a].count):t=n(e[a],t)}),t}function r(e,t){var a=[];return e instanceof Array&&e.forEach(function(e){a.push(r(e,t))}),e.items&&e.field?t?a.push(r(e.items,t+"."+e.field)):a.push(r(e.items,e.field)):e.field?t?a.push(t+"."+e.field):a.push(e.field):e.v?a.push(r(e.v,t)):e.f&&a.push(r(e.f,t)),a}function i(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?i(t):t)},[])}t.data=null,e.$watch("data",function(){var o,s,l;e.data&&e.data!==t.data&&(t.data=angular.copy(e.data),t.flattened=(o=t.data,s=[],l=i(r(o.metadata.fields)),o.parsed.forEach(function(e){for(var t=[],r=n(a(e)),i=0;i<r;i++)t.push([]);l.forEach(function(r,i){!function e(t,r,i,o,s){if(r&&t){var l=r.split(".");if(t instanceof Array){var c=0;t.forEach(function(t,l){var u=l+c;e(t,r,i,o,s+u);var d=n(a(t));d>0&&(d-=1),c+=d})}else if(1===l.length)i[s]||(i[s]={}),i[s][o]={rowspan:n(a(t)),value:t[l[0]]};else{var u=l.slice(1,l.length).join(".");e(t[l[0]],u,i,o,s)}}}(e,r,t,i,0)}),s.push(t)}),function(e){var t=0;e.forEach(function(e){e.forEach(function(e){e.length>t&&(t=e.length)})}),e.forEach(function(e){for(var a=t-1;a>=0;a--)for(var n=null,r=e.length,i=e.length-1;i>=0;i--){var o=e[i][a];o&&(o.rowspan=n?r-i:0,n=o,r=i)}});var a=[];return e.forEach(function(e){var t=[];e.forEach(function(e){var a=[];e instanceof Array?e.forEach(function(e){e&&a.push(e)}):Object.keys(e).forEach(function(t){a.push(e[t])}),t.push(a)}),a.push(t)}),a}(s)))},!0),t.getHeaderItems=function(){var e=[];return t.data&&t.data.metadata&&t.data.metadata.fields?e=i(r(t.data.metadata.fields)):e}}angular.module("ewx-components-result-table").controller("ResultTableController",e),e.$inject=["$scope"]}(),function(){angular.module("ewx-components-result-table").directive("resultTable",function(){return{scope:{data:"=",tableModifiers:"@"},replace:!0,restrict:"AE",controller:"ResultTableController",controllerAs:"vm",templateUrl:"shared/components/result-table/result-table.html",link:function(e){}}})}(),function(){function e(e){return{restrict:"A",scope:{},link:function(t,a,n,r){e.$on("$stateChangeSuccess",function(e,t,n,r,i){var o=angular.isDefined(r.data)&&angular.isDefined(r.data.cssClassnames)?r.data.cssClassnames:null,s=angular.isDefined(t.data)&&angular.isDefined(t.data.cssClassnames)?t.data.cssClassnames:null;o!==s&&(o&&a.removeClass(o),s&&a.addClass(s))})}}}angular.module("ewx-components-route-class").directive("routeClass",e),e.$inject=["$rootScope"]}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;function u(t,a){var n={ruleType:t,limit:100};a&&(n.pageToken=a),c.errorDialog=!1,e.getRules(n).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){c.listing.push(e)}),t.pageToken?u(t.pageToken):c.isLoading=!1},function(e){c.isLoading=!1,e&&404!==e.status&&(c.errorDialog=!0)})}function d(t){var a={name:t.name};c.prototypeReadyDialog=!1,c.isLoadingStatus=!0,e.isRuleUpdated(a).then(function(e){e.data.codeBlob&&(c.ruleSourcePrototype=e.data.codeBlob),c.isLoadingStatus=!1,t.isUpdated=e.data.isUpdated,f()},function(e){c.isLoadingStatus=!1,404===e.status?c.nothingFound=!0:p(n("translate")("feedback.messages.error"))})}function f(){t.getUser().then(function(e){var t=e.primaryNamespace;c.datalabUrl=function(e){var t="https://datalab.cloud.energyworx.com/";if(i.iss){var a=i.iss,n=a.indexOf("microsoft"),r=a.indexOf("windows");(n>=0||r>=0)&&(t="https://datalab-a.cloud.energyworx.com/")}if(i.auth_email&&e){var o=i.auth_email,s=o.replace(/@.*$/,""),l=o.substring(o.lastIndexOf("@")+1),u=c.selectedRule.ruleType,d=c.selectedRule.name;return s=s.split(".").join(""),l=l.split(".").join(""),e=e.split(".").join("_"),t=t+"user/"+s+"%23"+l+"/edit/namespace-"+e+"/"+s+"/rule_lib/"+u+"/"+d+".py"}return t}(t)},function(){})}function m(){c.refreshCodemirror=!0,o(function(){c.refreshCodemirror=!1})}function g(e,t){a.addMessage({type:t,message:e})}function p(e){g(e,"error")}c.isLoading=!0,c.errorDialog=!1,c.resultLimit=20,c.resultLimitDefault=20,c.listing=[],c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",c.functionToExecuteOnAdd=r.onAddSelection(),c.functionToExecuteOnDetails=r.onDetailsSelection(),c.updateStorageSearchKey=function(){i.sessionStorage.setItem("ruleSearchKey",c.filterListing)},i.sessionStorage.getItem("ruleSearchKey")&&(c.filterListing=i.sessionStorage.getItem("ruleSearchKey")),c.cmOption={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!1,readOnly:!0,indentUnit:4,mode:"python",theme:"ewx-dark"},s.params&&s.params.configId&&(c.currentState=s.params.configId),t.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time),c.userSettings.defaultChunkSize&&(c.resultLimit=parseInt(c.userSettings.defaultChunkSize)||20,c.resultLimitDefault=parseInt(c.userSettings.defaultChunkSize)||20)},function(e){}),c.typesLoading=!0,c.isLoading=!0,e.getRuleTypes({limit:100}).then(function(e){c.typesLoading=!1,e.data.items?(c.ruleTypeList=e.data.items,c.ruleType=c.ruleTypeList[0],u(c.ruleType)):(c.noRuleTypesAvialable=!0,c.isLoading=!1)},function(e){c.isLoading=!1,c.typesLoading=!1,p(n("translate")("feedback.messages.error"))}),c.showMoreResults=function(){c.resultLimit=c.resultLimit+c.resultLimitDefault},c.resetResultLimit=function(){c.resultLimit=c.resultLimitDefault},c.resetFilter=function(){c.filterListing="",c.resultLimit=c.resultLimitDefault,i.sessionStorage.removeItem("ruleSearchKey")},c.triggerLoadRules=function(){c.isLoading=!0,c.listing=[],u(c.ruleType)},c.openDetails=function(e){c.ruleSourcePrototype=!1,d(e),c.selectedRule=e,c.detailSheet=!0,l.sheetOpen=!0},c.refreshRulePrototypeStatus=function(){c.selectedRule.isUpdated=!1,d(c.selectedRule)},c.closeDetails=function(){c.detailSheet=!1,c.selectedRule.isUpdated=!1,c.selectedRule=!1,o(function(){l.sheetOpen=!1},200)},c.showRuleSource=function(){c.showSourceActive=!c.showSourceActive,c.ruleSource=c.selectedRule.codeBlob,c.codeEditable=!1,c.cmOption.readOnly=!0,m()},c.toggleEditCode=function(){c.codeEditable=!0,c.originalRuleSource=angular.copy(c.selectedRule.codeBlob),c.cmOption.readOnly=!1,m()},c.cancelEdit=function(){c.codeEditable=!1,c.ruleSource=c.originalRuleSource,c.showSourceActive=!1,c.cmOption.readOnly=!0},c.saveCodeEdit=function(){c.codeBlobSaving||(c.selectedRule.codeBlob=c.ruleSource,c.codeBlobSaving=!0,e.updateRule(c.selectedRule).then(function(e){c.codeBlobSaving=!1,c.showRuleSource(),g("Code blob has been updated")},function(e){c.codeBlobSaving=!1,c.showRuleSource(),p("Failed to update code")}))},c.showRuleSourcePrototype=function(){c.showSourcePrototypeActive=!c.showSourcePrototypeActive,m()},c.triggerReleaseRule=function(){var t,a;t=c.selectedRule,a={name:t.name},c.releaseLoading=!0,c.showReleaseConfirm=!1,e.releaseRule(a).then(function(e){c.releaseLoading=!1;var a=e.data;t.isUpdated=!1,t.codeBlob=a.codeBlob,t.updatedDatetime=a.updatedDatetime,t.codeBlob&&(c.selectedRule.codeBlobNew=t.codeBlob),g(n("translate")("feedback.messages.released"))},function(e){c.releaseLoading=!1,404===e.status?c.nothingFound=!0:p(n("translate")("feedback.messages.error"))})},c.triggerPrototypeRule=function(){var t,a;t=c.selectedRule.name,a={name:t},c.prototypeLoading=!0,e.prototypeRule(a).then(function(e){f(),c.prototypeLoading=!1,c.prototypeReadyDialog=!0},function(e){c.prototypeLoading=!1,404===e.status?c.nothingFound=!0:p(n("translate")("feedback.messages.error"))})},angular.element(i).bind("keydown",function(e){27!==e.keyCode||c.showSourceActive?27===e.keyCode&&(e.preventDefault(),r.$apply(function(){c.showSourceActive=!1})):(e.preventDefault(),r.$apply(function(){c.detailSheet=!1,c.selectedRule=!1,o(function(){l.sheetOpen=!1},200)}))}),r.$on("$destroy",function(){l.sheetOpen=!1,angular.element(i).unbind("keydown")}),r.$watch("vm.isLoading",function(){r.isLoading=c.isLoading},!1)}angular.module("ewx-components-rule-search").controller("RuleSearchController",e),e.$inject=["RulesService","UserService","feedbackService","$filter","$scope","$window","$timeout","$state","$rootScope"]}(),function(){angular.module("ewx-components-rule-search").directive("ruleSearch",function(){return{scope:{onDetailsSelection:"&onDetailsSelection",onAddSelection:"&onAddSelection",resourceSelector:"=",isLoading:"="},replace:!0,restrict:"AE",controller:"RuleSearchController",controllerAs:"vm",templateUrl:"shared/components/rule-search/rule-search.html",link:function(e){}}})}(),function(){function e(e){return{scope:{},restrict:"A",link:function(t,a){a.on("click",function(){var t=e.getSelection(),n=document.createRange();n.selectNodeContents(a[0]),t.removeAllRanges(),t.addRange(n)})}}}angular.module("ewx-components-select-click").directive("selectClick",e),e.$inject=["$window"]}(),function(){function e(e){var t=this;function a(){e[0].scrollTop=0}t.isOpen=!("isOpen"in t)||t.isOpen,t.closable=!("closable"in t)||t.closable,t.doOpen=function(n){(n=n||!0)&&(t.isOpen=!0);e[0].focus(),a(),"function"==typeof t.onOpen&&t.onOpen.call()},t.doClose=function(){t.isOpen=!1,"function"==typeof t.onClose&&t.onClose.call()},t.scrollToTop=a,t.scrollToBottom=function(){e[0].scrollTop=e[0].scrollHeight}}angular.module("ewx-components-sheet").controller("ewxSheetController",e),e.$inject=["$element"]}(),function(){function e(e){return{scope:!0,bindToController:{isOpen:"=open",closable:"=?",title:"@?",onOpen:"&?",onClose:"&?"},replace:!0,transclude:!0,restrict:"EA",controller:"ewxSheetController",controllerAs:"ewxSheetCtrl",templateUrl:"shared/components/sheet/sheet.html",link:function(t,a,n,r){function i(){e.off("click",o)}function o(e){var t=e.target;if(!("hidden"===angular.element(t).css("visibility"))){for(;t;){if(a[0]===t)return;t=t.parentElement}e.preventDefault(),r.doClose(),i()}}t.$watch("ewxSheetCtrl.isOpen",function(t,a){t?(e.on("click",o),r.doOpen(!1)):i()}),a.on("$destroy",i)}}}angular.module("ewx-components-sheet").directive("ewxSheet",e),e.$inject=["$document"]}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.getSoapEndpoints(a).then(function(e){var t=e.data;t.soapEndpoints&&t.soapEndpoints.forEach(function(e){r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.functionToExecuteOnAdd=a.onSelectSoapEndpoint(),r.updateStorageSearchKey=function(){n.sessionStorage.setItem("soapEndpointsSearchKey",r.filterListing)},n.sessionStorage.getItem("soapEndpointsSearchKey")&&(r.filterListing=n.sessionStorage.getItem("soapEndpointsSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("soapEndpointsSearchKey")}}angular.module("ewx-components-soap-endpoints-search").controller("SoapEndpointsSearchController",e),e.$inject=["SoapService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-soap-endpoints-search").directive("soapEndpointsSearch",function(){return{scope:{onSelectSoapEndpoint:"&onSelectSoapEndpoint"},replace:!0,restrict:"AE",controller:"SoapEndpointsSearchController",controllerAs:"vm",templateUrl:"shared/components/soap-endpoints-search/soap-endpoints-search.html",link:function(){}}})}(),function(){function e(){return{require:"ngModel",link:function(e,t,a,n){n.$parsers.push(function(e){return""+e}),n.$formatters.push(function(e){return parseFloat(e)})}}}angular.module("ewx-components-string-to-number").directive("stringToNumber",e),e.$inject=[]}(),function(){function e(e){return{restrict:"AE",link:function(t,a,n){e(function(){for(var e=a[0].children,t=n.tabGroup,r=function(a){for(var n=0;n<e.length;n++){e[n].children[0].classList.remove("active")}for(var r=document.querySelectorAll('.tabs__panel[data-tab-group="'+t+'"]'),i=0;i<r.length;i++)r[i].style.display="none";var o=a.getAttribute("data-target-tab"),s=document.querySelectorAll('.tabs__panel[data-tab-group="'+t+'"][data-tab-name="'+o+'"]')[0];a.classList.add("active"),s.style.display="block"},i=0;i<e.length;i++){var o=e[i].children[0];o.classList.contains("active")&&r(o),o.addEventListener("click",function(e){e.preventDefault(),r(this)})}},200)}}}e.$inject=["$timeout"],angular.module("ewx-components-tabs").directive("ewxTabs",e)}(),angular.module("ewx-components-tag-search").constant("headerProperties",{properties:[{id:0,enabled:!0,beKey:"accountnumber",uiKEY:"accountnumber",searchKey:"accountnumber"},{id:1,enabled:!0,beKey:"market",uiKEY:"market",searchKey:"market"},{id:2,enabled:!0,beKey:"discocode",uiKEY:"discocode",searchKey:"discocode"},{id:3,enabled:!0,beKey:"zone",uiKEY:"zone",searchKey:"zone"},{id:4,enabled:!0,beKey:"prnumber",uiKEY:"prnumber",searchKey:"prnumber"},{id:5,enabled:!0,beKey:"rateclass",uiKEY:"rateclass",searchKey:"rateclass"},{id:6,enabled:!0,beKey:"profileclass",uiKEY:"profileclass",searchKey:"profileclass"},{id:7,enabled:!0,beKey:"lossclass",uiKEY:"lossclass",searchKey:"lossclass"},{id:8,enabled:!0,beKey:"meterreadcycle",uiKEY:"meterreadcycle",searchKey:"meterreadcycle"},{id:9,enabled:!0,beKey:"metertype",uiKEY:"metertype",searchKey:"metertype"}]}),function(){function e(e,t,a,n,r,i,o,s,l){var c=this,u=null,d=!1;c.updateSearchTerm=function(){c.limitQuantity=0,c.pagingOffset=0,c.searchActive=!1,0===c.searchTerm.length&&(c.foundTags=[],c.limitQuantity=0,c.searchActive=!1,u&&u.cancel());var e={searchString:""},t=[];c.searchOptions.forEach(function(e){var a=e.key();a&&a.length>0&&t.push(a)}),e.searchString=t.join(" AND "),f&&f(t);e.searchString.length>2&&!c.limitSearchTo&&(c.searchTermPagination=e.searchString,m(e,!1));c.limitSearchTo&&(e&&e.searchString&&e.searchString.length>0?c.invertLimitSearchTo?e.searchString=c.limitSearchTo+" AND "+e.searchString:e.searchString=e.searchString+" AND "+c.limitSearchTo:e.searchString=c.limitSearchTo,c.searchTermPagination=e.searchString);c.searchTermPagination=e.searchString,c.selectedDatasourceClassifier&&(e.searchString&&e.searchString.length>0?e.searchString=e.searchString+" AND datasource_classifier = "+c.selectedDatasourceClassifier.name:e.searchString="datasource_classifier = "+c.selectedDatasourceClassifier.name);m(e,!1)},function(){c.userSettingsLoaded=!1,c.searchTerm="",c.limitQuantity=0,c.pagingOffset=0,c.tagTypes=[],c.selectedTagType="",c.foundTags=[],c.isLoading=!1,c.searchActive=!1,c.columnOrder=!1,c.selectEnabled=!1,c.showToolBar=!1,c.editLimitResults=!1,c.chunkSizeOptions=[10,20,30,40,50,60,70,80,90,100],c.currentStateName=s.current.name,c.searchOptions=[],c.currentSearchIndex=-1,c.mapView=!1,c.datasourceClassifiers=[],c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.limitResults?c.chunkSize=e.limitResults:c.chunkSize||(c.chunkSize=20),e.selectEnabled&&(c.selectEnabled=e.selectEnabled),e.invertLimitSearchTo&&(c.invertLimitSearchTo=e.invertLimitSearchTo),e.enableAddToCollection&&(c.addToCollectionEnabled=!0),e.enableCombineToView&&(c.combineToViewEnabled=!0),e.columnOrder&&(c.columnOrder=e.columnOrder),e.editLimitResults&&(c.editLimitResults=e.editLimitResults),e.prevStateId&&(c.prevStateId=e.prevStateId);var r=o.localStorage.getItem(active_namespace_id+"_ewxCollectedDatasources");c.selectedDatasourceCollection=r?JSON.parse(r):[],c.showToolBar=c.columnOrder||c.selectEnabled||c.editLimitResults,c.searchText="",c.limitSearchTo="",c.headerProperties=i,function e(t){var n={limit:100};t&&(n.pageToken=t),a.getDatasourceClassifiers(n).then(function(t){var a=t.data;a.items&&a.items.forEach(function(e){c.datasourceClassifiers.push(e)}),a.nextPageToken?e(a.nextPageToken):c.datasourceClassifiersLoading=!1},function(e){c.datasourceClassifiersLoading=!1})}(),function e(a){var r={limit:1e3};a&&(r.jobId=a),t.tagPropertiesMetaData(r).then(function(t){t&&t.data&&t.data.more&&t.data.jobId?(a||(a=t.data.jobId),n(function(){e(a)},1e3)):t&&t.data&&t.data.usedTags&&(c.autoCompleteSearchOptions={},t.data.usedTags.forEach(function(e){c.autoCompleteSearchOptions[e.tag]=e}),c.searchOptions.forEach(function(e){t.data.usedTags.forEach(function(t){e.autoComplete||(e.autoComplete={}),e.autoComplete[t.tag]=t})}))},function(e){})}()}(),c.checkIfDate=function(e,t){return a=e,n=t,moment(a,n,!0).isValid();var a,n},r.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time),c.userSettings.defaultChunkSize&&(c.chunkSize=parseInt(c.userSettings.defaultChunkSize)||20),c.userSettingsLoaded=!0},function(e){c.userSettingsLoaded=!0}),c.mapClick=function(e){s.go("console.datasources.view",{datasourceIds:e})},c.addFilter=function(){d=!1,c.searchTerm="",c.searchChange("")},c.focus=function(){n(function(){angular.forEach(document.querySelectorAll(".filter-search__pill-input-wrapper .filter-search__pill-input"),function(e){e.focus()})},10)},c.clearFilters=function(){for(var e=c.searchOptions.length-1;e>0;e--)c.searchOptions[e].delete()},c.searchChange=function(e,t){if(!d&&!t){var a={autoComplete:c.autoCompleteSearchOptions,currentLevel:0,levels:[],levelSeparators:["."],keyValueSeparator:"=",value:"",isModifyingValue:!1,key:function(){for(var e="",t=0;t<this.levelSeparators.length;t++){if(t>=this.currentLevel){this.levels[this.currentLevel]&&(e+=this.levels[this.currentLevel]);break}var a=this.levels[t],n=this.levelSeparators[t];a&&n&&(e+=a+n)}return this.levels[this.levelSeparators.length]&&(e+=this.levels[this.levelSeparators.length]),this.isModifyingValue&&(e+=this.keyValueSeparator+this.value),e},addChar:function(e){this.keyValueSeparator===e?this.isModifyingValue=!0:this.levelSeparators.indexOf(e)===this.currentLevel?this.currentLevel++:this.isModifyingValue?this.value+=e:this.levels[this.currentLevel]?this.levels[this.currentLevel]+=e:this.levels[this.currentLevel]=e},getAutocompleteOptions:function(){var e=[];if(0===this.currentLevel&&this.autoComplete){var t=this.key();Object.keys(this.autoComplete).forEach(function(a){0===a.indexOf(t)&&a.length>t.length&&e.push(a)})}else if(1===this.currentLevel&&this.autoComplete&&this.autoComplete.hasOwnProperty(this.levels[this.currentLevel-1])){var a=this.autoComplete[this.levels[this.currentLevel-1]];if(!a)return e;if(this.levels[this.currentLevel-1]&&a.tag===this.levels[this.currentLevel-1])for(var n=0;n<a.keys.length;n++)this.levels[this.currentLevel]?0===a.keys[n].indexOf(this.levels[this.currentLevel])&&a.keys[n].length>this.levels[this.currentLevel].length&&e.push(this.levels[0]+this.levelSeparators[0]+a.keys[n]):e.push(this.levels[0]+this.levelSeparators[0]+a.keys[n])}return e},initWithValue:function(e){this.isModifyingValue=!1,this.levels=[],this.currentLevel=0,this.value="";for(var t=0;t<this.levelSeparators.length;t++){var a=e.indexOf(this.levelSeparators[t]);if(!(a>-1)){this.levels[t]=e,e="";break}this.levels[t]=e.substr(0,a),e=e.substr(a+1),this.currentLevel++}if(e.length>0){var n=e.indexOf(this.keyValueSeparator);n>-1?(this.levels[this.levels.length]=e.substr(0,n),this.value=e.substr(n+1,e.length),this.isModifyingValue=!0):this.levels[this.levels.length]=e}},delete:function(){c.searchOptions.splice(c.searchOptions.indexOf(this),1),c.currentSearchIndex--}};c.searchOptions.push(a),d=!0,c.currentSearchIndex++}var n=t;n||(n=c.searchOptions[c.currentSearchIndex]);var r=n.key();e.length<=r.length||e.indexOf(r)<0||e.length>r.length+1?n.initWithValue(e):n.addChar(e.substr(r.length))},c.toggleVisibility=function(e){e.enabled=!e.enabled,h(),c.loopTags()};var f=e.onSearchTermChanged();function m(a,r){c.userSettingsLoaded?(u&&u.cancel(),c.isLoading=!0,r||(c.pageToken=null),(u=t.searchTagsNewAPI(a.searchString,c.pageToken,c.chunkSize,e.namespace)).then(function(e){if(c.moreResultsAvailable=e.data.more,!e||!e.data||!e.data.metadata||e.data.metadata.totalRows<=0)return c.isLoading=!1,c.searchActive=!0,c.foundTags=null,void(u=null);var t=l.genericPayloadParser(e.data.rows,e.data.metadata.fields);c.pageToken=e.data.pageToken,r?(t.forEach(function(e){c.foundTags.push(e)}),p(c.foundTags),c.loopTags()):(p(t),c.foundTags=t,c.loopTags()),r?c.limitQuantity=c.foundTags.length:c.foundTags.length>c.chunkSize?c.limitQuantity=c.chunkSize:c.limitQuantity=c.foundTags.length,c.searchActive=!0,c.isLoading=!1,u=null},function(e){-1!==e.status&&(c.foundTags=[],c.searchActive=!0,c.isLoading=!1,u=null)})):n(function(){m(a,r)},100)}e.searchOnLoad&&n(function(){c.updateSearchTerm()},200),c.loopTags=function(){h(),c.foundTags.forEach(function(e){var t=[];e.allTagProperties=t,c.headerSorting.forEach(function(a){if(a.enabled){var n=e.tags.filter(function(e){return e.tag===a.name});!n||n.length<1||(a.properties.forEach(function(e){if(e.enabled){var a=n[0].properties.filter(function(t){return t.key===e.name});a&&1===a.length&&t.push(a[0])}}),e.allTagProperties=t)}})})},c.showMoreTags=function(){if(!c.isLoading&&!u&&c.pageToken&&c.moreResultsAvailable){var e={searchString:c.searchTermPagination};c.selectedDatasourceClassifier&&(e.searchString&&e.searchString.length>0?e.searchString=e.searchString+" AND datasource_classifier = "+c.selectedDatasourceClassifier.name:e.searchString="datasource_classifier = "+c.selectedDatasourceClassifier.name),m(e,!0)}};var g=e.onSelectTag();function p(e){var t=o.localStorage.getItem(active_namespace_id+"_ewxColumnSorting");return t&&function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(t)?(t=JSON.parse(t)).forEach(function(e){e.visible=!1,e.properties.forEach(function(e){e.visible=!1})}):t=[],e?(e.forEach(function(e){e.tags.forEach(function(e){var a=0,n=t.filter(function(t){return t.name===e.tag});n&&n.length<1?a=t.push({name:e.tag,enabled:!0,visible:!0,properties:[]})-1:(n[0].visible=!0,a=t.indexOf(n[0])),e.properties.forEach(function(e){var n=t[a].properties,r=n.filter(function(t){return t.name===e.key});r&&r.length<1?n.push({name:e.key,enabled:!0,visible:!0}):r[0].visible=!0})})}),c.headerSorting=t,t):t}function h(){c.headerSorting&&o.localStorage.setItem(active_namespace_id+"_ewxColumnSorting",JSON.stringify(c.headerSorting))}c.selectTag=function(e){g&&g(e)},c.resetSorting=function(){o.localStorage.removeItem(active_namespace_id+"_ewxColumnSorting"),p(c.foundTags),c.loopTags()},c.toggleCollapse=function(e){e.collapse=!e.collapse},c.saveSearch=function(){var e=[];c.searchOptions.forEach(function(t){var a=t.key();a&&a.length>0&&e.push(a)}),c.searchToSave=e},c.loadSearch=function(){c.loadSearches=!0},c.toggleSettings=function(){c.settingsSheetOpen=!c.settingsSheetOpen},c.checkAll=function(){angular.forEach(c.foundTags,function(e){e.selected=!0})},c.unCheckAll=function(){angular.forEach(c.foundTags,function(e){e.selected=!1})},c.getSelectedDatasources=function(){var e=[];return c.foundTags.forEach(function(t){!0===t.selected&&e.push(t)}),w(e,"id")},c.datasourceClassifiersLoading=!0,c.addToCollection=function(){c.foundTags.forEach(function(e){!0===e.selected&&c.selectedDatasourceCollection.push(e)}),c.selectedDatasourceCollection=w(c.selectedDatasourceCollection,"id"),o.localStorage.setItem(active_namespace_id+"_ewxCollectedDatasources",JSON.stringify(c.selectedDatasourceCollection))};var v=e.onClickSelect();c.onClickSelect=function(e){v&&v(e)},c.clearCollection=function(){c.selectedDatasourceCollection=[],o.localStorage.setItem(active_namespace_id+"_ewxCollectedDatasources",JSON.stringify(c.selectedDatasourceCollection))};var S=e.onCombineToView();function w(e,t){for(var a,n=[],r=[],i=0;i<e.length;i++)a=e[i][t],-1===r.indexOf(a)&&(n.push(e[i]),r.push(a));return n}c.combineToView=function(){var e=[];angular.forEach(c.foundTags,function(t){!0===t.selected&&e.push(t)}),c.selectedDatasources=e,c.openMe=!0,S&&S(e)},c.createVirtualDatasource=function(){var e=[];c.searchOptions.forEach(function(t){var a=t.key();a&&a.length>0&&e.push(a)}),c.virtualDatasourceEql=e},c.startFlow=function(){c.startFlowDatasources=[],c.foundTags.forEach(function(e){e.selected&&c.startFlowDatasources.push(e)}),c.triggerFlow=!0},e.$watch("searchFilters",function(){if(c.searchFilters!==e.searchFilters&&e.searchFilters&&e.searchFilters.length>0)try{var t=JSON.parse(e.searchFilters);c.clearFilters();for(var a=0;a<t.length-1;a++)c.searchChange(t[a]),d=!1;c.searchChange(t[t.length-1]),c.searchTerm=t[t.length-1]}catch(t){c.searchChange(e.searchFilters),c.searchTerm=e.searchFilters}}),e.$watch("limitSearchTo",function(){c.limitSearchTo!==e.limitSearchTo&&e.limitSearchTo&&e.limitSearchTo.length>0&&(c.limitSearchTo=e.limitSearchTo)}),e.$watch("vm.foundTags",function(){!c.isLoading&&c.foundTags&&(c.selectedFilesDetected=!1,c.foundTags.forEach(function(e){e.selected&&(c.selectedFilesDetected=!0)}))},!0),e.$watch("vm.settingsSheetOpen",function(){c.settingsSheetOpen&&angular.element(o).bind("keydown",function(t){27===t.keyCode&&(t.preventDefault(),e.$apply(function(){c.settingsSheetOpen=!1}))})}),angular.element(o).bind("keydown",function(e){e.shiftKey&&13===e.keyCode&&(e.preventDefault(),document.getElementById("tagSearchAddFilterButton").click())}),e.$on("$destroy",function(){angular.element(o).unbind("keydown")})}angular.module("ewx-components-tag-search").controller("TagSearchController",e),e.$inject=["$scope","TagService","DataSourceService","$timeout","UserService","headerProperties","$window","$state","UtilService"]}(),function(){angular.module("ewx-components-tag-search").directive("tagSearch",function(){return{scope:{onSelectTag:"&onSelectTag",onSearchTermChanged:"&onSearchTermChanged",onCombineToView:"&onCombineToView",onClickSelect:"&onClickSelect",limitResults:"=",editLimitResults:"@",searchFilters:"@",limitSearchTo:"@",invertLimitSearchTo:"@",selectEnabled:"@",columnOrder:"@",searchOnLoad:"@",prevStateId:"@",disableContextMenu:"@",disableManageTags:"@",enableMap:"@",enableAddToCollection:"@",enableCombineToView:"@",enableSelectDatasourceIdentifiers:"=",enableClickSelect:"@",namespace:"@"},replace:!0,restrict:"AE",controller:"TagSearchController",controllerAs:"vm",templateUrl:"shared/components/tag-search/tag-search.html",link:function(e){}}})}(),function(){function e(e,t){var a=this;a.tags=[],a.sortyBy=r,a.isFutureDate=function(e){if((e=new Date(e))>new Date)return!0},a.topFunction=function(){i.scrollTop=10},a.checkIfDate=function(e,t){return a=e,n=t,moment(a,n,!0).isValid();var a,n},a.filterActiveOnly=function(e){},a.isActiveToggle=function(){a.isActiveSCD?a.activeFilter={isActiveSCD:!0}:a.activeFilter={}},a.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.tags&&e.tags.length>0&&(a.tags=e.tags,r("version")),e.timezone&&(a.timezone=e.timezone);var n=a.tags.filter(function(e){return new Date(e.validFrom)<new Date}).sort(function(e,t){return new Date(t.version)-new Date(e.version)});function r(e){"version"===e&&a.tags.sort(function(e,t){return e=new Date(e.version),(t=new Date(t.version))-e}),"validFrom"===e&&a.tags.sort(function(e,t){return e=new Date(e.validFrom),(t=new Date(t.validFrom))-e})}n.length>0&&(n[0].currentActive=!0),t.getUserSettings().then(function(e){a.userSettings=e,a.userSettings.defaultDateTime&&(a.userDateTimeFormat=a.userSettings.defaultDateTime.date+" "+a.userSettings.defaultDateTime.time)},function(e){});var i=document.getElementById("modalTagTimeline");i&&(i.onscroll=function(){i.scrollTop>20?document.getElementById("tagTimelineScrollTopButton").style.display="block":document.getElementById("tagTimelineScrollTopButton").style.display="none"})}angular.module("ewx-components-tag-timeline").controller("TagTimelineController",e),e.$inject=["$scope","UserService"]}(),function(){function e(){return{scope:{tags:"=",timezone:"="},replace:!0,restrict:"AE",controller:"TagTimelineController",controllerAs:"vm",templateUrl:"shared/components/tag-timeline/tag-timeline.html",link:function(e){}}}angular.module("ewx-components-tag-timeline").directive("tagTimeline",e),e.$inject=[]}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.getTaskFlows(a).then(function(e){var t=e.data;t.taskFlows&&t.taskFlows.forEach(function(e){r.listing.push(e)}),t.nextPageToken?i(t.nextPageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.updateStorageSearchKey=function(){n.sessionStorage.setItem("taskFlowSearchKey",r.filterListing)},n.sessionStorage.getItem("taskFlowSearchKey")&&(r.filterListing=n.sessionStorage.getItem("taskFlowSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("taskFlowSearchKey")};var o=a.onClickSelect();r.onClickSelect=function(e){o&&o(e)}}angular.module("ewx-components-market-adapters-search").controller("TaskFlowSearchController",e),e.$inject=["TasksService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-task-flow-search").directive("taskFlowSearch",function(){return{scope:{onClickSelect:"&onClickSelect",enableClickSelect:"@"},replace:!0,restrict:"AE",controller:"TaskFlowSearchController",controllerAs:"vm",templateUrl:"shared/components/task-flow-search/task-flow-search.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.listTransformationConfigurations(a).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.functionToExecuteOnAdd=a.onSelectConfiguration(),r.updateStorageSearchKey=function(){n.sessionStorage.setItem("tcmSearchKey",r.filterListing)},n.sessionStorage.getItem("tcmSearchKey")&&(r.filterListing=n.sessionStorage.getItem("tcmSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("tcmSearchKey")}}angular.module("ewx-components-tcm-search").controller("TcmSearchController",e),e.$inject=["IngestService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-tcm-search").directive("tcmSearch",function(){return{scope:{onSelectConfiguration:"&onSelectConfiguration"},replace:!0,restrict:"AE",controller:"TcmSearchController",controllerAs:"vm",templateUrl:"shared/components/tcm-search/tcm-search.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(t){var a={limit:100};t&&(a.pageToken=t),e.getTimesliceGroups(a).then(function(e){var t=e.data;t.timesliceGroups&&t.timesliceGroups.forEach(function(e){l.listing.push(e)}),t.nextPageToken?c(t.nextPageToken):l.isLoading=!1},function(e){e.data&&e.data.error&&404===e.data.error.code||(l.errorDialog=!0),l.isLoading=!1})}l.isLoading=!0,l.errorDialog=!1,l.resultLimit=20,l.resultLimitDefault=20,l.listing=[],l.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",l.updateStorageSearchKey=function(){r.sessionStorage.setItem("timesliceGroupSearchKey",l.filterListing)},r.sessionStorage.getItem("timesliceGroupSearchKey")&&(l.filterListing=r.sessionStorage.getItem("timesliceGroupSearchKey")),t.getUserSettings().then(function(e){l.userSettings=e,l.userSettings.defaultDateTime&&(l.userDateTimeFormat=l.userSettings.defaultDateTime.date+" "+l.userSettings.defaultDateTime.time),l.userSettings.defaultChunkSize&&(l.resultLimit=parseInt(l.userSettings.defaultChunkSize)||20,l.resultLimitDefault=parseInt(l.userSettings.defaultChunkSize)||20),c()},function(e){c()}),l.showMoreResults=function(){l.resultLimit=l.resultLimit+l.resultLimitDefault},l.resetResultLimit=function(){l.resultLimit=l.resultLimitDefault},l.resetFilter=function(){l.filterListing="",l.resultLimit=l.resultLimitDefault,r.sessionStorage.removeItem("timesliceGroupSearchKey")};var u=n.onClickSelect();l.onClickSelect=function(e){u&&u(e)},l.getUniqueTimesliceTypes=function(e){var t=[];return e&&e.forEach(function(e){t.push(e.periodType)}),t=t.filter(function(e,t,a){return a.indexOf(e)===t})},angular.element(r).bind("keydown",function(e){27===e.keyCode&&"console.timeslice-groups"===i.current.name&&(e.preventDefault(),n.$apply(function(){l.closeDetails()}))}),n.$on("$destroy",function(){angular.element(r).unbind("keydown")})}angular.module("ewx-components-timeslice-group-search").controller("TimesliceGroupSearchController",e),e.$inject=["TimesliceService","UserService","feedbackService","$scope","$window","$state","$filter","$timeout"]}(),function(){angular.module("ewx-components-timeslice-group-search").directive("timesliceGroupSearch",function(){return{scope:{onClickSelect:"&onClickSelect",enableClickSelect:"@",limitResults:"="},replace:!0,restrict:"AE",controller:"TimesliceGroupSearchController",controllerAs:"vm",templateUrl:"shared/components/timeslice-group-search/timeslice-group-search.html",link:function(e){}}})}(),function(){function e(e){var t=this;e.commercialElements?function(e){var a=1,n=[],r=e,i={cumulativeStoragePoints:{to:0}};for(;a<101;){var o={tierRate:r.tierRate*a,concurrentFlows:{from:Math.abs(r.quotas.concurrentFlows-r.quotas.concurrentFlows*a-1),to:r.quotas.concurrentFlows*a},concurrentRequests:{from:Math.abs(r.quotas.concurrentRequests-r.quotas.concurrentRequests*a-1),to:r.quotas.concurrentRequests*a},cumulativeStoragePoints:{from:1===a?Math.abs(r.quotas.cumulativeStoragePoints-r.quotas.cumulativeStoragePoints*a-1):i.cumulativeStoragePoints.to+1,to:1===a?r.quotas.cumulativeStoragePoints*(a-1)+r.quotas.cumulativeStoragePoints*Math.pow(r.quotas.cumulativeStoragePointsFactor,a-1):i.cumulativeStoragePoints.to+r.quotas.cumulativeStoragePoints*Math.pow(r.quotas.cumulativeStoragePointsFactor,a-1)},priorityFeatures:r.quotas.priorityFeatures*a};1===a&&(o.concurrentFlows.from=0,o.concurrentRequests.from=0,o.cumulativeStoragePoints.from=0,o.cumulativeStoragePoints.to=r.quotas.cumulativeStoragePoints),n.push(o),a++,i=o}t.tierLevels=n}(e.commercialElements):t.noTiersAvailable=!0}angular.module("ewx-components-tier-table").controller("TierTableController",e),e.$inject=["$scope"]}(),function(){function e(){return{scope:{commercialElements:"=",tierLevel:"="},replace:!0,restrict:"AE",controller:"TierTableController",controllerAs:"vm",templateUrl:"shared/components/tier-table/tier-table.html",link:function(e){}}}angular.module("ewx-components-tier-table").directive("tierTable",e),e.$inject=[]}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.getTransportAdapters(a).then(function(e){var t=e.data;t.transportAdapters&&t.transportAdapters.forEach(function(e){r.listing.push(e)}),t.nextPageToken?i(t.nextPageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",r.functionToExecuteOnAdd=a.onSelectTransportAdapter(),r.updateStorageSearchKey=function(){n.sessionStorage.setItem("transportAdapterSearchKey",r.filterListing)},n.sessionStorage.getItem("transportAdapterSearchKey")&&(r.filterListing=n.sessionStorage.getItem("transportAdapterSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),r.userSettings.defaultDateTime&&(r.userDateTimeFormat=r.userSettings.defaultDateTime.date+" "+r.userSettings.defaultDateTime.time),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("transportAdapterSearchKey")}}angular.module("ewx-components-transport-adapters-search").controller("TransportAdaptersSearchController",e),e.$inject=["TransportAdapterService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-transport-adapters-search").directive("transportAdaptersSearch",function(){return{scope:{onSelectTransportAdapter:"&onSelectTransportAdapter"},restrict:"E",controller:"TransportAdaptersSearchController",controllerAs:"vm",templateUrl:"shared/components/transport-adapters-search/transport-adapters-search.html",link:function(e){}}})}(),function(){function e(e,t,a,n){var r=this;function i(t){var a={limit:100};t&&(a.pageToken=t),e.getTriggers(a).then(function(e){var t=e.data;t.triggers&&t.triggers.forEach(function(e){r.listing.push(e)}),t.pageToken?i(t.pageToken):r.isLoading=!1},function(e){r.isLoading=!1,r.errorDialog=!0})}r.isLoading=!0,r.errorDialog=!1,r.resultLimit=20,r.resultLimitDefault=20,r.listing=[],r.functionToExecuteOnAdd=a.onSelectTrigger(),r.updateStorageSearchKey=function(){n.sessionStorage.setItem("triggersSearchKey",r.filterListing)},n.sessionStorage.getItem("triggersSearchKey")&&(r.filterListing=n.sessionStorage.getItem("triggersSearchKey")),t.getUserSettings().then(function(e){r.userSettings=e,r.userSettings.defaultChunkSize&&(r.resultLimit=parseInt(r.userSettings.defaultChunkSize)||20,r.resultLimitDefault=parseInt(r.userSettings.defaultChunkSize)||20),i()},function(e){i()}),r.showMoreResults=function(){r.resultLimit=r.resultLimit+r.resultLimitDefault},r.resetResultLimit=function(){r.resultLimit=r.resultLimitDefault},r.resetFilter=function(){r.filterListing="",r.resultLimit=r.resultLimitDefault,n.sessionStorage.removeItem("triggersSearchKey")}}angular.module("ewx-components-triggers-search").controller("TriggersSearchController",e),e.$inject=["TriggersService","UserService","$scope","$window"]}(),function(){angular.module("ewx-components-triggers-search").directive("triggersSearch",function(){return{scope:{onSelectTrigger:"&onSelectTrigger"},restrict:"E",controller:"TriggersSearchController",controllerAs:"vm",templateUrl:"shared/components/triggers-search/triggers-search.html"}})}(),function(){function e(e,t,a,n,r,i,o){var s=this,l=null;function c(t,a){e.addMessage({type:a,message:t})}s.finishUpload=function(){s.exceptionsDialog=!1,s.exceptions=[];var e=t.onLoaded();e&&e()},t.filePath?s.filePath=t.filePath:s.filePath="UPLOAD",t.tagsEnabled&&(s.tagsEnabled=!0),s.maxUploadSize=2147483648,s.log="",s.tags=[],s.uploading=!1,s.tagValidationPattern="^[a-zA-Z0-9-_]+$",s.upload=function(e){s.uploading=!1,s.processing=!1;var u={},d=0;if(e&&e.length){for(var f=0;f<e.length;f++){var m=e[f];m.tags=s.tags,m.$error||(u["file-"+d]=m,d++)}var g="";s.tags&&s.tags.length>0&&(g=","+s.tags.join()),d>0&&i.get("/_ah/api/ewx/v1/storage/files/uploadurl?subdir="+s.filePath+"&streaming=true&tags=console,manual"+g).then(function(e){!function(e,u){l=o.defer(),s.uploading=!0,i({method:"POST",url:e,cache:!1,processData:!1,headers:{"Content-Type":void 0},data:u,transformRequest:function(e){var t=new FormData;return angular.forEach(e,function(e,a){t.append(a,e,e.name),t.append("filename",e.name),t.append("name",e.name)}),t},uploadEventHandlers:{progress:function(e){s.progress=parseFloat(100*e.loaded/e.total),s.progress>=100&&(s.processing=!0)}},timeout:l.promise}).then(function(e){if(l=null,s.uploading=!1,e.data&&e.data.exceptions&&e.data.exceptions.length>0)s.exceptionsDialog=!0,s.exceptions=e.data.exceptions;else{var i=t.onLoaded();i&&i(),c(a("translate")("feedback.messages.uploadOk"))}s.tags=[],r(function(){var t=[];s.files.forEach(function(e){t.push(e.name)}),s.log="Uploaded the following file(s):\n\n"+t.join("\n"),s.files=[],n.uploadUri=e.data.uploadUri})},function(e){(l=null,s.uploading=!1,-1!==e.status)&&(r(function(){s.log+="Response: "+JSON.stringify(e.data)+"\n",e.data&&(n.uploadUri=e.data.uploadUri)}),c(a("translate")("feedback.messages.error"),"error"))})}(e.data.uploadUrl,u)},function(e){})}},s.cancelUpload=function(){l&&(l.resolve(),l=null);var e=t.onCancel();e&&e()},s.addTag=function(){return s.hasDuplicateName=!1,s.reservedTag=!1,!!s.addTagForm.$valid&&("console"===s.tag||"manual"===s.tag?(s.reservedTag=!0,!1):void(s.tags.indexOf(s.tag)>-1?s.hasDuplicateName=!0:(s.tags.push(s.tag),s.addTagForm.$setPristine(),s.tag="")))},s.removeTag=function(e){s.tags.splice(e,1)},s.tagNameChanged=function(){s.hasDuplicateName=!1,s.reservedTag=!1,s.addTagForm.$submitted=!1},t.$watch("vm.file",function(){s.file&&null!==s.file&&(s.files=[s.file])})}angular.module("ewx-components-upload").controller("UploadModuleController",e),e.$inject=["feedbackService","$scope","$filter","$window","$timeout","$http","$q"]}(),function(){function e(){return{scope:{filePath:"=",onLoaded:"&onLoaded",tagsEnabled:"=?"},replace:!0,restrict:"A",controller:"UploadModuleController",controllerAs:"vm",templateUrl:"shared/components/upload/upload.html",link:function(e){}}}angular.module("ewx-components-upload").directive("upload",e),e.$inject=[]}(),function(){function e(e,t,a,n,r,i){var o=this;function s(t){var n={limit:100};t&&(n.pageToken=t),a.groupId&&a.groupId.length>0&&(n.groupIds=a.groupId,o.groupId=a.groupId,o.filterByGroup=!0,a.groupName?o.groupName=a.groupName:e.getGroupById(o.groupId).then(function(e){o.groupName=e.name},function(e){})),e.getUsers(n).then(function(e){var t=e.data;t.items&&t.items.forEach(function(e){o.listing.push(e)}),t.nextPageToken?s(t.nextPageToken):o.isLoading=!1},function(e){o.isLoading=!1,o.errorDialog=!0})}o.isLoading=!0,o.errorDialog=!1,o.resultLimit=20,o.resultLimitDefault=20,o.listing=[],o.filterByGroup=!1,o.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",o.updateStorageSearchKey=function(){n.sessionStorage.setItem("iamUserSearchKey",o.filterListing)},n.sessionStorage.getItem("iamUserSearchKey")&&(o.filterListing=n.sessionStorage.getItem("iamUserSearchKey")),i(function(){document.getElementById("userSearchKeyInput").focus()}),t.getUserSettings().then(function(e){o.userSettings=e,o.userSettings.defaultDateTime&&(o.userDateTimeFormat=o.userSettings.defaultDateTime.date+" "+o.userSettings.defaultDateTime.time),o.userSettings.defaultChunkSize&&(o.resultLimit=parseInt(o.userSettings.defaultChunkSize)||20,o.resultLimitDefault=parseInt(o.userSettings.defaultChunkSize)||20),s()},function(e){s()}),o.showMoreResults=function(){o.resultLimit=o.resultLimit+o.resultLimitDefault},o.resetResultLimit=function(){o.resultLimit=o.resultLimitDefault},o.resetFilter=function(){o.filterListing="",o.resultLimit=o.resultLimitDefault,n.sessionStorage.removeItem("iamUserSearchKey")};var l=r.onClickSelect();o.onClickSelect=function(e){l&&l(e)}}angular.module("ewx-components-user-search").controller("UserSearchController",e),e.$inject=["IamService","UserService","$stateParams","$window","$scope","$timeout"]}(),function(){angular.module("ewx-components-user-search").directive("userSearch",function(){return{scope:{onClickSelect:"&onClickSelect",enableClickSelect:"@"},replace:!0,restrict:"AE",controller:"UserSearchController",controllerAs:"vm",templateUrl:"shared/components/user-search/user-search.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r,i,o,s,l){var c=this;if(c.types=[],c.statuses=[],c.collapseTaskFlowDetails=!0,c.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",c.paginationCount=10,c.openTaskDetails=function(e){n.go("console.tasks.flows.details.task",{taskId:e,orderByRanking:c.flow.orderByRanking},{})},c.toggleEditFlow=function(e){e?c.originalFlow&&(c.flow=c.originalFlow,c.originalFlow=!1):(c.originalFlow=angular.copy(c.flow),v(c.flow.flowSteps,c.statuses));c.editMode=!c.editMode},c.addLane=function(){c.flow.flowSteps||(c.flow.flowSteps=[]);var e={name:"New Lane",trigger:"",stepOrder:c.flow.flowSteps.length};c.flow.flowSteps.length<c.maxLanes&&(c.flow.flowSteps.push(e),C())},c.deleteLane=function(e){c.flow.flowSteps.splice(e,1),v(c.flow.flowSteps,c.statuses),C()},c.moveLane=function(e){c.flow.flowSteps.splice(e,1),C()},c.saveTaskFlow=y,c.setFlowStepOrder=C,c.deleteTaskFlow=function(){c.deletingTaskFlow=!0,e.deleteTaskFlow(c.flow.id).then(function(e){c.deletingTaskFlow=!1,A(r("translate")("feedback.messages.ok")),n.go("^")},function(e){c.deletingTaskFlow=!1,n.go("^"),e.data&&e.data.error&&e.data.error.message?b(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):b(r("translate")("feedback.messages.error"))})},c.getDueCountdown=k,c.updateTask=function(t,a,n,i,o,s){var l=t.target.parentNode.dataset.laneIndex,u=t.target.parentNode.dataset.statusIndex,d=void 0;l&&u&&(d=c.flow.flowSteps[l].statuses[u]);if(d){var f=n;f.status={status:d.status},c.isUpdating=!0,e.updateTask(f).then(function(e){c.isUpdating=!1,w(c.flow,!0)},function(e){c.isUpdating=!1,e.data&&e.data.error&&e.data.error.message?b(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):b(r("translate")("feedback.messages.error"))})}},c.updateStorageSearchKey=function(e){o.sessionStorage.setItem("taskFlowDetailsFilter"+e,c.filterListing)},c.refreshTaskFlow=function(){c.newVersionAvailable=!1,m&&s.cancel(m);if(c.assignedToMe){var e=auth_email;S(i.taskFlowId,e,!0)}else S(i.taskFlowId,!0)},c.addStatusToLane=function(e){e.statuses||(e.statuses=[]);e.selectedStatus&&(e.statuses.push(e.selectedStatus),v(c.flow.flowSteps,c.statuses))},c.deleteStatusFromLane=function(e,t){t.statuses.forEach(function(a,n){a.status===e.status&&t.statuses.splice(n,1)}),v(c.flow.flowSteps,c.statuses)},c.dragStart=function(e){c.dragActive=!0,c.flow.flowSteps.forEach(function(t,a){t.dragNotCurrent=a!==e})},c.dragEnd=function(){c.dragActive=!1},c.moveTask=function(e,t,a){t.tasks&&t.tasks.splice(e,1)},c.toggleAsignedtoMe=function(){var e=auth_email;s.cancel(m),c.assignedToMe?S(i.taskFlowId,e):S(i.taskFlowId)},c.filterStatuses=v,c.showMoreTasks=function(e,t){e.showLimit=e.showLimit+c.paginationCount,l.$evalAsync()},c.updateRankingSlider=function(){c.flow.maxRankingBoundary||0===c.flow.maxRankingBoundary||(c.flow.maxRankingBoundary=1e3);c.flow.minRankingBoundary||(c.flow.minRankingBoundary=0);c.rankingColors.options.floor=parseInt(c.flow.minRankingBoundary),c.rankingColors.options.ceil=parseInt(c.flow.maxRankingBoundary)},i.taskFlowId){c.assignedToMe=!0;var u=auth_email;S(i.taskFlowId,u,!1)}else c.nothingFoundDialog=!0;var d=8e3,f=0,m=void 0,g=!1,p=void 0;function h(t){m=s(function(){!function(t){c.isPolling=!0;var a={id:t,includeTasks:!1};p&&p.cancel(),(p=e.getTaskFlow(a)).then(function(e){c.isPolling=!1,e.data&&e.data.updatedDatetime&&e.data.updatedDatetime!==c.flow.updatedDatetime&&(c.newVersionAvailable=!0),f=0,g||c.isLoading||h()},function(e){c.isPolling=!1,g||h(2*++f*d)})}(i.taskFlowId)},t=t||d)}function v(e,t){var a=[];e&&e.forEach(function(e){e.statuses?e.statuses.forEach(function(e){a.push(e)}):e.statuses=[]}),t.forEach(function(e){var t=a.filter(function(t){return t.status===e.status});e.disabled=!1,t&&1===t.length&&(e.disabled=!0)});var n=t.filter(function(e){return e.disabled});c.allStatusesInUse=!1,n&&n.length&&t.length===n.length&&(c.allStatusesInUse=!0)}function S(t,a,n){c.isLoading=!0,n&&(c.isLoading=!1,c.subtleLoading=!0);var i={id:t,includeTasks:!0};a&&(i.assignee=a),e.getTaskFlow(i).then(function(e){c.flow=e.data,C(),function(e){e.flowSteps&&e.flowSteps.length>0&&e.tasks&&e.tasks.length>0&&e.tasks.forEach(function(t){e.flowSteps.forEach(function(e){e.statuses&&e.statuses.forEach(function(e){e.showLimit=c.paginationCount,e.tasks||(e.tasks=[]),e.status===t.status.status&&e.tasks.push(t)})})});w(e)}(c.flow),c.isLoading=!1,c.subtleLoading=!1,c.flow.rankingWarningThreshold=parseInt(c.flow.rankingWarningThreshold),c.flow.rankingAlertThreshold=parseInt(c.flow.rankingAlertThreshold),function(e,t){e||0===e||(e=500);t||0===t||(t=800);c.rankingColors={minValue:e,maxValue:t,options:{floor:parseInt(c.flow.minRankingBoundary),ceil:parseInt(c.flow.maxRankingBoundary),step:1,noSwitching:!0,draggableRange:!0,translate:function(e,t,a){switch(a){case"model":return'<b style="color: #fa0">'+r("translate")("generic.warning")+": "+e+"</b>";case"high":return'<b style="color: #ff5841">'+r("translate")("generic.alert")+": "+e+"</b>";default:return""+e}},getPointerColor:function(e,t){return"min"===t?"#fa0":"#ff5841"},getSelectionBarColor:function(e){return"#fa0"},showSelectionBar:!0,showSelectionBarEnd:!0}}}(c.flow.rankingWarningThreshold,c.flow.rankingAlertThreshold),o.sessionStorage.getItem("taskFlowDetailsFilter"+c.flow.id)&&(c.filterListing=o.sessionStorage.getItem("taskFlowDetailsFilter"+c.flow.id)),h(d)},function(e){c.isLoading=!1,c.subtleLoading=!1,e&&404===e.status?c.nothingFoundDialog=!0:c.errorDialog=!0})}function w(e,t){!function(e){if(e){var t=e.map(function(e){return moment(e.endDatetime)}),a=moment.max(t)}}(e.tasks);e.flowSteps&&e.flowSteps.length>0&&(e.flowSteps.forEach(function(t,a){t.statuses&&t.statuses.length>0&&t.statuses.forEach(function(t){e.orderByRanking?(t.taskOrder=[],t.tasks&&t.tasks.length>0&&t.tasks.sort(T(!0)).forEach(function(e){t.taskOrder.push(e.id)})):(t.taskOrder=[],t.tasks&&t.tasks.length>0&&t.tasks.sort(T()).forEach(function(e){t.taskOrder.push(e.id)}))})}),t&&y(!0)),function(e){e.flowSteps&&e.flowSteps.length>0&&e.flowSteps.forEach(function(t,a){a<e.flowSteps.length-1&&t.statuses&&t.statuses.length>0?t.statuses.forEach(function(e){e.tasks&&e.tasks.length>0&&e.tasks.forEach(function(e){e.endDatetime&&(e.due=k(e.endDatetime))})}):t.statuses&&t.statuses.length>0&&t.statuses.forEach(function(e){e.tasks&&e.tasks.length>0&&e.tasks.forEach(function(e){delete e.due})})})}(e)}function T(e,t){return function(a,n){if(e){if(a.ranking||(a.ranking=0),n.ranking||(n.ranking=0),parseInt(a.ranking)<parseInt(n.ranking))return 1;if(parseInt(a.ranking)>parseInt(n.ranking))return-1}else{if(a.priorityNumber=0,"high"===a.priority?a.priorityNumber=2:"medium"===a.priority&&(a.priorityNumber=1),n.priorityNumber=0,"high"===n.priority?n.priorityNumber=2:"medium"===n.priority&&(n.priorityNumber=1),a.priorityNumber<n.priorityNumber)return 1;if(a.priorityNumber>n.priorityNumber)return-1}return a.endDatetimeObj=new Date(a.endDatetime),n.endDatetimeObj=new Date(n.endDatetime),a.endDatetime||(a.endDatetimeObj=moment(t).add(1,"d")),n.endDatetime||(n.endDatetimeObj=moment(t).add(1,"d")),a.endDatetimeObj>n.endDatetimeObj?1:a.endDatetimeObj<n.endDatetimeObj?-1:void 0}}function C(){c.flow.flowSteps&&c.flow.flowSteps.length>0&&c.flow.flowSteps.forEach(function(e,t){e.stepOrder=t})}function y(t){if(c.savingTaskFlow=!0,!t&&(!c.taskFlowForm.$valid||c.duplicateStatuses))return c.savingTaskFlow=!1,c.collapseTaskFlowDetails=!1,!1;c.flow.flowSteps&&c.flow.flowSteps.length>0&&c.flow.flowSteps.forEach(function(e){e.statuses&&e.statuses.forEach(function(e){delete e.id})}),c.flow.orderByRanking&&c.rankingColors&&(c.flow.rankingWarningThreshold=parseInt(c.rankingColors.minValue),c.flow.rankingAlertThreshold=parseInt(c.rankingColors.maxValue)),e.updateTaskFlow(c.flow).then(function(e){if(e.data&&e.data.updatedDatetime&&(c.flow.updatedDatetime=e.data.updatedDatetime),c.savingTaskFlow=!1,c.editMode=!1,!t){A(r("translate")("feedback.messages.ok"));var a=auth_email;c.assignedToMe?S(c.flow.id,a):S(c.flow.id)}},function(e){c.savingTaskFlow=!1,t||(e.data&&e.data.error&&e.data.error.message?b(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):b(r("translate")("feedback.messages.error")))})}function k(e){var t="",a="days",n=moment(),r=n.diff(e,a),i=moment(e).diff(n),o=moment.utc(i).format("HH"),s=moment.utc(i).format("mm");return n>=moment(e)?t="alert":-1===r?(t="warning",a="hours",o=-(o=n.diff(e,"hours"))):0===r&&(a="hours",t="warning",0===(r=n.diff(e,a))&&(a="minutes",r=n.diff(e,a))),{diff:Math.abs(r),unit:a,severity:t,countdownHours:parseInt(o,10),countdownMinutes:parseInt(s,10)}}function A(e,t){a.addMessage({type:t,message:e})}function b(e){A(e,"error")}t.getUserSettings().then(function(e){c.userSettings=e,c.userSettings.defaultDateTime&&(c.userDateTimeFormat=c.userSettings.defaultDateTime.date+" "+c.userSettings.defaultDateTime.time),e.paginationCountTasks&&parseInt(e.paginationCountTasks)&&(c.paginationCount=parseInt(e.paginationCountTasks))},function(e){}),function t(a){c.isLoadingTypes=!0;var n={limit:100};a&&(n.pageToken=a),e.getTypes(n).then(function(e){var a=e.data;a.taskTypes&&a.taskTypes.length>0&&a.taskTypes.forEach(function(e){var t={type:e.type};c.types.push(t)}),a.pageToken?t(a.pageToken):c.isLoadingTypes=!1},function(e){c.isLoadingTypes=!1,c.errorDialogTypes=!0})}(),function t(a){c.isLoadingstatuses=!0;var n={limit:100};a&&(n.pageToken=a),e.getStatuses(n).then(function(e){var a=e.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){var t={status:e.status};c.statuses.push(t)}),a.pageToken?t(a.pageToken):c.isLoadingstatuses=!1,c.maxLanes=c.statuses.length},function(e){c.isLoadingstatuses=!1,c.errorDialogstatuses=!0})}(),l.$on("$destroy",function(){g=!0,m&&s.cancel(m)})}angular.module("console.tasks").controller("TasksFlowDetailsController",e),e.$inject=["TasksService","UserService","feedbackService","$state","$filter","$stateParams","$window","$timeout","$scope"]}(),function(){function e(e,t,a,n,r){var i=this;function o(e,t){var a=[];e.forEach(function(e){e.statuses?e.statuses.forEach(function(e){a.push(e)}):e.statuses=[]}),t.forEach(function(e){var t=a.filter(function(t){return t.status===e.status});e.disabled=!1,t&&1===t.length&&(e.disabled=!0)});var n=t.filter(function(e){return e.disabled});i.allStatusesInUse=!1,n&&n.length&&t.length===n.length&&(i.allStatusesInUse=!0)}function s(){i.flow.flowSteps.forEach(function(e,t){e.stepOrder=t})}function l(e,t){a.addMessage({type:t,message:e})}function c(e){l(e,"error")}i.flow={name:"New Board",description:"",flowSteps:[],minRankingBoundary:0,maxRankingBoundary:1e3},i.types=[],i.statuses=[],i.collapseTaskFlowDetails=!1,i.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",i.rankingColors={minValue:500,maxValue:800,options:{floor:0,ceil:1e3,step:1,noSwitching:!0,draggableRange:!0,translate:function(e,t,a){switch(a){case"model":return'<b style="color: #fa0">'+r("translate")("generic.warning")+": "+e+"</b>";case"high":return'<b style="color: #ff5841">'+r("translate")("generic.alert")+": "+e+"</b>";default:return""+e}},getPointerColor:function(e,t){return"min"===t?"#fa0":"#ff5841"},getSelectionBarColor:function(e){return"#fa0"},showSelectionBar:!0,showSelectionBarEnd:!0}},i.addLane=function(){var e={name:"New Lane",trigger:"",stepOrder:i.flow.flowSteps.length};i.flow.flowSteps.length<i.maxLanes&&(i.flow.flowSteps.push(e),s())},i.deleteLane=function(e){i.flow.flowSteps.splice(e,1),s()},i.moveLane=function(e){i.flow.flowSteps.splice(e,1),s()},i.saveTaskFlow=function(){if(i.savingTaskFlow=!0,!i.taskFlowForm.$valid||i.duplicateStatuses)return i.savingTaskFlow=!1,i.collapseTaskFlowDetails=!1,!1;i.flow.orderByRanking&&i.rankingColors.minValue>0&&i.rankingColors.maxValue>0&&(i.flow.rankingWarningThreshold=i.rankingColors.minValue,i.flow.rankingAlertThreshold=i.rankingColors.maxValue);e.createTaskFlow(i.flow).then(function(e){i.savingTaskFlow=!1,l(r("translate")("feedback.messages.ok")),n.go("^")},function(e){i.savingTaskFlow=!1,e.data&&e.data.error&&e.data.error.message?c(r("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):c(r("translate")("feedback.messages.error"))})},i.setOrderValues=s,i.filterStatuses=o,i.deleteStatusFromLane=function(e,t){t.statuses.forEach(function(a,n){a.status===e.status&&t.statuses.splice(n,1)}),o(i.flow.flowSteps,i.statuses)},i.addStatusToLane=function(e){e.statuses||(e.statuses=[]);e.selectedStatus&&(e.statuses.push(e.selectedStatus),o(i.flow.flowSteps,i.statuses))},i.updateRankingSlider=function(){i.flow.maxRankingBoundary||0===i.flow.maxRankingBoundary||(i.flow.maxRankingBoundary=1e3);i.flow.minRankingBoundary||(i.flow.minRankingBoundary=0);i.rankingColors.options.floor=parseInt(i.flow.minRankingBoundary),i.rankingColors.options.ceil=parseInt(i.flow.maxRankingBoundary)},t.getUserSettings().then(function(e){i.userSettings=e,i.userSettings.defaultDateTime&&(i.userDateTimeFormat=i.userSettings.defaultDateTime.date+" "+i.userSettings.defaultDateTime.time)},function(e){}),function t(a){i.isLoadingstatuses=!0;var n={limit:100};a&&(n.pageToken=a),e.getStatuses(n).then(function(e){var a=e.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){var t={status:e.status};i.statuses.push(t)}),a.pageToken?t(a.pageToken):i.isLoadingstatuses=!1,0===i.statuses.length&&(i.setupNeeded=!0),i.maxLanes=i.statuses.length},function(e){i.isLoadingstatuses=!1,i.errorDialogstatuses=!0})}()}angular.module("console.tasks").controller("TasksFlowCreateController",e),e.$inject=["TasksService","UserService","feedbackService","$state","$filter"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e,a){t.addMessage({type:a,message:e})}l.tagValidationPattern="^[a-zA-Z0-9-_]+$",l.tags=[],a.files&&(l.files=a.files,function(){l.readOnlyFiles=[];var e=[];l.files.forEach(function(t){t.readOnly?l.readOnlyFiles.push(t):e.push(t)}),l.files=e}()),l.addTag=function(){if(l.hasDuplicateName=!1,!l.addTagForm.$valid)return!1;l.tags.indexOf(l.tag)>-1?l.hasDuplicateName=!0:(l.tags.push(l.tag),l.addTagForm.$submitted=!1)},l.removeTag=function(e){l.tags.splice(e,1)},l.tagNameChanged=function(){l.hasDuplicateName=!1},l.saveTags=function(){if(l.addTagLoading=!0,!l.addTagForm.$valid)return l.addTagLoading=!1,!1;var t=[];l.files.forEach(function(e){e.tags||(e.tags=[]),t.push(e.blobKey)});for(var i=[];t.length>0;)i.push(t.splice(0,15));var o=0;i.forEach(function(t){o++,function(t,i,o,u){e.addTags(t,i).then(function(){o===u&&s(function(){l.addTagLoading=!1,c(n("translate")("feedback.messages.ok")),a.results&&(l.originalResults=a.results,l.files.forEach(function(e){l.originalResults.forEach(function(t){e.blobKey===t.blobKey&&(t.tags||(t.tags=[]),l.tags.forEach(function(e){t.tags.push(e)}))})})),r.go("console.tasks",{updatedResults:l.originalResults,originalPageToken:a.pageToken,originalMoreResultsAvailable:a.moreResultsAvailable,originalLimitQuantity:a.limitQuantity})},2e3)},function(e){l.addTagLoading=!1,c(n("translate")("feedback.messages.error"),"error")})}(t,l.tags,i.length,o)})},angular.element(i).bind("keydown",function(e){27===e.keyCode&&"console.tasks.search.add-tags"===r.$current.name&&(e.preventDefault(),r.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.tasks").controller("TasksAddTagsController",e),e.$inject=["StorageService","feedbackService","$stateParams","$filter","$state","$window","$scope","$timeout"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e,t){a.addMessage({type:t,message:e})}function u(e){c(e,"error")}l.updateTasks=function(){l.tasks.forEach(function(e){l.selectedAssignee&&(e.assignee=l.selectedAssignee.email),l.selectedStatus&&(e.status={status:l.selectedStatus.status}),l.selectedType&&(e.type={type:l.selectedType.type}),l.selectedPriority&&(e.priority=l.selectedPriority),l.selectedTaskFlow&&(e.flowIds||(e.flowIds=[]),e.flowIds.push(l.selectedTaskFlow.id)),l.endDatetime&&(e.endDatetime=l.endDatetime),e.endDatetime&&(e.endDatetime=moment(e.endDatetime).set({second:0,millisecond:0}).format("YYYY-MM-DDTHH:mm:ss.SSS")),delete e.type.id,delete e.status.id,delete e.updatedDatetime,delete e.createdDatetime,delete e.commentCount});var e={tasks:l.tasks};l.isUpdating=!0,t.updateTasks(e).then(function(e){l.isUpdating=!1,c(s("translate")("feedback.messages.ok")),r.go("^")},function(e){l.isUpdating=!1,e.data&&e.data.error&&e.data.error.message?u(s("translate")("feedback.messages.errorIntro")+" "+e.data.error.message):u(s("translate")("feedback.messages.error"))})},l.selectUser=function(e){l.selectedAssignee=e,l.searchUsersActive=!1},l.selectTaskFlow=function(e){l.selectedTaskFlow=e,l.searchTaskFlowsActive=!1},l.addTag=function(){if(l.hasDuplicateName=!1,!l.addTagForm.$valid)return!1;l.tags.indexOf(l.tag)>-1?l.hasDuplicateName=!0:(l.tags.push(l.tag),l.addTagForm.$submitted=!1)},l.timezone=moment.tz.guess(),l.currentDatetime=moment(),l.types=[],l.statuses=[],l.priorities=e.getPriorities(),o.tasks&&(l.tasks=o.tasks,function(){l.readOnlyTasks=[];var e=[];l.tasks.forEach(function(t){t.readOnly?l.readOnlyTasks.push(t):e.push(t)}),l.tasks=e}()),function e(a){l.isLoadingTypes=!0;var n={limit:100};a&&(n.pageToken=a),t.getTypes(n).then(function(t){var a=t.data;a.taskTypes&&a.taskTypes.length>0&&a.taskTypes.forEach(function(e){l.types.push(e)}),a.pageToken?e(a.pageToken):l.isLoadingTypes=!1},function(e){l.isLoadingTypes=!1,l.errorDialogTypes=!0})}(),function e(a){l.isLoadingstatuses=!0;var n={limit:100};a&&(n.pageToken=a),t.getStatuses(n).then(function(t){var a=t.data;a.taskStatuses&&a.taskStatuses.length>0&&a.taskStatuses.forEach(function(e){l.statuses.push(e)}),a.pageToken?e(a.pageToken):l.isLoadingstatuses=!1},function(e){l.isLoadingstatuses=!1,l.errorDialogstatuses=!0})}(),angular.element(n).bind("keydown",function(e){27===e.keyCode&&"console.tasks.search.manage-tasks"===r.$current.name&&(e.preventDefault(),r.go("^"))}),i.$on("$destroy",function(){angular.element(n).unbind("keydown")})}angular.module("console.tasks").controller("TasksManageController",e),e.$inject=["ConstantsService","TasksService","feedbackService","$window","$state","$scope","$stateParams","$filter"]}(),function(){function e(e,t,a,n,r,i,o,s){var l=this;function c(e){if("console"===e||"manual"===e)return!0}function u(e,a){t.addMessage({type:a,message:e})}l.tagList=[],l.selectAll=function(){l.tagList.forEach(function(e){c(e.tag)||(e.selected=!0)})},l.unSelectAll=function(){l.tagList.forEach(function(e){e.selected=!1})},l.removeTags=function(){l.removeTagLoading=!0;var t=[];l.tagList.forEach(function(e){e.selected&&t.push(e.tag)}),l.selectedTags=t;var i=[];l.tasks.forEach(function(e){e.readOnly||i.push(e)});var o=[];for(;i.length>0;)o.push(i.splice(0,15));var c=0;o.forEach(function(i){c++,function(t,i,o,c){e.deleteTags(t,i).then(function(){o===c&&s(function(){a.results&&(l.originalResults=a.results,l.tasks.forEach(function(e){l.originalResults.forEach(function(t){e.blobKey===t.blobKey&&(t.tags||(t.tags=[]),l.selectedTags.forEach(function(e){var a=t.tags.indexOf(e);-1!==a&&t.tags.splice(a,1)}))})})),l.removeTagLoading=!1,u(n("translate")("feedback.messages.removed")),r.go("console.file-management",{updatedResults:l.originalResults,originalPageToken:a.pageToken,originalMoreResultsAvailable:a.moreResultsAvailable,originalLimitQuantity:a.limitQuantity})},2e3)},function(e){l.removeTagLoading=!1,u(n("translate")("feedback.messages.error")+" (Error: "+e.data.error.message+")","error")})}(i,t,o.length,c)})},l.lockedTag=c,a.tasks&&(l.tasks=a.tasks,function(){l.readOnlyTasks=[];var e=[];l.tasks.forEach(function(t){t.readOnly?l.readOnlyTasks.push(t):e.push(t)}),l.tasks=e,function(e){var t=[];e.forEach(function(e){e.tags&&!e.readOnly&&e.tags.forEach(function(e){t.push(e)})});var a=[];t.forEach(function(e){a.indexOf(e)<0&&a.push(e)}),a.forEach(function(e){var t={tag:e};l.tagList.push(t)})}(l.tasks)}()),o.$watch("vm.tagList",function(){l.tagList&&(l.selectedTasksDetected=!1,l.tagList.forEach(function(e){e.selected&&(l.selectedTasksDetected=!0)}))},!0),angular.element(i).bind("keydown",function(e){27===e.keyCode&&"console.tasks.search.remove-tags"===r.$current.name&&(e.preventDefault(),r.go("^"))}),o.$on("$destroy",function(){angular.element(i).unbind("keydown")})}angular.module("console.tasks").controller("TasksRemoveTagsController",e),e.$inject=["StorageService","feedbackService","$stateParams","$filter","$state","$window","$scope","$timeout"]}(),function(){function e(e,t){var a=this;function n(e){if(e.validated=!1,e.tabTags=[{name:t("translate")("tcm.componentStatus.configurationPending"),status:"warning"}],e.channelId&&(e.channelClassifier||(e.channelClassifier={}),e.channelClassifier.name=e.channelId),e.channelClassifier&&e.channelClassifier.field&&(e.hasDynamicChannelClassifier=!0),!e.value&&!e.annotations)return!1;if(!(e.index||e.start&&e.stop))return!1;if(e.cleansingConfigurations&&e.cleansingConfigurations.length>0){var a=!1;if(e.cleansingConfigurations.forEach(function(e){e.name||(a=!0)}),a)return!1}if(e.index&&e.index.properties&&e.index.properties.length>0){var n=e.index.properties.filter(function(e){return"index_type"===e.key});n&&n.length>0&&e.index.properties.forEach(function(t){"index_type"===t.key.toLowerCase()&&(e.indexType=t.value)})}return!(e.annotations&&!e.annotations.key)&&(!(!e.channelClassifier||e.channelClassifier&&!e.channelClassifier.field&&!e.channelClassifier.staticValue||e.hasDynamicChannelClassifier&&!e.channelClassifier.field)&&(e.tabTags=[{name:t("translate")("tcm.componentStatus.configured"),status:"ok"}],e.validated=!0,void(e.name&&!e.name.staticValue||!e.channelClassifier.staticValue?e.title=e.channelClassifier.field:e.title=e.channelClassifier.staticValue)))}function r(e){e.index&&!e.index.properties&&(e.index.properties=[]);var t=e.index.properties.filter(function(e){return"index_type"===e.key});t&&t.length>0?e.index.properties.forEach(function(t){"index_type"===t.key.toLowerCase()&&(t.value=e.indexType)}):e.index.properties.push({key:"index_type",value:e.indexType})}e.channels||(e.channels=[]),a.channels=e.channels,a.removeChannel=function(e){a.channels.splice(e,1)},a.addChannel=function(){a.channels.push({tabTags:[{name:t("translate")("tcm.componentStatus.configurationPending"),status:"warning"}]})},a.selectedChannelClassifier=function(e){a.searchChannelClassifierActive=!1,a.selectedChannel.channelClassifier={staticValue:e.name}},a.toggleSearchChannelClassifier=function(e){e?(a.searchChannelClassifierActive=!0,a.selectedChannel=e):(a.searchChannelClassifierActive=!1,a.selectedChannel=null)},a.selectedFlowConfigurationId=function(e){a.searchFlowConfigurationsActive=!1,a.selectedChannel.flowConfigurationId=e.id,a.selectedChannel=null},a.toggleSearchFlowConfigurationId=function(e){e?(a.searchFlowConfigurationsActive=!0,a.selectedChannel=e):(a.searchFlowConfigurationsActive=!1,a.selectedChannel=null)},a.setIndexActiveOfChannel=function(e){e.indexActive=!e.indexActive},a.dropInChannel=function(e,t,a,n,i,o){if("timeserie"!==n&&"helper"===n)return;i[o]=t,i.index&&(i.indexType||(i.indexType="start"),r(i))},a.dropChannelClassifier=function(e,t,a,n,r,i){r.channelClassifier||(r.channelClassifier={});r.channelClassifier=t,delete r.channelClassifier.staticValue},a.createNewChannelClassifier=function(){a.createNewChannelClassifierActive=!0},a.removeCleansingConfiguration=function(e,t){e.cleansingConfigurations.splice(t,1)},a.addCleansingConfiguration=function(e){e.cleansingConfigurations||(e.cleansingConfigurations=[]);e.cleansingConfigurations.push({name:""})},a.timestampIsStartOrEnd=r,a.setColumnForClassifier=function(e){e.hasDynamicChannelClassifier=!e.hasDynamicChannelClassifier,e.hasDynamicChannelClassifier||delete e.channelClassifier.field;n(e)},e.$watch("vm.channels",function(){a.channels.forEach(function(e){n(e)})},!0)}angular.module("console.tcm").controller("TcmChannelsController",e),e.$inject=["$scope","$filter"]}(),function(){function e(){return{scope:{channels:"=",readOnly:"="},bindToController:!0,restrict:"AE",controller:"TcmChannelsController",controllerAs:"vm",templateUrl:"tcm/details/channels/tcm-channels.html"}}angular.module("console.tcm").directive("tcmChannels",e),e.$inject=[]}(),function(){function e(e,t,a){var n=this;function r(e){(e.validated=!1,e.tabTags=[{name:t("translate")("tcm.componentStatus.configurationPending"),status:"warning"}],!(e.datasourceId&&e.name&&e.classifier&&e.timezone))||(!e.datasourceId.valid||!e.name.valid||!e.classifier.valid||!e.timezone.valid||e.description&&!e.description.valid||(e.tabTags=[{name:t("translate")("tcm.componentStatus.configured"),status:"ok"}],e.validated=!0))}e.datasource?n.datasource=e.datasource:(e.datasource={},n.datasource=e.datasource),n.drop=function(e,t,a,r,i){if("column"!==r&&"helper"===r&&"split"===t.pillType)return;!function(e,t,a){for(var n=a.split("."),r=e,i=r,o=0;o<n.length-1;o++)i[n[o]]||(i[n[o]]={}),i=i[n[o]];i[n[n.length-1]]=t}(n,t,i)},angular.element(document).ready(function(){a(function(){r(n.datasource)},100)}),e.$watch("vm.datasource",function(e,t){e!==t&&r(n.datasource)},!0)}angular.module("console.tcm").controller("TcmDatasourcePropertiesController",e),e.$inject=["$scope","$filter","$timeout"]}(),function(){function e(){return{scope:{datasource:"=",readOnly:"="},bindToController:!0,restrict:"AE",controller:"TcmDatasourcePropertiesController",controllerAs:"vm",templateUrl:"tcm/details/properties/tcm-properties.html"}}angular.module("console.tcm").directive("tcmDatasourceProperties",e),e.$inject=[]}(),function(){function e(e,t){var a=this;function n(e){var n={name:t("translate")("tcm.componentStatus.configurationPending"),status:"warning"},r={name:t("translate")("tcm.componentStatus.duplicateTagName"),status:"alert"},i={name:t("translate")("tcm.componentStatus.configured"),status:"ok"};if(e.tabTags=[],e.validated=!1,e.tag&&e.tag.valid){if("scd"!==e.type&&(e.type="static",e.validFrom=null),function(e){var t={},a=[];for(var n in e.forEach(function(e){e.tag&&e.tag.staticValue&&(t[e.tag.staticValue]||(t[e.tag.staticValue]=0),t[e.tag.staticValue]+=1)}),t)t[n]>=2&&a.push(n);return a}(a.tags).indexOf(e.tag.staticValue)>=0)e.tabTags.push(r);else if(e.properties&&e.properties.length>0){var o=!0;e.properties.forEach(function(e){e.valid||(o=!1)}),o?(e.tabTags.push(i),e.validated=!0):e.tabTags.push(n)}else e.tabTags.push(i),e.validated=!0;e.tag.staticValue?e.title=e.tag.staticValue:e.title=e.tag.field}else e.tabTags.push(n)}function r(){a.tags.forEach(function(e){n(e)})}e.tags?a.tags=e.tags:(e.tags={},a.tags=e.tags),a.dropInTagName=function(e,t,a,n,r,i){if("column"!==n&&"helper"===n&&"split"===t.pillType)return;r.tag=t},a.dropInTagProperties=function(e,t,a,n,r){if(e<0)return;r.properties.splice(e,0,t)},a.dropTimestamp=function(e,t,a,n,r,i){if("timeserie"!==n){if("helper"===n&&"addStaticValue"!==t.name)return;t.function="to_date",t.functionParams=[{value:"%Y-%m-%dT%H:%M:%SZ",key:"dateformat"}],r[i]=t}else r[i]=t},a.addTag=function(){var e={type:"static",properties:[],tabTags:[{name:t("translate")("tcm.componentStatus.configurationPending"),status:"warning"}]};a.tags.push(e)},a.validateTag=n,a.validateAllTags=r,e.$watch("vm.tags",function(){r()},!0)}angular.module("console.tcm").controller("TcmTagsController",e),e.$inject=["$scope","$filter"]}(),function(){function e(){return{scope:{tags:"=",readOnly:"="},bindToController:!0,restrict:"AE",controller:"TcmTagsController",controllerAs:"vm",templateUrl:"tcm/details/tags/tcm-tags.html"}}angular.module("console.tcm").directive("tcmTags",e),e.$inject=[]}(),function(){function e(e,t,a){var n=this,r=null;function i(t){if(n.isLoading=!0,t){n.auditEvents=[];var a=t.split(":"),i=a[0],s=moment(n.selectedDatapoint.x).utc().format("YYYY-MM-DD HH:mm:ssZ"),l=a[1],c="";c=(c=(l=l.split("-")).length>1?l[1]:l[0]).trim(),n.queryParams.query="SELECT timestamp, source, subjects, message, severity, user_email, properties FROM ( SELECT timestamp, source, subjects, message, severity, user_email, properties, ( SELECT p.value FROM   Unnest(properties) AS p WHERE  p.KEY='start_datetime') AS _start_datetime, ( SELECT p.value FROM   Unnest(properties) AS p WHERE  p.KEY='end_datetime') AS _end_datetime, ( SELECT 'has_match' FROM   Unnest(properties) AS p WHERE  p.value='"+c+"') AS _a_column_with_matching_name FROM   audit_events, Unnest(subjects) AS s WHERE  s.subject_type='datasource' AND    s.subject='"+i+"' ) WHERE    ( _start_datetime <= '"+s+"' AND _end_datetime >= '"+s+"' AND  _a_column_with_matching_name='has_match')  ORDER BY timestamp DESC limit 100 ",function t(a,i){n.selectedDatapoint.isSource?(i||(n.queryParams.pageToken=null,n.queryParams.jobId=null),r&&r.cancel(),n.isLoading=!0,(r=e.eqlQuery(a)).then(function(e){e&&e.parsed&&e.parsed.length>0?(e.reference&&e.reference.jobId?n.queryParams.jobId=e.reference.jobId:n.queryParams.jobId=null,e.pageToken?(n.queryParams.pageToken=e.pageToken,t(n.queryParams,!0)):(n.queryParams.pageToken=null,n.isLoading=!1),i?(e.rows.forEach(function(e){o.rows.push(e)}),e.parsed.forEach(function(e){o.parsed.push(e)}),o.pageToken=e.pagetoken,o.reference=e.reference,o.metadata=e.metadata):o=e):(n.noResults=!0,n.isLoading=!1),n.auditEvents=o.parsed},function(e){n.queryIsCancelled||(n.queryError=!0,e.data&&e.data.error&&e.data.error.message&&(n.errorMessage=e.data.error.message),n.queryParams.jobId=null),n.isLoading=!1})):n.isLoading=!1}(n.queryParams)}else n.isLoading=!1}n.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",n.queryParams={compressed:!0},n.deslectSelectedPoint=function(){a.datapoint=null},a.datapoint&&(n.selectedDatapoint=a.datapoint,i(n.selectedDatapoint.series)),t.getUserSettings().then(function(e){n.userSettings=e,n.userSettings.defaultDateTime&&(n.userDateTimeFormat=n.userSettings.defaultDateTime.date+" "+n.userSettings.defaultDateTime.time)},function(e){});var o=[];a.$watch("datapoint",function(e,t){e!==t&&(n.selectedDatapoint=a.datapoint,n.selectedDatapoint&&i(n.selectedDatapoint.series))},!0)}angular.module("ewx-components-chart").controller("ChartSelectedDatapointController",e),e.$inject=["QueryService","UserService","$scope"]}(),function(){angular.module("ewx-components-chart").directive("chartSelectedDatapoint",function(){return{scope:{datapoint:"="},replace:!0,restrict:"AE",controller:"ChartSelectedDatapointController",controllerAs:"vm",templateUrl:"shared/components/chart/selected-datapoint/selected-datapoint.html",link:function(e){}}})}(),function(){function e(e,t){var a=this;function n(){a.showNamespaceSelector=!1,a.searchResourceActive=!a.searchResourceActive}function r(){e.resourceInput=a.ruleValueList}"list"===e.valueType?e.resourceInput?a.ruleValueList=e.resourceInput:a.ruleValueList=[]:e.resourceInput&&(a.resourceInput=e.resourceInput),"text"===e.fieldType?a.fieldTypeIsInput=!1:a.fieldTypeIsInput=!0,e.hideFindText&&(a.hideFindText=!0),e.resourceType&&(a.resourceType=e.resourceType.toLowerCase()),e.namespaces&&(a.namespaces=e.namespaces,1===a.namespaces.length&&(a.selectedNamespace=a.namespaces[0])),a.openResourceFinder=function(e){e?n():a.namespaces&&a.namespaces.length>1?a.showNamespaceSelector=!a.showNamespaceSelector:n()},a.updateSingleResource=function(){e.resourceInput=a.resourceInput},a.addResourceToList=function(e){(a.hasDuplicateName=!1,e)&&(a.ruleValueList.indexOf(e)>-1?a.hasDuplicateName=!0:a.ruleValueList.push(e));r()},a.removeRuleFromList=function(e){a.ruleValueList.splice(e,1),r()},a.selectedResource=function(n){t(function(){"ChannelClassifier"===e.resourceType||"Rule"===e.resourceType?a.resourceInput=n.name:a.resourceInput=n.id,e.resourceInput=a.resourceInput,a.searchResourceActive=!a.searchResourceActive},100)}}angular.module("ewx-components-control-widgets").controller("RuleResourceWidgetController",e),e.$inject=["$scope","$timeout"]}(),function(){angular.module("ewx-components-control-widgets").directive("ruleResourceWidget",function(){return{scope:{resourceInput:"=",resourceType:"@",namespaces:"=",valueType:"@",inputPlaceHolder:"@",fieldType:"@",hideFindText:"="},replace:!0,restrict:"AE",controller:"RuleResourceWidgetController",controllerAs:"vm",templateUrl:"shared/components/control-widgets/resource-widget/resource-widget.html",link:function(e){}}})}(),function(){function e(e,t,a){var n=this;function r(){if("aggregatedTable"===n.widget.view.type){o(n.queryResults);var t=n.widget.view.dataOptions.filter(function(e){return"aggregationPeriod"===e.key});t.length>0&&(r=t[0].value.toUpperCase(),e.performAggregation(r,n.dataStructure).then(function(e){a(function(){n.queryResults=e.data},1)},function(e){}))}else n.widget.queries&&n.widget.queries.length>0&&n.widget.queries.forEach(function(e){"flowTimeseries"===e.type?n.queryResults.forEach(function(e){if(e.row.flow){var t=e.row.flow.flow_id,a=void 0;try{a=n.flowStructure.getDatasourceByFlowId(t)}catch(e){}if(!a){var r=n.widget.view.dataOptions.filter(function(e){return"datasourceId"===e.key});a=r.length>=1?r[0].value:""}n.dataStructure[a]||(n.dataStructure[a]={}),e.row.flow.channel.forEach(function(r){var o=r.channel_classifier_id;n.dataStructure[a][o]||(n.dataStructure[a][o]={flowId:t,values:[],annotations:[],isSource:!1,visible:!0}),n.dataStructure[a][o].values.push([e.row.timestamp,r.value]),n.flowStructure[a]||s(a),n.flowStructure[a][o]||l(a,o),n.flowStructure[a][o].annotations[t]||(n.flowStructure[a][o].annotations[t]={annotations:{}}),r.annotation.forEach(function(r){n.flowStructure[a][o].annotations[t].annotations[r.sequence_id]||(n.flowStructure[a][o].annotations[t].annotations[r.sequence_id]={}),n.flowStructure[a][o].annotations[t].annotations[r.sequence_id][r.annotation]||(n.flowStructure[a][o].annotations[t].annotations[r.sequence_id][r.annotation]={properties:r.properties,indexes:[]}),n.flowStructure[a][o].annotations[t].annotations[r.sequence_id][r.annotation].indexes.push(e.row.timestamp),i(a,o,e.row.timestamp,r)})})}}):"rawTimeseries"===e.type?function(e){e.forEach(function(e){if(e.row.datasource){var t=e.row.datasource.datasource_id;n.dataStructure[t]||(n.dataStructure[t]={}),e.row.datasource.channel.forEach(function(a){var r=a.channel_classifier_id;n.dataStructure[t][r]||(n.dataStructure[t][r]={flowId:"",values:[],annotations:[],isSource:!0,visible:!0}),n.dataStructure[t][r].values.push([e.row.timestamp,a.value]),n.dataStructure[t][r].deleted=!1,n.flowStructure[t]||s(t),n.flowStructure[t][r]||l(t,r),n.flowStructure[t][r].annotations[r]||(n.flowStructure[t][r].annotations[r]={annotations:{}}),a.annotation.forEach(function(a){n.flowStructure[t][r].annotations[r].annotations[a.sequence_id]||(n.flowStructure[t][r].annotations[r].annotations[a.sequence_id]={}),n.flowStructure[t][r].annotations[r].annotations[a.sequence_id][a.annotation]||(n.flowStructure[t][r].annotations[r].annotations[a.sequence_id][a.annotation]={properties:a.properties,indexes:[]}),n.flowStructure[t][r].annotations[r].annotations[a.sequence_id][a.annotation].indexes.push(e.row.timestamp),i(t,r,e.row.timestamp,a)})})}})}(n.queryResults):o(n.queryResults)});var r}function i(e,t,a,r){var i=n.dataStructure[e][t].annotations.filter(function(e){return e.id===r.annotation&&e.sequenceId===r.sequence_id});0===i.length?n.dataStructure[e][t].annotations.push({id:r.annotation,sequenceId:r.sequence_id,values:[[a,r.properties]]}):(i.length,i[0].values.push([a,r.properties]))}function o(e){n.dataStructure={},e.forEach(function(e){var t=!1;if(e.row&&e.row.datasource){t=!0;var a=e.row.datasource.datasource_id;n.dataStructure[a]||(n.dataStructure[a]={}),e.row.datasource.channel.forEach(function(t){var r=t.channel_classifier_id;n.dataStructure[a][r]||(n.dataStructure[a][r]={flowId:"",values:[],isSource:!0,visible:!0}),n.dataStructure[a][r].deleted=!1,n.dataStructure[a][r].values.push([e.row.timestamp,t.value]),n.dataStructure[a][r].annotations||(n.dataStructure[a][r].annotations=[]),t.annotation.forEach(function(t){i(a,r,e.row.timestamp,t)})})}if(e.row&&e.row.flow){t=!0;var r=e.row.flow.flow_id;n.dataStructure[r]||(n.dataStructure[r]={}),e.row.flow.channel.forEach(function(t){var a=t.channel_classifier_id;n.dataStructure[r][a]||(n.dataStructure[r][a]={flowId:"",values:[],isSource:!0,visible:!0}),n.dataStructure[r][a].deleted=!1,n.dataStructure[r][a].values.push([e.row.timestamp,t.value]),n.dataStructure[r][a].annotations||(n.dataStructure[r][a].annotations=[]),t.annotation.forEach(function(t){i(r,a,e.row.timestamp,t)})})}if(!t){Object.keys(e).length>1&&Object.keys(e).forEach(function(t,a){if(n.dataStructure.Source||(n.dataStructure.Source={}),a>0){var r=t;n.dataStructure.Source[r]||(n.dataStructure.Source[r]={flowId:"",values:[],annotations:[],isSource:!1,visible:!0});var i=null,o=null;try{i=moment(e[Object.keys(e)[0]]).utc().valueOf(),o=e[Object.keys(e)[a]]}catch(e){}null!==i&&null!==o&&n.dataStructure.Source[r].values.push([i,o])}})}})}function s(e){n.flowStructure[e]={getChannelClassifiers:function(){var e=this,t=[];return Object.keys(this).forEach(function(a){_.isFunction(e[a])||-1!==t.indexOf(a)||t.push(a)}),t}}}function l(e,t){n.flowStructure[e][t]={selectedFlow:{},flows:[],annotations:{},getFlow:function(e){var t=this.flows.filter(function(t){return t.flowId===e});if(t.length>0)return t[0]},getAnnotations:function(e){if(this.annotations[e])return this.annotations[e]}}}function c(e,t){var a=function(e){if(e[0]){var t=Object.keys(e[0]),a=function(e,t){return null===t?"":t},n=e.map(function(e){return t.map(function(t){return JSON.stringify(e[t],a)}).join("\t")});return n.unshift(t.join("\t")),n=n.join("\r\n")}}(e),n=encodeURI(a),r=document.createElement("a");r.style.visibility="hidden",r.setAttribute("href","data:text/plain;charset=utf-8,"+n),r.setAttribute("download","export-"+t+".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}n.widget=t.widget,n.queryResults=t.queryResults,n.dataStructure={},n.flowStructure={getDatasourceByFlowId:function(e){var t=this,a=void 0;return Object.keys(this).forEach(function(n){_.isFunction(t[n])||t[n].getChannelClassifiers().forEach(function(r){var i=t[n][r].getFlow(e);i&&(a=i.datasourceId)})}),a}},r(),t.onUpdate=function(e){n.queryResults=e,r()},t.onDownload=function(){"aggregatedTable"===n.widget.view.type?c(n.queryResults,n.widget.title):n.triggerChartDownload=!n.triggerChartDownload}}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetChartController",e),e.$inject=["AggregationService","$scope","$timeout"]}(),function(){angular.module("ewx-components-dashboard-widget").directive("dashboardWidgetChart",function(){return{scope:{widget:"=",queryResults:"=",onUpdate:"=",onDownload:"="},replace:!0,restrict:"AE",controller:"DashboardWidgetChartController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/chart/chart.html"}})}(),function(){function e(e,t){var a=this;function n(e,t){var n=function(e){e=angular.copy(e),"datasource"===a.widget.view.dataType&&e.forEach(function(e){e.tags&&e.tags.length>0&&e.tags.forEach(function(t){t.properties&&t.properties.forEach(function(a){e["tag:"+t.tag+" key: "+a.key]=a.value})}),e.channels&&e.channels.length>0&&e.channels.forEach(function(t){var a=Object.keys(t);a.forEach(function(a){e["channel: "+a]=t[a]})}),delete e.allTagProperties,delete e.channels,delete e.tags,delete e.test});"flow"===a.widget.view.dataType&&e.forEach(function(e){e.properties&&e.properties.length>0&&e.properties.forEach(function(t){e[t.key]=t.value}),delete e.key,delete e.value,delete e.properties,delete e.messages});"auditEvents"===a.widget.view.dataType&&e.forEach(function(e){e.subjects&&e.subjects.length>0&&e.subjects.forEach(function(t){e["subject: "+t.subject_type]=t.subject}),e.properties&&e.properties.length>0&&e.properties.forEach(function(t){e["property: "+t.key]=t.value}),delete e.properties,delete e.subjects});var t=[];e.forEach(function(e){Object.keys(e).forEach(function(e){t.push(e)})});var n=Array.from(new Set(t)),r=[];e.forEach(function(e){var t={};n.forEach(function(a){var n="";Object.keys(e).forEach(function(t){a===t&&(n=e[t],"timestamp"!==a&&"created_datetime"!==a&&"flow_timestamp"!==a||(n=moment(n).format()))}),t[a]=n}),r.push(t)});var i=function(e,t){return null===t?"":t},o=r.map(function(e){return n.map(function(t){return JSON.stringify(e[t],i)}).join("\t")});return o.unshift(n.join("\t")),o=o.join("\r\n")}(e),r=encodeURI(n),i=document.createElement("a");i.style.visibility="hidden",i.setAttribute("href","data:text/plain;charset=utf-8,"+r),i.setAttribute("download","export-"+t+".csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}a.widget=e.widget,a.queryResults=e.queryResults,a.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",a.flowPropertyKeyCheck=function(e,t,a){var n=e.properties.filter(function(e){return e.key===t&&e.value===a});return n&&n.length>0},a.valueParser=function(e,t){"created_datetime"!==e&&"updated_datetime"!==e&&"timestamp"!==e||(t=moment(t).format(a.userDateTimeFormat));return t},a.resetFilter=function(){a.filterListing=""},t.getUserSettings().then(function(e){a.userSettings=e,a.userSettings.defaultDateTime&&(a.userDateTimeFormat=a.userSettings.defaultDateTime.date+" "+a.userSettings.defaultDateTime.time)},function(e){}),"datasource"===a.widget.view.dataType&&a.queryResults&&a.queryResults.length>0&&a.queryResults.forEach(function(e){e.allTagProperties=function(e){var t=[];e.tags&&e.tags.length>0&&e.tags.forEach(function(e){t=t.concat(e.properties)});return t}(e)}),e.onUpdate=function(e){a.queryResults=e},e.onDownload=function(){n(a.queryResults,a.widget.title)}}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetListController",e),e.$inject=["$scope","UserService"]}(),function(){angular.module("ewx-components-dashboard-widget").directive("dashboardWidgetList",function(){return{scope:{widget:"=",queryResults:"=",showSearchFilter:"=",onUpdate:"=",onDownload:"="},replace:!0,restrict:"AE",controller:"DashboardWidgetListController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/list/list.html"}})}(),function(){function e(e,t){var a=this;function n(e,t){var a=function(e){var t=Object.keys(e[0]),a=function(e,t){return null===t?"":t},n=e.map(function(e){return t.map(function(t){return JSON.stringify(e[t],a)}).join("\t")});return n.unshift(t.join("\t")),n=n.join("\r\n")}(e),n=encodeURI(a),r=document.createElement("a");r.style.visibility="hidden",r.setAttribute("href","data:text/plain;charset=utf-8,"+n),r.setAttribute("download","export-"+t+".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}a.widget=e.widget,a.queryResults=e.queryResults,a.goToView=function(e){t.go("console.datasources.view",{datasourceIds:[e]})},e.onDownload=function(){n(a.queryResults,a.widget.title)}}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetMapController",e),e.$inject=["$scope","$state"]}(),function(){angular.module("ewx-components-dashboard-widget").directive("dashboardWidgetMap",function(){return{scope:{widget:"=",queryResults:"=",onUpdate:"=",onDownload:"="},replace:!0,restrict:"AE",controller:"DashboardWidgetMapController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/map/map.html"}})}(),function(){function e(e,t,a,n,r,i,o){var s=this;s.widget=n.widget,s.originalWidget=angular.copy(s.widget),s.timeFrameOptions=["hours","days","weeks","months","years"],s.futurePastOptions=["past","future"],s.refreshIntervalOptions=["minutes","hours"];var l=e.getEqlHints();function c(){s.hideStartEndControls=!1,s.onlyStartDate=!1,s.widget.queries&&s.widget.queries.forEach(function(e){e.validDynamicTimestamps=function(e){var t=!1;e&&e.includes("{start_date}")&&e.includes("{end_date}")?t=!0:e&&e.includes("{start_date}")?(t=!0,s.onlyStartDate=!0):s.hideStartEndControls=!0;return t}(e.query)})}CodeMirror.defineMIME("text/x-eql",l),s.queryOptions={lineNumbers:!0,lineWrapping:!0,indentWithTabs:!0,readOnly:!0,mode:"text/x-eql",extraKeys:{"Ctrl-Space":"autocomplete"},hint:CodeMirror.hint.sql,hintOptions:{tables:{}},theme:"ewx-dark",onLoad:function(e){e.on("change",function(){o(function(){c()},200)})}},s.setTimeFrame=function(){if(!s.editTimeframeForm.$valid)return!1;s.editTimeFrame=!s.editTimeFrame,s.editTimeframeForm.$setPristine()},s.toggleRefreshInterval=function(){s.editRefreshInterval=!s.editRefreshInterval,s.editRefreshInterval&&!s.widget.refresh&&(s.widget.refresh={value:5,unit:"minutes"})},s.setRefreshInterval=function(){if(!s.editRefreshIntervalForm.$valid)return!1;s.editRefreshInterval=!s.editRefreshInterval},s.resetEditRefreshIntervalForm=function(){s.widget.refresh=null,s.editRefreshIntervalForm.$setPristine()},s.cancel=function(){n.isActive=!1,n.widget=angular.copy(s.originalWidget),n.$evalAsync()},s.onApply=function(e){u&&(u(e),function(){if(i.dashboardIndex){var e=void 0;e=i.dashboardIndex;var t=r.localStorage.getItem(active_namespace_id+"_dashboardconfig");t=JSON.parse(t);for(var n=0;n<t.dashboard[e].config.length;n++){var o=t.dashboard[e].config[n].position,l=_.isEqual(o,s.widget.position);l&&t.dashboard[e].config.splice(n,1)}t.dashboard[e].config.push(s.widget),s.widget.fromCache&&(s.widget.fromCache=null,s.widget.fromCacheTimeStamp=null),r.localStorage.setItem(active_namespace_id+"_dashboardconfig",JSON.stringify({namespace:active_namespace_id,dashboard:t.dashboard})),t.dashboard.forEach(function(e){e.config.forEach(function(e){e.fromCache&&(e.fromCache=null,e.fromCacheTimeStamp=null)})});var c=JSON.stringify(t.dashboard);s.isSaving=!0;var u={properties:[{key:"dashboardconfig",value:c}]};a.updateUserProperties(u).then(function(){s.isSaving=!1},function(){s.isSaving=!1})}}())},t.eqlMetadata().then(function(e){var t={};e&&e.data&&e.data.tables&&(e.data.tables.forEach(function(e){var a=[];t[e.name]||(e.fields.forEach(function(e){-1===a.indexOf(e.field)&&a.push(e.field)}),t[e.name]=a)}),s.metadata=e.data.tables),CodeMirror.hint.sql;var a={tables:{}};angular.extend(a.tables,t)},function(e){}),s.widget.period&&s.widget.period.dynamic&&(s.widget.period.dynamic.end||(s.widget.period.dynamic.end={subtractionValue:0,subtractionUnit:"days",subtractionTense:"future"})),c();var u=n.onApply()}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetSettingsController",e),e.$inject=["ConstantsService","QueryService","UserService","$scope","$window","$stateParams","$timeout"]}(),function(){angular.module("ewx-components-dashboard-widget").directive("dashboardWidgetSettings",function(){return{scope:{widget:"=",onApply:"&",isActive:"="},replace:!0,restrict:"AE",controller:"DashboardWidgetSettingsController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/quick-settings/quick-settings.html"}})}(),function(){function e(e){var t=this;function a(){var e=[];t.queryResults.forEach(function(a){var n=void 0;Object.keys(a).forEach(function(r){var i=angular.copy(t.widget.view.colors);if(i&&i.length>0){i.sort(function(e,t){return e.value>t.value?1:-1});for(var o=0;o<i.length;o++){var s=i[o],l={value:0};if(i[o-1]&&(l=i[o-1].value),s.active){if(0===o&&a[r]===l.value){n=s.color;break}if(a[r]>=l.value&&a[r]<s.value){n=s.color;break}a[r]>=s.value&&(n=s.color)}}}e.push({key:r,value:a[r],color:n})})}),t.structuredResult=e,angular.element(document).ready(function(){fitty(".card-statistic .card-statistic__value",{maxSize:72}),fitty(".card-statistic .card-statistic__label",{maxSize:22})})}function n(e,t){var a=function(e){var t=Object.keys(e[0]),a=function(e,t){return null===t?"":t},n=e.map(function(e){return t.map(function(t){return JSON.stringify(e[t],a)}).join("\t")});return n.unshift(t.join("\t")),n=n.join("\r\n")}(e),n=encodeURI(a),r=document.createElement("a");r.style.visibility="hidden",r.setAttribute("href","data:text/plain;charset=utf-8,"+n),r.setAttribute("download","export-"+t+".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}t.widget=e.widget,t.queryResults=e.queryResults,t.isNumber=angular.isNumber,a(),e.onUpdate=function(e){t.queryResults=e,a()},e.onDownload=function(){n(t.queryResults,t.widget.title)}}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetStatisticController",e),e.$inject=["$scope"]}(),function(){angular.module("ewx-components-dashboard-widget").directive("dashboardWidgetStatistic",function(){return{scope:{widget:"=",queryResults:"=",onUpdate:"=",onDownload:"="},replace:!0,restrict:"AE",controller:"DashboardWidgetStatisticController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/statistic/statistic.html"}})}(),function(){function e(e,t,a){var n=this;if(n.widget=e.widget,n.queryResults=e.queryResults,e.widget.view&&e.widget.view.dataType){var r=e.widget.view.dataType;"generic"===r?function(e){n.showTable=!1;var t=[],r=[];e[0]&&e[0].row?(e.forEach(function(e){if(e.row){var t=function(e){var t={};return function e(a,n){if(Object(a)!==a)t[n]=a;else if(Array.isArray(a))for(var r=0,i=a.length;r<i;r++)e(a[r],n+"["+r+"]"),0===i&&(t[n]=[]);else{var o=!0;for(var s in a)o=!1,e(a[s],n?n+"."+s:s);o&&n&&(t[n]={})}}(e,""),t}(e.row),a={};Object.keys(t).forEach(function(e){var n=e.split(".");n=n.pop(),a[n]=t[e]}),r.push(a)}}),Object.keys(r[0]).forEach(function(e){var a={headerName:e,field:e};"flow_timestamp"!==e&&"timestamp"!==e||(a.valueGetter=i,a.comparator=o),t.push(a)})):(Object.keys(e[0]).forEach(function(e){var a={headerName:e,field:e};"flow_timestamp"!==e&&"timestamp"!==e||(a.valueGetter=i,a.comparator=o),t.push(a)}),r=e);n.gridOptions={defaultColDef:{enableValue:!0,enableRowGroup:!0,enablePivot:!0,sortable:!0,filter:!0,resizable:!0},allowContextMenuWithControlKey:!0,sideBar:!0,animateRows:!0,rowGroupPanelShow:"always",sortingOrder:["desc","asc",null],columnDefs:t,rowData:r,enableRangeSelection:!0,onGridReady:function(e){e.api.closeToolPanel();var t=n.gridOptions.rowData.length;n.tableHeight=t<21?25.25*(t+1)+200+"px":"724px"}},a(function(){n.showTable=!0},100)}(n.queryResults):"timeseries"===r?function(e){n.showTable=!1;var r=[{headerName:t("translate")("generic.timestamp"),field:"timestamp",valueGetter:i,comparator:o},{headerName:t("translate")("generic.value"),field:"value",cellClass:"bold align-right",aggFunc:"first"},{headerName:t("translate")("generic.datasourceId"),field:"datasourceId",hide:!0},{headerName:t("translate")("generic.channel"),field:"channel",pivot:!0},{headerName:t("translate")("datasourceProperties.sourceChannel"),field:"isSource"},{headerName:t("translate")("generic.flowId"),field:"flowId",hide:!0}],c=[],u=void 0;n.widget.view&&n.widget.view.dataOptions&&n.widget.view.dataOptions.forEach(function(e){"datasourceId"===e.key&&(u=e.value)});u&&e.forEach(function(e){e.row.datasource&&e.row.datasource.channel&&e.row.datasource.channel.forEach(function(a){var n=e.row.timestamp,i={timestamp:n,value:a.value,datasourceId:e.row.datasource.datasource_id,channel:a.channel_classifier_id};if(a.annotion){var o=t("translate")("generic.annotations");r.filter(function(e){return e.headerName===o}).length<=0&&r.push({headerName:o,marryChildren:!0,children:[],headerClass:"is-bold"}),a.annotion.forEach(function(e){e.values&&e.values.length>0&&(r.forEach(function(t){t.headerName===o&&t.children.filter(function(t){return t.field===e.id}).length<=0&&t.children.push({field:e.id,colId:e.id,aggFunc:"first",cellClass:function(e){return e.value?"is-annotation":"is-empty"}})}),e.values.forEach(function(t,a){if(t[0]===i.timestamp){var n="";t[1]&&t[1].length>0&&t[1].forEach(function(e,t){n=n+e.key+": "+e.value+", "}),n=n.substring(0,n.length-2),i[e.id]=n}}))})}c.push(i)})});n.gridOptions={statusBar:{statusPanels:[{statusPanel:"agTotalAndFilteredRowCountComponent",align:"left"}]},defaultColDef:{enableValue:!0,enableRowGroup:!0,enablePivot:!0,sortable:!0,filter:!0,resizable:!0},getContextMenuItems:l,allowContextMenuWithControlKey:!0,sideBar:!0,suppressDragLeaveHidesColumns:!0,animateRows:!0,rowGroupPanelShow:"always",sortingOrder:["desc","asc",null],columnDefs:r,rowData:c,enableRangeSelection:!0,onGridReady:function(e){e.api.closeToolPanel();var t=n.gridOptions.rowData.length;n.tableHeight=t<21?25.25*(t+1)+200+"px":"724px",a(function(){e.api.sizeColumnsToFit()},100)},onColumnMoved:s},a(function(){n.showTable=!0},100)}(n.queryResults):"flow"===r?function(e){n.showTable=!1;var r=[],s=[];Object.keys(e[0]).forEach(function(e){var t={headerName:e,field:e};"flow_config"===e||"messages"===e?t.hide=!0:"flow_timestamp"===e&&(t.valueGetter=i,t.comparator=o),"properties"!==e&&r.push(t)}),e.forEach(function(e){if(e.properties){var a=t("translate")("generic.properties");r.filter(function(e){return e.headerName===a}).length<=0&&r.push({headerName:a,marryChildren:!0,children:[],headerClass:"is-bold"}),e.properties.forEach(function(t){r.forEach(function(e){e.headerName===a&&e.children.filter(function(e){return e.field===t.key}).length<=0&&e.children.push({field:t.key,colId:t.key,hide:!0})}),e[t.key]=t.value}),delete e.properties}s.push(e)}),n.gridOptions={defaultColDef:{enableValue:!0,enableRowGroup:!0,enablePivot:!0,sortable:!0,filter:!0,resizable:!0},allowContextMenuWithControlKey:!0,sideBar:!0,animateRows:!0,rowGroupPanelShow:"always",sortingOrder:["desc","asc",null],columnDefs:r,rowData:s,enableRangeSelection:!0,onGridReady:function(e){e.api.closeToolPanel();var t=n.gridOptions.rowData.length;n.tableHeight=t<21?25.25*(t+1)+200+"px":"724px"}},a(function(){n.showTable=!0},100)}(n.queryResults):"datasource"===r?function(e){n.showTable=!1;var r=[],s=[];Object.keys(e[0]).forEach(function(e){var t={headerName:e,field:e};"created_datetime"!==e&&"updated_datetime"!==e||(t.valueGetter=i,t.comparator=o),"channels"!==e&&"tags"!==e&&r.push(t)}),e.forEach(function(e){if(e.channels){var a=t("translate")("generic.channels");r.filter(function(e){return e.headerName===a}).length<=0&&r.push({headerName:a,marryChildren:!0,children:[],headerClass:"is-bold"}),e.channels.forEach(function(t){r.forEach(function(e){e.headerName===a&&e.children.filter(function(e){return e.field===t.id}).length<=0&&e.children.push({field:t.id,colId:t.id})}),Object.keys(t).forEach(function(a){e[a]=t[a]})})}s.push(e)}),s=e,n.gridOptions={defaultColDef:{enableValue:!0,enableRowGroup:!0,enablePivot:!0,sortable:!0,filter:!0,resizable:!0},allowContextMenuWithControlKey:!0,sideBar:!0,animateRows:!0,rowGroupPanelShow:"always",sortingOrder:["desc","asc",null],columnDefs:r,rowData:s,enableRangeSelection:!0,onGridReady:function(e){e.api.closeToolPanel();var t=n.gridOptions.rowData.length;n.tableHeight=t<21?25.25*(t+1)+200+"px":"724px"}},a(function(){n.showTable=!0},100)}(n.queryResults):"auditEvents"===r&&function(e){n.showTable=!1;var r=[],s=[];Object.keys(e[0]).forEach(function(e){var t={headerName:e,field:e};"timestamp"===e&&(t.valueGetter=i,t.comparator=o),"properties"!==e&&"subjects"!==e&&r.push(t)}),e.forEach(function(e){var a=void 0;e.properties&&(a=t("translate")("generic.properties"),r.filter(function(e){return e.headerName===a}).length<=0&&r.push({headerName:a,marryChildren:!0,children:[],headerClass:"is-bold"}),e.properties.forEach(function(t){r.forEach(function(e){e.headerName===a&&e.children.filter(function(e){return e.field===t.key}).length<=0&&e.children.push({field:t.key,colId:t.key,hide:!0})}),e[t.key]=t.value}),delete e.properties);var n=void 0;e.subjects&&(n=t("translate")("generic.subjects"),r.filter(function(e){return e.headerName===n}).length<=0&&r.push({headerName:n,marryChildren:!0,children:[],headerClass:"is-bold"}),e.subjects.forEach(function(t){r.forEach(function(e){e.headerName===n&&e.children.filter(function(e){return e.field===t.subject}).length<=0&&e.children.push({field:t.subject,colId:t.subject,hide:!0})}),e[t.subject]=t.subject_type}),delete e.subjects),s.push(e)}),n.gridOptions={defaultColDef:{enableValue:!0,enableRowGroup:!0,sortable:!0,filter:!0,resizable:!0},allowContextMenuWithControlKey:!0,sideBar:!0,animateRows:!0,rowGroupPanelShow:"always",sortingOrder:["desc","asc",null],columnDefs:r,rowData:s,enableRangeSelection:!0,onGridReady:function(e){e.api.closeToolPanel();var t=n.gridOptions.rowData.length;n.tableHeight=t<21?25.25*(t+1)+200+"px":"724px"}},a(function(){n.showTable=!0},100)}(n.queryResults)}function i(e){if(e.data&&(e.data.flow_timestamp||e.data.timestamp||e.data.created_datetime||e.data.updated_datetime)){var t=void 0;return e.data.timestamp?t=e.data.timestamp:e.data.flow_timestamp?t=e.data.flow_timestamp:e.data.created_datetime?t=e.data.created_datetime:e.data.updated_datetime&&(t=e.data.updated_datetime),moment(t).format()}}function o(e,t,a){var n=moment(e).valueOf(),r=moment(t).valueOf();return null===n&&null===r?0:null===n?-1:null===r?1:n-r}function s(){n.gridChanged=!0}function l(t){var r={name:"Reset",action:function(){n.gridOptions.columnApi.resetColumnState(),n.gridOptions.columnApi.setPivotMode(!1),n.gridOptions.api.closeToolPanel(),n.gridOptions.suppressAggFuncInHeader=!1,n.gridChanged=!1,a(function(){n.gridOptions.api.sizeColumnsToFit()},100)}},i={name:"Pivot Channels to Columns",action:function(){n.gridOptions.suppressAggFuncInHeader=!0,n.gridOptions.columnApi.setPivotMode(!0),n.gridOptions.columnApi.setPivotColumns(["channel"]),n.gridOptions.columnApi.setRowGroupColumns(["timestamp"]),n.gridOptions.api.sizeColumnsToFit()}},o=["copy","copyWithHeaders","separator","csvExport","excelExport"];return e.gridTableOptions.pivotChannelsToColumns?o.push("separator",i,r):o.push("separator",r),o}e.onUpdate=function(e){n.queryResults=e},e.onDownload=function(){var e,t,a;e="csv",t=n.widget.title,a={skipHeader:!1,skipFooters:!0,fileName:"export.csv"},"csv"===e?(a.fileName="export.csv",t&&(a.fileName=t+"-"+a.fileName),n.gridOptions.api.exportDataAsCsv(a)):"excel"===e&&(a.fileName="export.xlsx",t&&(a.fileName=t+"-"+a.fileName),n.gridOptions.api.exportDataAsExcel(a))}}angular.module("ewx-components-dashboard-widget").controller("DashboardWidgetTableController",e),e.$inject=["$scope","$filter","$timeout"]}(),function(){angular.module("ewx-components-dashboard-widget").directive("dashboardWidgetTable",function(){return{scope:{widget:"=",queryResults:"=",onUpdate:"=",onDownload:"="},replace:!0,restrict:"AE",controller:"DashboardWidgetTableController",controllerAs:"vm",templateUrl:"shared/components/dashboard-widget/table/table.html"}})}(),function(){function e(e,t){var a=this;function n(){a.gridChanged=!0}function r(){a.gridOptions.api.setQuickFilter(a.gridTableFilter)}function i(){var t=e.onClose();t&&t(!0)}e.rule?(a.selectedRule=e.rule,a.userDateTimeFormat="MMM DD, YYYY h:mm:ss a",e.dateTimeFormat&&(a.userDateTimeFormat=e.dateTimeFormat),e.timezone?a.timezone=e.timezone:a.timezone=moment.tz.guess(),function(e){var t=[];e.detectorInfo&&e.detectorInfo.properties&&e.detectorInfo.properties.length>0&&e.detectorInfo.properties.forEach(function(e){var a={key:e.key,value:e.value};t.push(a)});a.gridOptions={defaultColDef:{filter:!0,resizable:!0,sortable:!0},suppressDragLeaveHidesColumns:!0,enableRangeSelection:!0,rowSelection:"multiple",sortingOrder:["asc","desc",null],columnDefs:[{headerName:"Key",field:"key"},{headerName:"Value",field:"value",sort:"asc"}],rowData:t,onGridReady:function(e){e.api.sizeColumnsToFit()},onColumnMoved:n};var r=a.gridOptions.rowData.length;a.rowLength=r,a.tableHeight=r<21?25.25*(r+1)+"px":"600px";a.showTable=!0}(e.rule)):i(),a.onFilterTextBoxChanged=r,a.exportTable=function(e){var t={skipHeader:!1,skipFooters:!0,skipGroups:!0};"csv"===e?(t.fileName=a.selectedRule.function+".csv",a.selectedRule.detectorInfo&&a.selectedRule.detectorInfo.flowId&&(t.fileName="flowId-"+a.selectedRule.detectorInfo.flowId+"-rule-"+a.selectedRule.function+".csv"),a.gridOptions.api.exportDataAsCsv(t)):"excel"===e&&(t.fileName=a.selectedRule.function+".xlsx",a.selectedRule.detectorInfo&&a.selectedRule.detectorInfo.flowId&&(t.fileName="flowId-"+a.selectedRule.detectorInfo.flowId+"-rule-"+a.selectedRule.function+".xlsx"),a.gridOptions.api.exportDataAsExcel(t))},a.resetColumnState=function(){a.gridOptions.columnApi.resetColumnState(),a.gridOptions.api.sizeColumnsToFit(),a.gridChanged=!1},a.resetGridTableFilter=function(){a.gridTableFilter="",r()},a.closeModal=i,angular.element(t).bind("keydown",function(t){27===t.keyCode&&(t.preventDefault(),i(),e.$evalAsync())}),e.$on("$destroy",function(){angular.element(t).unbind("keydown")})}angular.module("ewx-components-flow-metadata").controller("FlowMetadataRuleModalController",e),e.$inject=["$scope","$window"]}(),function(){angular.module("ewx-components-flow-metadata").directive("flowMetadataRuleModal",function(){return{scope:{rule:"=",onClose:"&",dateTimeFormat:"=",timezone:"="},replace:!0,restrict:"AE",controller:"FlowMetadataRuleModalController",controllerAs:"vm",templateUrl:"shared/components/flow-metadata/rule-modal/rule-modal.html",link:function(e){}}})}(),function(){function e(e,t,a,n,r){var i=this;function o(){i.storedSearches.forEach(function(e){e.selected=!1})}function s(t){var a={properties:[{key:"storedsearches",value:JSON.stringify(i.storedSearches)}]};e.updateUserProperties(a).then(function(){t&&l(n("translate")("feedback.messages.deleted"))},function(){c(n("translate")("feedback.messages.error"))})}function l(e,a){t.addMessage({type:a,message:e})}function c(e){l(e,"error")}a.loadSearches&&(i.loadSearches=a.loadSearches),i.deleteSearch=function(e){var t=i.storedSearches.filter(function(t){return t===e});t&&1===t.length&&i.storedSearches.splice(i.storedSearches.indexOf(t[0]),1);s()},i.deleteSearches=function(){i.deletingFiles=!0;for(var e=i.storedSearches.length-1;e>=0;e--)i.storedSearches[e].selected&&i.storedSearches.splice(e,1);s(!0)},i.selectAll=function(){i.storedSearches.forEach(function(e){e.selected=!0})},i.unSelectAll=o,i.cancel=function(){o(),i.loadSearches=null},i.toggleDeleteConfirmation=function(){i.showDeleteConfirmation=!i.showDeleteConfirmation},i.loadSearch=function(e){r.go(r.current,{searchFilters:e.searchFilters,searchOnLoad:!0},{reload:!0})},i.isLoading=!0,i.storedSearches=[],e.getUser(!0).then(function(e){if(i.isLoading=!1,e.properties){var t=e.properties.filter(function(e){return"storedsearches"===e.key.toLowerCase()});t&&t.length>0&&(i.storedSearches=JSON.parse(t[0].value))}},function(){i.isLoading=!1,c(n("translate")("feedback.messages.error"))}),a.$watch("vm.storedSearches",function(){i.storedSearches&&(i.selectedSearchesDetected=!1,i.storedSearches.forEach(function(e){e.selected&&(i.selectedSearchesDetected=!0)}))},!0)}angular.module("ewx-components-tag-search").controller("LoadSearchController",e),e.$inject=["UserService","feedbackService","$scope","$filter","$state"]}(),function(){function e(){return{scope:{loadSearches:"="},bindToController:!0,replace:!0,restrict:"A",controller:"LoadSearchController",controllerAs:"vm",templateUrl:"shared/components/tag-search/load-search/load-search.html"}}angular.module("ewx-components-tag-search").directive("loadSearch",e),e.$inject=[]}(),function(){function e(e,t,a,n){var r=this;function i(e,a){t.addMessage({type:a,message:e})}function o(e){i(e,"error")}a.searchToSave&&(r.searchToSave=a.searchToSave),r.limit=20,r.storedSearchesLimitReached=!1,r.loadingUserProperties=!0,e.getUser(!0).then(function(e){if(r.loadingUserProperties=!1,r.searchesUserProps=[],e.properties){var t=e.properties.filter(function(e){return"storedsearches"===e.key.toLowerCase()});t&&t.length>0&&(r.searchesUserProps=JSON.parse(t[0].value)),r.searchesUserProps.length>=r.limit&&(r.storedSearchesLimitReached=!0)}},function(e){r.loadingUserProperties=!1,o(n("translate")("feedback.messages.error"))}),r.saveSearch=function(){if(r.isSaving=!0,!r.saveSearchform.$valid)return r.isSaving=!1,!1;!function(t){r.searchesUserProps.push(t);var a={properties:[{key:"storedsearches",value:JSON.stringify(r.searchesUserProps)}]};e.updateUserProperties(a).then(function(){r.isSaving=!1,r.searchToSave=null,i(n("translate")("feedback.messages.ok"))},function(e){r.isSaving=!1,o(n("translate")("feedback.messages.error"))})}({name:r.searchProperties.name,description:r.searchProperties.description,searchFilters:r.searchToSave})},r.cancel=function(){r.searchToSave=null}}angular.module("ewx-components-tag-search").controller("SaveSearchController",e),e.$inject=["UserService","feedbackService","$scope","$filter"]}(),function(){function e(){return{scope:{searchToSave:"="},bindToController:!0,replace:!0,restrict:"A",controller:"SaveSearchController",controllerAs:"vm",templateUrl:"shared/components/tag-search/save-search/save-search.html"}}angular.module("ewx-components-tag-search").directive("saveSearch",e),e.$inject=[]}(),function(){function e(e,t,a){return{getWhitelist:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/admin/whitelist/accounts/list",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},whitelistAccounts:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/admin/whitelist/accounts/add",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateWhitelistAccount:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/admin/whitelist/account/update",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getNamespaceList:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/admin/namespace/list",params:n});return i.cancel=function(){r.resolve()},i},getNamespace:function(n){var r=t.defer(),i=t.defer();i.cancel=r;var o={method:"GET",url:a+"/ewx/v1/admin/namespace/get/"+n,data:{id:n},timeout:r.promise};return n?e(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject(),i.cancel=function(){r.resolve()},i.promise},addNamespaceProperties:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/admin/namespace/properties/add",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateNamespaceProperties:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/admin/namespace/properties/update",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},removeNamespaceProperties:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/admin/namespace/properties/remove",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},bootstrapNamespaces:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/admin/namespaces/bootstrap",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-admin").factory("AdminService",e),e.$inject=["$http","$q","restUrl"]}(),angular.module("ewx-services-aggregation",[]),function(){function e(e){return{performAggregation:function(t,a){var n,r=e.defer(),i=new Worker((n=new Blob(["\n                function isFunction(object) {\n                    'use strict';\n                    return typeof(object) === 'function';\n                }\n                \n                onmessage = function (e) {\n                    'use strict';\n                    console.log('Starting with aggregation');\n                \n                    let startTime = new Date();\n\n                    var tableStructure = {\n                        headers: ['Date'],\n                        values: []\n                    };\n\n                    var tableData = {};\n                    \n                    \n                    Object.keys(e.data.dataStructure).forEach(function (key) {\n                        if (!isFunction(e.data.dataStructure[key])) {\n                            var datasource = e.data.dataStructure[key];\n                            Object.keys(datasource).forEach(function (channelId) {\n                                if (!isFunction(datasource[channelId])) {\n                                    var channel = datasource[channelId];\n                                    if (tableStructure.headers.indexOf(channelId) === -1) {\n                                        tableStructure.headers.push(channelId);\n                                    }\n                \n                                    channel.values.forEach(function (value) {\n                                        var parsedIndex = new Date(value[0]);\n                                        var concattedIndex = parsedIndex.getFullYear();\n                                        if (e.data.aggregationFunction === 'DAY') {\n                                            concattedIndex += '-' + ((parsedIndex.getMonth() + 1) < 10 ? '0' : '') + (parsedIndex.getMonth() + 1) + '-' + (parsedIndex.getDate() < 10 ? '0' : '') + parsedIndex.getDate();\n                                        } else if (e.data.aggregationFunction === 'MONTH') {\n                                            concattedIndex += '-' + ((parsedIndex.getMonth() + 1) < 10 ? '0' : '') + (parsedIndex.getMonth() + 1);\n                                        }\n\n                                        if (!tableData[concattedIndex]) {\n                                            tableData[concattedIndex] = {};\n                                        }\n                                        if (!tableData[concattedIndex][channelId]) {\n                                            tableData[concattedIndex][channelId] = 0;\n                                        }\n                                        tableData[concattedIndex][channelId] += value[1]\n                                    });\n                                }\n                            });\n                        }\n                    });\n                    console.log('Intermediate timing', new Date() - startTime, 'ms');\n\n                    Object.keys(tableData).forEach(function (row) {\n                        let rowObject = [row];\n                        for (let i = 1; i < tableStructure.headers.length; i++) {\n                            rowObject.push(null);\n                        }\n                        Object.keys(tableData[row]).forEach(function (cell) {\n                            rowObject[tableStructure.headers.indexOf(cell)] = tableData[row][cell];\n                        });\n\n                        tableStructure.values.push(rowObject);\n                    });\n\n                    let endTime = new Date();\n                    console.log('Aggregating took', endTime - startTime, 'ms');\n                \n                    this.postMessage(tableStructure);\n                };\n            "]),window.URL.createObjectURL(n)));return i.onmessage=function(e){r.resolve(e)},i.postMessage({aggregationFunction:t,dataStructure:a}),r.promise}}}angular.module("ewx-services-aggregation").factory("AggregationService",e),e.$inject=["$q"]}(),function(){function e(e,t,a){return{getBillingAccount:function(){var n=t.defer(),r={method:"GET",url:a+"/ewx/v1/billingaccount/billingaccount",timeout:n.promise},i=e(r);return i.cancel=function(){n.resolve()},i},createBillingAccount:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/billingaccount/billingaccount",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateBillingAccount:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/billingaccount/billingaccount/current",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},whitelistAccount:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/billingaccount/billingaccount/whitelisted",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateWhitelistAccount:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/billingaccount/billingaccount/whitelisted",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-billing").factory("BillingService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getBillingAccounts:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/billingaccount/billingaccounts",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getBillingAccount:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/billingaccount/billingaccount/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateBillingAccount:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/billingaccount/billingaccount/",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getBillingDefaults:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/billingaccount/pricing",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getWhitelist:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/billingaccount/billingaccount/whitelisted",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createNamespace:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/billingaccount/billingaccount/namespace",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-billing-admin").factory("BillingAdminService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{createChannelClassifier:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/channelclassifier/create",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-channel").factory("ChannelService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(){return{clearChart:function(t){var a=e(t);if(!a||!a.series)return!1;for(;a.series.length>0;)a.series[0]&&a.series[0].remove(!1);return!0},addSeriesToChart:function(t,a,n){var r=e(t);if(!r)return!1;a.forEach(function(e){r.addSeries(e,!1)}),n&&r.redraw();return!0},appendSeriesToChart:function(t,a){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e(t);if(!r)return!1;for(var i=function(e){var t=a[e];s=!1;var n=r.get(t.id);n&&(t.data.forEach(function(e){e instanceof Array?-1===n.xData.indexOf(e[0])&&n.addPoint(e):-1===n.xData.indexOf(e.x)&&(n.options.turboThreshold+=1,n.addPoint(e))}),s=!0),s||r.addSeries(t,!1)},o=0;o<a.length;o++){var s;i(o)}n&&r.redraw();return!0},removeSeriesFromChart:function(t,a){var n=e(t);if(!n)return!1;return a.forEach(function(e){n.series.forEach(function(t){t.userOptions.id===e&&t.remove(!1)})}),n.redraw(),!0},getChartObject:e,redrawChart:function(t){var a=e(t);if(!a)return!1;return a.redraw(),!0}};function e(t,a){var n;try{n=t.getChartObj()}catch(n){if(a||(a=0),a<2)return e(t,a+1)}return n}}angular.module("ewx-services-chart").factory("ChartService",e),e.$inject=[]}(),function(){function e(){var e=["invoice"],t=[{key:"US",value:"us"},{key:"EU",value:"eu"},{key:"Asia",value:"asia"}],a=[{name:"best_effort",price:"125",unit:"hour"},{name:"standard",percentage:"15",maxPrice:"2500",unit:"percentage"},{name:"premium",percentage:"25",maxPrice:"5000",unit:"percentage"}],n=[{name:"Afghanistan",code:"AF"},{name:"Åland Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"AndorrA",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Congo, The Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea, Democratic People'S Republic of",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao People'S Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"RWANDA",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia and Montenegro",code:"CS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan, Province of China",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor-Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Viet Nam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}],r=[{symbol:"$",name:"US Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"USD",name_plural:"US dollars"},{symbol:"€",name:"Euro",symbol_native:"€",decimal_digits:2,rounding:0,code:"EUR",name_plural:"euros"},{symbol:"£",name:"British Pound Sterling",symbol_native:"£",decimal_digits:2,rounding:0,code:"GBP",name_plural:"British pounds sterling"}],i=["composite","generate_id","local_to_utc","split","to_date","to_geopoint","to_heartbeat","set_value"],o=["string","number","boolean","timestamp","datasource","flowdesign"],s={name:"sql",keywords:p("and as asc between by count desc distinct from group having in is join like not on or order select union where limit begin"),builtin:p("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),atoms:p("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:p("date time timestamp"),support:p("doubleQuote binaryNumber hexNumber")},l=["minute","hour","day","week","month","year"],c=["en","pt"],u=["daily","weekdays","weekend","saturday","sunday","sunday_holiday","holiday"],d=["low","medium","high"],f=["datasource","flowConfiguration"],m=["keep_all","delete_all_before_write"],g=["datasource","flow_configuration_id","task_type"];function p(e){for(var t={},a=e.split(" "),n=0;n<a.length;++n)t[a[n]]=!0;return t}return{getPaymentMethods:function(){return e},getSaasRegions:function(){return t},getSupportLevels:function(){return a},getCountryByCode:function(e){var t=null;return n.forEach(function(a){a.code===e&&(t=a)}),t},getCountries:function(){return n},getCurrency:function(e){var t=null;return r.forEach(function(a){a.code===e&&(t=a)}),t},getCurrencies:function(){return r},getTcmFunctions:function(){return i},getTcmValueTypes:function(){return o},getEqlHints:function(){return s},getTimeSpan:function(){return l},getAvailableLanguages:function(){return c},getTimeslicePeriodTypes:function(){return u},getPriorities:function(){return d},getTaskSubjects:function(){return f},getDataRetentionPolicies:function(){return m},getTaskAggregationOptions:function(){return g}}}angular.module("ewx-services-constants").factory("ConstantsService",e),e.$inject=[]}(),function(){function e(e,t,a){return{getScoringQualityTimeline:function(n,r,i){var o=t.defer(),s=t.defer();s.cancel=o;var l={method:"GET",url:a+"/ewx/v1/run/metadata/get",params:{filename:"/datalab-engie-test_com/.STAGING/METRICS/4bcb77fe-3092-4bc9-9db4-bbc1008b6e50_qualityScoresTimelineFile.json"},timeout:o.promise};return e(l).then(function(e){var t=JSON.parse(e.data.content),a={data:[],connectNulls:!1,name:"Data Score",color:"rgba(223, 83, 83, .5)"};t.index.forEach(function(e,n){var r=new Date(e),i=t.data[n][t.columns.indexOf("datasourceId")].split(":")[0],o=Number(t.data[n][t.columns.indexOf("qualityScore")]);a.data.push({x:r,name:i,y:o})}),a.boostThreshold=a.data.length+1,a.turboThreshold=a.data.length+1,s.resolve(a)},function(e){s.reject(e)}),s.cancel=function(){o.resolve()},s.promise},getDataFlowTimeline:function(n,r,i,o){var s=t.defer(),l=t.defer();l.cancel=s;var c={method:"GET",url:a+"/ewx/v1/run/metadata/get",params:{filename:"/datalab-engie-test_com/.STAGING/METRICS/4bcb77fe-3092-4bc9-9db4-bbc1008b6e50_originValuesTimeLine.json"},timeout:s.promise};return e(c).then(function(e){var t=JSON.parse(e.data.content),a={data:[],id:"1",connectNulls:!1,name:"Data Flow Activity"},n={data:[],id:"2",connectNulls:!1,name:"Data Lab Activity"},r=[a,n];t.index.forEach(function(e,r){var i=new Date(e);a.data.push([i,Number(t.data[r][t.columns.indexOf("dataflow")])]),n.data.push([i,Number(t.data[r][t.columns.indexOf("datalab")])])}),l.resolve(r)},function(e){l.reject(e)}),l.cancel=function(){s.resolve()},l.promise}}}angular.module("ewx-services-dashboard").factory("DashboardService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{editDataPoints:function(n){var r=t.defer(),i=t.defer();i.cancel=r;var o={method:"POST",url:a+"/ewx/v1/datapoint",data:n,timeout:r.promise};return e(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}),i.cancel=function(){r.resolve()},i.promise}}}angular.module("ewx-services-datapoint").factory("DataPointService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){var n={};return{getDataSource:function(n){var r=t.defer(),i=t.defer();i.cancel=r;var o={method:"GET",url:a+"/ewx/v1/datasource/get/"+n,data:{id:n},timeout:r.promise};return n?e(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject(),i.cancel=function(){r.resolve()},i.promise},getChannelClassifiers:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/datasource/channels/classifier/list",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateChannelClassifier:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/datasource/channels/classifier/update",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getDatasourceClassifiersForNamespace:function(r,i,o){var s=this,l=t.defer();o&&(l=o);var c=t.defer(),u={method:"GET",url:a+"/ewx/v1/datasource/classifiers",params:r,timeout:c.promise};n[i]&&!r.pageToken?l.resolve(n[i]):e(u).then(function(e){if(e&&e.data&&e.data.items){if(n[i]?n[i]=n[i].concat(e.data.items):n[i]=e.data.items,e.data.nextPageToken)return r.pageToken=e.data.nextPageToken,s.getDatasourceClassifiersForNamespace(r,i,l);l.resolve(n[i])}else l.resolve(n[i])},function(){l.reject()});return l.cancel=function(){c.resolve()},l.promise},getDatasourceAndUnitTypes:function(){var n=t.defer(),r={method:"GET",url:a+"/ewx/v1/datasource/channels/classifier/types",timeout:n.promise},i=e(r);return i.cancel=function(){n.resolve()},i},getDatasourceClassifiers:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/datasource/classifiers",params:n});return i.cancel=function(){r.resolve()},i},createDatasourceClassifier:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/datasource/classifier",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateDatasourceClassifier:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/datasource/classifier",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteDatasourceClassifier:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/datasource/classifier?name="+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-datasource").factory("DataSourceService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{startFlow:function(n){var r=a.defer(),i={method:"POST",url:e+"/ewx/v1/run/start",data:n,timeout:r.promise},o=t(i);return o.cancel=function(){r.resolve()},o},getChannelClassifiers:function(n){var r=a.defer(),i={method:"GET",url:e+"/ewx/v1/run/classifiers/list/"+n,params:{limit:99},timeout:r.promise},o=t(i);return o.cancel=function(){r.resolve()},o},approveFlow:function(n){var r=a.defer(),i=a.defer();i.cancel=r;var o={method:"PATCH",url:e+"/ewx/v1/run/approve",data:n,timeout:r.promise};n?t(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject();return i.cancel=function(){r.resolve()},i.promise},adjustFlow:function(n){var r=a.defer(),i=a.defer();i.cancel=r;var o={method:"PATCH",url:e+"/ewx/v1/run/adjust",data:n,timeout:r.promise};n?t(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject();return i.cancel=function(){r.resolve()},i.promise},getAllFlows:function n(r,i,o){var s=a.defer();var l={method:"GET",url:e+"/ewx/v1/run/search",params:{datasourceIds:r.datasourceIds,channelClassifiers:r.channelClassifierIds},timeout:s.promise};r.jobId&&(l.params.jobId=r.jobId);r.limit&&(l.params.limit=r.limit);r.pageToken&&(l.params.pageToken=r.pageToken);i||((i=a.defer()).cancel=function(){s.resolve()});o||(o=0);t(l).then(function(e){e&&e.data&&e.data.more&&e.data.jobId&&!e.data.items?(r.jobId=e.data.jobId,n(r,i,o+1)):i.resolve(e)},function(e){i.reject(e),l.params.jobId=null});return i.promise}}}angular.module("ewx-services-flow").factory("FlowService",e),e.$inject=["restUrl","$http","$q"]}(),function(){function e(e,t,a){return{listDecisionTrees:function(n){var r=e.defer(),i={method:"GET",url:a+"/ewx/v1/decisiontree",params:n,timeout:r.promise},o=t(i);return o.cancel=function(){r.resolve()},o},getDecisionTree:function(n){var r=e.defer(),i={method:"GET",url:a+"/ewx/v1/decisiontree/"+n,timeout:r.promise},o=t(i);return o.promise=function(){r.resolve()},o},deleteDecisionTree:function(n){var r=e.defer(),i={method:"DELETE",url:a+"/ewx/v1/decisiontree/"+n,timeout:r.promise},o=t(i);return o.promise=function(){r.resolve()},o},updateDecisionTree:function(n){var r=e.defer(),i={method:"PUT",url:a+"/ewx/v1/decisiontree/"+n.id,data:n,timeout:r.promise},o=t(i);return o.promise=function(){r.resolve()},o},createDecisionTree:function(n){var r=e.defer(),i={method:"POST",url:a+"/ewx/v1/decisiontree",data:n,timeout:r.promise},o=t(i);return o.promise=function(){r.resolve()},o},testDecisionTree:function(n){var r=e.defer(),i={method:"POST",url:a+"/ewx/v1/decisiontree/"+n.datasourceId,data:n,timeout:r.promise},o=t(i);return o.promise=function(){r.resolve()},o}}}angular.module("ewx-services-decision-tree").factory("DecisionTreeService",e),e.$inject=["$q","$http","restUrl"]}(),function(){function e(e,t,a){return{getFlowConfigList:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/runconfig/list",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getFlowConfig:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/runconfig/get/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateFlowConfig:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/runconfig/update/",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createFlowConfig:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/runconfig/create/",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteFlowConfig:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/runconfig/delete/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-flowconfig").factory("FlowConfigService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getUsers:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/iam/user/list",params:n});return i.cancel=function(){r.resolve()},i},getGroups:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/iam/group/list/",params:n});return i.cancel=function(){r.resolve()},i},getUserById:function(n){var r=t.defer(),i=t.defer();i.cancel=r;var o={method:"GET",url:a+"/ewx/v1/iam/user/get/"+n,data:{id:n},timeout:r.promise};return n?e(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject(),i.cancel=function(){r.resolve()},i.promise},getGroupById:function(n){var r=t.defer(),i=t.defer();i.cancel=r;var o={method:"GET",url:a+"/ewx/v1/iam/group/get/"+n,data:{id:n},timeout:r.promise};return n?e(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject(),i.cancel=function(){r.resolve()},i.promise},createGroup:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/iam/group/create",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateGroup:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/iam/group/update",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteGroup:function(n){var r=t.defer(),i=t.defer();i.cancel=r;var o={method:"DELETE",url:a+"/ewx/v1/iam/group/delete",params:{id:n},timeout:r.promise};return n?e(o).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}):i.reject(),i.cancel=function(){r.resolve()},i.promise},deletePermission:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/iam/group/scope/remove",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},addPermission:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/iam/group/scope/add",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getScopes:function(){var n=t.defer(),r={method:"GET",url:a+"/ewx/v1/iam/scope/list",timeout:n.promise},i=e(r);return i.cancel=function(){n.resolve()},i},addUsersToGroup:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/iam/group/user/add",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},removeUsersFromGroup:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/iam/group/user/remove",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-iam").factory("IamService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getTransformationConfiguration:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/integration/config/get/"+n});return i.cancel=function(){r.resolve()},i},createTransformationConfiguration:function(n){var r=t.defer(),i=e({method:"POST",url:a+"/ewx/v1/integration/config/create",data:n});return i.cancel=function(){r.resolve()},i},updateTransformationConfiguration:function(n){var r=t.defer(),i=e({method:"PUT",url:a+"/ewx/v1/integration/config/update",data:n});return i.cancel=function(){r.resolve()},i},deleteTransformationConfiguration:function(n){var r=t.defer(),i=e({method:"DELETE",url:a+"/ewx/v1/integration/config/delete/"+n});return i.cancel=function(){r.resolve()},i},listTransformationConfigurations:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/integration/config/list",params:n});return i.cancel=function(){r.resolve()},i},publishToPrepare:function(n){var r=t.defer(),i=e({method:"POST",url:a+"/ewx/v1/integration/config/prepare",data:n});return i.cancel=function(){r.resolve()},i},publishToIngest:function(n){var r=t.defer(),i=e({method:"POST",url:a+"/ewx/v1/integration/config/ingest",data:n});return i.cancel=function(){r.resolve()},i}}}angular.module("ewx-services-ingest").factory("IngestService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e){return{logout:function(){e.localStorage.clear(),e.location.href="/logout"}}}angular.module("ewx-services-login").factory("LoginService",e),e.$inject=["$window"]}(),function(){function e(e,t,a){return{getMarketAdapters:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/marketadapter/marketadapters",params:n});return i.cancel=function(){r.resolve()},i},getMarketAdapterDetails:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/marketadapter/marketadapter/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createMarketAdapter:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/marketadapter/marketadapter",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateMarketAdapter:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/marketadapter/marketadapter",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteMarketAdapter:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/marketadapter/marketadapter/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-marketadapter").factory("MarketAdapterService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t){function a(t,a){var n={type:t.type};switch(t.type){case e.DAY:n.value=moment(t.value).add(a,"days").toDate();break;case e.WEEK:n.value=moment(t.value).add(7*a,"days").toDate();break;case e.MONTH:n.value=moment(t.value).add(a,"months").toDate();break;case e.YEAR:n.value=moment(t.value).add(a,"years").toDate();break;default:return}return n}return{getAggregationParameters:function(t){switch(t.type){case e.DAY:return{aggregationInterval:"PER_HOUR_OF_DAY",aggregationPeriod:"IN_DAY_OF_MONTH"};case e.WEEK:return{aggregationInterval:"PER_DAY_OF_WEEK",aggregationPeriod:"IN_WEEK_OF_YEAR"};case e.MONTH:return{aggregationInterval:"PER_DAY_OF_MONTH",aggregationPeriod:"IN_MONTH_OF_YEAR"};case e.YEAR:return{aggregationInterval:"PER_MONTH_OF_YEAR",aggregationPeriod:"IN_YEAR"};default:return}},getPreviousPeriod:function(e){return a(e,-1)},getNextPeriod:function(e){return a(e,1)},navigateDown:function(t,a){var n=angular.copy(t);switch(t.type){case e.DAY:n=null;break;case e.WEEK:var r=moment(t.value),i=r.isoWeek(),o=r.year();n.type=e.DAY,n.value=moment().year(o).isoWeek(i).isoWeekday(a+1).toDate();break;case e.MONTH:var s=a+1;n.value.setDate(s),n.type=e.DAY;break;case e.YEAR:var l=a;n.value.setMonth(l),n.type=e.MONTH;break;default:return}return n},getNormalizedPeriodValue:function(t){var a=moment(t.value);switch(t.type){case e.DAY:a.startOf("day");break;case e.WEEK:a.startOf("isoweek");break;case e.MONTH:a.startOf("month");break;case e.YEAR:a.startOf("year")}return a.toDate()},getPeriodValueString:function(a){switch(a.type){case e.DAY:return t("date")(a.value,"d MMMM yyyy");case e.WEEK:return t("date")(a.value,"Week w yyyy");case e.MONTH:return t("date")(a.value,"MMMM yyyy");case e.YEAR:return t("date")(a.value,"yyyy");default:return}},getMinimumPeriodValueString:function(a){switch(a.type){case e.DAY:return t("date")(a.value,"HH:mm");case e.WEEK:return t("date")(a.value,"d MMM");case e.MONTH:return t("date")(a.value,"d");case e.YEAR:return t("date")(a.value,"MMM");default:return}}}}angular.module("ewx-services-period").factory("PeriodService",e).constant("PERIOD_TYPE",{DAY:"DAY",WEEK:"WEEK",MONTH:"MONTH",YEAR:"YEAR"}),e.$inject=["PERIOD_TYPE","$filter"]}(),function(){function e(e,t,a,n){var r={};return{eqlQuery:function n(s,l,c){var u=t.defer();l||((l=t.defer()).promise.cancel=function(){u.resolve(),c>0&&e.pendingRequests&&e.pendingRequests>0&&e.pendingRequests.forEach(function(e){e.cancel&&e.cancel.resolve()})});s.priority||(s.priority="interactive");var d={method:"GET",url:a+"/ewx/v1/query/execute",params:{limit:s.limit,query:i(s.query),pageToken:s.pageToken,compressed:s.compressed,priority:s.priority},timeout:u.promise,cancel:u};s.validateOnly&&(d.params.validateOnly=s.validateOnly);s.jobId&&(d.params.jobId=s.jobId);s.query&&s.query.length>0&&(s.query=i(s.query),d.params.query=s.query);s.pageToken&&s.pageToken.length>0&&(d.params.pageToken=s.pageToken);c||(c=0);e(d).then(function(e){if(e&&e.data&&e.data.more&&!e.data.reference.jobComplete&&e.data.reference.jobId)s.jobId=e.data.reference.jobId,n(s,l,c+=1);else if(e&&e.data&&e.data.more&&e.data.pageToken&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e&&e.toLowerCase().indexOf("FROM INGEST WHERE".toLowerCase())>-1)return!0;if(e&&e.toLowerCase().indexOf("FROM flows WHERE".toLowerCase())>-1)return!0;return!1}(e.data.reference.query))r[e.data.reference.jobId]?r[e.data.reference.jobId].rows=r[e.data.reference.jobId].rows.concat(e.data.rows):r[e.data.reference.jobId]=e.data,s.pageToken=e.data.pageToken,n(s,l,c);else if(r[e.data.reference.jobId]){var t={data:r[e.data.reference.jobId]};delete r[e.data.reference.jobId],o(l,t)}else o(l,e)},function(e){l.reject(e),d.params.jobId=null});return l.promise},eqlMetadata:function(){var n=t.defer(),r={method:"GET",url:a+"/ewx/v1/query/metadata",timeout:n.promise,cancel:n},i=e(r);return i.cancel=function(){n.resolve()},i}};function i(e){return e?e.replace(/(?:\s\s+|\r\n|\r|\n|\t)/g," ").replace(/\( /g,"(").replace(/ \)/g,")").replace(/\[ /g,"[").replace(/ \]/g,"]").replace(/"/g,'\\"'):e}function o(e,t){try{var a;new Date;try{t.data&&t.data.rows&&t.data.metadata&&t.data.metadata.fields&&t.data.metadata.fields.length>0&&(a=n.genericPayloadParser(t.data.rows,t.data.metadata.fields),t.data.parsed=a)}catch(t){return void e.reject("Failed to parse flow data")}new Date;e.resolve(t.data)}catch(t){e.reject()}}}angular.module("ewx-services-query").factory("QueryService",e),e.$inject=["$http","$q","restUrl","UtilService"]}(),function(){function e(e,t,a){return{getRules:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/rule/list/"+n.ruleType,params:{limit:n.limit,pageToken:n.pageToken},timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getRuleTypes:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/rule/ruletype/list",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getRule:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/rule/get/"+n.name,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},isRuleUpdated:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/rule/updated/"+n.name,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},releaseRule:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/rule/release/"+n.name,timeout:r.promise,data:{}},o=e(i);return o.cancel=function(){r.resolve()},o},prototypeRule:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/rule/prototype/"+n.name,timeout:r.promise,data:{}},o=e(i);return o.cancel=function(){r.resolve()},o},createRule:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/rule/create",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateRule:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/rule/update",timeout:r.promise,data:n},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-rules").factory("RulesService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(){return{shareObject:function(e){return e}}}angular.module("ewx-services-share").factory("ShareService",e),e.$inject=[]}(),function(){function e(e,t,a){return{getSoapEndpoints:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/soap/endpoints",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getSoapEndpoint:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/soap/endpoints/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createSoapEndpoint:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/soap/endpoints",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateSoapEndpoint:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/soap/endpoints",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteSoapEndpoint:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/soap/endpoints/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-soap").factory("SoapService",e),e.$inject=["$http","$q","restUrl"]}(),angular.module("ewx-services-state").service("StateService",function(){var e={};return{save:function(t,a,n){e[t]||(e[t]={});for(var r=0;r<n.length;r++)e[t][n[r]]=a[n[r]]},load:function(t,a,n){if(!e[t])return a;for(var r=0;r<n.length;r++)void 0!==e[t][n[r]]&&(a[n[r]]=e[t][n[r]]);return a}}}),function(){function e(e,t,a){return{searchFiles:function(n,r){var i=t.defer(),o={method:"GET",url:a+"/ewx/v1/storage/files/search",params:n};r&&r.length>0&&(o.params.pageToken=r);var s=e(o);return s.cancel=function(){i.resolve()},s},deleteFile:function(t){return e.get("/files/delete/"+t)},addTags:function(n,r){var i=t.defer(),o=e({method:"GET",url:a+"/ewx/v1/storage/files/tags/add",params:{blobKeyList:n,tags:r}});return o.cancel=function(){i.resolve()},o},deleteTags:function(n,r){var i=t.defer(),o=e({method:"GET",url:a+"/ewx/v1/storage/files/tags/delete",params:{blobKeyList:n,tags:r}});return o.cancel=function(){i.resolve()},o},ingestFiles:function(n,r,i){var o=t.defer(),s=e({method:"POST",url:a+"/ewx/v1/storage/files/ingest",data:{fileLocations:n,marketAdapterId:r,useStreaming:i}});return s.cancel=function(){o.resolve()},s},assignMarketAdapter:function(n,r){var i=t.defer(),o=e({method:"POST",url:a+"/ewx/v1/storage/files/marketadapter/assign",data:{blobKeyList:n,marketAdapterId:r}});return o.cancel=function(){i.resolve()},o}}}angular.module("ewx-services-storage").factory("StorageService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getReleaseNotes:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/system/version/release/history",params:n});return i.cancel=function(){r.resolve()},i}}}angular.module("ewx-services-system").factory("SystemService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{searchTagsNewAPI:function(n,r,i,o){var s=t.defer(),l={method:"GET",url:a+"/ewx/v1/query/execute",params:{limit:"20",query:""},timeout:s.promise};o&&(l.params.namespace=o),n&&n.length>0&&(n=n.replace(/"/g,'\\"'),l.params.query=n),r&&r.length>0&&(l.params.pageToken=r),i&&(l.params.limit=i);var c=e(l);return c.cancel=function(){s.resolve()},c},tagsGetAll:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/tag/get/all",params:{datasourceIds:n},timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},removeTags:function(n){var r=t.defer(),i=e({method:"PATCH",url:a+"/ewx/v1/tag/remove",data:{mutatedTags:n}});return i.cancel=function(){r.resolve()},i},addTags:function(n){var r=t.defer(),i=e({method:"PUT",url:a+"/ewx/v1/tag/add",data:{mutatedTags:n}});return i.cancel=function(){r.resolve()},i},updateTags:function(n){var r=t.defer(),i=e({method:"PATCH",url:a+"/ewx/v1/tag/update",data:{mutatedTags:n}});return i.cancel=function(){r.resolve()},i},tagPropertiesMetaData:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/tag/list",params:{limit:n.limit,pageToken:n.pageToken,jobId:n.jobId},timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-tag").factory("TagService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getTaskFlows:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/flows",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getTaskFlow:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/flows/"+n.id,params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createTaskFlow:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/taskmanagement/flows",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateTaskFlow:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/taskmanagement/flows",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteTaskFlow:function(n){var r={id:n},i=t.defer(),o={method:"DELETE",url:a+"/ewx/v1/taskmanagement/flows",params:r,timeout:i.promise},s=e(o);return s.cancel=function(){i.resolve()},s},linkTasksFlow:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/taskmanagement/link",data:{taskIds:n.taskIds,flowId:n.flowId}},o=e(i);return o.cancel=function(){r.resolve()},o},unlinkTasksFlow:function(n){var r=t.defer(),i=e({method:"DELETE",url:a+"/ewx/v1/taskmanagement/unlink",params:n});return i.cancel=function(){r.resolve()},i},searchTasks:function(n,r){var i=t.defer(),o={method:"GET",url:a+"/ewx/v1/taskmanagement/search",params:n};r&&r.length>0&&(o.params.pageToken=r);var s=e(o);return s.cancel=function(){i.resolve()},s},getTasks:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getTask:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getSubTasks:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/taskitem/list",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getComments:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/comments",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},addComment:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/taskmanagement/"+n.taskId+"/comment",data:{comment:n.comment},timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createTask:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/taskmanagement",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateTask:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/taskmanagement",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateTasks:function(n){var r=t.defer(),i={method:"PATCH",url:a+"/ewx/v1/taskmanagement/multiple",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteTasks:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/taskmanagement",params:{ids:n},timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getStatuses:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/task/status",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},addStatus:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/taskmanagement/task/status",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateStatus:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/taskmanagement/task/status",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getTypes:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/taskmanagement/task/type",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},addType:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/taskmanagement/task/type",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateType:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/taskmanagement/task/type",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-tasks").factory("TasksService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getTimesliceGroups:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/timeslice",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},getTimesliceGroup:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/timeslice/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createTimesliceGroup:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/timeslice",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateTimesliceGroup:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/timeslice",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteTimesliceGroup:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/timeslice/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},assignToChannelClassifier:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/timeslice/assign/channelClassifier",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},assignToDatasourceChannel:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/timeslice/assign/channel",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-timeslice").factory("TimesliceService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(){var e={countries:{AD:{id:"AD",name:"Andorra",timezones:["Europe/Andorra"]},AE:{id:"AE",name:"United Arab Emirates",timezones:["Asia/Dubai"]},AF:{id:"AF",name:"Afghanistan",timezones:["Asia/Kabul"]},AG:{id:"AG",name:"Antigua & Barbuda",timezones:["America/Port_of_Spain"]},AI:{id:"AI",name:"Anguilla",timezones:["America/Port_of_Spain"]},AL:{id:"AL",name:"Albania",timezones:["Europe/Tirane"]},AM:{id:"AM",name:"Armenia",timezones:["Asia/Yerevan"]},AO:{id:"AO",name:"Angola",timezones:["Africa/Lagos"]},AQ:{id:"AQ",name:"Antarctica",timezones:["Antarctica/Rothera","Antarctica/Palmer","Antarctica/Mawson","Antarctica/Davis","Antarctica/Casey","Antarctica/Vostok","Antarctica/DumontDUrville","Antarctica/Syowa","Antarctica/Troll","Pacific/Auckland"]},AR:{id:"AR",name:"Argentina",timezones:["America/Argentina/Buenos_Aires","America/Argentina/Cordoba","America/Argentina/Salta","America/Argentina/Jujuy","America/Argentina/Tucuman","America/Argentina/Catamarca","America/Argentina/La_Rioja","America/Argentina/San_Juan","America/Argentina/Mendoza","America/Argentina/San_Luis","America/Argentina/Rio_Gallegos","America/Argentina/Ushuaia"]},AS:{id:"AS",name:"Samoa (American)",timezones:["Pacific/Pago_Pago"]},AT:{id:"AT",name:"Austria",timezones:["Europe/Vienna"]},AU:{id:"AU",name:"Australia",timezones:["Australia/Lord_Howe","Antarctica/Macquarie","Australia/Hobart","Australia/Currie","Australia/Melbourne","Australia/Sydney","Australia/Broken_Hill","Australia/Brisbane","Australia/Lindeman","Australia/Adelaide","Australia/Darwin","Australia/Perth","Australia/Eucla"]},AW:{id:"AW",name:"Aruba",timezones:["America/Curacao"]},AX:{id:"AX",name:"Åland Islands",timezones:["Europe/Helsinki"]},AZ:{id:"AZ",name:"Azerbaijan",timezones:["Asia/Baku"]},BA:{id:"BA",name:"Bosnia & Herzegovina",timezones:["Europe/Belgrade"]},BB:{id:"BB",name:"Barbados",timezones:["America/Barbados"]},BD:{id:"BD",name:"Bangladesh",timezones:["Asia/Dhaka"]},BE:{id:"BE",name:"Belgium",timezones:["Europe/Brussels"]},BF:{id:"BF",name:"Burkina Faso",timezones:["Africa/Abidjan"]},BG:{id:"BG",name:"Bulgaria",timezones:["Europe/Sofia"]},BH:{id:"BH",name:"Bahrain",timezones:["Asia/Qatar"]},BI:{id:"BI",name:"Burundi",timezones:["Africa/Maputo"]},BJ:{id:"BJ",name:"Benin",timezones:["Africa/Lagos"]},BL:{id:"BL",name:"St Barthelemy",timezones:["America/Port_of_Spain"]},BM:{id:"BM",name:"Bermuda",timezones:["Atlantic/Bermuda"]},BN:{id:"BN",name:"Brunei",timezones:["Asia/Brunei"]},BO:{id:"BO",name:"Bolivia",timezones:["America/La_Paz"]},BQ:{id:"BQ",name:"Caribbean Netherlands",timezones:["America/Curacao"]},BR:{id:"BR",name:"Brazil",timezones:["America/Noronha","America/Belem","America/Fortaleza","America/Recife","America/Araguaina","America/Maceio","America/Bahia","America/Sao_Paulo","America/Campo_Grande","America/Cuiaba","America/Santarem","America/Porto_Velho","America/Boa_Vista","America/Manaus","America/Eirunepe","America/Rio_Branco"]},BS:{id:"BS",name:"Bahamas",timezones:["America/Nassau"]},BT:{id:"BT",name:"Bhutan",timezones:["Asia/Thimphu"]},BW:{id:"BW",name:"Botswana",timezones:["Africa/Maputo"]},BY:{id:"BY",name:"Belarus",timezones:["Europe/Minsk"]},BZ:{id:"BZ",name:"Belize",timezones:["America/Belize"]},CA:{id:"CA",name:"Canada",timezones:["America/St_Johns","America/Halifax","America/Glace_Bay","America/Moncton","America/Goose_Bay","America/Blanc-Sablon","America/Toronto","America/Nipigon","America/Thunder_Bay","America/Iqaluit","America/Pangnirtung","America/Resolute","America/Atikokan","America/Rankin_Inlet","America/Winnipeg","America/Rainy_River","America/Regina","America/Swift_Current","America/Edmonton","America/Cambridge_Bay","America/Yellowknife","America/Inuvik","America/Creston","America/Dawson_Creek","America/Fort_Nelson","America/Vancouver","America/Whitehorse","America/Dawson"]},CC:{id:"CC",name:"Cocos (Keeling) Islands",timezones:["Indian/Cocos"]},CD:{id:"CD",name:"Congo (Dem. Rep.)",timezones:["Africa/Maputo","Africa/Lagos"]},CF:{id:"CF",name:"Central African Rep.",timezones:["Africa/Lagos"]},CG:{id:"CG",name:"Congo (Rep.)",timezones:["Africa/Lagos"]},CH:{id:"CH",name:"Switzerland",timezones:["Europe/Zurich"]},CI:{id:"CI",name:"Côte d'Ivoire",timezones:["Africa/Abidjan"]},CK:{id:"CK",name:"Cook Islands",timezones:["Pacific/Rarotonga"]},CL:{id:"CL",name:"Chile",timezones:["America/Santiago","Pacific/Easter"]},CM:{id:"CM",name:"Cameroon",timezones:["Africa/Lagos"]},CN:{id:"CN",name:"China",timezones:["Asia/Shanghai","Asia/Urumqi"]},CO:{id:"CO",name:"Colombia",timezones:["America/Bogota"]},CR:{id:"CR",name:"Costa Rica",timezones:["America/Costa_Rica"]},CU:{id:"CU",name:"Cuba",timezones:["America/Havana"]},CV:{id:"CV",name:"Cape Verde",timezones:["Atlantic/Cape_Verde"]},CW:{id:"CW",name:"Curacao",timezones:["America/Curacao"]},CX:{id:"CX",name:"Christmas Island",timezones:["Indian/Christmas"]},CY:{id:"CY",name:"Cyprus",timezones:["Asia/Nicosia"]},CZ:{id:"CZ",name:"Czech Republic",timezones:["Europe/Prague"]},DE:{id:"DE",name:"Germany",timezones:["Europe/Zurich","Europe/Berlin"]},DJ:{id:"DJ",name:"Djibouti",timezones:["Africa/Nairobi"]},DK:{id:"DK",name:"Denmark",timezones:["Europe/Copenhagen"]},DM:{id:"DM",name:"Dominica",timezones:["America/Port_of_Spain"]},DO:{id:"DO",name:"Dominican Republic",timezones:["America/Santo_Domingo"]},DZ:{id:"DZ",name:"Algeria",timezones:["Africa/Algiers"]},EC:{id:"EC",name:"Ecuador",timezones:["America/Guayaquil","Pacific/Galapagos"]},EE:{id:"EE",name:"Estonia",timezones:["Europe/Tallinn"]},EG:{id:"EG",name:"Egypt",timezones:["Africa/Cairo"]},EH:{id:"EH",name:"Western Sahara",timezones:["Africa/El_Aaiun"]},ER:{id:"ER",name:"Eritrea",timezones:["Africa/Nairobi"]},ES:{id:"ES",name:"Spain",timezones:["Europe/Madrid","Africa/Ceuta","Atlantic/Canary"]},ET:{id:"ET",name:"Ethiopia",timezones:["Africa/Nairobi"]},FI:{id:"FI",name:"Finland",timezones:["Europe/Helsinki"]},FJ:{id:"FJ",name:"Fiji",timezones:["Pacific/Fiji"]},FK:{id:"FK",name:"Falkland Islands",timezones:["Atlantic/Stanley"]},FM:{id:"FM",name:"Micronesia",timezones:["Pacific/Chuuk","Pacific/Pohnpei","Pacific/Kosrae"]},FO:{id:"FO",name:"Faroe Islands",timezones:["Atlantic/Faroe"]},FR:{id:"FR",name:"France",timezones:["Europe/Paris"]},GA:{id:"GA",name:"Gabon",timezones:["Africa/Lagos"]},GB:{id:"GB",name:"Britain (UK)",timezones:["Europe/London"]},GD:{id:"GD",name:"Grenada",timezones:["America/Port_of_Spain"]},GE:{id:"GE",name:"Georgia",timezones:["Asia/Tbilisi"]},GF:{id:"GF",name:"French Guiana",timezones:["America/Cayenne"]},GG:{id:"GG",name:"Guernsey",timezones:["Europe/London"]},GH:{id:"GH",name:"Ghana",timezones:["Africa/Accra"]},GI:{id:"GI",name:"Gibraltar",timezones:["Europe/Gibraltar"]},GL:{id:"GL",name:"Greenland",timezones:["America/Godthab","America/Danmarkshavn","America/Scoresbysund","America/Thule"]},GM:{id:"GM",name:"Gambia",timezones:["Africa/Abidjan"]},GN:{id:"GN",name:"Guinea",timezones:["Africa/Abidjan"]},GP:{id:"GP",name:"Guadeloupe",timezones:["America/Port_of_Spain"]},GQ:{id:"GQ",name:"Equatorial Guinea",timezones:["Africa/Lagos"]},GR:{id:"GR",name:"Greece",timezones:["Europe/Athens"]},GS:{id:"GS",name:"South Georgia & the South Sandwich Islands",timezones:["Atlantic/South_Georgia"]},GT:{id:"GT",name:"Guatemala",timezones:["America/Guatemala"]},GU:{id:"GU",name:"Guam",timezones:["Pacific/Guam"]},GW:{id:"GW",name:"Guinea-Bissau",timezones:["Africa/Bissau"]},GY:{id:"GY",name:"Guyana",timezones:["America/Guyana"]},HK:{id:"HK",name:"Hong Kong",timezones:["Asia/Hong_Kong"]},HN:{id:"HN",name:"Honduras",timezones:["America/Tegucigalpa"]},HR:{id:"HR",name:"Croatia",timezones:["Europe/Belgrade"]},HT:{id:"HT",name:"Haiti",timezones:["America/Port-au-Prince"]},HU:{id:"HU",name:"Hungary",timezones:["Europe/Budapest"]},ID:{id:"ID",name:"Indonesia",timezones:["Asia/Jakarta","Asia/Pontianak","Asia/Makassar","Asia/Jayapura"]},IE:{id:"IE",name:"Ireland",timezones:["Europe/Dublin"]},IL:{id:"IL",name:"Israel",timezones:["Asia/Jerusalem"]},IM:{id:"IM",name:"Isle of Man",timezones:["Europe/London"]},IN:{id:"IN",name:"India",timezones:["Asia/Kolkata"]},IO:{id:"IO",name:"British Indian Ocean Territory",timezones:["Indian/Chagos"]},IQ:{id:"IQ",name:"Iraq",timezones:["Asia/Baghdad"]},IR:{id:"IR",name:"Iran",timezones:["Asia/Tehran"]},IS:{id:"IS",name:"Iceland",timezones:["Atlantic/Reykjavik"]},IT:{id:"IT",name:"Italy",timezones:["Europe/Rome"]},JE:{id:"JE",name:"Jersey",timezones:["Europe/London"]},JM:{id:"JM",name:"Jamaica",timezones:["America/Jamaica"]},JO:{id:"JO",name:"Jordan",timezones:["Asia/Amman"]},JP:{id:"JP",name:"Japan",timezones:["Asia/Tokyo"]},KE:{id:"KE",name:"Kenya",timezones:["Africa/Nairobi"]},KG:{id:"KG",name:"Kyrgyzstan",timezones:["Asia/Bishkek"]},KH:{id:"KH",name:"Cambodia",timezones:["Asia/Bangkok"]},KI:{id:"KI",name:"Kiribati",timezones:["Pacific/Tarawa","Pacific/Enderbury","Pacific/Kiritimati"]},KM:{id:"KM",name:"Comoros",timezones:["Africa/Nairobi"]},KN:{id:"KN",name:"St Kitts & Nevis",timezones:["America/Port_of_Spain"]},KP:{id:"KP",name:"Korea (North)",timezones:["Asia/Pyongyang"]},KR:{id:"KR",name:"Korea (South)",timezones:["Asia/Seoul"]},KW:{id:"KW",name:"Kuwait",timezones:["Asia/Riyadh"]},KY:{id:"KY",name:"Cayman Islands",timezones:["America/Cayman"]},KZ:{id:"KZ",name:"Kazakhstan",timezones:["Asia/Almaty","Asia/Qyzylorda","Asia/Aqtobe","Asia/Aqtau","Asia/Oral"]},LA:{id:"LA",name:"Laos",timezones:["Asia/Bangkok"]},LB:{id:"LB",name:"Lebanon",timezones:["Asia/Beirut"]},LC:{id:"LC",name:"St Lucia",timezones:["America/Port_of_Spain"]},LI:{id:"LI",name:"Liechtenstein",timezones:["Europe/Zurich"]},LK:{id:"LK",name:"Sri Lanka",timezones:["Asia/Colombo"]},LR:{id:"LR",name:"Liberia",timezones:["Africa/Monrovia"]},LS:{id:"LS",name:"Lesotho",timezones:["Africa/Johannesburg"]},LT:{id:"LT",name:"Lithuania",timezones:["Europe/Vilnius"]},LU:{id:"LU",name:"Luxembourg",timezones:["Europe/Luxembourg"]},LV:{id:"LV",name:"Latvia",timezones:["Europe/Riga"]},LY:{id:"LY",name:"Libya",timezones:["Africa/Tripoli"]},MA:{id:"MA",name:"Morocco",timezones:["Africa/Casablanca"]},MC:{id:"MC",name:"Monaco",timezones:["Europe/Monaco"]},MD:{id:"MD",name:"Moldova",timezones:["Europe/Chisinau"]},ME:{id:"ME",name:"Montenegro",timezones:["Europe/Belgrade"]},MF:{id:"MF",name:"St Martin (French part)",timezones:["America/Port_of_Spain"]},MG:{id:"MG",name:"Madagascar",timezones:["Africa/Nairobi"]},MH:{id:"MH",name:"Marshall Islands",timezones:["Pacific/Majuro","Pacific/Kwajalein"]},MK:{id:"MK",name:"Macedonia",timezones:["Europe/Belgrade"]},ML:{id:"ML",name:"Mali",timezones:["Africa/Abidjan"]},MM:{id:"MM",name:"Myanmar (Burma)",timezones:["Asia/Rangoon"]},MN:{id:"MN",name:"Mongolia",timezones:["Asia/Ulaanbaatar","Asia/Hovd","Asia/Choibalsan"]},MO:{id:"MO",name:"Macau",timezones:["Asia/Macau"]},MP:{id:"MP",name:"Northern Mariana Islands",timezones:["Pacific/Guam"]},MQ:{id:"MQ",name:"Martinique",timezones:["America/Martinique"]},MR:{id:"MR",name:"Mauritania",timezones:["Africa/Abidjan"]},MS:{id:"MS",name:"Montserrat",timezones:["America/Port_of_Spain"]},MT:{id:"MT",name:"Malta",timezones:["Europe/Malta"]},MU:{id:"MU",name:"Mauritius",timezones:["Indian/Mauritius"]},MV:{id:"MV",name:"Maldives",timezones:["Indian/Maldives"]},MW:{id:"MW",name:"Malawi",timezones:["Africa/Maputo"]},MX:{id:"MX",name:"Mexico",timezones:["America/Mexico_City","America/Cancun","America/Merida","America/Monterrey","America/Matamoros","America/Mazatlan","America/Chihuahua","America/Ojinaga","America/Hermosillo","America/Tijuana","America/Santa_Isabel","America/Bahia_Banderas"]},MY:{id:"MY",name:"Malaysia",timezones:["Asia/Kuala_Lumpur","Asia/Kuching"]},MZ:{id:"MZ",name:"Mozambique",timezones:["Africa/Maputo"]},NA:{id:"NA",name:"Namibia",timezones:["Africa/Windhoek"]},NC:{id:"NC",name:"New Caledonia",timezones:["Pacific/Noumea"]},NE:{id:"NE",name:"Niger",timezones:["Africa/Lagos"]},NF:{id:"NF",name:"Norfolk Island",timezones:["Pacific/Norfolk"]},NG:{id:"NG",name:"Nigeria",timezones:["Africa/Lagos"]},NI:{id:"NI",name:"Nicaragua",timezones:["America/Managua"]},NL:{id:"NL",name:"Netherlands",timezones:["Europe/Amsterdam"]},NO:{id:"NO",name:"Norway",timezones:["Europe/Oslo"]},NP:{id:"NP",name:"Nepal",timezones:["Asia/Kathmandu"]},NR:{id:"NR",name:"Nauru",timezones:["Pacific/Nauru"]},NU:{id:"NU",name:"Niue",timezones:["Pacific/Niue"]},NZ:{id:"NZ",name:"New Zealand",timezones:["Pacific/Auckland","Pacific/Chatham"]},OM:{id:"OM",name:"Oman",timezones:["Asia/Dubai"]},PA:{id:"PA",name:"Panama",timezones:["America/Panama"]},PE:{id:"PE",name:"Peru",timezones:["America/Lima"]},PF:{id:"PF",name:"French Polynesia",timezones:["Pacific/Tahiti","Pacific/Marquesas","Pacific/Gambier"]},PG:{id:"PG",name:"Papua New Guinea",timezones:["Pacific/Port_Moresby","Pacific/Bougainville"]},PH:{id:"PH",name:"Philippines",timezones:["Asia/Manila"]},PK:{id:"PK",name:"Pakistan",timezones:["Asia/Karachi"]},PL:{id:"PL",name:"Poland",timezones:["Europe/Warsaw"]},PM:{id:"PM",name:"St Pierre & Miquelon",timezones:["America/Miquelon"]},PN:{id:"PN",name:"Pitcairn",timezones:["Pacific/Pitcairn"]},PR:{id:"PR",name:"Puerto Rico",timezones:["America/Puerto_Rico"]},PS:{id:"PS",name:"Palestine",timezones:["Asia/Gaza","Asia/Hebron"]},PT:{id:"PT",name:"Portugal",timezones:["Europe/Lisbon","Atlantic/Madeira","Atlantic/Azores"]},PW:{id:"PW",name:"Palau",timezones:["Pacific/Palau"]},PY:{id:"PY",name:"Paraguay",timezones:["America/Asuncion"]},QA:{id:"QA",name:"Qatar",timezones:["Asia/Qatar"]},RE:{id:"RE",name:"Réunion",timezones:["Indian/Reunion"]},RO:{id:"RO",name:"Romania",timezones:["Europe/Bucharest"]},RS:{id:"RS",name:"Serbia",timezones:["Europe/Belgrade"]},RU:{id:"RU",name:"Russia",timezones:["Europe/Kaliningrad","Europe/Moscow","Europe/Simferopol","Europe/Volgograd","Europe/Samara","Asia/Yekaterinburg","Asia/Omsk","Asia/Novosibirsk","Asia/Novokuznetsk","Asia/Krasnoyarsk","Asia/Irkutsk","Asia/Chita","Asia/Yakutsk","Asia/Khandyga","Asia/Vladivostok","Asia/Sakhalin","Asia/Ust-Nera","Asia/Magadan","Asia/Srednekolymsk","Asia/Kamchatka","Asia/Anadyr"]},RW:{id:"RW",name:"Rwanda",timezones:["Africa/Maputo"]},SA:{id:"SA",name:"Saudi Arabia",timezones:["Asia/Riyadh"]},SB:{id:"SB",name:"Solomon Islands",timezones:["Pacific/Guadalcanal"]},SC:{id:"SC",name:"Seychelles",timezones:["Indian/Mahe"]},SD:{id:"SD",name:"Sudan",timezones:["Africa/Khartoum"]},SE:{id:"SE",name:"Sweden",timezones:["Europe/Stockholm"]},SG:{id:"SG",name:"Singapore",timezones:["Asia/Singapore"]},SH:{id:"SH",name:"St Helena",timezones:["Africa/Abidjan"]},SI:{id:"SI",name:"Slovenia",timezones:["Europe/Belgrade"]},SJ:{id:"SJ",name:"Svalbard & Jan Mayen",timezones:["Europe/Oslo"]},SK:{id:"SK",name:"Slovakia",timezones:["Europe/Prague"]},SL:{id:"SL",name:"Sierra Leone",timezones:["Africa/Abidjan"]},SM:{id:"SM",name:"San Marino",timezones:["Europe/Rome"]},SN:{id:"SN",name:"Senegal",timezones:["Africa/Abidjan"]},SO:{id:"SO",name:"Somalia",timezones:["Africa/Nairobi"]},SR:{id:"SR",name:"Suriname",timezones:["America/Paramaribo"]},SS:{id:"SS",name:"South Sudan",timezones:["Africa/Khartoum"]},ST:{id:"ST",name:"Sao Tome & Principe",timezones:["Africa/Abidjan"]},SV:{id:"SV",name:"El Salvador",timezones:["America/El_Salvador"]},SX:{id:"SX",name:"St Maarten (Dutch part)",timezones:["America/Curacao"]},SY:{id:"SY",name:"Syria",timezones:["Asia/Damascus"]},SZ:{id:"SZ",name:"Swaziland",timezones:["Africa/Johannesburg"]},TC:{id:"TC",name:"Turks & Caicos Is",timezones:["America/Grand_Turk"]},TD:{id:"TD",name:"Chad",timezones:["Africa/Ndjamena"]},TF:{id:"TF",name:"French Southern & Antarctic Lands",timezones:["Indian/Reunion","Indian/Kerguelen"]},TG:{id:"TG",name:"Togo",timezones:["Africa/Abidjan"]},TH:{id:"TH",name:"Thailand",timezones:["Asia/Bangkok"]},TJ:{id:"TJ",name:"Tajikistan",timezones:["Asia/Dushanbe"]},TK:{id:"TK",name:"Tokelau",timezones:["Pacific/Fakaofo"]},TL:{id:"TL",name:"East Timor",timezones:["Asia/Dili"]},TM:{id:"TM",name:"Turkmenistan",timezones:["Asia/Ashgabat"]},TN:{id:"TN",name:"Tunisia",timezones:["Africa/Tunis"]},TO:{id:"TO",name:"Tonga",timezones:["Pacific/Tongatapu"]},TR:{id:"TR",name:"Turkey",timezones:["Europe/Istanbul"]},TT:{id:"TT",name:"Trinidad & Tobago",timezones:["America/Port_of_Spain"]},TV:{id:"TV",name:"Tuvalu",timezones:["Pacific/Funafuti"]},TW:{id:"TW",name:"Taiwan",timezones:["Asia/Taipei"]},TZ:{id:"TZ",name:"Tanzania",timezones:["Africa/Nairobi"]},UA:{id:"UA",name:"Ukraine",timezones:["Europe/Kiev","Europe/Uzhgorod","Europe/Zaporozhye"]},UG:{id:"UG",name:"Uganda",timezones:["Africa/Nairobi"]},UM:{id:"UM",name:"US minor outlying islands",timezones:["Pacific/Pago_Pago","Pacific/Wake","Pacific/Honolulu"]},US:{id:"US",name:"United States",timezones:["America/New_York","America/Detroit","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Indiana/Indianapolis","America/Indiana/Vincennes","America/Indiana/Winamac","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Vevay","America/Chicago","America/Indiana/Tell_City","America/Indiana/Knox","America/Menominee","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/North_Dakota/Beulah","America/Denver","America/Boise","America/Phoenix","America/Los_Angeles","America/Metlakatla","America/Anchorage","America/Juneau","America/Sitka","America/Yakutat","America/Nome","America/Adak","Pacific/Honolulu"]},UY:{id:"UY",name:"Uruguay",timezones:["America/Montevideo"]},UZ:{id:"UZ",name:"Uzbekistan",timezones:["Asia/Samarkand","Asia/Tashkent"]},VA:{id:"VA",name:"Vatican City",timezones:["Europe/Rome"]},VC:{id:"VC",name:"St Vincent",timezones:["America/Port_of_Spain"]},VE:{id:"VE",name:"Venezuela",timezones:["America/Caracas"]},VG:{id:"VG",name:"Virgin Islands (UK)",timezones:["America/Port_of_Spain"]},VI:{id:"VI",name:"Virgin Islands (US)",timezones:["America/Port_of_Spain"]},VN:{id:"VN",name:"Vietnam",timezones:["Asia/Bangkok","Asia/Ho_Chi_Minh"]},VU:{id:"VU",name:"Vanuatu",timezones:["Pacific/Efate"]},WF:{id:"WF",name:"Wallis & Futuna",timezones:["Pacific/Wallis"]},WS:{id:"WS",name:"Samoa (western)",timezones:["Pacific/Apia"]},YE:{id:"YE",name:"Yemen",timezones:["Asia/Riyadh"]},YT:{id:"YT",name:"Mayotte",timezones:["Africa/Nairobi"]},ZA:{id:"ZA",name:"South Africa",timezones:["Africa/Johannesburg"]},ZM:{id:"ZM",name:"Zambia",timezones:["Africa/Maputo"]},ZW:{id:"ZW",name:"Zimbabwe",timezones:["Africa/Maputo"]},UTC:{id:"UTC",name:"UTC",timezones:["UTC"]}},timezones:{"Europe/Andorra":{name:"Europe/Andorra",utcOffset:60,offsetStr:"+01:00",countries:["AD"]},"Asia/Dubai":{name:"Asia/Dubai",utcOffset:240,offsetStr:"+04:00",countries:["AE","OM"]},"Asia/Kabul":{name:"Asia/Kabul",utcOffset:270,offsetStr:"+04:30",countries:["AF"]},"Europe/Tirane":{name:"Europe/Tirane",utcOffset:60,offsetStr:"+01:00",countries:["AL"]},"Asia/Yerevan":{name:"Asia/Yerevan",utcOffset:240,offsetStr:"+04:00",countries:["AM"]},"Antarctica/Rothera":{name:"Antarctica/Rothera",utcOffset:-180,offsetStr:"-03:00",countries:["AQ"]},"Antarctica/Palmer":{name:"Antarctica/Palmer",utcOffset:-180,offsetStr:"-03:00",countries:["AQ"]},"Antarctica/Mawson":{name:"Antarctica/Mawson",utcOffset:300,offsetStr:"+05:00",countries:["AQ"]},"Antarctica/Davis":{name:"Antarctica/Davis",utcOffset:420,offsetStr:"+07:00",countries:["AQ"]},"Antarctica/Casey":{name:"Antarctica/Casey",utcOffset:480,offsetStr:"+08:00",countries:["AQ"]},"Antarctica/Vostok":{name:"Antarctica/Vostok",utcOffset:360,offsetStr:"+06:00",countries:["AQ"]},"Antarctica/DumontDUrville":{name:"Antarctica/DumontDUrville",utcOffset:600,offsetStr:"+10:00",countries:["AQ"]},"Antarctica/Syowa":{name:"Antarctica/Syowa",utcOffset:180,offsetStr:"+03:00",countries:["AQ"]},"Antarctica/Troll":{name:"Antarctica/Troll",utcOffset:0,offsetStr:"+00:00",countries:["AQ"]},"America/Argentina/Buenos_Aires":{name:"America/Argentina/Buenos_Aires",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Cordoba":{name:"America/Argentina/Cordoba",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Salta":{name:"America/Argentina/Salta",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Jujuy":{name:"America/Argentina/Jujuy",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Tucuman":{name:"America/Argentina/Tucuman",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Catamarca":{name:"America/Argentina/Catamarca",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/La_Rioja":{name:"America/Argentina/La_Rioja",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/San_Juan":{name:"America/Argentina/San_Juan",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Mendoza":{name:"America/Argentina/Mendoza",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/San_Luis":{name:"America/Argentina/San_Luis",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Rio_Gallegos":{name:"America/Argentina/Rio_Gallegos",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"America/Argentina/Ushuaia":{name:"America/Argentina/Ushuaia",utcOffset:-180,offsetStr:"-03:00",countries:["AR"]},"Pacific/Pago_Pago":{name:"Pacific/Pago_Pago",utcOffset:-660,offsetStr:"-11:00",countries:["AS","UM"]},"Europe/Vienna":{name:"Europe/Vienna",utcOffset:60,offsetStr:"+01:00",countries:["AT"]},"Australia/Lord_Howe":{name:"Australia/Lord_Howe",utcOffset:660,offsetStr:"+11:00",countries:["AU"]},"Antarctica/Macquarie":{name:"Antarctica/Macquarie",utcOffset:660,offsetStr:"+11:00",countries:["AU"]},"Australia/Hobart":{name:"Australia/Hobart",utcOffset:660,offsetStr:"+11:00",countries:["AU"]},"Australia/Currie":{name:"Australia/Currie",utcOffset:660,offsetStr:"+11:00",countries:["AU"]},"Australia/Melbourne":{name:"Australia/Melbourne",utcOffset:660,offsetStr:"+11:00",countries:["AU"]},"Australia/Sydney":{name:"Australia/Sydney",utcOffset:660,offsetStr:"+11:00",countries:["AU"]},"Australia/Broken_Hill":{name:"Australia/Broken_Hill",utcOffset:630,offsetStr:"+10:30",countries:["AU"]},"Australia/Brisbane":{name:"Australia/Brisbane",utcOffset:600,offsetStr:"+10:00",countries:["AU"]},"Australia/Lindeman":{name:"Australia/Lindeman",utcOffset:600,offsetStr:"+10:00",countries:["AU"]},"Australia/Adelaide":{name:"Australia/Adelaide",utcOffset:630,offsetStr:"+10:30",countries:["AU"]},"Australia/Darwin":{name:"Australia/Darwin",utcOffset:570,offsetStr:"+09:30",countries:["AU"]},"Australia/Perth":{name:"Australia/Perth",utcOffset:480,offsetStr:"+08:00",countries:["AU"]},"Australia/Eucla":{name:"Australia/Eucla",utcOffset:525,offsetStr:"+08:45",countries:["AU"]},"Asia/Baku":{name:"Asia/Baku",utcOffset:240,offsetStr:"+04:00",countries:["AZ"]},"America/Barbados":{name:"America/Barbados",utcOffset:-240,offsetStr:"-04:00",countries:["BB"]},"Asia/Dhaka":{name:"Asia/Dhaka",utcOffset:360,offsetStr:"+06:00",countries:["BD"]},"Europe/Brussels":{name:"Europe/Brussels",utcOffset:60,offsetStr:"+01:00",countries:["BE"]},"Europe/Sofia":{name:"Europe/Sofia",utcOffset:120,offsetStr:"+02:00",countries:["BG"]},"Atlantic/Bermuda":{name:"Atlantic/Bermuda",utcOffset:-240,offsetStr:"-04:00",countries:["BM"]},"Asia/Brunei":{name:"Asia/Brunei",utcOffset:480,offsetStr:"+08:00",countries:["BN"]},"America/La_Paz":{name:"America/La_Paz",utcOffset:-240,offsetStr:"-04:00",countries:["BO"]},"America/Noronha":{name:"America/Noronha",utcOffset:-120,offsetStr:"-02:00",countries:["BR"]},"America/Belem":{name:"America/Belem",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Fortaleza":{name:"America/Fortaleza",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Recife":{name:"America/Recife",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Araguaina":{name:"America/Araguaina",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Maceio":{name:"America/Maceio",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Bahia":{name:"America/Bahia",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Sao_Paulo":{name:"America/Sao_Paulo",utcOffset:-120,offsetStr:"-02:00",countries:["BR"]},"America/Campo_Grande":{name:"America/Campo_Grande",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Cuiaba":{name:"America/Cuiaba",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Santarem":{name:"America/Santarem",utcOffset:-180,offsetStr:"-03:00",countries:["BR"]},"America/Porto_Velho":{name:"America/Porto_Velho",utcOffset:-240,offsetStr:"-04:00",countries:["BR"]},"America/Boa_Vista":{name:"America/Boa_Vista",utcOffset:-240,offsetStr:"-04:00",countries:["BR"]},"America/Manaus":{name:"America/Manaus",utcOffset:-240,offsetStr:"-04:00",countries:["BR"]},"America/Eirunepe":{name:"America/Eirunepe",utcOffset:-300,offsetStr:"-05:00",countries:["BR"]},"America/Rio_Branco":{name:"America/Rio_Branco",utcOffset:-300,offsetStr:"-05:00",countries:["BR"]},"America/Nassau":{name:"America/Nassau",utcOffset:-300,offsetStr:"-05:00",countries:["BS"]},"Asia/Thimphu":{name:"Asia/Thimphu",utcOffset:360,offsetStr:"+06:00",countries:["BT"]},"Europe/Minsk":{name:"Europe/Minsk",utcOffset:180,offsetStr:"+03:00",countries:["BY"]},"America/Belize":{name:"America/Belize",utcOffset:-360,offsetStr:"-06:00",countries:["BZ"]},"America/St_Johns":{name:"America/St_Johns",utcOffset:-210,offsetStr:"-03:30",countries:["CA"]},"America/Halifax":{name:"America/Halifax",utcOffset:-240,offsetStr:"-04:00",countries:["CA"]},"America/Glace_Bay":{name:"America/Glace_Bay",utcOffset:-240,offsetStr:"-04:00",countries:["CA"]},"America/Moncton":{name:"America/Moncton",utcOffset:-240,offsetStr:"-04:00",countries:["CA"]},"America/Goose_Bay":{name:"America/Goose_Bay",utcOffset:-240,offsetStr:"-04:00",countries:["CA"]},"America/Blanc-Sablon":{name:"America/Blanc-Sablon",utcOffset:-240,offsetStr:"-04:00",countries:["CA"]},"America/Toronto":{name:"America/Toronto",utcOffset:-300,offsetStr:"-05:00",countries:["CA"]},"America/Nipigon":{name:"America/Nipigon",utcOffset:-300,offsetStr:"-05:00",countries:["CA"]},"America/Thunder_Bay":{name:"America/Thunder_Bay",utcOffset:-300,offsetStr:"-05:00",countries:["CA"]},"America/Iqaluit":{name:"America/Iqaluit",utcOffset:-300,offsetStr:"-05:00",countries:["CA"]},"America/Pangnirtung":{name:"America/Pangnirtung",utcOffset:-300,offsetStr:"-05:00",countries:["CA"]},"America/Resolute":{name:"America/Resolute",utcOffset:-360,offsetStr:"-06:00",countries:["CA"]},"America/Atikokan":{name:"America/Atikokan",utcOffset:-300,offsetStr:"-05:00",countries:["CA"]},"America/Rankin_Inlet":{name:"America/Rankin_Inlet",utcOffset:-360,offsetStr:"-06:00",countries:["CA"]},"America/Winnipeg":{name:"America/Winnipeg",utcOffset:-360,offsetStr:"-06:00",countries:["CA"]},"America/Rainy_River":{name:"America/Rainy_River",utcOffset:-360,offsetStr:"-06:00",countries:["CA"]},"America/Regina":{name:"America/Regina",utcOffset:-360,offsetStr:"-06:00",countries:["CA"]},"America/Swift_Current":{name:"America/Swift_Current",utcOffset:-360,offsetStr:"-06:00",countries:["CA"]},"America/Edmonton":{name:"America/Edmonton",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Cambridge_Bay":{name:"America/Cambridge_Bay",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Yellowknife":{name:"America/Yellowknife",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Inuvik":{name:"America/Inuvik",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Creston":{name:"America/Creston",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Dawson_Creek":{name:"America/Dawson_Creek",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Fort_Nelson":{name:"America/Fort_Nelson",utcOffset:-420,offsetStr:"-07:00",countries:["CA"]},"America/Vancouver":{name:"America/Vancouver",utcOffset:-480,offsetStr:"-08:00",countries:["CA"]},"America/Whitehorse":{name:"America/Whitehorse",utcOffset:-480,offsetStr:"-08:00",countries:["CA"]},"America/Dawson":{name:"America/Dawson",utcOffset:-480,offsetStr:"-08:00",countries:["CA"]},"Indian/Cocos":{name:"Indian/Cocos",utcOffset:390,offsetStr:"+06:30",countries:["CC"]},"Europe/Zurich":{name:"Europe/Zurich",utcOffset:60,offsetStr:"+01:00",countries:["CH","DE","LI"]},"Africa/Abidjan":{name:"Africa/Abidjan",utcOffset:0,offsetStr:"+00:00",countries:["CI","BF","GM","GN","ML","MR","SH","SL","SN","ST","TG"]},"Pacific/Rarotonga":{name:"Pacific/Rarotonga",utcOffset:-600,offsetStr:"-10:00",countries:["CK"]},"America/Santiago":{name:"America/Santiago",utcOffset:-180,offsetStr:"-03:00",countries:["CL"]},"Pacific/Easter":{name:"Pacific/Easter",utcOffset:-300,offsetStr:"-05:00",countries:["CL"]},"Asia/Shanghai":{name:"Asia/Shanghai",utcOffset:480,offsetStr:"+08:00",countries:["CN"]},"Asia/Urumqi":{name:"Asia/Urumqi",utcOffset:360,offsetStr:"+06:00",countries:["CN"]},"America/Bogota":{name:"America/Bogota",utcOffset:-300,offsetStr:"-05:00",countries:["CO"]},"America/Costa_Rica":{name:"America/Costa_Rica",utcOffset:-360,offsetStr:"-06:00",countries:["CR"]},"America/Havana":{name:"America/Havana",utcOffset:-300,offsetStr:"-05:00",countries:["CU"]},"Atlantic/Cape_Verde":{name:"Atlantic/Cape_Verde",utcOffset:-60,offsetStr:"-01:00",countries:["CV"]},"America/Curacao":{name:"America/Curacao",utcOffset:-240,offsetStr:"-04:00",countries:["CW","AW","BQ","SX"]},"Indian/Christmas":{name:"Indian/Christmas",utcOffset:420,offsetStr:"+07:00",countries:["CX"]},"Asia/Nicosia":{name:"Asia/Nicosia",utcOffset:120,offsetStr:"+02:00",countries:["CY"]},"Europe/Prague":{name:"Europe/Prague",utcOffset:60,offsetStr:"+01:00",countries:["CZ","SK"]},"Europe/Berlin":{name:"Europe/Berlin",utcOffset:60,offsetStr:"+01:00",countries:["DE"]},"Europe/Copenhagen":{name:"Europe/Copenhagen",utcOffset:60,offsetStr:"+01:00",countries:["DK"]},"America/Santo_Domingo":{name:"America/Santo_Domingo",utcOffset:-240,offsetStr:"-04:00",countries:["DO"]},"Africa/Algiers":{name:"Africa/Algiers",utcOffset:60,offsetStr:"+01:00",countries:["DZ"]},"America/Guayaquil":{name:"America/Guayaquil",utcOffset:-300,offsetStr:"-05:00",countries:["EC"]},"Pacific/Galapagos":{name:"Pacific/Galapagos",utcOffset:-360,offsetStr:"-06:00",countries:["EC"]},"Europe/Tallinn":{name:"Europe/Tallinn",utcOffset:120,offsetStr:"+02:00",countries:["EE"]},"Africa/Cairo":{name:"Africa/Cairo",utcOffset:120,offsetStr:"+02:00",countries:["EG"]},"Africa/El_Aaiun":{name:"Africa/El_Aaiun",utcOffset:0,offsetStr:"+00:00",countries:["EH"]},"Europe/Madrid":{name:"Europe/Madrid",utcOffset:60,offsetStr:"+01:00",countries:["ES"]},"Africa/Ceuta":{name:"Africa/Ceuta",utcOffset:60,offsetStr:"+01:00",countries:["ES"]},"Atlantic/Canary":{name:"Atlantic/Canary",utcOffset:0,offsetStr:"+00:00",countries:["ES"]},"Europe/Helsinki":{name:"Europe/Helsinki",utcOffset:120,offsetStr:"+02:00",countries:["FI","AX"]},"Pacific/Fiji":{name:"Pacific/Fiji",utcOffset:720,offsetStr:"+12:00",countries:["FJ"]},"Atlantic/Stanley":{name:"Atlantic/Stanley",utcOffset:-180,offsetStr:"-03:00",countries:["FK"]},"Pacific/Chuuk":{name:"Pacific/Chuuk",utcOffset:600,offsetStr:"+10:00",countries:["FM"]},"Pacific/Pohnpei":{name:"Pacific/Pohnpei",utcOffset:660,offsetStr:"+11:00",countries:["FM"]},"Pacific/Kosrae":{name:"Pacific/Kosrae",utcOffset:660,offsetStr:"+11:00",countries:["FM"]},"Atlantic/Faroe":{name:"Atlantic/Faroe",utcOffset:0,offsetStr:"+00:00",countries:["FO"]},"Europe/Paris":{name:"Europe/Paris",utcOffset:60,offsetStr:"+01:00",countries:["FR"]},"Europe/London":{name:"Europe/London",utcOffset:0,offsetStr:"+00:00",countries:["GB","GG","IM","JE"]},"Asia/Tbilisi":{name:"Asia/Tbilisi",utcOffset:240,offsetStr:"+04:00",countries:["GE"]},"America/Cayenne":{name:"America/Cayenne",utcOffset:-180,offsetStr:"-03:00",countries:["GF"]},"Africa/Accra":{name:"Africa/Accra",utcOffset:0,offsetStr:"+00:00",countries:["GH"]},"Europe/Gibraltar":{name:"Europe/Gibraltar",utcOffset:60,offsetStr:"+01:00",countries:["GI"]},"America/Godthab":{name:"America/Godthab",utcOffset:-180,offsetStr:"-03:00",countries:["GL"]},"America/Danmarkshavn":{name:"America/Danmarkshavn",utcOffset:0,offsetStr:"+00:00",countries:["GL"]},"America/Scoresbysund":{name:"America/Scoresbysund",utcOffset:-60,offsetStr:"-01:00",countries:["GL"]},"America/Thule":{name:"America/Thule",utcOffset:-240,offsetStr:"-04:00",countries:["GL"]},"Europe/Athens":{name:"Europe/Athens",utcOffset:120,offsetStr:"+02:00",countries:["GR"]},"Atlantic/South_Georgia":{name:"Atlantic/South_Georgia",utcOffset:-120,offsetStr:"-02:00",countries:["GS"]},"America/Guatemala":{name:"America/Guatemala",utcOffset:-360,offsetStr:"-06:00",countries:["GT"]},"Pacific/Guam":{name:"Pacific/Guam",utcOffset:600,offsetStr:"+10:00",countries:["GU","MP"]},"Africa/Bissau":{name:"Africa/Bissau",utcOffset:0,offsetStr:"+00:00",countries:["GW"]},"America/Guyana":{name:"America/Guyana",utcOffset:-240,offsetStr:"-04:00",countries:["GY"]},"Asia/Hong_Kong":{name:"Asia/Hong_Kong",utcOffset:480,offsetStr:"+08:00",countries:["HK"]},"America/Tegucigalpa":{name:"America/Tegucigalpa",utcOffset:-360,offsetStr:"-06:00",countries:["HN"]},"America/Port-au-Prince":{name:"America/Port-au-Prince",utcOffset:-300,offsetStr:"-05:00",countries:["HT"]},"Europe/Budapest":{name:"Europe/Budapest",utcOffset:60,offsetStr:"+01:00",countries:["HU"]},"Asia/Jakarta":{name:"Asia/Jakarta",utcOffset:420,offsetStr:"+07:00",countries:["ID"]},"Asia/Pontianak":{name:"Asia/Pontianak",utcOffset:420,offsetStr:"+07:00",countries:["ID"]},"Asia/Makassar":{name:"Asia/Makassar",utcOffset:480,offsetStr:"+08:00",countries:["ID"]},"Asia/Jayapura":{name:"Asia/Jayapura",utcOffset:540,offsetStr:"+09:00",countries:["ID"]},"Europe/Dublin":{name:"Europe/Dublin",utcOffset:0,offsetStr:"+00:00",countries:["IE"]},"Asia/Jerusalem":{name:"Asia/Jerusalem",utcOffset:120,offsetStr:"+02:00",countries:["IL"]},"Asia/Kolkata":{name:"Asia/Kolkata",utcOffset:330,offsetStr:"+05:30",countries:["IN"]},"Indian/Chagos":{name:"Indian/Chagos",utcOffset:360,offsetStr:"+06:00",countries:["IO"]},"Asia/Baghdad":{name:"Asia/Baghdad",utcOffset:180,offsetStr:"+03:00",countries:["IQ"]},"Asia/Tehran":{name:"Asia/Tehran",utcOffset:210,offsetStr:"+03:30",countries:["IR"]},"Atlantic/Reykjavik":{name:"Atlantic/Reykjavik",utcOffset:0,offsetStr:"+00:00",countries:["IS"]},"Europe/Rome":{name:"Europe/Rome",utcOffset:60,offsetStr:"+01:00",countries:["IT","SM","VA"]},"America/Jamaica":{name:"America/Jamaica",utcOffset:-300,offsetStr:"-05:00",countries:["JM"]},"Asia/Amman":{name:"Asia/Amman",utcOffset:120,offsetStr:"+02:00",countries:["JO"]},"Asia/Tokyo":{name:"Asia/Tokyo",utcOffset:540,offsetStr:"+09:00",countries:["JP"]},"Africa/Nairobi":{name:"Africa/Nairobi",utcOffset:180,offsetStr:"+03:00",countries:["KE","DJ","ER","ET","KM","MG","SO","TZ","UG","YT"]},"Asia/Bishkek":{name:"Asia/Bishkek",utcOffset:360,offsetStr:"+06:00",countries:["KG"]},"Pacific/Tarawa":{name:"Pacific/Tarawa",utcOffset:720,offsetStr:"+12:00",countries:["KI"]},"Pacific/Enderbury":{name:"Pacific/Enderbury",utcOffset:780,offsetStr:"+13:00",countries:["KI"]},"Pacific/Kiritimati":{name:"Pacific/Kiritimati",utcOffset:840,offsetStr:"+14:00",countries:["KI"]},"Asia/Pyongyang":{name:"Asia/Pyongyang",utcOffset:510,offsetStr:"+08:30",countries:["KP"]},"Asia/Seoul":{name:"Asia/Seoul",utcOffset:540,offsetStr:"+09:00",countries:["KR"]},"America/Cayman":{name:"America/Cayman",utcOffset:-300,offsetStr:"-05:00",countries:["KY"]},"Asia/Almaty":{name:"Asia/Almaty",utcOffset:360,offsetStr:"+06:00",countries:["KZ"]},"Asia/Qyzylorda":{name:"Asia/Qyzylorda",utcOffset:360,offsetStr:"+06:00",countries:["KZ"]},"Asia/Aqtobe":{name:"Asia/Aqtobe",utcOffset:300,offsetStr:"+05:00",countries:["KZ"]},"Asia/Aqtau":{name:"Asia/Aqtau",utcOffset:300,offsetStr:"+05:00",countries:["KZ"]},"Asia/Oral":{name:"Asia/Oral",utcOffset:300,offsetStr:"+05:00",countries:["KZ"]},"Asia/Beirut":{name:"Asia/Beirut",utcOffset:120,offsetStr:"+02:00",countries:["LB"]},"Asia/Colombo":{name:"Asia/Colombo",utcOffset:330,offsetStr:"+05:30",countries:["LK"]},"Africa/Monrovia":{name:"Africa/Monrovia",utcOffset:0,offsetStr:"+00:00",countries:["LR"]},"Europe/Vilnius":{name:"Europe/Vilnius",utcOffset:120,offsetStr:"+02:00",countries:["LT"]},"Europe/Luxembourg":{name:"Europe/Luxembourg",utcOffset:60,offsetStr:"+01:00",countries:["LU"]},"Europe/Riga":{name:"Europe/Riga",utcOffset:120,offsetStr:"+02:00",countries:["LV"]},"Africa/Tripoli":{name:"Africa/Tripoli",utcOffset:120,offsetStr:"+02:00",countries:["LY"]},"Africa/Casablanca":{name:"Africa/Casablanca",utcOffset:0,offsetStr:"+00:00",countries:["MA"]},"Europe/Monaco":{name:"Europe/Monaco",utcOffset:60,offsetStr:"+01:00",countries:["MC"]},"Europe/Chisinau":{name:"Europe/Chisinau",utcOffset:120,offsetStr:"+02:00",countries:["MD"]},"Pacific/Majuro":{name:"Pacific/Majuro",utcOffset:720,offsetStr:"+12:00",countries:["MH"]},"Pacific/Kwajalein":{name:"Pacific/Kwajalein",utcOffset:720,offsetStr:"+12:00",countries:["MH"]},"Asia/Rangoon":{name:"Asia/Rangoon",utcOffset:390,offsetStr:"+06:30",countries:["MM"]},"Asia/Ulaanbaatar":{name:"Asia/Ulaanbaatar",utcOffset:480,offsetStr:"+08:00",countries:["MN"]},"Asia/Hovd":{name:"Asia/Hovd",utcOffset:420,offsetStr:"+07:00",countries:["MN"]},"Asia/Choibalsan":{name:"Asia/Choibalsan",utcOffset:480,offsetStr:"+08:00",countries:["MN"]},"Asia/Macau":{name:"Asia/Macau",utcOffset:480,offsetStr:"+08:00",countries:["MO"]},"America/Martinique":{name:"America/Martinique",utcOffset:-240,offsetStr:"-04:00",countries:["MQ"]},"Europe/Malta":{name:"Europe/Malta",utcOffset:60,offsetStr:"+01:00",countries:["MT"]},"Indian/Mauritius":{name:"Indian/Mauritius",utcOffset:240,offsetStr:"+04:00",countries:["MU"]},"Indian/Maldives":{name:"Indian/Maldives",utcOffset:300,offsetStr:"+05:00",countries:["MV"]},"America/Mexico_City":{name:"America/Mexico_City",utcOffset:-360,offsetStr:"-06:00",countries:["MX"]},"America/Cancun":{name:"America/Cancun",utcOffset:-300,offsetStr:"-05:00",countries:["MX"]},"America/Merida":{name:"America/Merida",utcOffset:-360,offsetStr:"-06:00",countries:["MX"]},"America/Monterrey":{name:"America/Monterrey",utcOffset:-360,offsetStr:"-06:00",countries:["MX"]},"America/Matamoros":{name:"America/Matamoros",utcOffset:-360,offsetStr:"-06:00",countries:["MX"]},"America/Mazatlan":{name:"America/Mazatlan",utcOffset:-420,offsetStr:"-07:00",countries:["MX"]},"America/Chihuahua":{name:"America/Chihuahua",utcOffset:-420,offsetStr:"-07:00",countries:["MX"]},"America/Ojinaga":{name:"America/Ojinaga",utcOffset:-420,offsetStr:"-07:00",countries:["MX"]},"America/Hermosillo":{name:"America/Hermosillo",utcOffset:-420,offsetStr:"-07:00",countries:["MX"]},"America/Tijuana":{name:"America/Tijuana",utcOffset:-480,offsetStr:"-08:00",countries:["MX"]},"America/Santa_Isabel":{name:"America/Santa_Isabel",utcOffset:-480,offsetStr:"-08:00",countries:["MX"]},"America/Bahia_Banderas":{name:"America/Bahia_Banderas",utcOffset:-360,offsetStr:"-06:00",countries:["MX"]},"Asia/Kuala_Lumpur":{name:"Asia/Kuala_Lumpur",utcOffset:480,offsetStr:"+08:00",countries:["MY"]},"Asia/Kuching":{name:"Asia/Kuching",utcOffset:480,offsetStr:"+08:00",countries:["MY"]},"Africa/Maputo":{name:"Africa/Maputo",utcOffset:120,offsetStr:"+02:00",countries:["MZ","BI","BW","CD","MW","RW","ZM","ZW"]},"Africa/Windhoek":{name:"Africa/Windhoek",utcOffset:120,offsetStr:"+02:00",countries:["NA"]},"Pacific/Noumea":{name:"Pacific/Noumea",utcOffset:660,offsetStr:"+11:00",countries:["NC"]},"Pacific/Norfolk":{name:"Pacific/Norfolk",utcOffset:660,offsetStr:"+11:00",countries:["NF"]},"Africa/Lagos":{name:"Africa/Lagos",utcOffset:60,offsetStr:"+01:00",countries:["NG","AO","BJ","CD","CF","CG","CM","GA","GQ","NE"]},"America/Managua":{name:"America/Managua",utcOffset:-360,offsetStr:"-06:00",countries:["NI"]},"Europe/Amsterdam":{name:"Europe/Amsterdam",utcOffset:60,offsetStr:"+01:00",countries:["NL"]},"Europe/Oslo":{name:"Europe/Oslo",utcOffset:60,offsetStr:"+01:00",countries:["NO","SJ"]},"Asia/Kathmandu":{name:"Asia/Kathmandu",utcOffset:345,offsetStr:"+05:45",countries:["NP"]},"Pacific/Nauru":{name:"Pacific/Nauru",utcOffset:720,offsetStr:"+12:00",countries:["NR"]},"Pacific/Niue":{name:"Pacific/Niue",utcOffset:-660,offsetStr:"-11:00",countries:["NU"]},"Pacific/Auckland":{name:"Pacific/Auckland",utcOffset:780,offsetStr:"+13:00",countries:["NZ","AQ"]},"Pacific/Chatham":{name:"Pacific/Chatham",utcOffset:825,offsetStr:"+13:45",countries:["NZ"]},"America/Panama":{name:"America/Panama",utcOffset:-300,offsetStr:"-05:00",countries:["PA"]},"America/Lima":{name:"America/Lima",utcOffset:-300,offsetStr:"-05:00",countries:["PE"]},"Pacific/Tahiti":{name:"Pacific/Tahiti",utcOffset:-600,offsetStr:"-10:00",countries:["PF"]},"Pacific/Marquesas":{name:"Pacific/Marquesas",utcOffset:-570,offsetStr:"-09:30",countries:["PF"]},"Pacific/Gambier":{name:"Pacific/Gambier",utcOffset:-540,offsetStr:"-09:00",countries:["PF"]},"Pacific/Port_Moresby":{name:"Pacific/Port_Moresby",utcOffset:600,offsetStr:"+10:00",countries:["PG"]},"Pacific/Bougainville":{name:"Pacific/Bougainville",utcOffset:660,offsetStr:"+11:00",countries:["PG"]},"Asia/Manila":{name:"Asia/Manila",utcOffset:480,offsetStr:"+08:00",countries:["PH"]},"Asia/Karachi":{name:"Asia/Karachi",utcOffset:300,offsetStr:"+05:00",countries:["PK"]},"Europe/Warsaw":{name:"Europe/Warsaw",utcOffset:60,offsetStr:"+01:00",countries:["PL"]},"America/Miquelon":{name:"America/Miquelon",utcOffset:-180,offsetStr:"-03:00",countries:["PM"]},"Pacific/Pitcairn":{name:"Pacific/Pitcairn",utcOffset:-480,offsetStr:"-08:00",countries:["PN"]},"America/Puerto_Rico":{name:"America/Puerto_Rico",utcOffset:-240,offsetStr:"-04:00",countries:["PR"]},"Asia/Gaza":{name:"Asia/Gaza",utcOffset:120,offsetStr:"+02:00",countries:["PS"]},"Asia/Hebron":{name:"Asia/Hebron",utcOffset:120,offsetStr:"+02:00",countries:["PS"]},"Europe/Lisbon":{name:"Europe/Lisbon",utcOffset:0,offsetStr:"+00:00",countries:["PT"]},"Atlantic/Madeira":{name:"Atlantic/Madeira",utcOffset:0,offsetStr:"+00:00",countries:["PT"]},"Atlantic/Azores":{name:"Atlantic/Azores",utcOffset:-60,offsetStr:"-01:00",countries:["PT"]},"Pacific/Palau":{name:"Pacific/Palau",utcOffset:540,offsetStr:"+09:00",countries:["PW"]},"America/Asuncion":{name:"America/Asuncion",utcOffset:-180,offsetStr:"-03:00",countries:["PY"]},"Asia/Qatar":{name:"Asia/Qatar",utcOffset:180,offsetStr:"+03:00",countries:["QA","BH"]},"Indian/Reunion":{name:"Indian/Reunion",utcOffset:240,offsetStr:"+04:00",countries:["RE","TF"]},"Europe/Bucharest":{name:"Europe/Bucharest",utcOffset:120,offsetStr:"+02:00",countries:["RO"]},"Europe/Belgrade":{name:"Europe/Belgrade",utcOffset:60,offsetStr:"+01:00",countries:["RS","BA","HR","ME","MK","SI"]},"Europe/Kaliningrad":{name:"Europe/Kaliningrad",utcOffset:120,offsetStr:"+02:00",countries:["RU"]},"Europe/Moscow":{name:"Europe/Moscow",utcOffset:180,offsetStr:"+03:00",countries:["RU"]},"Europe/Simferopol":{name:"Europe/Simferopol",utcOffset:180,offsetStr:"+03:00",countries:["RU"]},"Europe/Volgograd":{name:"Europe/Volgograd",utcOffset:180,offsetStr:"+03:00",countries:["RU"]},"Europe/Samara":{name:"Europe/Samara",utcOffset:240,offsetStr:"+04:00",countries:["RU"]},"Asia/Yekaterinburg":{name:"Asia/Yekaterinburg",utcOffset:300,offsetStr:"+05:00",countries:["RU"]},"Asia/Omsk":{name:"Asia/Omsk",utcOffset:360,offsetStr:"+06:00",countries:["RU"]},"Asia/Novosibirsk":{name:"Asia/Novosibirsk",utcOffset:360,offsetStr:"+06:00",countries:["RU"]},"Asia/Novokuznetsk":{name:"Asia/Novokuznetsk",utcOffset:420,offsetStr:"+07:00",countries:["RU"]},"Asia/Krasnoyarsk":{name:"Asia/Krasnoyarsk",utcOffset:420,offsetStr:"+07:00",countries:["RU"]},"Asia/Irkutsk":{name:"Asia/Irkutsk",utcOffset:480,offsetStr:"+08:00",countries:["RU"]},"Asia/Chita":{name:"Asia/Chita",utcOffset:480,offsetStr:"+08:00",countries:["RU"]},"Asia/Yakutsk":{name:"Asia/Yakutsk",utcOffset:540,offsetStr:"+09:00",countries:["RU"]},"Asia/Khandyga":{name:"Asia/Khandyga",utcOffset:540,offsetStr:"+09:00",countries:["RU"]},"Asia/Vladivostok":{name:"Asia/Vladivostok",utcOffset:600,offsetStr:"+10:00",countries:["RU"]},"Asia/Sakhalin":{name:"Asia/Sakhalin",utcOffset:600,offsetStr:"+10:00",countries:["RU"]},"Asia/Ust-Nera":{name:"Asia/Ust-Nera",utcOffset:600,offsetStr:"+10:00",countries:["RU"]},"Asia/Magadan":{name:"Asia/Magadan",utcOffset:600,offsetStr:"+10:00",countries:["RU"]},"Asia/Srednekolymsk":{name:"Asia/Srednekolymsk",utcOffset:660,offsetStr:"+11:00",countries:["RU"]},"Asia/Kamchatka":{name:"Asia/Kamchatka",utcOffset:720,offsetStr:"+12:00",countries:["RU"]},"Asia/Anadyr":{name:"Asia/Anadyr",utcOffset:720,offsetStr:"+12:00",countries:["RU"]},"Asia/Riyadh":{name:"Asia/Riyadh",utcOffset:180,offsetStr:"+03:00",countries:["SA","KW","YE"]},"Pacific/Guadalcanal":{name:"Pacific/Guadalcanal",utcOffset:660,offsetStr:"+11:00",countries:["SB"]},"Indian/Mahe":{name:"Indian/Mahe",utcOffset:240,offsetStr:"+04:00",countries:["SC"]},"Africa/Khartoum":{name:"Africa/Khartoum",utcOffset:180,offsetStr:"+03:00",countries:["SD","SS"]},"Europe/Stockholm":{name:"Europe/Stockholm",utcOffset:60,offsetStr:"+01:00",countries:["SE"]},"Asia/Singapore":{name:"Asia/Singapore",utcOffset:480,offsetStr:"+08:00",countries:["SG"]},"America/Paramaribo":{name:"America/Paramaribo",utcOffset:-180,offsetStr:"-03:00",countries:["SR"]},"America/El_Salvador":{name:"America/El_Salvador",utcOffset:-360,offsetStr:"-06:00",countries:["SV"]},"Asia/Damascus":{name:"Asia/Damascus",utcOffset:120,offsetStr:"+02:00",countries:["SY"]},"America/Grand_Turk":{name:"America/Grand_Turk",utcOffset:-240,offsetStr:"-04:00",countries:["TC"]},"Africa/Ndjamena":{name:"Africa/Ndjamena",utcOffset:60,offsetStr:"+01:00",countries:["TD"]},"Indian/Kerguelen":{name:"Indian/Kerguelen",utcOffset:300,offsetStr:"+05:00",countries:["TF"]},"Asia/Bangkok":{name:"Asia/Bangkok",utcOffset:420,offsetStr:"+07:00",countries:["TH","KH","LA","VN"]},"Asia/Dushanbe":{name:"Asia/Dushanbe",utcOffset:300,offsetStr:"+05:00",countries:["TJ"]},"Pacific/Fakaofo":{name:"Pacific/Fakaofo",utcOffset:780,offsetStr:"+13:00",countries:["TK"]},"Asia/Dili":{name:"Asia/Dili",utcOffset:540,offsetStr:"+09:00",countries:["TL"]},"Asia/Ashgabat":{name:"Asia/Ashgabat",utcOffset:300,offsetStr:"+05:00",countries:["TM"]},"Africa/Tunis":{name:"Africa/Tunis",utcOffset:60,offsetStr:"+01:00",countries:["TN"]},"Pacific/Tongatapu":{name:"Pacific/Tongatapu",utcOffset:780,offsetStr:"+13:00",countries:["TO"]},"Europe/Istanbul":{name:"Europe/Istanbul",utcOffset:120,offsetStr:"+02:00",countries:["TR"]},"America/Port_of_Spain":{name:"America/Port_of_Spain",utcOffset:-240,offsetStr:"-04:00",countries:["TT","AG","AI","BL","DM","GD","GP","KN","LC","MF","MS","VC","VG","VI"]},"Pacific/Funafuti":{name:"Pacific/Funafuti",utcOffset:720,offsetStr:"+12:00",countries:["TV"]},"Asia/Taipei":{name:"Asia/Taipei",utcOffset:480,offsetStr:"+08:00",countries:["TW"]},"Europe/Kiev":{name:"Europe/Kiev",utcOffset:120,offsetStr:"+02:00",countries:["UA"]},"Europe/Uzhgorod":{name:"Europe/Uzhgorod",utcOffset:120,offsetStr:"+02:00",countries:["UA"]},"Europe/Zaporozhye":{name:"Europe/Zaporozhye",utcOffset:120,offsetStr:"+02:00",countries:["UA"]},"Pacific/Wake":{name:"Pacific/Wake",utcOffset:720,offsetStr:"+12:00",countries:["UM"]},"America/New_York":{name:"America/New_York",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Detroit":{name:"America/Detroit",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Kentucky/Louisville":{name:"America/Kentucky/Louisville",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Kentucky/Monticello":{name:"America/Kentucky/Monticello",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Indiana/Indianapolis":{name:"America/Indiana/Indianapolis",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Indiana/Vincennes":{name:"America/Indiana/Vincennes",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Indiana/Winamac":{name:"America/Indiana/Winamac",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Indiana/Marengo":{name:"America/Indiana/Marengo",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Indiana/Petersburg":{name:"America/Indiana/Petersburg",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Indiana/Vevay":{name:"America/Indiana/Vevay",utcOffset:-300,offsetStr:"-05:00",countries:["US"]},"America/Chicago":{name:"America/Chicago",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/Indiana/Tell_City":{name:"America/Indiana/Tell_City",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/Indiana/Knox":{name:"America/Indiana/Knox",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/Menominee":{name:"America/Menominee",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/North_Dakota/Center":{name:"America/North_Dakota/Center",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/North_Dakota/New_Salem":{name:"America/North_Dakota/New_Salem",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/North_Dakota/Beulah":{name:"America/North_Dakota/Beulah",utcOffset:-360,offsetStr:"-06:00",countries:["US"]},"America/Denver":{name:"America/Denver",utcOffset:-420,offsetStr:"-07:00",countries:["US"]},"America/Boise":{name:"America/Boise",utcOffset:-420,offsetStr:"-07:00",countries:["US"]},"America/Phoenix":{name:"America/Phoenix",utcOffset:-420,offsetStr:"-07:00",countries:["US"]},"America/Los_Angeles":{name:"America/Los_Angeles",utcOffset:-480,offsetStr:"-08:00",countries:["US"]},"America/Metlakatla":{name:"America/Metlakatla",utcOffset:-480,offsetStr:"-08:00",countries:["US"]},"America/Anchorage":{name:"America/Anchorage",utcOffset:-540,offsetStr:"-09:00",countries:["US"]},"America/Juneau":{name:"America/Juneau",utcOffset:-540,offsetStr:"-09:00",countries:["US"]},"America/Sitka":{name:"America/Sitka",utcOffset:-540,offsetStr:"-09:00",countries:["US"]},"America/Yakutat":{name:"America/Yakutat",utcOffset:-540,offsetStr:"-09:00",countries:["US"]},"America/Nome":{name:"America/Nome",utcOffset:-540,offsetStr:"-09:00",countries:["US"]},"America/Adak":{name:"America/Adak",utcOffset:-600,offsetStr:"-10:00",countries:["US"]},"Pacific/Honolulu":{name:"Pacific/Honolulu",utcOffset:-600,offsetStr:"-10:00",countries:["US","UM"]},"America/Montevideo":{name:"America/Montevideo",utcOffset:-180,offsetStr:"-03:00",countries:["UY"]},"Asia/Samarkand":{name:"Asia/Samarkand",utcOffset:300,offsetStr:"+05:00",countries:["UZ"]},"Asia/Tashkent":{name:"Asia/Tashkent",utcOffset:300,offsetStr:"+05:00",countries:["UZ"]},"America/Caracas":{name:"America/Caracas",utcOffset:-270,offsetStr:"-04:30",countries:["VE"]},"Asia/Ho_Chi_Minh":{name:"Asia/Ho_Chi_Minh",utcOffset:420,offsetStr:"+07:00",countries:["VN"]},"Pacific/Efate":{name:"Pacific/Efate",utcOffset:660,offsetStr:"+11:00",countries:["VU"]},"Pacific/Wallis":{name:"Pacific/Wallis",utcOffset:720,offsetStr:"+12:00",countries:["WF"]},"Pacific/Apia":{name:"Pacific/Apia",utcOffset:840,offsetStr:"+14:00",countries:["WS"]},"Africa/Johannesburg":{name:"Africa/Johannesburg",utcOffset:120,offsetStr:"+02:00",countries:["ZA","LS","SZ"]},UTC:{name:"UTC",utcOffset:0,offsetStr:"z",countries:["UTC"]}}};return{getTimezones:function(){return e}}}angular.module("ewx-services-timezones").factory("TimezonesService",e),e.$inject=[]}(),function(){function e(e,t,a){return{getTransportAdapters:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/transportadapters",params:n});return i.cancel=function(){r.resolve()},i},getTransportAdapterDetails:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/transportadapters/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createTransportAdapter:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/transportadapters",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateTransportAdapter:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/transportadapters/"+n.id,data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteTransportAdapter:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/transportadapters/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},triggerTransportAdapter:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/transportadapters/"+n+"/trigger",timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-transportadapter").factory("TransportAdapterService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a){return{getTriggers:function(n){var r=t.defer(),i=e({method:"GET",url:a+"/ewx/v1/trigger/list",params:n});return i.cancel=function(){r.resolve()},i},getAvailableTriggers:function(){var n=t.defer(),r=e({method:"GET",url:a+"/ewx/v1/trigger/available/list"});return r.cancel=function(){n.resolve()},r},getTriggerDetails:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/trigger/get/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createTrigger:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/trigger/create",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},updateTrigger:function(n){var r=t.defer(),i={method:"PUT",url:a+"/ewx/v1/trigger/update",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteTrigger:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/trigger/delete/"+n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},executeTrigger:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/trigger/execute/",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-triggers").factory("TriggersService",e),e.$inject=["$http","$q","restUrl"]}(),function(){function e(e,t,a,n){var r=null,i=null,o=!1;return{getUser:function(n){var i=e.defer(),o=e.defer();return i.cancel=function(){o.resolve()},r&&!n?i.resolve(r):t.get(a+"/ewx/v1/user/get").then(function(e){r=e.data,i.resolve(r)},function(){r=null,i.reject()}),i.promise},getUserSettings:function(t){var a=e.defer();return this.getUser(t).then(function(e){if(e.properties){var t=e.properties.filter(function(e){return"usersettings"===e.key.toLowerCase()});t&&t.length>0?a.resolve(JSON.parse(t[0].value)):a.resolve({})}else a.resolve({})},function(e){a.reject(e)}),a.promise},updateUserProperties:function(n){var r=e.defer(),i={method:"PATCH",url:a+"/ewx/v1/user/properties/update",data:n,timeout:r.promise},o=t(i);return o.cancel=function(){r.resolve()},o},removeUserProperties:function(n){var r=e.defer(),i={method:"PATCH",url:a+"/ewx/v1/user/properties/remove",data:n,timeout:r.promise},o=t(i);return o.cancel=function(){r.resolve()},o},getUserScopes:function r(s){s||(s=e.defer());var l=e.defer();s.cancel=function(){l.resolve()};if(o)return n(function(){r(s)},100),s.promise;i?s.resolve(i):(o=!0,t.get(a+"/ewx/v1/user/scopes").then(function(e){i=e.data,s.resolve(i),o=!1},function(){i=null,s.reject(),o=!1}));return s.promise},hasNamespaceProperty:function(e,t){var a=!1;r&&r.namespace&&r.namespace.properties&&r.namespace.properties.forEach(function(n){n.key.toLowerCase()===e.toLowerCase()&&n.value===t&&(a=!0)});return a}}}angular.module("ewx-services-user").factory("UserService",e),e.$inject=["$q","$http","restUrl","$timeout"]}(),function(){function e(e,t,a){return{parseDataFrameJsonFormatToSeriesFormat:function(e){var t={headers:[],series:{}};if(!e.data)return t;for(var a=e.data,n=0;n<a.length;n++){var r=a[n];t.headers.push(r.name),t.series[n]={name:t.headers[n],data:[]},r.values.forEach(function(a,r){if(a||0===a){var i=new Date(e.index.values[r]),o=Number(a);t.series[n].data.push([i,Number(o)])}})}return t},plotChartData:function a(n,r,i,o,s){s||(s=t.defer());i||(i=500);o||(o=0);e(function(){var e=null;try{e=r.getChartObj()}catch(e){}if(!e||!e.series)return o<2?a(n,r,100,o+=1,s):void s.reject("Max retries reached");for(;e.series.length>0;)e&&e.series[0].remove(!1);n.timeSeries&&n.timeSeries.length>0&&n.timeSeries.forEach(function(t){e.addSeries(t,!1)}),n.flagSeries&&n.flagSeries.length>0&&n.flagSeries.forEach(function(t){e.addSeries(t,!1)}),e.redraw();var t=0;n.timeSeries.forEach(function(e){t+=e.data.length}),s.resolve(t)},i,1,!0);return s.promise},getVisibility:function(e){var t=e.toUpperCase();return t.indexOf("FORECAST")>-1||t.indexOf("MERGED")>-1},getColor:function(e){if(e.toUpperCase().indexOf("FORECAST")>-1)return"#72c126";if(e.toUpperCase().indexOf("PRED:")>-1)return"#eecf00";if(e.toUpperCase().indexOf("MERGED")>-1)return"#019beb";if(e.toUpperCase().indexOf("FLAG:")>-1)return"#ff5841";if(e.toUpperCase().indexOf("EDIT:")>-1)return"#fe9500";return"#014e76"},genericPayloadParser:function e(t,a,n){if(t instanceof Array){n||(n=[]);for(var r=0;r<t.length;r++)n.push(e(t[r],a,{}))}else if(t.hasOwnProperty("f")&&t.f instanceof Array&&a instanceof Array){if(t.f.length!==a.length)return n;for(var i=0;i<t.f.length;i++)e(t.f[i],a[i],n)}else if(t.hasOwnProperty("v")&&t.v instanceof Array&&!(a instanceof Array)&&a.field&&a.items)n[a.field]=e(t.v,a.items,[]);else if(t.hasOwnProperty("v")&&t.v&&t.v.hasOwnProperty("f")&&t.v.f&&t.v.f instanceof Array&&a instanceof Array)e(t.v,a,n);else if(t.hasOwnProperty("v")&&a.field)"string"===a.type?n[a.field]=t.v:"record"===a.type?n[a.field]=e(t.v,a.items,{}):"timestamp"===a.type?t.v&&angular.isNumber(t.v)?n[a.field]=1e3*t.v:t.v&&t.v.indexOf("E")>-1?n[a.field]=1e3*parseFloat(t.v):t.v?n[a.field]=new Date(t.v):n[a.field]=t.v:"datetime"===a.type||"date"===a.type?t.v?n[a.field]=new Date(t.v):n[a.field]=t.v:"float"===a.type?n[a.field]=parseFloat(t.v):"integer"===a.type?n[a.field]=parseInt(t.v):"boolean"===a.type&&(n[a.field]=t.v);else if(t.hasOwnProperty("f")&&t.f&&"record"===a.type){n[a.field]=[];for(var o=0;o<t.f.length;o++)n[a.field].push(e(t.f[o],a.items,{}))}return n}}}angular.module("ewx-services-util").factory("UtilService",e),e.$inject=["$interval","$q","$http"]}(),function(){function e(e,t,a){return{getVirtualDatasource:function(n){var r=t.defer(),i={method:"GET",url:a+"/ewx/v1/virtualdatasource/find",params:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},createVirtualDatasource:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/virtualdatasource/create",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},deleteVirtualDatasource:function(n){var r=t.defer(),i={method:"DELETE",url:a+"/ewx/v1/virtualdatasource/delete",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o},triggerVirtualDatasource:function(n){var r=t.defer(),i={method:"POST",url:a+"/ewx/v1/virtualdatasource/trigger",data:n,timeout:r.promise},o=e(i);return o.cancel=function(){r.resolve()},o}}}angular.module("ewx-services-virtualdatasource").factory("VirtualDataSourceService",e),e.$inject=["$http","$q","restUrl"]}();